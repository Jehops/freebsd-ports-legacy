--- Makefile.orig	Thu Dec 20 19:16:25 2001
+++ Makefile	Sun Dec 30 11:43:57 2001
@@ -1,26 +1,26 @@
-INSTDIR   = /usr/local
+INSTDIR   = ${PREFIX}
 OBJS      = src/expatls.o src/events.o src/node.o src/dom.o src/msgno.o src/stack.o
 LIBNAME   = domc
-SONAME    = lib$(LIBNAME).so.0.5.8
-SOVERSION = lib$(LIBNAME).so.0.5
+SONAME    = lib$(LIBNAME).so.${SHLIB_MAJOR}
+SOVERSION = lib$(LIBNAME).so.${SHLIB_MAJOR}
 
 all: lib$(LIBNAME).so
 
 lib$(LIBNAME).so: $(OBJS)
-	gcc -Wall -shared $(OBJS) -lc -Wl,-soname -Wl,$(SOVERSION) -o $(SONAME)
+	${CC} ${CFLAGS} -shared $(OBJS) -Wl,-soname -Wl,$(SOVERSION) -o $(SONAME) -L${LOCALBASE}/lib -lexpat -Wl,-rpath ${LOCALBASE}/lib
 
 example:
 	$(MAKE) -C examples
 
 install:
-	cp src/dom.h $(INSTDIR)/include/dom.h
-	cp src/msgno.h $(INSTDIR)/include/msgno.h
-	cp $(SONAME) $(INSTDIR)/lib
-	cd $(INSTDIR)/lib && ln -sf $(SONAME) $(SOVERSION) && ln -sf $(SONAME) lib$(LIBNAME).so
+	${BSD_INSTALL_DATA} src/dom.h $(INSTDIR)/include/dom.h
+	${BSD_INSTALL_DATA} src/msgno.h $(INSTDIR)/include/msgno.h
+	${BSD_INSTALL_DATA} $(SONAME) $(INSTDIR)/lib
+	ln -sf $(SONAME) $(INSTDIR)/lib/lib$(LIBNAME).so
 
 clean:
 	rm $(OBJS) $(SONAME) $(INSTDIR)/include/dom.h $(INSTDIR)/include/msgno.h $(INSTDIR)/lib/$(SONAME) $(INSTDIR)/lib/$(SOVERSION) $(INSTDIR)/lib/lib$(LIBNAME).so
 	if [ -f examples/d5.o ]; then $(MAKE) -C examples clean; fi
 
 .c.o:
-	gcc -Wall -I../include -Isrc -Lsrc -fPIC -DPIC -c -o $*.o $<
+	${CC} ${CFLAGS} -I${LOCALBASE}/include/xml -I../include -Isrc -Lsrc -fPIC -DPIC -c -o $*.o $<
