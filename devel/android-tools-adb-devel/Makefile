# $FreeBSD$

DISTVERSION=	m-preview-1112
DISTVERSIONSUFFIX=	-ge4c1bb5
PORTREVISION=	0
PKGNAMESUFFIX=	-devel

CONFLICTS_INSTALL=	${PORTNAME}-[0-9]*

MASTERDIR=	${.CURDIR}/../android-tools-adb
DISTINFO_FILE=	${.CURDIR}/distinfo
MAKEFILE=	${.CURDIR}/files/Makefile
FILESDIR=	${.CURDIR}/files
PATCHDIR=	${.CURDIR}/files

USES=		compiler:c++11-lib
BUILD_WRKSRC=	${WRKSRC}/adb
INSTALL_WRKSRC=	${BUILD_WRKSRC}
MAKE_ENV=	FILESDIR="${FILESDIR}"
CFLAGS+=	-DADB_REVISION='\"${DISTVERSIONFULL}\"'
ALL_TARGET=	all

OPTIONS_DEFINE=	TEST

TEST_BUILD_DEPENDS=googletest>=1.6.0:${PORTSDIR}/devel/googletest \
		${PYTHON_PKGNAMEPREFIX}mock>0:${PORTSDIR}/devel/py-mock
TEST_USES=	python:2.7,build
TEST_ALL_TARGET=adb_test

pre-install-TEST-on:
	${BUILD_WRKSRC}/adb_test
	PATH=${BUILD_WRKSRC}:${PATH} PYTHONPATH=${WRKSRC} \
		${PYTHON_CMD} ${BUILD_WRKSRC}/test_adb.py
	PATH=${BUILD_WRKSRC}:${PATH} PYTHONPATH=${WRKSRC} \
		${PYTHON_CMD} ${BUILD_WRKSRC}/test_device.py

.include "${MASTERDIR}/Makefile"
