--- GNUmakefile.orig	Tue Jul  8 09:09:30 2003
+++ GNUmakefile	Wed Jul  9 02:04:50 2003
@@ -8,11 +8,7 @@
 
 # Where to install.
 #
-ifeq ($(USER),root)
-		INSTALL_DIR=/usr/local/bin
-else
-		INSTALL_DIR=$(HOME)/bin
-endif
+		INSTALL_DIR=${PREFIX}/bin
 
 INSTALL			= install
 INSTALL_OWNER	=
@@ -74,7 +70,7 @@
 else
 
 ifndef DEBUG
-C_OPTIMIZE = -O2 -finline-functions
+C_OPTIMIZE = ${CFLAGS}
 else
 C_OPTIMIZE = -O
 endif
@@ -145,10 +141,10 @@
 
 # -----	editing the rest should usually be unnecessary ------------------------
 
-CC			= gcc -c
-CC_FLAGS	= -I$(INC_DIR) $(PROF_OPTS) $(C_DEBUG) $(C_OPTIMIZE) $(C_OPTS) $(C_WARNINGS) -pipe `$(GTK_CONFIG) --cflags` `gnome-config --cflags gnomeui`
+#CC			= gcc -c
+CC_FLAGS	= -I$(INC_DIR) $(PROF_OPTS) $(C_DEBUG) $(C_OPTIMIZE) $(C_OPTS) $(C_WARNINGS) `gnome-config --cflags gnomeui`
 LD			= gcc
-LD_FLAGS	+= $(PROF_OPTS) -pipe `$(GTK_CONFIG) --libs` `gnome-config --libs gnomeui`
+LD_FLAGS	+= $(PROF_OPTS) `gnome-config --libs gnomeui`
 C_SRCS		= $(addprefix $(SRC)/,$(C_SRCS_))
 C_OBJS_		= $(C_SRCS_:.c=.o)
 C_OBJS		= $(addprefix $(OUT)/,$(C_OBJS_))
@@ -180,7 +176,7 @@
 		$(LD) -o $(OUT)/hypersrc $(C_OBJS) $(LD_FLAGS) $(LIBS) $(OUT)/libparser.a
 
 $(OUT)/%.o:     $(SRC)/%.c
-		$(CC) -o $@ $(CC_FLAGS) $(subst $(OUT)/,$(SRC)/,$<)
+		$(CC) -c -o $@ $(CC_FLAGS) $(subst $(OUT)/,$(SRC)/,$<)
 
 # -----------------------------------------------------------------------------
 # parser (lex/yacc code that builds func graph/tree)
@@ -218,13 +214,13 @@
 		mv  y.tab.[cho] $(OUT)
 
 $(OUT)/y.tab.o:  $(OUT)/y.tab.c
-		$(CC) -o $@ $(CC_FLAGS_PARSER) $(OUT)/y.tab.c
+		$(CC) -c -o $@ $(CC_FLAGS_PARSER) $(OUT)/y.tab.c
 
 $(OUT)/lex.yy.o:  $(OUT)/lex.yy.c
-		$(CC) -o $@ $(CC_FLAGS_PARSER) $(OUT)/lex.yy.c
+		$(CC) -c -o $@ $(CC_FLAGS_PARSER) $(OUT)/lex.yy.c
 
 $(OUT)/str_heap.o:  $(SRC)/str_heap.c  $(INC_DIR)/str_heap.h
-		$(CC) -o $@ $(CC_FLAGS_PARSER) $(SRC)/str_heap.c
+		$(CC) -c -o $@ $(CC_FLAGS_PARSER) $(SRC)/str_heap.c
 
 # -----------------------------------------------------------------------------
 
@@ -242,10 +238,11 @@
 		rm -f $(INSTALL_DIR)/ctags.pl
 		cat  Hypersrc.pl  \
 		| sed 's|\$hypersrc = "hypersrc"|\$hypersrc = "${INSTALL_DIR}/hypersrc"|'  \
-		| sed 's|\$ctags_pl = "ctags.pl"|\$ctags_pl = "${INSTALL_DIR}/ctags.pl"|'  >  $(INSTALL_DIR)/Hypersrc.pl
+		| sed 's|\$ctags_pl = "ctags.pl"|\$ctags_pl = "${INSTALL_DIR}/ctags.pl"|'  >  $(OUT)/Hypersrc.pl
+		${BSD_INSTALL_SCRIPT}  $(OUT)/Hypersrc.pl  $(INSTALL_DIR)
 		@
-		cp  $(OUT)/hypersrc  $(INSTALL_DIR)
-		cp  ctags.pl  $(INSTALL_DIR)
+		${BSD_INSTALL_PROGRAM}  $(OUT)/hypersrc  $(INSTALL_DIR)
+		${BSD_INSTALL_SCRIPT}  ctags.pl  $(INSTALL_DIR)
 		@
 		chmod  +rx  $(INSTALL_DIR)/hypersrc
 		chmod  +rx  $(INSTALL_DIR)/Hypersrc.pl
