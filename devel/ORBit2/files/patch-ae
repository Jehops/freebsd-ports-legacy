
$FreeBSD$

--- configure.orig	Mon Jan  7 11:09:58 2002
+++ configure	Fri Jan 11 11:51:55 2002
@@ -2151,9 +2151,9 @@
   rm -f conf.glibtest
 
 
-GMODULE_CFLAGS=`glib-config --cflags gmodule`
+GMODULE_CFLAGS=`$GLIB_CONFIG --cflags gmodule`
 
-GMODULE_LIBS=`glib-config --libs gmodule`
+GMODULE_LIBS=`$GLIB_CONFIG --libs gmodule`
 
 
 for ac_prog in 'bison -y' byacc
@@ -3757,37 +3757,30 @@
 fi
 
 
+echo $ac_n "checking how many vectors writev is capable to handle""... $ac_c" 1>&6
+echo "configure:3761: checking how many vectors writev is capable to handle" >&5
 if test "$cross_compiling" = yes; then
-  cat >> confdefs.h <<\EOF
-#define HAVE_LIMITED_WRITEV 1
-EOF
-
+  MAXIOV=16
 else
   cat > conftest.$ac_ext <<EOF
 #line 3768 "configure"
 #include "confdefs.h"
 
-#include <fcntl.h>
+#include <sys/types.h>
 #include <sys/uio.h>
-#define NIOVECS 50
+#include <fcntl.h>
+#include <stdio.h>
 int main(int argc, char *argv[])
 {
-	char dumbuf[20] = "\n";
-	struct iovec iovecs[NIOVECS];
-	int i,fd;
-
-	for(i = 0; i < NIOVECS; i++) {
-		iovecs[i].iov_base = dumbuf;
-		iovecs[i].iov_len = 1;
-	}
-
-	fd=open("/dev/null", O_WRONLY);
-	if(fd==-1)
-		return(1);
-
-	if(writev(fd, iovecs, NIOVECS) < 0)
+	FILE *f;
+	int fd, i;
+	static struct iovec iovecs[4097];
+	if ((f = fopen("conftestval", "w")) == NULL || \
+	    (fd = open("/dev/null", O_WRONLY)) < 0)
 		return 1;
-
+	for (i = 1; i < 4098 && writev(fd, iovecs, i) >= 0; i++);
+	fprintf(f, "%d\n", i - 1);
+	fclose(f);
 	close(fd);
 	return 0;
 }
@@ -3795,19 +3788,16 @@
 EOF
 if { (eval echo configure:3797: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
-  :
+  MAXIOV=`cat conftestval`
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -fr conftest*
-  cat >> confdefs.h <<\EOF
-#define HAVE_LIMITED_WRITEV 1
-EOF
-
+  MAXIOV=16
 fi
 rm -fr conftest*
 fi
-
+echo "$ac_t""$MAXIOV" 1>&6
 
 
 #######################
@@ -4740,7 +4730,7 @@
 s%@LIB_WRAP@%$LIB_WRAP%g
 s%@HAVE_HOSTS_ACCESS_TRUE@%$HAVE_HOSTS_ACCESS_TRUE%g
 s%@HAVE_HOSTS_ACCESS_FALSE@%$HAVE_HOSTS_ACCESS_FALSE%g
-s%@HAVE_LIMITED_WRITEV@%$HAVE_LIMITED_WRITEV%g
+s%@MAXIOV@%$MAXIOV%g
 s%@subdirs@%$subdirs%g
 s%@pkglibdir@%$pkglibdir%g
 
@@ -5064,10 +5054,6 @@
       *) # Relative path.
         ac_sub_cache_file="$ac_dots$cache_file" ;;
       esac
-  case "$ac_given_INSTALL" in
-        [/$]*) INSTALL="$ac_given_INSTALL" ;;
-        *) INSTALL="$ac_dots$ac_given_INSTALL" ;;
-        esac
 
       echo "running ${CONFIG_SHELL-/bin/sh} $ac_sub_configure $ac_sub_configure_args --cache-file=$ac_sub_cache_file --srcdir=$ac_sub_srcdir"
       # The eval makes quoting arguments work.
