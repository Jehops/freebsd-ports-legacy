# New ports collection makefile for:	ode
# Date created:				11 Oct 2003
# Whom:					David Yeske <dyeske@yahoo.com>
#
# $FreeBSD$
#

PORTNAME=	ode
PORTVERSION=	0.039
CATEGORIES=	devel
MASTER_SITES=	${MASTER_SITE_SOURCEFORGE}
MASTER_SITE_SUBDIR=	opende
EXTRACT_SUFX=	.tgz

MAINTAINER=	dyeske@yahoo.com
COMMENT=	Articulated rigid body dynamics library

USE_X_PREFIX=	yes
USE_GL=		yes
USE_GMAKE=	yes
USE_REINPLACE=	yes

.include <bsd.port.pre.mk>

.if ${ARCH} == "amd64"
BROKEN=		"Does not build on amd64"
.endif

post-patch:
	@${REINPLACE_CMD} -e \
		's|malloc.h|stdlib.h|g' \
		${WRKSRC}/configurator.c

	@${REINPLACE_CMD} -e \
		's|gcc|${CC}|; \
		s|-fno-rtti||' \
		${WRKSRC}/OPCODE/Makefile

	@${REINPLACE_CMD} -E -e \
		's|^CC.+$$|CC=${CC}|; \
		s|-Wall||g; \
		s|-L/usr/X11/lib|-lXext|; \
		s|-L/usr/lib/X11R6||; \
		s|-L/usr/lib/X11||; \
		s|-L/usr/X11R6/lib|-L${X11BASE}/lib|; \
		s|-fno-rtti||; \
		s|-ffast-math|${CFLAGS} -I${X11BASE}/include|' \
		${WRKSRC}/config/makefile.unix-gcc

do-install:
	@${INSTALL_DATA} ${WRKSRC}/lib/libode.a ${PREFIX}/lib
	@${INSTALL_DATA} ${WRKSRC}/lib/libdrawstuff.a ${PREFIX}/lib
	@${MKDIR} ${PREFIX}/include/ode
	@${INSTALL_DATA} ${WRKSRC}/include/ode/*.h ${PREFIX}/include/ode

.include <bsd.port.post.mk>
