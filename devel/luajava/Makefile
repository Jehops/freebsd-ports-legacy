# Created by: sunghyuk
# $FreeBSD$

PORTNAME=	luajava
PORTVERSION=	1.1
PORTREVISION=	1
CATEGORIES=	devel java
MASTER_SITES=	http://luaforge.net/frs/download.php/2105/

MAINTAINER=	sunghyuk@gmail.com
COMMENT=	Lua scripting tool for Java

USES=		gmake dos2unix
USE_LUA=	5.1
LUA_COMPS=	lua
.if ${USE_LUA} == 5.0
LUA_COMPS+=	compat51
.endif
USE_JAVA=	yes
USE_LDCONFIG=	yes
MAKE_JOBS_UNSAFE=	yes

ALL_TARGET=	run
DOS2UNIX_REGEX=	.*\.*

post-patch:
	@${REINPLACE_CMD} -e 's|%%LUA_DIR%%|${PREFIX}|' ${WRKSRC}/config
	@${REINPLACE_CMD} -e 's|%%LUA_LIBDIR%%|${LUA_LIBDIR}|' ${WRKSRC}/config
	@${REINPLACE_CMD} -e 's|%%LUA_INCDIR%%|${LUA_INCDIR}|' ${WRKSRC}/config
	@${REINPLACE_CMD} -e 's|%%JAVA_HOME%%|${JAVA_HOME}|' ${WRKSRC}/config
	@${REINPLACE_CMD} -e 's|linux|freebsd|' ${WRKSRC}/config

do-install:
	${MKDIR} ${STAGEDIR}${LUA_MODLIBDIR}
	${INSTALL_PROGRAM} ${WRKSRC}/libluajava-1.1.so ${STAGEDIR}${LUA_MODLIBDIR}
	${MKDIR} ${STAGEDIR}${JAVAJARDIR}
	${INSTALL_DATA} ${WRKSRC}/luajava-1.1.jar ${STAGEDIR}${JAVAJARDIR}

post-install:
.if !defined(NOPORTDOCS)
	${MKDIR} ${STAGEDIR}${DOCSDIR}
	(cd ${WRKSRC}/doc/ && ${COPYTREE_SHARE} \* ${STAGEDIR}${DOCSDIR})
.endif

.include <bsd.port.mk>
