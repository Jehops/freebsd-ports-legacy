--- ltmain.sh.orig	Thu Apr 29 15:30:37 1999
+++ ltmain.sh	Sat May 22 13:59:59 1999
@@ -54,7 +54,7 @@
 # Constants.
 PROGRAM=ltmain.sh
 PACKAGE=libtool
-VERSION=1.3
+VERSION=1.3-freebsd-ports
 TIMESTAMP=" (1.385.2.117 1999/04/29 13:07:13)"
 
 default_mode=
@@ -150,6 +150,11 @@
     exit 0
     ;;
 
+  --prefix)
+    echo "$PREFIX"
+    exit 0
+    ;;
+
   --debug)
     echo "$progname: enabling shell trace mode"
     set -x
@@ -928,7 +933,7 @@
 	  continue
 	  ;;
 	release)
-	  release="-$arg"
+	  release="$arg"
 	  prev=
 	  continue
 	  ;;
@@ -981,6 +986,7 @@
 	;;
 
       -avoid-version)
+	build_old_libs=no
 	avoid_version=yes
 	continue
 	;;
@@ -1066,6 +1072,10 @@
 	deplibs="$deplibs $arg"
 	;;
 
+      -?thread)
+	deplibs="$deplibs $arg"
+	;;
+
       -module)
 	module=yes
 	continue
@@ -1763,6 +1773,9 @@
 	*-*-cygwin* | *-*-mingw* | *-*-os2* | *-*-beos*)
 	  # these systems don't actually have a c library (as such)!
 	  ;;
+	*-*-freebsd*)
+	  # FreeBSD doesn't need this...
+	  ;;
 	*)
 	  # Add libc to deplibs on all other systems.
 	  deplibs="$deplibs -lc"
@@ -1785,7 +1798,7 @@
 
       # Now set the variables for building old libraries.
       if test "$build_old_libs" = yes && test "$build_libtool_libs" != convenience ; then
-	oldlibs="$oldlibs $output_objdir/$libname.$libext"
+	oldlibs="$oldlibs $output_objdir/$libname$release.$libext"
 
 	# Transform .lo files to .o files.
 	oldobjs="$objs "`$echo "X$libobjs" | $SP2NL | $Xsed -e '/\.'${libext}'$/d' -e "$lo2o" | $NL2SP`
@@ -1979,7 +1992,7 @@
 	      echo "*** \`nm' from GNU binutils and a full rebuild may help."
 	    fi
 	    if test "$build_old_libs" = no; then
-	      oldlibs="$output_objdir/$libname.$libext"
+	      oldlibs="$output_objdir/$libname$release.$libext"
 	      build_libtool_libs=module
 	      build_old_libs=yes
 	    else
@@ -2933,7 +2946,7 @@
     case "$output" in
     *.la)
       old_library=
-      test "$build_old_libs" = yes && old_library="$libname.$libext"
+      test "$build_old_libs" = yes && old_library="$libname$release.$libext"
       $show "creating $output"
 
       if test -n "$xrpath"; then
@@ -3230,10 +3243,12 @@
 	fi
 
 	# Install the pseudo-library for information purposes.
-	name=`$echo "X$file" | $Xsed -e 's%^.*/%%'`
-	instname="$dir/$name"i
-	$show "$install_prog $instname $destdir/$name"
-	$run eval "$install_prog $instname $destdir/$name" || exit $?
+	if test "$install_ltlibs" = yes; then
+	  name=`$echo "X$file" | $Xsed -e 's%^.*/%%'`
+	  instname="$dir/$name"i
+	  $show "$install_prog $instname $destdir/$name"
+	  $run eval "$install_prog $instname $destdir/$name" || exit $?
+	fi
 
 	# Maybe install the static library, too.
 	test -n "$old_library" && staticlibs="$staticlibs $dir/$old_library"
@@ -3322,7 +3337,6 @@
 	    fi
 	    libfile="$libdir/`$echo "X$lib" | $Xsed -e 's%^.*/%%g'`"
 	    if test -n "$libdir" && test ! -f "$libfile"; then
-	      $echo "$modename: warning: \`$lib' has not been installed in \`$libdir'" 1>&2
 	      finalize=no
 	    fi
 	  done
