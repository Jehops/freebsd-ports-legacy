--- sysdeps/freebsd/procmap.c.orig	Thu May 27 13:56:48 1999
+++ sysdeps/freebsd/procmap.c	Wed Dec 27 10:51:50 2000
@@ -35,3 +35,7 @@
 #include <vm/vm_object.h>
+#if (__FreeBSD_version >= 400011)
+#include <vm/vm.h>
+#else
 #include <vm/vm_prot.h>
+#endif
 #include <vm/vm_map.h>
@@ -94,3 +98,2 @@
 	struct inode inode;
-	struct mount mount;
 #endif
@@ -116,3 +119,7 @@
 	if (kvm_read (server->machine.kd,
+#if __FreeBSD_version >= 500013
+		      (unsigned long) pinfo [0].ki_vmspace,
+#else
 		      (unsigned long) pinfo [0].kp_proc.p_vmspace,
+#endif
 		      (char *) &vmspace, sizeof (vmspace)) != sizeof (vmspace))
@@ -253,7 +260,2 @@
 			glibtop_error_io_r (server, "kvm_read (inode)");
-
-		if (kvm_read (server->machine.kd,
-			      (unsigned long) vnode.v_mount,
-			      &mount, sizeof (mount)) != sizeof (mount))
-			glibtop_error_io_r (server, "kvm_read (mount)");
 
--- sysdeps/freebsd/sem_limits.c.orig	Sun Jan  2 16:32:20 2000
+++ sysdeps/freebsd/sem_limits.c	Sun Jan  2 16:35:00 2000
@@ -46,7 +46,7 @@
 
 /* #define KERNEL to get declaration of `struct seminfo'. */
 
-#if defined(__FreeBSD__) || defined(__bsdi__)
+#if defined(__bsdi__) || (__FreeBSD_version < 400011)
 #define KERNEL 1
 #else
 #define _KERNEL 1
--- sysdeps/freebsd/shm_limits.c.orig	Sun Jan  2 16:27:59 2000
+++ sysdeps/freebsd/shm_limits.c	Sun Jan  2 16:35:18 2000
@@ -46,7 +46,7 @@
 
 /* #define KERNEL to get declaration of `struct shminfo'. */
 
-#if defined(__FreeBSD__)  || defined(__bsdi__)
+#if defined(__bsdi__) || (__FreeBSD_version < 400011)
 #define KERNEL 1
 #else
 #define _KERNEL 1
