diff -ru src/tla/libarch/changeset-report.c tla-1.3.4/src/tla/libarch/changeset-report.c
--- src/tla/libarch/changeset-report.c	Wed Jan  4 17:26:08 2006
+++ src/tla/libarch/changeset-report.c	Tue Jul 11 13:03:48 2006
@@ -606,6 +606,10 @@
     {
       int x;
       rel_field key;
+      t_uchar * orig_part_path;
+      t_uchar * orig_path;
+      t_uchar * mod_path;
+
       assoc_table orig_paths = rel_to_assoc (report->orig_files_index,  out_fd, 0);
 
       safe_printfmt ( out_fd, "* modified files\n\n");
@@ -615,9 +619,9 @@
           t_uchar * id2 = str_save(0, rel_peek_str(report->patched_regular_files, x, 0)) /*report->patched_regular_files[x][1]*/;
           key = rel_make_field_str(id);
 
-          t_uchar * orig_part_path = assoc_get_str_taking(orig_paths, key) /*assoc_ref(orig_paths, id)*/;
-          t_uchar * orig_path = file_name_in_vicinity(0, orig_dir, orig_part_path);
-          t_uchar * mod_path = file_name_in_vicinity(0, mod_dir, id2 /*report->patched_regular_files[x][0]*/);
+          orig_part_path = assoc_get_str_taking(orig_paths, key) /*assoc_ref(orig_paths, id)*/;
+          orig_path = file_name_in_vicinity(0, orig_dir, orig_part_path);
+          mod_path = file_name_in_vicinity(0, mod_dir, id2 /*report->patched_regular_files[x][0]*/);
 
           arch_really_invoke_diff ( out_fd, orig_path,  orig_part_path, mod_path, id2 /*report->patched_regular_files[x][0]*/, (char **)opts);
 
diff -ru src/tla/libarch/cmd-commit.c tla-1.3.4/src/tla/libarch/cmd-commit.c
--- src/tla/libarch/cmd-commit.c	Wed Jan  4 17:26:08 2006
+++ src/tla/libarch/cmd-commit.c	Tue Jul 11 13:04:50 2006
@@ -518,6 +518,7 @@
          t_uchar *file_name = 0;
          t_uchar *content_spec = 0;
          t_uchar *s = str_chr_index(revision_file_spec, ':');
+         int fd ;
          
          if (!s)
            {
@@ -528,7 +529,6 @@
          file_name = str_save_n(0, revision_file_spec, s - revision_file_spec);
          content_spec = str_save(0, s + 1); 
          
-         int fd ;
          fd = safe_open(file_name, O_WRONLY | O_CREAT | O_TRUNC, 0666);
          if (!fd)
            {
diff -ru src/tla/libarch/cmd-export.c tla-1.3.4/src/tla/libarch/cmd-export.c
--- src/tla/libarch/cmd-export.c	Wed Jan  4 17:26:08 2006
+++ src/tla/libarch/cmd-export.c	Tue Jul 11 13:05:37 2006
@@ -301,6 +301,7 @@
 	    t_uchar * output_dirname = 0;
         t_uchar * cwd = safe_current_working_directory ();
         t_uchar * absolute_output_dir = 0;
+	int output_dirname_exists;
         if (file_name_is_absolute(output_dir))
            absolute_output_dir = str_save(0, output_dir);
           
@@ -309,7 +310,7 @@
         canonical_dir = file_name_from_directory(0, absolute_output_dir);
         output_dirname = file_name_directory (0, canonical_dir);
         
-	    int output_dirname_exists = safe_access (output_dirname, F_OK) == 0;
+	    output_dirname_exists = safe_access (output_dirname, F_OK) == 0;
 
 	    if (!output_dirname_exists)
 	      {
