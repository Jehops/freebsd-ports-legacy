--- configure.orig	Mon Feb 27 23:35:09 2006
+++ configure	Mon Feb 27 23:35:39 2006
@@ -1057,6 +1057,7 @@ Optional Features:
   --enable-python         build python bindings
   --enable-selinux        build with SELinux support
   --enable-dnotify        build with dnotify support (linux only)
+  --enable-kqueue         build with kqueue support (FreeBSD only)
   --enable-shared[=PKGS]
                           build shared libraries [default=yes]
   --enable-static[=PKGS]
@@ -4533,7 +4534,7 @@ if test "x$GCC" = "xyes"; then
 
   case " $CFLAGS " in
   *[\ \	]-Wfloat-equal[\ \	]*) ;;
-  *) CFLAGS="$CFLAGS -Wfloat-equal" ;;
+  *) CFLAGS="$CFLAGS" ;;
   esac
 
   case " $CFLAGS " in
@@ -27231,6 +27232,31 @@ if test x$have_dnotify = xyes; then
 
 cat >>confdefs.h <<\_ACEOF
 #define DBUS_BUS_ENABLE_DNOTIFY_ON_LINUX 1
+_ACEOF
+
+fi
+
+# kqueue checks
+case "${target_os}" in
+    freebsd*)
+    	# Check whether --enable-kqueue or --disable-kqueue was given.
+    if test "${enable_kqueue+set}" = set; then
+        enableval="$enable_kqueue"
+        enable_kqueue=$enableval
+    else
+        enable_kqueue=auto
+    fi;
+    if test x$enable_kqueue = xno ; then
+	have_kqueue=no;
+    else
+	have_kqueue=yes;
+    fi
+;;
+esac
+if test x$have_kqueue = xyes; then
+
+cat >>confdefs.h <<\_ACEOF
+#define DBUS_BUS_ENABLE_KQUEUE_ON_FREEBSD 1
 _ACEOF
 
 fi
