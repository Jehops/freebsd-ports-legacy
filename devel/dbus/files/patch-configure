--- configure.orig	Wed Jun 14 00:57:48 2006
+++ configure	Wed Jun 14 00:58:20 2006
@@ -1057,6 +1057,7 @@ Optional Features:
   --enable-python         build python bindings
   --enable-selinux        build with SELinux support
   --enable-dnotify        build with dnotify support (linux only)
+  --enable-kqueue         build with kqueue support (FreeBSD only)
   --enable-console-owner-file
                           enable console owner file
   --enable-shared[=PKGS]
@@ -4550,7 +4551,7 @@ if test "x$GCC" = "xyes"; then
 
   case " $CFLAGS " in
   *[\ \	]-Wfloat-equal[\ \	]*) ;;
-  *) CFLAGS="$CFLAGS -Wfloat-equal" ;;
+  *) CFLAGS="$CFLAGS" ;;
   esac
 
   case " $CFLAGS " in
@@ -28332,6 +28333,31 @@ if test x$have_dnotify = xyes; then
 
 cat >>confdefs.h <<\_ACEOF
 #define DBUS_BUS_ENABLE_DNOTIFY_ON_LINUX 1
+_ACEOF
+
+fi
+
+# kqueue checks
+case "${target_os}" in
+    freebsd*)
+    	# Check whether --enable-kqueue or --disable-kqueue was given.
+    if test "${enable_kqueue+set}" = set; then
+        enableval="$enable_kqueue"
+        enable_kqueue=$enableval
+    else
+        enable_kqueue=auto
+    fi;
+    if test x$enable_kqueue = xno ; then
+	have_kqueue=no;
+    else
+	have_kqueue=yes;
+    fi
+;;
+esac
+if test x$have_kqueue = xyes; then
+
+cat >>confdefs.h <<\_ACEOF
+#define DBUS_BUS_ENABLE_KQUEUE_ON_FREEBSD 1
 _ACEOF
 
 fi
