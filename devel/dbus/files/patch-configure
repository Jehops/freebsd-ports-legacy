--- configure.orig	Sun Sep 11 15:30:46 2005
+++ configure	Sun Sep 11 15:30:46 2005
@@ -1059,6 +1059,7 @@
                           optimize for fast installation [default=yes]
   --disable-libtool-lock  avoid locking (might break parallel builds)
   --disable-dnotify         Disable using dnotify on Linux
+  --disable-kqueue          Disable using kqueue on FreeBSD
 
 Optional Packages:
   --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]
@@ -4485,7 +4486,7 @@
 
   case " $CFLAGS " in
   *[\ \	]-Wfloat-equal[\ \	]*) ;;
-  *) CFLAGS="$CFLAGS -Wfloat-equal" ;;
+  *) CFLAGS="$CFLAGS" ;;
   esac
 
   case " $CFLAGS " in
@@ -28088,6 +28089,32 @@
 
 cat >>confdefs.h <<\_ACEOF
 #define DBUS_BUS_ENABLE_DNOTIFY_ON_LINUX 1
+_ACEOF
+
+fi
+
+# kqueue checks
+case "${target_os}" in
+    freebsd*)
+    	# Check whether --enable-kqueue or --disable-kqueue was given.
+if test "${enable_kqueue+set}" = set; then
+    enableval="$enable_kqueue"
+    case "${enableval}" in
+	yes) kqueue=false ;;
+	no) kqueue=true ;;
+	*) { { echo "$as_me:$LINENO: error: bad value ${enableval} for --disable-kqueue" >&5
+echo "$as_me: error: bad value ${enableval} for --disable-kqueue" >&2;}
+   { (exit 1); exit 1; }; } ;;
+        esac
+else
+    kqueue=true
+fi;
+;;
+esac
+if test x$kqueue = xtrue; then
+
+cat >>confdefs.h <<\_ACEOF
+#define DBUS_BUS_ENABLE_KQUEUE_ON_FREEBSD 1
 _ACEOF
 
 fi
