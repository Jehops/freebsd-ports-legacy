#!/bin/sh

if [ -n "${PACKAGE_BUILDING}" ]; then
	exit 0
fi

USER=sfs
GROUP=sfs
UID=171
GID=171
PW=/usr/sbin/pw
COMMENT='Self-Certifying File System'

if [ "$2" = "PRE-INSTALL" ]; then
	echo -n "Checking for group '$GROUP'... "

	if ! ${PW} groupshow $GROUP >/dev/null 2>&1; then
		echo -n "doesn't exist, adding... "
		if ${PW} groupadd $GROUP -g ${GID}; then
			echo "success."
		else
			echo "FAILED!"
			exit 1
		fi
	else
		echo "exists."
	fi

	echo -n "Checking for user '$USER'... "

	if ! ${PW} usershow $USER >/dev/null 2>&1; then
		echo -n "doesn't exist, adding... "
		if ${PW} useradd $USER -u ${UID} -c ${COMMENT} \
                   -d /nonexistent -g $GROUP -s /sbin/nologin -h -; then
			echo "success."
		else
			echo "FAILED!"
			exit 1
		fi
	else
		echo "exists."
	fi
fi

exit 0
