Index: modules/doctools/ChangeLog
==================================================================
--- modules/doctools/ChangeLog
+++ modules/doctools/ChangeLog
@@ -1,10 +1,18 @@
+2013-02-25  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
+
+	* mpformats/_nroff.tcl (nroff_postprocess): Followup fixes to
+	* mpformats/fmt.nroff: bugs found in branch "bug-3601370-td",
+	* pkgIndex.tcl: Missing markup of several nroff directives as
+	* doctools.tcl: such. Version bumped to 1.4.15.
+	* doctools.man:
+
 2013-02-01  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	*
 	* Released and tagged Tcllib 1.15 ========================
-	* 
+	*
 
 2013-01-29  Andreas Kupries  <andreask@activestate.com>
 
 	* doctools.man: Bumped version to 1.4.14 for the
 	* doctools.tcl: last change, see below.
@@ -26,11 +34,11 @@
 
 2011-12-13  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	*
 	* Released and tagged Tcllib 1.14 ========================
-	* 
+	*
 
 2011-11-07  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	* tests/nroff/04: Updated the test outputs to match the changes
 	* tests/nroff/07: introduced by the last two commits, below.
@@ -63,11 +71,11 @@
 
 2011-01-24  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	*
 	* Released and tagged Tcllib 1.13 ========================
-	* 
+	*
 
 2011-01-12  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	* doctools.test: Updated for the changes made per the entry below.
 
@@ -104,11 +112,11 @@
 	* mpformats/fmt.latex:
 	* mpformats/fmt.tmml:
 	* mpformats/fmt.html:
 	* mpformats/fmt.nroff:
 	* mpformats/fmt.null:
-	* doctools.man: 
+	* doctools.man:
 	* pkgIndex.tcl:
 	* doctools.tcl:
 
 2010-06-17  Andreas Kupries  <andreask@activestate.com>
 
@@ -156,12 +164,12 @@
 	* ../../apps/dtplite:
 
 	* docidx.man: Added missing dt_package and restricted 'file'
 	* docidx.tcl: support to doctool::toc and doctools::idx. Versions
 	* doctoc.man: bumped to 1.1.3 and 1.0.4.
-	* doctoc.tcl: 
-	* pkgIndex.tcl: 
+	* doctoc.tcl:
+	* pkgIndex.tcl:
 
 	* mpformats/toc.text: Fixed command names using various textutil
 	* mpformats/idx.text: functionality.
 
 2010-02-05  Andreas Kupries  <andreask@activestate.com>
@@ -173,11 +181,11 @@
 	* pkgIndex.tcl: 1.4.6.
 
 2010-02-04  Andreas Kupries  <andreask@activestate.com>
 
 	* doctools.tcl: Extended with new plugin API command
-	* doctools.man: [dt_mainfile], which always returns 
+	* doctools.man: [dt_mainfile], which always returns
 	* doctools_plugin_apiref.man: the toplevel file currently
 	* pkgIndex.tcl: processed, in contrast to [dt_file] which
 	  returns the currently processed file, which may be included.
 	  Bumped version to 1.4.5.
 
@@ -186,11 +194,11 @@
 	  instead of the toplevel.
 
 2009-12-09  Andreas Kupries  <andreask@activestate.com>
 
 	* doctools.tcl: Bumped version to 1.4.4.
-	* doctools.man: 
+	* doctools.man:
 	* pkgIndex.tcl:
 
 	* mpformats/fmt.html: Extended to support the engine variable
 	* doctools.test: 'raw' (boolean flag). The default is off, causing
 	  the engine to generate the full html, as usual. If set, the
@@ -213,11 +221,11 @@
 
 2009-12-07  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	*
 	* Released and tagged Tcllib 1.12 ========================
-	* 
+	*
 
 2009-07-21  Andreas Kupries  <andreask@activestate.com>
 
 	* doctools.tcl: Fixed @mdgen instructions, added forgotten
 	  ownership reference to man.macros. See ActiveState Bug 83781,
@@ -277,11 +285,11 @@
 	* doctools.tcl: their result instead of generating a
 	* doctools.test: '.so man.macros' command. Stuart Cassoff
 	* doctools_plugin_apiref.man: <stwo@users.sourceforge.net> did the
 	* mpformats/_nroff.tcl: work and provided the patches as part of
 	* mpformats/fmt.nroff: his effort on making a Tcllib OpenBSD port.
-	* mpformats/idx.nroff: 
+	* mpformats/idx.nroff:
 	* mpformats/toc.nroff:
 
 2009-01-28  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	* checker.tcl: Fixed bug in handling 'category' command. Bumped
@@ -316,17 +324,17 @@
 
 2008-12-12  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	*
 	* Released and tagged Tcllib 1.11.1 ========================
-	* 
+	*
 
 2008-12-01  Andreas Kupries  <andreask@activestate.com>
 
 	* doctools.tcl: New command in doctools language is extended API.
 	* doctools.man: Bumped minor version, to 1.4.
-	* pkgIndex.tcl: 
+	* pkgIndex.tcl:
 
 2008-11-26  Andreas Kupries  <andreask@activestate.com>
 
 	* api.tcl: Extended doctools language with a 'category'
 	* checker.tcl: command. This allows manpages to provide
@@ -355,11 +363,11 @@
 
 2008-10-16  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	*
 	* Released and tagged Tcllib 1.11 ========================
-	* 
+	*
 
 2008-07-08  Andreas Kupries  <andreask@activestate.com>
 
 	* changelog.man: Bumped the packages to version 1. They have
 	* changelog.tcl: been on 0 long enough.
@@ -386,11 +394,11 @@
 	* ../tie/tie.man: Fixed the sectref argument order issues.
 
 2008-05-15  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	* doctools.tcl: Bumped version to 1.3.4.
-	* doctools.man: 
+	* doctools.man:
 	* pkgIndex.tcl:
 
 	* checker.tcl: Reworked the (sub)section handling, enabled the
 	* doctools_lang_cmdref.man: documentation writer to label
 	  (sub)sections with logical names and use these in references.
@@ -411,11 +419,11 @@
 	* mpformats/fr.msg:
 
 	* mpformats/fmt.html: Updated the backends for the changes in the
 	* mpformats/fmt.latex: frontend/backend API, and updated testsuite
 	* mpformats/fmt.nroff: results.
-	* mpformats/fmt.text: 
+	* mpformats/fmt.text:
 	* mpformats/fmt.tmml:
 	* mpformats/fmt.wiki:
 	* mpformats/_common.tcl:
 	* tests/latex/00:
 	* tests/latex/01:
@@ -521,16 +529,16 @@
 
 2008-04-23  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	* tests/man/02: Added see_also and keyword references to this
 	* tests/html/02: example. Updated all changed results.
-	* tests/latex/02: 
-	* tests/list/02: 
-	* tests/nroff/02: 
-	* tests/text/02: 
-	* tests/tmml/02: 
-	* tests/wiki/02: 
+	* tests/latex/02:
+	* tests/list/02:
+	* tests/nroff/02:
+	* tests/text/02:
+	* tests/tmml/02:
+	* tests/wiki/02:
 
 2008-04-21  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	* mpformats/fmt.html: Modified to put sections and subsections
 	* mpformats/_html.tcl: into divisions a CSS can lock onto. Changed
@@ -711,11 +719,11 @@
 	* doctools.man: first pass, to avoid replication. Bumped version
 	  to 1.3.1. This fixes [SF Tcllib Bug 1800413].
 
 	* mpformats/fmt.nroff: Fixed argument swap in fmt_arg_def, fixing
 	  [SF Tcllib Bug 1800420].
-	
+
 	* mpformats/fmt.html: Handled [SF Tcllib Bug 1800408] and [SF
 	  Tcllib Bug 411], removing superfluous whitespace around link
 	  text and adding more class names to semantic markup.
 
 2007-09-20  Andreas Kupries  <andreask@activestate.com>
@@ -730,11 +738,11 @@
 
 2007-09-12  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	*
 	* Released and tagged Tcllib 1.10 ========================
-	* 
+	*
 
 2007-08-20  Andreas Kupries  <andreask@activestate.com>
 
 	* doctools.tcl: Bumped versions to 1.3 and 0.3 respectively to
 	* docidx.tcl:   reflect the extended syntax and bugfixes listed
@@ -797,11 +805,11 @@
 	  to warnings.
 
 	* checker_toc.tcl: Language change (doctoc, docidx). Comments in
 	* checker_idx.tcl: the input are now swallowed by the checker
 	  layer and not propagated to the backend anymore.
-	
+
 	* checker.tcl: Language changes.
 	  -- Comments are swallowed, backends do not see them anymore.
 	  -- 'require'ments an now go everywhere in the header, not only
 	  after the 'desc'riptions.
 	  -- Warnings now have location information.
@@ -824,11 +832,11 @@
 	  Note that everything which was made deprecated is still accepted
 	  as valid input, however their use does cause the generation of
 	  warnings. This means that the language after the changes is a
 	  proper superset of the language before it. Old documents can be
 	  processed just fine with the new code.
-	
+
 	* mpformats/fmt.html: Use the new list types for translation.
 	* mpformats/fmt.latex:
 	* mpformats/fmt.text:
 	* mpformats/fmt.tmml:
 
@@ -851,11 +859,11 @@
 	  are now cross-referencable via 'term', allowing direct links
 	  between documents. Comments about internals added. Documentation
 	  updated for the new functionality, and fixed all warnings due to
 	  use of deprecated commands and list types. Added a section on
 	  how to give feedback.
-	
+
 	* cvs.man: Fixed all warnings due to use of deprecated commands
 	* changelog.man: and list types, tweaked the titles, and added
 	  sections about how to give feedback.
 
 	* docidx.man: Significant rewrites for better language, better
@@ -903,11 +911,11 @@
 
 2006-10-03  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	*
 	* Released and tagged Tcllib 1.9 ========================
-	* 
+	*
 
 2006-10-02  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	* doctools.test: Made the testsuite robust against locale
 	* doctoc.test:   settings in the environment. The tests
@@ -914,11 +922,11 @@
 	* docidx.test:   assume the default locale (LANG=C).
 
 2006-09-19  Andreas Kupries  <andreask@activestate.com>
 
 	* doctools.man: Bumped version to 1.2.1
-	* doctools.tcl: 
+	* doctools.tcl:
 	* pkgIndex.tcl:
 
 2006-08-10  Andreas Kupries <andreask@activestate.com>
 
 	* mpformats/_text.tcl: Replaced textutil with the exact packages
@@ -955,11 +963,11 @@
 
 2005-10-06  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	*
 	* Released and tagged Tcllib 1.8 ========================
-	* 
+	*
 
 2005-10-03  Andreas Kupries <andreask@activestate.com>
 
 	* checker.tcl:      Added code checking for ambiguities in section
 	* mpformats/c.msg:  and subsection titles. It causes warnings.
@@ -983,12 +991,12 @@
 	* doctools.test: Testsuite package requirements fixed to ensure
 	* docidx.test:   use of local packages.
 	* doctoc.test:
 
 	* doctools.tcl: Typo police.
-	* docidx.tcl: 
-	* doctoc.tcl: 
+	* docidx.tcl:
+	* doctoc.tcl:
 
 2005-02-18  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	* mpformats/_nroff.tcl: Fixed problem with comment
 	  handling. Before the fix we could generate output where nroff
@@ -1021,11 +1029,11 @@
 
 2004-10-05  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	*
 	* Released and tagged Tcllib 1.7 ========================
-	* 
+	*
 
 2004-09-23  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	* mpformats/_text.tcl: Fixed expr'essions without braces.
 
@@ -1063,17 +1071,17 @@
 	* docidx.test:
 
 2004-07-24  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	* docidx_fmt.man: More overhaul.
-	* docidx_api.man: 
-	* doctoc_fmt.man: 
-	* doctoc_api.man: 
-	* doctoc.man: 
-	* doctools_fmt.man: 
-	* doctools_api.man: 
-	* doctools.man: 
+	* docidx_api.man:
+	* doctoc_fmt.man:
+	* doctoc_api.man:
+	* doctoc.man:
+	* doctools_fmt.man:
+	* doctools_api.man:
+	* doctools.man:
 	* changelog.man:
 	* cvs.man:
 
 2004-07-23  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
@@ -1082,30 +1090,30 @@
 
 	* ../../apps/dtplite: Revamped the whole file mapping. Actually
 	  ripped it out. Is not needed, the formatting engine does the
 	  necessary parts for us, if we feed it the correct -file
 	  options. This kills the outstanding bug with xref links.
-	
+
 	* ../../apps/dtplite: Bugfix. Added checks to prevent duplicate
 	  entries in the keyword index. Without these checks going through
 	  a set of packages twice for merging will create double links for
 	  each actual entry. Changed the representation of the index saved
 	  between merge invokations to keep the array for the voiding of
 	  duplicates around.
 
 	* docidx.man:    Overhaul of documentation.
-	* cvs.man: 
-	* changelog.man: 
+	* cvs.man:
+	* changelog.man:
 
 2004-07-22  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	* ../../apps/dtplite: Reduced error output, show only the message,
 	  not the whole stack.
 
 	* doctools.tcl: Changed processing of error messages so that
 	* doctoc.tcl:   we don't loose the location information.
-	* docidx.tcl: 
+	* docidx.tcl:
 
 2004-07-22  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	* doctools_api.man:       Polished the manpages a bit,
 	* ../../apps/dtplite.man: for better cross-referencing.
@@ -1164,15 +1172,15 @@
 
 2004-05-23  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	*
 	* Released and tagged Tcllib 1.6.1 ========================
-	* 
+	*
 
 2004-05-23  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
-	* doctools.tcl: Rel. engineering. Updated version number 
+	* doctools.tcl: Rel. engineering. Updated version number
 	* doctools.man: of doctools to reflect its changes, to 1.0.2.
 	* pkgIndex.tcl:
 
 2004-05-14  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
@@ -1188,14 +1196,14 @@
 	* mpformats/_nroff.tcl:  the validator subsystem, and all formatting
 	* mpformats/_text.tcl:   engines which are coming with the package.
 	* mpformats/fmt.html:    For HTML output subsections are added to
 	* mpformats/fmt.latex:   the TOC (See [SF Tcllib RFE 772491] below)
 	* mpformats/fmt.nroff:   as well.
-	* mpformats/fmt.null: 
-	* mpformats/fmt.text: 
-	* mpformats/fmt.tmml: 
-	* mpformats/fmt.wiki: 
+	* mpformats/fmt.null:
+	* mpformats/fmt.text:
+	* mpformats/fmt.tmml:
+	* mpformats/fmt.wiki:
 
 2004-05-14  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	* mpformats/_text.tcl (SECT): Fixed a small problem in the text
 	  generator which was present for ages. Titles of more than one
@@ -1230,16 +1238,16 @@
 	                       'opt_def'.
 
 2004-04-22  Joe English  <jenglish@users.sourceforge.net>
 
 	* mpformats/fmt.xml: BUGFIX: "puts stderr" ==> "puts_stderr".
-	
+
 2004-02-15  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	*
 	* Released and tagged Tcllib 1.6 ========================
-	* 
+	*
 
 2004-02-09  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	* doctools.test: Fixed problems with Tcl 8.5, the tests were
 	  dependent on the order of keys in the result of [array get].
@@ -1269,11 +1277,11 @@
 
 2003-05-05  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	*
 	* Released and tagged Tcllib 1.4 ========================
-	* 
+	*
 
 2003-04-01  Andreas Kupries  <andreask@activestate.com>
 
 	* checker_toc.tcl: Bug fixes for handling of nested toc divisions.
 
@@ -1285,12 +1293,12 @@
 	* docidx.tcl: Added the package and file ops initially created in
 	  doctools.tcl to these packages too, so that their text engines
 	  can use 'textutil' too.
 
 	* mpformats/_text.tcl:
-	* mpformats/fmt.text: 
-	* mpformats/toc.text: 
+	* mpformats/fmt.text:
+	* mpformats/toc.text:
 	* mpformats/idx.text: Bug fixes.
 
 2003-03-31  Andreas Kupries  <andreask@activestate.com>
 
 	* mpformats/toc.text:
@@ -1367,11 +1375,11 @@
 	  cross-references causing unwanted suppression (leakage of
 	  definitions between multiple pages).
 
 	* doctoc.tcl:   Bug fixes in three return statemments.
 	* docidx.tcl:   (return -code error string, not return -code string)
-	* doctools.tcl: 
+	* doctools.tcl:
 
 2003-03-11  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	* mpformats/fmt.html:  Rewrite handling of [keywords] and
 	* mpformats/fmt.latex: [see_also] to behave like for the TMML
@@ -1460,11 +1468,11 @@
 	* dtocformat.man:            and a number of formatting engines
 	* dtocengine.man:            plugging into this package to
 	* mpformats/_toc_common.tcl: generate output in various formats.
 	* mpformats/toc.html:        This required additional checker code
 	* mpformats/toc.nroff:       and more messages in the message
-	* mpformats/toc.null:        catalogs. 
+	* mpformats/toc.null:        catalogs.
 	* mpformats/toc.tmml:
 	* mpformats/toc.wiki:
 	* pkgIndex.tcl:
 	* mpformats/c.msg:
 	* mpformats/en.msg:
@@ -1513,15 +1521,15 @@
 	* mpformats/fmt.nroff: now also redirects the command to 'emph'.
 	* mpformats/fmt.wiki:  The option -visualwarn (doctools, and
 	* mpformats/fmt.null:  mpexpand) renamed to -deprecated. Message
 	* mpformats/fmt.list:  'visualmarkup' removed from the catalogs,
 	* mpformats/c.msg:     and 'depr_strong' added instead.
-	* mpformats/en.msg: 
-	* mpformats/de.msg: 
-	* checker.tcl: 
-	* doctools.tcl: 
-	* mpexpand: 
+	* mpformats/en.msg:
+	* mpformats/de.msg:
+	* checker.tcl:
+	* doctools.tcl:
+	* mpexpand:
 
 	* doctools.man:    Updated, converted [strong] to better
 	* dtformat.man:    formatting commands. Ditto for all manpages
 	* dtformatter.man: in tcllib containing 'strong'. 'strong' is now
 	* mpexpand.man:    not present anymore.
@@ -1534,17 +1542,17 @@
 				 being given to the formatter.
 
 	* mpformats/fmt.html:  Removed the phrase 'All rights reserved'
 	* mpformats/fmt.latex: from the code, on recommendation by
 	* mpformats/fmt.nroff: Joe English.
-	* mpformats/fmt.wiki: 
+	* mpformats/fmt.wiki:
 
 	(In the way to early morrow :)
 	* mpformats/fmt.html:  Changed to display copyright information in
 	* mpformats/fmt.latex: the conversion result itself and not only
 	* mpformats/fmt.nroff: embedded in comments.
-	* mpformats/fmt.wiki: 
+	* mpformats/fmt.wiki:
 
 2003-01-14  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	* doctools.tcl:          Added a new formatting command,
 	* doctools.test:         'copyright', to declare/assign copyright
@@ -1557,13 +1565,13 @@
 	* mpformats/fmt.list:    precedence over information coming from the
 	* mpformats/fmt.nroff:   processor. Updated all predefined engines
 	* mpformats/fmt.null:    to handle the new command. TMML done only
 	* mpformats/fmt.tmml:    partially, as I don't know where the copy-
 	* mpformats/fmt.wiki:    right has to go.
-	* mpformats/_common.tcl: 
-	* mpformats/_html.tcl:   
-	* mpformats/_nroff.tcl:  
+	* mpformats/_common.tcl:
+	* mpformats/_html.tcl:
+	* mpformats/_nroff.tcl:
 	* mpexpand:
 
 2003-01-13  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	* mpexpand:      Moved format help into the package itself.
@@ -1621,11 +1629,11 @@
 	* mpformats/fmt.html: Changed bug #578465 which caused
 	  mis-generation of angle-brackets and quotes.
 
 2002-06-06  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
-	* mpformats/fmt.html: 
+	* mpformats/fmt.html:
 	* mpformats/_html.tcl: Added the missing handling of " (&quot;) to
 	  the format.
 
 2002-05-27  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
@@ -1632,11 +1640,11 @@
 	* mpformats/_xml.tcl: args -> arguments, as the argument is not
 	  the last one. The code as is was not erroneous, but a possible
 	  trouble spot should tcl ever be more strict with 'args'.
 
 2002-05-21  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
-	
+
 	* mpformats/fmt.nroff: Accepted patch for bug #556509, both by Joe
 	  English <jenglish@users.sourceforge.net>.
 
 2002-05-09  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
@@ -1662,18 +1670,18 @@
 	* mpformats/fmt.null:  Added new list types for arguments, options,
 	  commands, and Tk (widget) options.
 
 2002-04-24  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
-	* mpformats/fmt.html: 
+	* mpformats/fmt.html:
 	* mpformats/_html.tcl: Changes analogous to TMML (see below) to
 	  differentiate internal markup and external special characters.
 
 2002-04-24  Joe English  <jenglish@users.sourceforge.net>
 
 	* mpformats/_xml.tcl
-	* mpformats/fmt.tmml: Correctly handles XML markup characters 
+	* mpformats/fmt.tmml: Correctly handles XML markup characters
 	  in macro arguments.  Also correctly escapes apostrophes
 	  in attribute values (previously-unnoticed bug).
 	* mpformats/fmt.tmml: TMML uses <url> instead of <uri>, and
 	  does not have a <strong> element; changed output accordingly.
 
@@ -1691,12 +1699,12 @@
 	  are stripped in the post processor of this format, so
 	  unconditionally adding them does not hurt.
 
 2002-04-02  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
-	* mpformats/en.msg: 
-	* mpformats/c.msg: 
+	* mpformats/en.msg:
+	* mpformats/c.msg:
 	* mpformats/de.msg: Added the messages required by the new code
 	  below.
 
 	* mpexpand: Added code to check that plain text is not used in
 	  places where it is not allowed.
@@ -1716,16 +1724,16 @@
 	  allowing for easy i18n and l10n of mpexpand. Catalogs for the
 	  locales "c", "en", and "de" are provided.
 
 	* mpformats/fmt.html: Changed uri formatting to be a link.
 
-	* mpformats/fmt.tmml: 
-	* mpformats/fmt.html: 
-	* mpformats/fmt.nroff: 
-	* mpformats/fmt.latex: 
-	* mpformats/fmt.list: 
-	* mpformats/fmt.null: 
+	* mpformats/fmt.tmml:
+	* mpformats/fmt.html:
+	* mpformats/fmt.nroff:
+	* mpformats/fmt.latex:
+	* mpformats/fmt.list:
+	* mpformats/fmt.null:
 	* mpformats/_api.tcl: Added formatting commands "term" and "const"
 	  to allow the structural markup of non-specific terminology and
 	  of constant values.
 
 	* mpformats/fmt.nroff (bullet): Bulleting changed, use \(bu as
@@ -1781,13 +1789,13 @@
 
 2002-02-27  Andreas Kupries  <andreas_kupries@users.sourceforge.net>
 
 	* mpformats/fmt.null: Null format, does not produce any output.
 
-	* mpformats/fmt.tmml: 
-	* mpformats/fmt.nroff: 
-	* mpformats/fmt.latex: 
+	* mpformats/fmt.tmml:
+	* mpformats/fmt.nroff:
+	* mpformats/fmt.latex:
 	* mpformats/fmt.html:
 	* mpformats/fmt.list: Implementations of the new command.
 
 	* mpexpand: Added the commands to the processor application. Added
 	  option "-visualwarn". When present the processor warn about

Index: modules/doctools/doctools.man
==================================================================
--- modules/doctools/doctools.man
+++ modules/doctools/doctools.man
@@ -1,13 +1,13 @@
 [comment {-*- tcl -*- doctools manpage}]
-[manpage_begin doctools n 1.4.14]
+[manpage_begin doctools n 1.4.15]
 [copyright {2003-2013 Andreas Kupries <andreas_kupries@users.sourceforge.net>}]
 [moddesc   {Documentation tools}]
 [titledesc {doctools - Processing documents}]
 [category  {Documentation tools}]
 [require Tcl 8.2]
-[require doctools [opt 1.4.14]]
+[require doctools [opt 1.4.15]]
 [description]
 
 This package provides a class for the creation of objects able to
 process and convert text written in the [term doctools] markup
 language into any output format X for which a

Index: modules/doctools/doctools.tcl
==================================================================
--- modules/doctools/doctools.tcl
+++ modules/doctools/doctools.tcl
@@ -1335,6 +1335,6 @@
     #catch {search [file join $here                lib doctools mpformats]}
     #catch {search [file join [file dirname $here] lib doctools mpformats]}
     catch {search [file join $here                             mpformats]}
 }
 
-package provide doctools 1.4.14
+package provide doctools 1.4.15

Index: modules/doctools/mpformats/_nroff.tcl
==================================================================
--- modules/doctools/mpformats/_nroff.tcl
+++ modules/doctools/mpformats/_nroff.tcl
@@ -13,11 +13,11 @@
 # Any empty line created because of this is filtered out in the 
 # post-processing step.
 
 
 proc nr_lp      {}          {return \n\1.LP}
-proc nr_ta      {{text {}}} {return ".ta$text"}
+proc nr_ta      {{text {}}} {return "\1.ta$text"}
 proc nr_bld     {}          {return \1\\fB}
 proc nr_bldt    {t}         {return "\n\1.B $t\n"}
 proc nr_ul      {}          {return \1\\fI}
 proc nr_rst     {}          {return \1\\fR}
 proc nr_p       {}          {return \n\1.PP\n}
@@ -101,16 +101,18 @@
     # - Strip empty lines out of the text
     # - Remove leading and trailing whitespace from lines.
     # - Exceptions to the above: Keep empty lines and leading
     #   whitespace when in verbatim sections (no-fill-mode)
 
-    set nfMode   [list .nf .CS]	; # commands which start no-fill mode
-    set fiMode   [list .fi .CE]	; # commands which terminate no-fill mode
+    set nfMode   [list \1.nf \1.CS]	; # commands which start no-fill mode
+    set fiMode   [list \1.fi \1.CE]	; # commands which terminate no-fill mode
     set lines    [list]         ; # Result buffer
     set verbatim 0              ; # Automaton mode/state
 
     foreach line [split $nroff "\n"] {
+	#puts_stderr |[expr {$verbatim ? "VERB" : "    "}]|$line|
+
 	if {!$verbatim} {
 	    # Normal lines, not in no-fill mode.
 
 	    if {[lsearch -exact $nfMode [split $line]] >= 0} {
 		# no-fill mode starts after this line.
@@ -134,20 +136,21 @@
 		# [bug-3601370] Only lift & attach if last line is not
 		# a directive
 
 		set last  [lindex   $lines end]
 		if { ! [string match "\1.*" $last] } {
+		    #puts_stderr \tLIFT
 		    set lines [lreplace $lines end end]
 		    set line "$last $line"
 		}
 	    } elseif {[string match {['.]*} $line]} {
-		# Apostrophes or periods at the beginning of a line have to
-		# quoted to prevent misinterpretation as comments or directives.
-		# The true comments and directive are quoted with \1
-		# already and will therefore not detected by the code
-		# here.
-
+		# Apostrophes or periods at the beginning of a line
+		# have to be quoted to prevent misinterpretation as
+		# comments or directives.  The true comments and
+		# directive are quoted with \1 already and will
+		# therefore not detected by the code here.
+		#puts_stderr \tQUOTE
 		set line \1\\$line
 	    }
 	} else {
 	    # No-fill mode. We remove trailing whitespace, but keep
 	    # leading whitespace and empty lines.
@@ -164,14 +167,15 @@
     set lines [join $lines "\n"]
 
     # Remove superfluous .IP commands (empty paragraph). The first
     # identity mapping is there to avoid smashing a man macro
     # definition.
-    set lines [string map [list \
-	       \n\1.IP\n\1..\n  \n\1.IP\n\1..\n \
-	       \n\1.IP\n\1.     \n\1.] \
-	   $lines]
+
+    lappend map	\n\1.IP\n\1.\1.\n  \n\1.IP\n\1.\1.\n
+    lappend map \n\1.IP\n\1.       \n\1.
+
+    set lines [string map $map $lines]
 
     # Return the modified result buffer
     return [string map $finalMap $lines]
 }
 

Index: modules/doctools/mpformats/fmt.nroff
==================================================================
--- modules/doctools/mpformats/fmt.nroff
+++ modules/doctools/mpformats/fmt.nroff
@@ -267,15 +267,15 @@
 proc fmt_image {text {label {}}} {
     # text = symbolic name of the image.
 
     set img [dt_imgdata $text {pic}]
     if {$img ne {}} {
-	return \n.PS\n$img\n.PE\n
+	return \n\1.PS\n$img\n\1.PE\n
     }
     set img [dt_imgdata $text {txt}]
     if {$img ne {}} {
-	return \n.PS\n.nf\n$img\n.fi\n.PE\n
+	return \n\1.PS\n\1.nf\n$img\n\1.fi\n\1.PE\n
     }
     if {$label eq {}} {
 	return "IMAGE: $text"
     } else {
 	return "IMAGE: $text $label"

Index: modules/doctools/pkgIndex.tcl
==================================================================
--- modules/doctools/pkgIndex.tcl
+++ modules/doctools/pkgIndex.tcl
@@ -1,6 +1,6 @@
 if {![package vsatisfies [package provide Tcl] 8.2]} {return}
-package ifneeded doctools            1.4.14 [list source [file join $dir doctools.tcl]]
+package ifneeded doctools            1.4.15 [list source [file join $dir doctools.tcl]]
 package ifneeded doctools::toc       1.1.3  [list source [file join $dir doctoc.tcl]]
 package ifneeded doctools::idx       1.0.4  [list source [file join $dir docidx.tcl]]
 package ifneeded doctools::cvs       1      [list source [file join $dir cvs.tcl]]
 package ifneeded doctools::changelog 1.1    [list source [file join $dir changelog.tcl]]

