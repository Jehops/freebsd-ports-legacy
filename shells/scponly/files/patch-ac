--- scponly.c.orig	Thu Dec 22 08:12:22 2005
+++ scponly.c	Tue Dec 27 23:09:30 2005
@@ -611,7 +611,9 @@ int process_ssh_request(char *request)
 				fflush(stdout);
 				fflush(stderr);
 				discard_vector(av);
+#ifdef USE_SAFE_ENVIRONMENT
 				discard_vector(safeenv);
+#endif
 				free(flat_request);
 				free(tmprequest);
 				return(WEXITSTATUS(status));
@@ -629,7 +631,9 @@ int process_ssh_request(char *request)
 		syslog(LOG_ERR, "failed: %s with error %s(%u) (%s)", flat_request, strerror(errno), errno, logstamp());
 		free(flat_request);
 		discard_vector(av);
+#ifdef USE_SAFE_ENVIRONMENT
 		discard_vector(safeenv);
+#endif
 #ifdef WINSCP_COMPAT
 		if (winscp_mode)
 		{
