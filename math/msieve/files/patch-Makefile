--- Makefile.orig	2011-02-06 19:12:31.000000000 -0500
+++ Makefile	2011-02-06 19:12:39.000000000 -0500
@@ -14,12 +14,12 @@
 
 # gcc with basic optimization (-march flag could
 # get overridden by architecture-specific builds)
-CC = gcc -D_FILE_OFFSET_BITS=64
+#CC = gcc -D_FILE_OFFSET_BITS=64
 WARN_FLAGS = -Wall -W
-OPT_FLAGS = -O3 -fomit-frame-pointer -march=athlon-xp -DNDEBUG
-OPT_FLAGS = -O3 -fomit-frame-pointer -march=k8 -DNDEBUG -D_LARGEFILE64_SOURCE
+#OPT_FLAGS = -O3 -fomit-frame-pointer -march=athlon-xp -DNDEBUG
+#OPT_FLAGS = -O3 -fomit-frame-pointer -march=k8 -DNDEBUG -D_LARGEFILE64_SOURCE
 
-CFLAGS = $(OPT_FLAGS) $(MACHINE_FLAGS) $(WARN_FLAGS) \
+CFLAGS += $(OPT_FLAGS) $(MACHINE_FLAGS) $(WARN_FLAGS) \
 		-I. -Iinclude -Ignfs -Ignfs/poly -Ignfs/poly/stage1
 
 # tweak the compile flags
@@ -61,7 +61,7 @@
 # win32 or win64, so it's safe to pull libpthread into the link line.
 # Of course this does mean you have to install the minGW pthreads bundle...
 
-LIBS += -lgmp -lm -lpthread
+LIBS += -lgmp -lm $(PTHREAD_LIBS)
 
 #---------------------------------- Generic file lists -------------------
 
