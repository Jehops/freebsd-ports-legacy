# $FreeBSD$

PORTNAME=	blasfeo
DISTVERSION=	0.1.1
PORTREVISION=	1
CATEGORIES=	math

MAINTAINER=	yuri@FreeBSD.org
COMMENT=	Basic Linear Algebra Subroutines For Embedded Optimization

LICENSE=	GPLv3
LICENSE_FILE=	${WRKSRC}/LICENSE.txt

USES=		cmake
USE_GITHUB=	yes
GH_ACCOUNT=	giaf

CMAKE_ARGS=	-DTARGET:STRING=GENERIC

OPTIONS_SINGLE=		${ARCH:C/amd64/TARGET/:C/[a-z].*//} # architecture-wise options are based on the list in Makefile.rule
OPTIONS_SINGLE_TARGET=	${ARCH:C/amd64/GENERIC X64_INTEL_HASWELL X64_INTEL_SANDY_BRIDGE X64_INTEL_CORE X64_AMD_BULLDOZER/:C/[a-z].*//}
OPTIONS_DEFAULT=	${ARCH:C/amd64/GENERIC/:C/[a-z].*//}
# TODO ARM also has SIMD acceleration

GENERIC_DESC=				Generic C code without SIMD acceleration
X64_INTEL_HASWELL_DESC=			x86_64 architecture with AVX2 and FMA ISA (64 bit OS)
X64_INTEL_SANDY_BRIDGE_DESC=		x86_64 architecture with AVX ISA (64 bit OS)
X64_INTEL_CORE_DESC=			x86_64 architecture with SSE3 (64 bit OS)
X64_AMD_BULLDOZER_DESC=			x86_64 architecture with AVX and FMA ISA (64 bit OS)

X64_INTEL_HASWELL_CMAKE_ON=		-DTARGET:STRING=X64_INTEL_HASWELL
X64_INTEL_SANDY_BRIDGE_CMAKE_ON=	-DTARGET:STRING=X64_INTEL_SANDY_BRIDGE
X64_INTEL_CORE_CMAKE_ON=		-DTARGET:STRING=X64_INTEL_CORE
X64_AMD_BULLDOZER_CMAKE_ON=		-DTARGET:STRING=X64_AMD_BULLDOZER

.include <bsd.port.mk>
