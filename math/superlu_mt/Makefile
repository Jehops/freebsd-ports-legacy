# New ports collection makefile for:	SuperLU_MT
# Date created:		31 Apr 2003
# Whom:			Pedro Giffuni <giffunip@asme.org>
#
# $FreeBSD$
#

PORTNAME=	superlu_mt
PORTVERSION=	1.0
CATEGORIES=	math
MASTER_SITES=	http://crd.lbl.gov/~xiaoye/SuperLU/ \
		http://crd.lbl.gov/~xiaoye/
DISTNAME=	${PORTNAME}_${PORTVERSION}
.ifndef NOPORTDOCS
DISTFILES=	${DISTNAME}${EXTRACT_SUFX} simax97.ps.gz
.endif
DIST_SUBDIR=	superlu
EXTRACT_ONLY=	${DISTNAME}${EXTRACT_SUFX}

MAINTAINER=	ports@FreeBSD.org
COMMENT=	Routines for performing multithreaded sparse factorization

BUILD_DEPENDS=	${LOCALBASE}/lib/libblas.a:${PORTSDIR}/math/blas

USE_REINPLACE=	yes
WRKSRC=		${WRKDIR}/SuperLU_MT
ALL_TARGET=	superlulib

BLAS_LIBS=	${LOCALBASE}/lib/libblas.a

.include <bsd.port.pre.mk>

.if ${OSVERSION} >= 502126
BROKEN=		"Broken by changes to make(1) on FreeBSD >= 5.x"
.endif

post-patch:
	@${REINPLACE_CMD} -e 's+%%BLAS_LIBS%%+${BLAS_LIBS}+ ; \
	  s+%%PTHREAD_CFLAGS%%+${PTHREAD_CFLAGS}+ ; \
	  s+%%PTHREAD_LIBS%%+${PTHREAD_LIBS}+ ' \
		${WRKSRC}/make.inc

do-install:
	${INSTALL_DATA} ${WRKSRC}/libsuperlu_mt.* ${PREFIX}/lib
	${MKDIR} ${PREFIX}/include/${PORTNAME}
	${INSTALL_DATA} ${WRKSRC}/SRC/*.h ${PREFIX}/include/${PORTNAME}
.ifndef NOPORTDOCS
	@${MKDIR} ${DOCSDIR}
	${INSTALL_DATA} ${WRKSRC}/INSTALL/*.ps ${DOCSDIR}
	${GZIP_CMD} ${DOCSDIR}/*.ps
	${INSTALL_DATA} ${DISTDIR}/${DIST_SUBDIR}/simax97.ps.gz ${DOCSDIR}
.endif

.include <bsd.port.post.mk>
