--- linuxx86/hinst.orig	Tue Dec  6 11:25:53 2005
+++ linuxx86/hinst	Mon Jul 17 09:12:18 2006
@@ -11,7 +11,6 @@
 #	Copyright 1998-2000 Citrix Systems, Inc. All rights reserved.
 #
 ###############################################################################
-
 # note: the INSTALLER_... strings should be in lowercase. The installer will then
 # accept lowercase or uppercase versions of them as input.
 INSTALLER_YES=ja
@@ -73,7 +72,13 @@
 fi
 
 #  Install in here by default.
-DefaultInstallDir=/usr/lib/ICAClient
+
+DefaultInstallDir=$PREFIX/ICAClient
+
+if [ "$PREFIX/ICAClient" = "/ICAClient" ]
+then
+	DefaultInstallDir=/usr/local/ICAClient
+fi
 
 #  Default CDROM mount point
 DefaultCDSourceDir=/cdrom
@@ -2175,7 +2180,7 @@
 	tr_file $TR_FILE_KEY $PORT/$PORT.psf
 	preen_files
 
-	/bin/true
+	/usr/bin/true
 }
 
 ###############################################################################
@@ -2227,10 +2232,34 @@
 #
 ###############################################################################
 
+check_for_ns() {
+        BIN=`/usr/bin/file $1/plugins/libnullplugin.so | /usr/bin/awk '{print $11}'`
+        case ${BIN} in
+        \(SYSV\),)
+                NETSCAPE_DIR="$1"
+                PLUGIN_PATH="$s/plugins"
+                FOUND_NS="TRUE"
+        esac
+}
+
+NSCP="/usr/local/libexec/netscape \
+        /usr/local/libexec/netscape-linux \
+        /usr/local/netscape \
+        /usr/local/netscape-linux \
+        /usr/local/lib/netscape \
+        /usr/local/lib/netscape-linux \
+        /usr/local/lib/linux-mozilla \
+        /usr/local/lib/mozilla \
+        $MOZILLA_HOME"
+
+for dir in ${NSCP}; do
+        if [ -e $dir/plugins/libnullplugin.so ]; then
+                check_for_ns $dir;
+        fi
+done
+
 INST_DIR=$ICAInstDir
 TMP_NAME=/tmp/ICAnetscape.$$
-NETSCAPE_DIR="/usr/local/lib/netscape"
-PLUGIN_PATH="/usr/local/netscape/plugins"
 PLUGIN_NAME=npica.so
 PLUGIN_CLASS=ICAClObj.class
 MAILCAP_FILE=mailcap
@@ -2303,26 +2332,19 @@
 
 netscape_integrate()
 {
-  user_echo $integrate_netscape1
   if test -z "$SU_INSTALL"
   then
     set_npui_variables
     found_netscape 
   else
     search_ok=0
-    EXTRA_BROWSERS=`find_browsers`
   
-    if  test -d "/usr/lib/netscape"\
-	|| test -d "/usr/local/netscape"\
-	|| test -d "/opt/netscape"\
-	|| test -d "/usr/local/lib/netscape"\
-	|| test -d "/usr/dt/appconfig/netscape"\
-	|| test "$MOZILLA_HOME" != "" -a -d "$MOZILLA_HOME"\
-	|| test "$EXTRA_BROWSERS" != ""
-    then
+    case ${FOUND_NS} in
+    TRUE)
   	user_echo $integrate_netscape3
   	found_netscape 
-    else
+	;;
+    *)
 	user_prompt $integrate_netscape2
  	getyesno $INSTALLER_NO
 	if [ "$ANSWER" = "$INSTALLER_YES" ]
@@ -2331,9 +2353,9 @@
 	else
   		user_echo $integrate_netscape6
 	fi
+	;;
+    esac
     fi
-  fi
-
     # Create utility script files in install root.
     create_wfica_script
     create_wfica_assoc_script
@@ -2969,55 +2991,6 @@
     echo "$BINDIR"
 }
 
-################################################################################
-#
-# find_browsers
-#
-# Returns a list of directories containing new-style mozilla-based browsers 
-# that may be launched by files on the $PATH.
-#
-################################################################################
-find_browsers()
-{
-    PROGS="netscape mozilla firefox"
-    DIST_BIN_DIR=""
-    STANDARD_DIRS="/usr/local/netscape /usr/local/mozilla /usr/local/firefox /usr/lib/mozilla"
-
-    case $op_system in
-       SunOS) if
-                 /usr/bin/pkginfo -q $SOLARIS_PACKAGE_NAME
-              then
-                 relocation_base=`/usr/bin/pkginfo -r $SOLARIS_PACKAGE_NAME`
-                 STANDARD_DIRS="$STANDARD_DIRS $relocation_base/$SOLARIS_PACKAGE_DIRECTORY"
-
-                 # N.B. the Netscape 7 packages for SOLARIS 9 have an extended installation path built-in!
-                 case `uname -r` in
-                    5.9) STANDARD_DIRS="$STANDARD_DIRS $relocation_base/dt/appconfig/$SOLARIS_PACKAGE_DIRECTORY"
-                         ;;
-                    *)   ;;
-                 esac
-              fi;;
-       *) ;;
-    esac
-
-    for d in `echo $PATH | sed "s/:/ /g"` $STANDARD_DIRS
-    do
-	echo $d
-    done | sort -u | while read d
-    do 
-	for p in $PROGS
-	do    
-	    # Find the each instance of each named browser
-	    PROG=$d/$p
-	    if test -f $PROG
-	    then
-		# Where is the installation and what version is it?
-		find_extra_bin_dirs $PROG
-	    fi
-	done
-    done | sort -u
-}
-
 BROWSER_LIST_KEY="BROWSER_DIR"
 ################################################################################
 #
@@ -3244,13 +3217,16 @@
 XDG_TARGET_DIR="/usr/share/applications"
 TL_MENU_DIR="Vendor_menus/Applications"                    # TurboLinux
 TL_TOP_DIR="/usr/share/applnk/"$TL_MENU_DIR
-DEFAULT_GNOME_TARGET_DIRS="/etc/opt/gnome/SuSE/Internet"
-DEFAULT_KDE_TARGET_DIRS="/usr/share/applnk-redhat/Internet \
-                         /usr/share/applnk-mdk/Networking \
-                         $TL_TOP_DIR/Internet \
-			 /etc/opt/kde3/share/applnk/SuSE/Internet \
-                         /usr/share/applnk/Applications"
-
+DEFAULT_GNOME_TARGET_DIRS="/usr/share/applications \
+                           /usr/local/share/applnk/Internet \
+                           /usr/local/share/applnk/Networking \
+                           /etc/opt/gnome/SuSE/Internet"
+DEFAULT_KDE_TARGET_DIRS="/usr/share/applnk/Applications \
+			/usr/local/share/applnk/Applications \
+			/usr/local/share/applnk/Internet \
+                        /usr/share/applnk-redhat/Internet \
+                        /usr/share/applnk-mdk/Networking \
+                        /etc/opt/kde3/share/applnk/SuSE/Internet"
 DEFAULT_DT_TARGET_DIRS="$XDG_TARGET_DIR $DEFAULT_GNOME_TARGET_DIRS $DEFAULT_KDE_TARGET_DIRS"
 DEFAULT_DT_FOLDER="Applications"
 
