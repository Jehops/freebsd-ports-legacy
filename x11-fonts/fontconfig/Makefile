# New ports collection makefile for:	fontconfig
# Date created:		06 October 2002
# Whom:			Joe Marcus Clarke <marcus@FreeBSD.org>
#
# $FreeBSD$
#

PORTNAME=	fontconfig
PORTVERSION=	2.1
PORTREVISION=	3
CATEGORIES=	x11-fonts
MASTER_SITES=	http://www.fontconfig.org/fontconfig/release/
DISTNAME=	fcpackage.${PORTVERSION:S/./_/}

MAINTAINER=	gnome@FreeBSD.org
COMMENT=	An XML-based font configuration API for X Windows

BUILD_DEPENDS=	pkg-config:${PORTSDIR}/devel/pkgconfig
LIB_DEPENDS=	freetype.9:${PORTSDIR}/print/freetype2 \
		expat.4:${PORTSDIR}/textproc/expat2
RUN_DEPENDS=	pkg-config:${PORTSDIR}/devel/pkgconfig

USE_GMAKE=	yes
PREFIX?=	${X11BASE}
INSTALLS_SHLIB=	yes
GNU_CONFIGURE=	yes
USE_REINPLACE=	yes
CONFIGURE_ARGS=	--with-confdir=${PREFIX}/etc/fonts \
		--with-expat=${LOCALBASE} \
		--with-default-fonts=${X11BASE}/lib/X11/fonts
CONFIGURE_TARGET=	--target=${MACHINE_ARCH}-unknown-freebsd${OSREL}
WRKSRC=	${WRKDIR}/${DISTNAME}/fontconfig

MAN1=		fc-cache.1 fc-list.1
MAN3=		fontconfig.3

.include <bsd.port.pre.mk>
.if ${XFREE86_VERSION} == 3
MTREE_FILE=     /etc/mtree/BSD.x11.dist
.else
MTREE_FILE=     /etc/mtree/BSD.x11-4.dist
.endif

pre-patch:
	@${REINPLACE_CMD} -e 's|[(]LIBDIR[)]/pkgconfig|(prefix)/libdata/pkgconfig|g' ${WRKSRC}/Makefile.in

post-install:
	@${INSTALL_DATA} ${WRKSRC}/src/fontconfig.man \
		${PREFIX}/man/man3/fontconfig.3
	@${INSTALL_DATA} ${WRKSRC}/fc-cache/fc-cache.man \
		${PREFIX}/man/man1/fc-cache.1
	@${INSTALL_DATA} ${WRKSRC}/fc-list/fc-list.man \
		${PREFIX}/man/man1/fc-list.1
.if !defined(PACKAGE_BUILDING)
	@${SH} ${PKGINSTALL} ${PKGNAME} POST-INSTALL
.endif

.include <bsd.port.post.mk>
