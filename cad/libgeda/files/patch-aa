--- configure.in.orig	Sun Mar  4 23:38:32 2001
+++ configure.in	Sat Mar 10 21:32:04 2001
@@ -167,7 +167,7 @@
 dnl CFLAGS="$CFLAGS $CFEXTRA `$GTK_CONFIG --cflags`"
 
 CFLAGS="`$GTK_CONFIG --cflags` $CFLAGS $CFEXTRA"
-LDFLAGS="$LDEXTRA `$GTK_CONFIG --libs` -lgtk -lgdk -lglib $LDFLAGS -lm"
+LDFLAGS="$LDEXTRA `$GTK_CONFIG --libs` $LDFLAGS -lm"
 
 AC_MSG_CHECKING([for the rest of gtk])
 AC_TRY_COMPILE(
@@ -208,34 +208,31 @@
          libgdgeda_cflags=`$LIBGDGEDACONFIG --cflags`
          GD_EXTRA="$libgdgeda_cflags $libgdgeda_ldflags -lm"
          X_CFLAGS="$libgdgeda_cflags `$GTK_CONFIG --cflags`"
-fi
 
-AC_CHECK_LIB(gdgeda, gdImageColorAllocate, GDGEDA_LIB="-lgdgeda", GDGEDA_LIB=no, $GD_EXTRA)
 
-if test $GDGEDA_LIB = no; then
-        GDGEDA_LIB=""
-else
-        if test "$no_gdgeda" = "yes"; then
-                echo found libgdgeda, but disabling gdgeda
-                GDGEDA_LIB=""
-         	libgdgeda_ldflags=""
-         	libgdgeda_cflags=""
-        else
-                AC_CHECK_LIB(z, uncompress, Z_LIB="-lz", Z_LIB=no)
-                if test $Z_LIB = no; then
-                        AC_MSG_ERROR(Cannot find libz (zlib), be sure to install zlib; it is required for libgdgeda)
-		fi
-		
+	AC_CHECK_LIB(z, uncompress, Z_LIB="-lz", Z_LIB=no)
+	if test $Z_LIB = no; then
+		AC_MSG_ERROR(Cannot find libz (zlib), be sure to install zlib; it is required for libgdgeda)
+	else
 		PNG_EXTRA="-lz -lm"
-                AC_CHECK_LIB(png, png_read_init, PNG_LIB="-lpng", PNG_LIB=no, $PNG_EXTRA)
-                if test $PNG_LIB = no; then
-                        AC_MSG_ERROR(Cannot find libpng, be sure to install png; it is required for libgdgeda)
-                fi
-
-                AC_DEFINE(HAS_LIBZ)
-                AC_DEFINE(HAS_LIBPNG)
-                AC_DEFINE(HAS_LIBGDGEDA)
-        fi
+		AC_CHECK_LIB(png, png_read_init, PNG_LIB="-lpng", PNG_LIB=no, $PNG_EXTRA)
+	        if test $PNG_LIB = no; then
+        		AC_MSG_ERROR(Cannot find libpng, be sure to install png; it is required for libgdgeda)
+        	else
+			GD_EXTRA="-lpng"
+			AC_CHECK_LIB(gdgeda, gdImageColorAllocate, GDGEDA_LIB="-lgdgeda", GDGEDA_LIB=no, $GD_EXTRA)
+
+			if test $GDGEDA_LIB = no; then
+		        	GDGEDA_LIB=""	
+	        	 	libgdgeda_ldflags=""
+	        	 	libgdgeda_cflags=""
+			else
+	        	        AC_DEFINE(HAS_LIBZ)
+		                AC_DEFINE(HAS_LIBPNG)
+	        	        AC_DEFINE(HAS_LIBGDGEDA)
+			fi
+		fi
+	fi
 fi
 
 if ! test "$CYGWIN"x = x; then
@@ -306,6 +303,8 @@
 AC_SUBST(GTK)
 AC_SUBST(GDK)
 AC_SUBST(GLIB)
+AC_SUBST(libgdgeda_ldflags)
+AC_SUBST(libgdgeda_cflags)
 
 AC_OUTPUT([ 
 	Makefile 
