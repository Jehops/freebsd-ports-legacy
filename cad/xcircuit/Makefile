# New ports collection makefile for:	xcircuit
# Date created:		3 Apr 1998
# Whom:			giffunip@asme.org
#
# $FreeBSD$
#

PORTNAME=	xcircuit
PORTVERSION=	3.4.22
PORTEPOCH=	1
CATEGORIES=	cad
MASTER_SITES=	http://opencircuitdesign.com/xcircuit/archive/ \
		http://mirror.inerd.com/FreeBSD/distfiles/${PORTNAME}/
EXTRACT_SUFX=	.tgz

MAINTAINER=	shaun@inerd.com
COMMENT=	An X11 drawing program [especially for circuit schematics]

BUILD_DEPENDS=	tclsh${TCL_VER}:${PORTSDIR}/lang/tcl${USE_TCL} \
		wish${TK_VER}:${PORTSDIR}/x11-toolkits/tk${USE_TK}

USE_X_PREFIX=	yes
USE_XPM=	yes
USE_TCL=	84
USE_TK=		84
USE_GHOSTSCRIPT_RUN=	yes
USE_GMAKE=	yes
GNU_CONFIGURE=	yes
CONFIGURE_TARGET=	--build=${MACHINE_ARCH}-portbld-freebsd${OSREL}
CONFIGURE_ARGS=	--with-tcl=${TCL_LIBDIR} \
		--with-tk=${TK_LIBDIR}

CFLAGS+=	-fPIC

MAN1=		xcircuit.1

OPTIONS=	GHOSTSCRIPT_AFPL "Use AFPL Postscript interpreter" off

.include <bsd.port.pre.mk>

pre-configure:
.if defined(WITH_GHOSTSCRIPT_AFPL)
	@${ECHO_MSG} "===>  Using AFPL Postscript interpreter"
.else
	@${ECHO_MSG} "===>  Using GNU Postscript interpreter"
.endif

post-patch:
	@${REINPLACE_CMD} -e '/test/s| == | = |g ; \
		 s|-Wl,-Bshareable,-x|-shared -Wl,-x|g ; \
		 s|TCL_LIB_NAME=.*$$|TCL_LIB_NAME="tcl${TCL_VER:S/.//}"|g ; \
		 s|TK_LIB_NAME=.*$$|TK_LIB_NAME="tk${TK_VER:S/.//}"|g ; \
		 s|wish |${WISH:T} |g' ${WRKSRC}/configure

post-install:
.if !defined(NOPORTDOCS)
	@${MKDIR} ${EXAMPLESDIR}
	${INSTALL_DATA} ${WRKSRC}/examples/.xcircuitrc ${EXAMPLESDIR}
	${INSTALL_DATA} ${WRKSRC}/examples/*.lgf ${EXAMPLESDIR}
	${INSTALL_DATA} ${WRKSRC}/examples/*.lps ${EXAMPLESDIR}
	${INSTALL_DATA} ${WRKSRC}/examples/*.ps ${EXAMPLESDIR}
	${INSTALL_DATA} ${WRKSRC}/examples/*.sim ${EXAMPLESDIR}
.endif

.include <bsd.port.post.mk>
