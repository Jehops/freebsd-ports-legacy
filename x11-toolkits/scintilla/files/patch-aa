--- makefile.orig	Fri Oct 15 19:41:26 2004
+++ makefile	Sun Oct 16 02:51:33 2005
@@ -8,16 +8,17 @@
 # To force GTK+ 1 build, define GTK1 on the make command line.
 
 .SUFFIXES: .cxx .c .o .h .a
-CC = g++
+CC ?= g++
 CCOMP = gcc
-AR = ar
+AR = $(CC) -shared
 RANLIB = touch
 
 ifeq ($(shell uname),Darwin)
 RANLIB = ranlib
 endif
 
-COMPLIB=../bin/scintilla.a
+COMPLIB=../bin/libscintilla.so.1
+LEXRLIB=../bin/libscintilla_lexers.so.1
 
 vpath %.h ../src ../include
 vpath %.cxx ../src
@@ -32,33 +33,33 @@
 endif
 
 ifdef DEBUG
-CXXFLAGS=-DDEBUG -g $(CXXBASEFLAGS) $(THREADFLAGS)
+CXXFLAGS+=-DDEBUG -g $(CXXBASEFLAGS) $(THREADFLAGS)
 else
-CXXFLAGS=-DNDEBUG -Os $(CXXBASEFLAGS) $(THREADFLAGS)
+CXXFLAGS+=-DNDEBUG $(CXXBASEFLAGS) $(THREADFLAGS)
 endif
 
 # If explicit setting of GTK1 or GTK2 then use that else look for
 # pkg-config which is an OK indication that GTK2 is available
 ifdef GTK2
-CONFIGFLAGS=pkg-config --cflags gtk+-2.0
+CONFIGFLAGS=pkg-config --cflags gtk+-2.0 gthread-2.0
 MARSHALLER=scintilla-marshal.o
 else
 ifdef GTK1
-CONFIGFLAGS=gtk-config --cflags
+CONFIGFLAGS=pkg-config --cflags gtk+ gthread
 else
 ifneq (,$(findstring /,$(shell whereis pkg-config)))
-CONFIGFLAGS=pkg-config --cflags gtk+-2.0
+CONFIGFLAGS=pkg-config --cflags gtk+-2.0 gthread-2.0
 MARSHALLER=scintilla-marshal.o
 else
-CONFIGFLAGS=gtk-config --cflags
+CONFIGFLAGS=gtk-config --cflags gtk+ gthread
 endif
 endif
 endif
 
 .cxx.o:
-	$(CC) `$(CONFIGFLAGS)` $(CXXFLAGS) -c $<
+	$(CC) $(PICFLAGS) `$(CONFIGFLAGS)` $(CXXFLAGS) -c $<
 .c.o:
-	$(CCOMP) `$(CONFIGFLAGS)` $(CXXFLAGS) -w -c $<
+	$(CCOMP) $(PICFLAGS) `$(CONFIGFLAGS)` $(CXXFLAGS) -w -c $<
 
 #++Autogenerated -- run src/LexGen.py to regenerate
 #**LEXOBJS=\\\n\(\*.o \)
@@ -72,7 +73,7 @@
 LexTeX.o LexVB.o LexVerilog.o LexVHDL.o LexYAML.o
 #--Autogenerated -- end of automatically generated section
 
-all: $(COMPLIB)
+all: $(COMPLIB) $(LEXRLIB)
 
 clean:
 	rm -f *.o $(COMPLIB)
@@ -83,10 +84,11 @@
 $(COMPLIB): DocumentAccessor.o WindowAccessor.o KeyWords.o StyleContext.o Document.o CallTip.o \
 	ScintillaBase.o ContractionState.o Editor.o ExternalLexer.o PropSet.o PlatGTK.o \
 	KeyMap.o LineMarker.o ScintillaGTK.o CellBuffer.o ViewStyle.o \
-	RESearch.o Style.o Indicator.o AutoComplete.o UniConversion.o XPM.o \
-	$(MARSHALLER) $(LEXOBJS)
-	$(AR) rc $@ $^
-	$(RANLIB) $@
+	RESearch.o Style.o Indicator.o AutoComplete.o UniConversion.o XPM.o $(MARSHALLER)
+	$(AR) `$(CONFIGFLAGS:cflags=libs)` -o $@ $^
+
+$(LEXRLIB): $(LEXOBJS)
+	$(AR) `$(CONFIGFLAGS:cflags=libs)` -o $@ $^
 
 # Automatically generate header dependencies with "make deps"
 include deps.mak
