--- Imakefile.orig	Sun Jun 26 03:47:22 1994
+++ Imakefile	Sat Aug  6 23:14:35 2005
@@ -4,8 +4,8 @@
 /**/# Top level Imakefile for ProductNameAndRelease
 /**/# @(#)Imakefile	1.7 1/7/92 SMI
 
-CC = cc
-CFLAGS = -O 
+CC ?= cc
+CFLAGS += -fstrength-reduce -fpcc-struct-return 
 
 #define IHaveSubdirs
 #define PassCDebugFlags
@@ -13,7 +13,7 @@
            WORLDOPTS = 
 /**/# If you want to make only the library, then start the build in the lib
 /**/# subdirectory.  Be sure to do a 'make includes' in images and bitmaps first.
-            COREDIRS = lib images bitmaps misc util
+            COREDIRS = lib images bitmaps misc util config
 #if InstallOpenLookFonts 
             FONTSDIR = fonts
 #else
@@ -21,6 +21,9 @@
 #endif
           CLIENTSDIR = clients
              SUBDIRS = $(COREDIRS) $(FONTSDIR) 
+.ifdef WITHDOCSUBDIR
+SUBDIRS+= doc
+.endif
 /**/# even if these subdirs are not included in the general rules, be sure to
 /**/# do a make clean in them.
        CLEAN_SUBDIRS = clients contrib doc fonts bitmaps images lib misc util
@@ -59,11 +62,11 @@
 	@echo ""
 	@date
 	@echo ""
-	$(MAKE) $(MFLAGS) 'SUBDIRS=$(SUBDIRS) doc' Makefiles
-	$(MAKE) $(MFLAGS) 'CLEAN_SUBDIRS=$(SUBDIRS)' clean
-	$(MAKE) $(MFLAGS) 'SUBDIRS=$(SUBDIRS)' includes
-	$(MAKE) $(MFLAGS) 'SUBDIRS=$(SUBDIRS)' depend
-	$(MAKE) $(MFLAGS) 'SUBDIRS=$(SUBDIRS)' 'CDEBUGFLAGS=$(CDEBUGFLAGS)' $(WORLDOPTS)
+	$(MAKE) $(MFLAGS) -DWITHDOCSUBDIR Makefiles
+	$(MAKE) $(MFLAGS) clean
+	$(MAKE) $(MFLAGS) includes
+	$(MAKE) $(MFLAGS) depend
+	$(MAKE) $(MFLAGS) 'CDEBUGFLAGS=$(CDEBUGFLAGS)' $(WORLDOPTS)
 	@echo ""
 	@date
 	@echo ""
