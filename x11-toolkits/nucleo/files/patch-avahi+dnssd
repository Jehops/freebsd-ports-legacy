--- apps/Makefile.in.orig	Mon Jan 29 15:59:00 2007
+++ apps/Makefile.in	Fri Jun  1 17:46:53 2007
@@ -109,6 +109,9 @@
 DARWIN_TRUE = @DARWIN_TRUE@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DNS_SD_CPPFLAGS = @DNS_SD_CPPFLAGS@
+DNS_SD_LDFLAGS = @DNS_SD_LDFLAGS@
+DNS_SD_LIBS = @DNS_SD_LIBS@
 ECHO = @ECHO@
 ECHO_C = @ECHO_C@
 ECHO_N = @ECHO_N@
@@ -251,8 +254,8 @@
 sysconfdir = @sysconfdir@
 target_alias = @target_alias@
 SUBDIRS = videoServer
-AM_CPPFLAGS = -I${top_srcdir}/ -I${top_builddir}
-AM_LDFLAGS = -L${top_builddir}/nucleo -lNucleo
+AM_CPPFLAGS = -I${top_srcdir}/ -I${top_builddir} $(DNS_SD_CPPFLAGS)
+AM_LDFLAGS = -L${top_builddir}/nucleo -lNucleo $(DNS_SD_LIBS)
 videoClient_SOURCES = videoClient.cxx
 all: all-recursive
 
--- apps/videoServer/Makefile.in.orig	Mon Jan 29 15:59:00 2007
+++ apps/videoServer/Makefile.in	Fri Jun  1 17:48:13 2007
@@ -112,6 +112,9 @@
 DARWIN_TRUE = @DARWIN_TRUE@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DNS_SD_CPPFLAGS = @DNS_SD_CPPFLAGS@
+DNS_SD_LDFLAGS = @DNS_SD_LDFLAGS@
+DNS_SD_LIBS = @DNS_SD_LIBS@
 ECHO = @ECHO@
 ECHO_C = @ECHO_C@
 ECHO_N = @ECHO_N@
@@ -253,8 +256,8 @@
 sharedstatedir = @sharedstatedir@
 sysconfdir = @sysconfdir@
 target_alias = @target_alias@
-AM_CPPFLAGS = -I${top_srcdir} -I${top_builddir}
-AM_LDFLAGS = -L${top_builddir}/nucleo -lNucleo
+AM_CPPFLAGS = -I${top_srcdir} -I${top_builddir} $(DNS_SD_CPPFLAGS)
+AM_LDFLAGS = -L${top_builddir}/nucleo -lNucleo $(DNS_SD_LIBS)
 videoServer_SOURCES = main.cxx VideoServer.cxx \
 	VideoService.cxx Notifier.cxx \
 	FileStreamer.cxx VideoStreamer.cxx \
--- demos/misc/Makefile.in.orig	Mon Jan 29 15:59:01 2007
+++ demos/misc/Makefile.in	Fri Jun  1 17:50:33 2007
@@ -121,6 +121,9 @@
 DARWIN_TRUE = @DARWIN_TRUE@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DNS_SD_CPPFLAGS = @DNS_SD_CPPFLAGS@
+DNS_SD_LDFLAGS = @DNS_SD_LDFLAGS@
+DNS_SD_LIBS = @DNS_SD_LIBS@
 ECHO = @ECHO@
 ECHO_C = @ECHO_C@
 ECHO_N = @ECHO_N@
@@ -262,8 +265,8 @@
 sharedstatedir = @sharedstatedir@
 sysconfdir = @sysconfdir@
 target_alias = @target_alias@
-AM_CPPFLAGS = -I${top_srcdir} -I${top_builddir}
-AM_LDFLAGS = -L${top_builddir}/nucleo -lNucleo
+AM_CPPFLAGS = -I${top_srcdir} -I${top_builddir} $(DNS_SD_CPPFLAGS)
+AM_LDFLAGS = -L${top_builddir}/nucleo -lNucleo $(DNS_SD_LIBS)
 @HAVE_OPENGL_TRUE@paz_SOURCES = paz.cxx
 @DARWIN_TRUE@@HAVE_OPENGL_TRUE@multitexture_SOURCES = multitexture.cxx
 documentOpener_SOURCES = documentOpener.cxx
--- demos/video/Makefile.in.orig	Mon Jan 29 15:59:01 2007
+++ demos/video/Makefile.in	Fri Jun  1 17:51:12 2007
@@ -135,6 +135,9 @@
 DARWIN_TRUE = @DARWIN_TRUE@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DNS_SD_CPPFLAGS = @DNS_SD_CPPFLAGS@
+DNS_SD_LDFLAGS = @DNS_SD_LDFLAGS@
+DNS_SD_LIBS = @DNS_SD_LIBS@
 ECHO = @ECHO@
 ECHO_C = @ECHO_C@
 ECHO_N = @ECHO_N@
@@ -276,8 +279,8 @@
 sharedstatedir = @sharedstatedir@
 sysconfdir = @sysconfdir@
 target_alias = @target_alias@
-AM_CPPFLAGS = -I${top_srcdir} -I${top_builddir}
-AM_LDFLAGS = -L${top_builddir}/nucleo -lNucleo
+AM_CPPFLAGS = -I${top_srcdir} -I${top_builddir} $(DNS_SD_CPPFLAGS)
+AM_LDFLAGS = -L${top_builddir}/nucleo -lNucleo $(DNS_SD_LIBS)
 simplegl_SOURCES = simplegl.cxx
 blender_SOURCES = blender.cxx
 timeoverlay_SOURCES = timeoverlay.cxx
--- tests/Makefile.in.orig	Mon Jan 29 15:59:08 2007
+++ tests/Makefile.in	Fri Jun  1 17:53:04 2007
@@ -226,6 +226,9 @@
 DARWIN_TRUE = @DARWIN_TRUE@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DNS_SD_CPPFLAGS = @DNS_SD_CPPFLAGS@
+DNS_SD_LDFLAGS = @DNS_SD_LDFLAGS@
+DNS_SD_LIBS = @DNS_SD_LIBS@
 ECHO = @ECHO@
 ECHO_C = @ECHO_C@
 ECHO_N = @ECHO_N@
@@ -367,8 +370,8 @@
 sharedstatedir = @sharedstatedir@
 sysconfdir = @sysconfdir@
 target_alias = @target_alias@
-AM_CPPFLAGS = -I${top_srcdir} -I${top_builddir}
-AM_LDFLAGS = -L${top_builddir}/nucleo -lNucleo
+AM_CPPFLAGS = -I${top_srcdir} -I${top_builddir} $(DNS_SD_CPPFLAGS)
+AM_LDFLAGS = -L${top_builddir}/nucleo -lNucleo $(DNS_SD_LIBS)
 test_reducePath_SOURCES = test-reducePath.cxx
 test_StringUtils_SOURCES = test-StringUtils.cxx
 test_URI_SOURCES = test-URI.cxx
--- nucleo/network/dnssd/Makefile.in.orig	Fri Jun  1 17:59:12 2007
+++ nucleo/network/dnssd/Makefile.in	Fri Jun  1 17:54:06 2007
@@ -110,6 +110,9 @@
 DARWIN_TRUE = @DARWIN_TRUE@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DNS_SD_CPPFLAGS = @DNS_SD_CPPFLAGS@
+DNS_SD_LDFLAGS = @DNS_SD_LDFLAGS@
+DNS_SD_LIBS = @DNS_SD_LIBS@
 ECHO = @ECHO@
 ECHO_C = @ECHO_C@
 ECHO_N = @ECHO_N@
@@ -254,7 +251,8 @@
 sharedstatedir = @sharedstatedir@
 sysconfdir = @sysconfdir@
 target_alias = @target_alias@
-AM_CPPFLAGS = -I${top_srcdir} -I${top_builddir}
+AM_CPPFLAGS = -I${top_srcdir} -I${top_builddir} $(DNS_SD_CPPFLAGS)
+AM_LDFLAGS = $(DNS_SD_LIBS)
 noinst_LTLIBRARIES = libdnssd.la
 libdnssd_la_SOURCES = DNSServiceAnnouncer.cxx DNSServiceBrowser.cxx
 pkginclude_HEADERS = DNSService.H DNSServiceAnnouncer.H DNSServiceBrowser.H
--- configure.orig	Mon Jan 29 15:59:11 2007
+++ configure	Fri Jun  1 17:43:40 2007
@@ -894,6 +894,9 @@
 HAVE_FREETYPE2_TRUE
 HAVE_FREETYPE2_FALSE
 HAVE_DNS_SD
+DNS_SD_CPPFLAGS
+DNS_SD_LDFLAGS
+DNS_SD_LIBS
 HAVE_DNS_SD_TRUE
 HAVE_DNS_SD_FALSE
 HAVE_FFMPEG
@@ -23216,6 +23219,28 @@
 problem_dns_sd=""
 with_dns_sd="yes"
 HAVE_DNS_SD=1
+if test x$TARGET != xDARWIN ; then
+  echo "$as_me:$LINENO: checking for avahi-compat-libdns_sd using pkg-config" >&5
+  echo $ECHO_N "checking for avahi-compat-libdns_sd using pkg-config... $ECHO_C" >&6
+  HAVE_DNS_SD=0
+  if test -n "$MY_PKG_CONFIG" && { (echo "$as_me:$LINENO: \$MY_PKG_CONFIG --exists avahi-compat-libdns_sd") >&5
+  ($MY_PKG_CONFIG --exists avahi-compat-libdns_sd) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; then
+    HAVE_DNS_SD=1
+    DNS_SD_CPPFLAGS=`$MY_PKG_CONFIG --cflags-only-I avahi-compat-libdns_sd`
+    DNS_SD_LDFLAGS=`$MY_PKG_CONFIG --libs-only-L avahi-compat-libdns_sd`
+    DNS_SD_LIBS=`$MY_PKG_CONFIG --libs-only-l avahi-compat-libdns_sd`
+    echo "$as_me:$LINENO: result: yes" >&5
+    echo "${ECHO_T}yes" >&6
+  else
+    echo "$as_me:$LINENO: result: no" >&5
+    echo "${ECHO_T}no" >&6
+  fi
+fi
+
+  if test $HAVE_DNS_SD = 0 ; then
 
 for ac_header in dns_sd.h
 do
@@ -23387,8 +23412,6 @@
 
 done
 
-if test x$TARGET != xDARWIN; then
-
 { echo "$as_me:$LINENO: checking for DNSServiceRegister in -ldns_sd" >&5
 echo $ECHO_N "checking for DNSServiceRegister in -ldns_sd... $ECHO_C" >&6; }
 if test "${ac_cv_lib_dns_sd_DNSServiceRegister+set}" = set; then
@@ -23472,6 +23495,7 @@
 _ACEOF
 
   LIBS="-ldns_sd $LIBS"
+  HAVE_DNS_SD=1; with_dns_sd="yes"; problem_dns_sd=""
 
 else
   HAVE_DNS_SD=0; with_dns_sd="no"; problem_dns_sd=" (dns_sd library not found)"
@@ -25092,6 +25116,9 @@
 HAVE_FREETYPE2_TRUE!$HAVE_FREETYPE2_TRUE$ac_delim
 HAVE_FREETYPE2_FALSE!$HAVE_FREETYPE2_FALSE$ac_delim
 HAVE_DNS_SD!$HAVE_DNS_SD$ac_delim
+DNS_SD_CPPFLAGS!$DNS_SD_CPPFLAGS$ac_delim
+DNS_SD_LDFLAGS!$DNS_SD_LDFLAGS$ac_delim
+DNS_SD_LIBS!$DNS_SD_LIBS$ac_delim
 HAVE_DNS_SD_TRUE!$HAVE_DNS_SD_TRUE$ac_delim
 HAVE_DNS_SD_FALSE!$HAVE_DNS_SD_FALSE$ac_delim
 HAVE_FFMPEG!$HAVE_FFMPEG$ac_delim
@@ -25121,7 +25148,7 @@
 LTLIBOBJS!$LTLIBOBJS$ac_delim
 _ACEOF
 
-  if test `sed -n "s/.*$ac_delim\$/X/p" conf$$subs.sed | grep -c X` = 70; then
+  if test `sed -n "s/.*$ac_delim\$/X/p" conf$$subs.sed | grep -c X` = 73; then
     break
   elif $ac_last_try; then
     { { echo "$as_me:$LINENO: error: could not make $CONFIG_STATUS" >&5
--- nucleo.pc.in.orig	2006-04-02 16:49:58
+++ nucleo.pc.in	2007-02-26 12:41:15
@@ -6,5 +6,5 @@
 Name: nucleo
 Description: a toolking for exploring new uses of video and new interaction techniques
 Version: @VERSION@
-Cflags: @CPPFLAGS@ -I${includedir}
-Libs: @LDFLAGS@ -L${libdir} -lNucleo @LIBS@
+Cflags: @CPPFLAGS@ -I${includedir} @DNS_SD_CPPFLAGS@
+Libs: @LDFLAGS@ -L${libdir} -lNucleo @LIBS@ @DNS_SD_LIBS@
--- nucleo-config.in.orig	2007-01-15 16:33:27
+++ nucleo-config.in	2007-02-26 12:41:15
@@ -13,10 +13,10 @@
 libdir=@libdir@
 includedir=@includedir@
 
-CPPFLAGS="@CPPFLAGS@ -I$includedir"
+CPPFLAGS="@CPPFLAGS@ -I$includedir @DNS_SD_CPPFLAGS@"
 CXXFLAGS="@CXXFLAGS@"
 LDFLAGS="-L$libdir @LDFLAGS@"
-LIBS="-lNucleo @LIBS@"
+LIBS="-lNucleo @LIBS@ @DNS_SD_LIBS@"
 
 case $1 in
   --cxx)
