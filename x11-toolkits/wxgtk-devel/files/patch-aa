
$FreeBSD$

--- configure.in.orig	Sun Sep 21 20:31:30 2003
+++ configure.in	Mon Oct  6 15:02:13 2003
@@ -1751,7 +1751,7 @@
         dnl Apple did fix the security problem in it and not using the system
         dnl library results in a whole bunch of warnings when linking with
         dnl Carbon framework
-        if test "$USE_DARWIN" = 1; then
+        if test "$USE_DARWIN" = 1 -o "$USE_FREEBSD" = 1; then
             system_zlib_h_ok="yes"
         else
             dnl we have troubles with ancient zlib versions (e.g. 1.0.4 is
@@ -2785,8 +2785,8 @@
 
 WX_VERSION_TAG=`echo WX${TOOLKIT_DIR}${TOOLKIT_VERSION}${WIDGET_SET}${lib_unicode_suffix}${lib_debug_suffix}_${WX_RELEASE} | tr "[[a-z]]" "[[A-Z]]"`
 
-TOOLCHAIN_NAME="${TOOLKIT_DIR}${TOOLKIT_VERSION}${WIDGET_SET}${lib_unicode_suffix}${lib_debug_suffix}-${WX_RELEASE}"
-TOOLCHAIN_NAME_GL="${TOOLKIT_DIR}${TOOLKIT_VERSION}${WIDGET_SET}${lib_unicode_suffix}${lib_debug_suffix}_gl-${WX_RELEASE}"
+TOOLCHAIN_NAME="${TOOLKIT_DIR}${WIDGET_SET}${lib_unicode_suffix}${lib_debug_suffix}"
+TOOLCHAIN_NAME_GL="${TOOLKIT_DIR}${WIDGET_SET}${lib_unicode_suffix}${lib_debug_suffix}_gl"
 
 if test "$cross_compiling" = "yes"; then
     TOOLCHAIN_NAME="${TOOLCHAIN_NAME}-${host_alias}"
@@ -2799,14 +2799,12 @@
 WX_LIBRARY_BASENAME="wx_${TOOLKIT_DIR}${TOOLKIT_VERSION}${WIDGET_SET}${lib_unicode_suffix}${lib_debug_suffix}"
 
 dnl the name of the shared library
-WX_LIBRARY_NAME_SHARED="lib${WX_LIBRARY}.${SO_SUFFIX}.${WX_CURRENT}.${WX_REVISION}.${WX_AGE}"
-WX_LIBRARY_NAME_SHARED_GL="lib${WX_LIBRARY_GL}.${SO_SUFFIX}.${WX_CURRENT}.${WX_REVISION}.${WX_AGE}"
+WX_LIBRARY_NAME_SHARED="lib${WX_LIBRARY}.${SO_SUFFIX}.2"
+WX_LIBRARY_NAME_SHARED_GL="lib${WX_LIBRARY_GL}.${SO_SUFFIX}.2"
 
 dnl the name of the links to the shared library
-WX_LIBRARY_LINK1="lib${WX_LIBRARY}.${SO_SUFFIX}.${WX_CURRENT}"
-WX_LIBRARY_LINK2="lib${WX_LIBRARY}.${SO_SUFFIX}"
-WX_LIBRARY_LINK1_GL="lib${WX_LIBRARY_GL}.${SO_SUFFIX}.${WX_CURRENT}"
-WX_LIBRARY_LINK2_GL="lib${WX_LIBRARY_GL}.${SO_SUFFIX}"
+WX_LIBRARY_LINK1="lib${WX_LIBRARY}.${SO_SUFFIX}"
+WX_LIBRARY_LINK1_GL="lib${WX_LIBRARY_GL}.${SO_SUFFIX}"
 
 case "${host}" in
     *-*-cygwin* | *-*-mingw32* )
@@ -3607,7 +3605,7 @@
         dnl simply linking with libpthread should make the test below work but
         dnl it's far from certain that the threaded programs compiled without
         dnl any special switches actually work, so try it after all the others
-        THREAD_OPTS="$THREAD_OPTS pthread none"
+        THREAD_OPTS=
 
         dnl now test for all possibilities
         THREADS_OK=no
@@ -3649,6 +3647,9 @@
               THREADS_CFLAGS=""
       done
 
+      THREADS_OK=yes
+      THREADS_LINK="$PTHREAD_LIBS"
+
       if test "x$THREADS_OK" != "xyes"; then
           wxUSE_THREADS=no
           AC_MSG_WARN([No thread support on this system... disabled])
@@ -3672,7 +3673,7 @@
                 flag="-D_THREAD_SAFE"
                 ;;
             *-freebsd*)
-                flag="-D_THREAD_SAFE"
+                flag="${PTHREAD_CFLAGS}"
                 ;;
             *-hp-hpux* )
                 flag="-D_REENTRANT"
@@ -3954,21 +3955,6 @@
     esac
 fi
 
-if test "$wxUSE_OPTIMISE" = "no" ; then
-    OPTIMISE=
-else
-    if test "$GCC" = yes ; then
-        OPTIMISE="-O2"
-        case "${host}" in
-            i586-*-*|i686-*-* )
-            OPTIMISE="${OPTIMISE} "
-        ;;
-        esac
-    else
-        OPTIMISE="-O"
-    fi
-fi
-
 if test "$WXWIN_COMPATIBILITY_2" = "yes"; then
     AC_DEFINE(WXWIN_COMPATIBILITY_2)
 
@@ -5439,7 +5425,6 @@
 AC_SUBST(WX_LIBRARY_IMPORTLIB)
 AC_SUBST(WX_TARGET_LIBRARY)
 AC_SUBST(WX_LIBRARY_LINK1)
-AC_SUBST(WX_LIBRARY_LINK2)
 AC_SUBST(PROGRAM_EXT)
 
 dnl global gl options
@@ -5447,7 +5432,6 @@
 AC_SUBST(WX_LIBRARY_NAME_SHARED_GL)
 AC_SUBST(WX_TARGET_LIBRARY_GL)
 AC_SUBST(WX_LIBRARY_LINK1_GL)
-AC_SUBST(WX_LIBRARY_LINK2_GL)
 
 dnl are we supposed to create the links?
 AC_SUBST(WX_ALL)
