# New ports collection makefile for:	XFree86-clients
# Date created:		10 Oct 1999
# Whom:			taguchi@tohoku.iij.ad.jp
#
# $FreeBSD$
#

PORTNAME=	clients
PORTVERSION=	4.2.1
CATEGORIES=	x11
MASTER_SITES=	${MASTER_SITE_XFREE:S/$/:x/} \
		${MASTER_SITE_XFREE:S/source//g:S/$/:x421patch/} \
		${MASTER_SITE_LOCAL:S/$/:local/}
MASTER_SITE_SUBDIR=	4.2.0/:x \
			${PORTVERSION}/patches/:x421patch \
			anholt/:local
PKGNAMEPREFIX=	XFree86-
DISTFILES=	X420src-1.tgz:x \
		X420src-2.tgz:x \
		4.2.0-4.2.1.diff.gz:x421patch \
		Wraphelp.gz:local
EXTRACT_ONLY=	X420src-1.tgz

PATCH_DIST_STRIP=	-p1

MAINTAINER=	anholt@freebsd.org

LIB_DEPENDS=	freetype.9:${PORTSDIR}/print/freetype2 \
		GLU.1:${PORTSDIR}/x11/XFree86-4-libraries

XFREE86_VERSION=	4
USE_IMAKE=		YES
DIST_SUBDIR=		xc
WRKSRC=			${WRKDIR}/xc
PATCHDIR=		${.CURDIR}/../XFree86-4-libraries/files
SCRIPTS_ENV=		InstallXdmConfig=${InstallXdmConfig} \
			InstallXinitConfig=${InstallXinitConfig} \
			InstallAppDefFiles=${InstallAppDefFiles} \
			HasSecureRPC=${HasSecureRPC} \
			HasPam=${HasPam}
MAKE_ENV=		PKGNAMEPREFIX=${PKGNAMEPREFIX} \
			PORTNAME=${PORTNAME} \
			PORTVERSION=${PORTVERSION}
ALL_TARGET=		FreeBSDPortsBuild
INSTALL_TARGET=		FreeBSDPortsInstall FreeBSDPortsInstall.man

# ---
# XFree86 User Config:
# Name          Default		Meaning
# ----------------------------------------------------------------------------
# HasSecureRPC	YES		build with SecureRPC (require FreeBSD-3 or later)
# HasPam	YES		support PAM (require FreeBSD-3.1 or later)
# InstallXdmConfig      YES     install config files for xdm.
# InstallXinitConfig    YES     install config files for xinit.
# InstallAppDefFiles    YES	install resource files.
# ----------------------------------------------------------------------------
# DEFAULT means ports will use values which set by ${PORTSDIR}/devel/imake-4
#
InstallXdmConfig?=	DEFAULT
InstallXinitConfig?=	DEFAULT
InstallAppDefFiles?=	DEFAULT
HasSecureRPC?=		DEFAULT
HasPam?=		DEFAULT

post-extract:
	( cd ${WRKDIR} && \
	 ${EXTRACT_CMD} ${EXTRACT_BEFORE_ARGS} \
	   ${DISTDIR}/${DIST_SUBDIR}/X420src-2.tgz \
	    | ${TAR} -xf - xc/fonts/util )
	${GUNZIP_CMD} -c ${DISTDIR}/${DIST_SUBDIR}/Wraphelp.gz > \
		${WRKSRC}/lib/Xdmcp/Wraphelp.c
pre-patch:
	-@${GZCAT} ${DISTDIR}/${DIST_SUBDIR}/4.2.0-4.2.1.diff.gz \
		| ${PATCH} ${PATCH_DIST_ARGS} --batch

post-patch:
	cd ${WRKSRC}/nls; \
	for i in Compose XI18N_OBJS XLC_LOCALE; do \
		${LN} -s zh_TW.big5 $$i/zh_TW.Big5; \
	done

do-configure:
	cd ${.CURDIR} && ${SETENV} ${SCRIPTS_ENV} ${SH} ${SCRIPTDIR}/configure
	@cd ${WRKSRC}; ${MAKE} FreeBSDPortsConfigure

.include <bsd.port.pre.mk>
.include "${FILESDIR}/manpages"
.include <bsd.port.post.mk>
