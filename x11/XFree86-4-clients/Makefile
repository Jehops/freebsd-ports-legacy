# New ports collection makefile for:	XFree86-clients
# Date created:		10 Oct 1999
# Whom:			taguchi@tohoku.iij.ad.jp
#
# $FreeBSD$
#

PORTNAME=	clients
PORTVERSION=	4.5.0
PORTREVISION=	3
CATEGORIES=	x11
MASTER_SITES=	${MASTER_SITE_XFREE}
MASTER_SITE_SUBDIR= ${PORTVERSION}
PKGNAMEPREFIX=	XFree86-
DISTFILES=	XFree86-${PORTVERSION}-src-1.tgz \
		XFree86-${PORTVERSION}-src-2.tgz \
		XFree86-${PORTVERSION}-src-3.tgz \
		XFree86-${PORTVERSION}-src-4.tgz

MAINTAINER=	x11@FreeBSD.org
COMMENT=	XFree86-4 client programs and related files

RUN_DEPENDS=	xterm>0:${PORTSDIR}/x11/xterm
LIB_DEPENDS=	freetype.9:${PORTSDIR}/print/freetype2 \
		expat.6:${PORTSDIR}/textproc/expat2 \
		Xcursor.1:${PORTSDIR}/x11/XFree86-4-libraries \
		png.5:${PORTSDIR}/graphics/png \
		Xft.2:${PORTSDIR}/x11-fonts/libXft

CONFLICTS=	xorg-clients-[0-9]*

SCRIPTS_ENV=		InstallXdmConfig=${InstallXdmConfig} \
			InstallXinitConfig=${InstallXinitConfig} \
			InstallAppDefFiles=${InstallAppDefFiles}

MAKE_ENV=		PKGNAMEPREFIX=${PKGNAMEPREFIX} \
			PORTNAME=${PORTNAME} \
			PORTVERSION=${PORTVERSION}
XBUILD_DIRS=		lib/xtrans lib/lbxutil programs fonts/util
XINSTALL_DIRS=		programs fonts/util
XINSTALL_MAN_DIRS=	programs

.for pf in patch-bdftruncate.pl patch-ucs2any.pl \
	   patch-programs::fonttosfnt::read.c \
	   patch-programs::Imakefile
EXTRA_PATCHES+=		${FILESDIR}/${pf}
.endfor

# ---
# XFree86 User Config:
# Name          Default		Meaning
# ----------------------------------------------------------------------------
# HasSecureRPC	YES		build with SecureRPC (require FreeBSD-3 or later)
# HasPam	YES		support PAM (require FreeBSD-3.1 or later)
# InstallXdmConfig      YES     install config files for xdm.
# InstallXinitConfig    YES     install config files for xinit.
# InstallAppDefFiles    YES	install resource files.
# ----------------------------------------------------------------------------
# DEFAULT means ports will use values which set by ${PORTSDIR}/devel/imake-4
#
InstallXdmConfig?=	DEFAULT
InstallXinitConfig?=	DEFAULT
InstallAppDefFiles?=	DEFAULT

.if !defined(WITH_SETUID_LUIT)
pre-everything::
	@${ECHO_MSG} "If you want to use xterm with locales in a secure manner, luit must be installed"
	@${ECHO_MSG} "setuid.  If you want to do this, define WITH_SETUID_LUIT when installing this"
	@${ECHO_MSG} "port (either in /etc/make.conf or on command line with install target)."
.endif

post-install:
	if [ ! -e ${X11BASE}/bin/resize ]; then \
		${LN} -sf ${X11BASE}/bin/resize-static ${X11BASE}/bin/resize; \
	fi
	if [ ! -e ${X11BASE}/bin/xterm ]; then \
		${LN} -sf ${X11BASE}/bin/xterm-static ${X11BASE}/bin/xterm; \
	fi
	if [ ! -e ${X11BASE}/bin/uxterm ]; then \
		${LN} -sf ${X11BASE}/bin/uxterm-static ${X11BASE}/bin/uxterm; \
	fi
	if [ ! -e ${X11BASE}/lib/X11/app-defaults/UXTerm ]; then \
		${LN} -sf ${X11BASE}/lib/X11/app-defaults/UXTerm-static \
		${X11BASE}/lib/X11/app-defaults/UXTerm; \
	fi
	if [ ! -e ${X11BASE}/lib/X11/app-defaults/XTerm ]; then \
		${LN} -sf ${X11BASE}/lib/X11/app-defaults/XTerm-static \
		${X11BASE}/lib/X11/app-defaults/XTerm; \
	fi
	if [ ! -e ${X11BASE}/lib/X11/app-defaults/XTerm-color ]; then \
		${LN} -sf ${X11BASE}/lib/X11/app-defaults/XTerm-color-static \
		${X11BASE}/lib/X11/app-defaults/XTerm-color; \
	fi
.if defined(WITH_SETUID_LUIT)
	${CHOWN} root:wheel ${PREFIX}/bin/luit
	${CHMOD} 04711 ${PREFIX}/bin/luit
.endif
	@${SETENV} ${SCRIPTS_ENV} PKG_PREFIX="${PREFIX}" ${SH} ${PKGINSTALL} ${PKGNAME} POST-INSTALL

.include "${.CURDIR}/../../x11/XFree86-4-libraries/Makefile.inc"
.include <bsd.port.pre.mk>

.if ${X_WINDOW_SYSTEM:L} != xfree86-4
IGNORE=	is part of XFree86 and you have ${X_WINDOW_SYSTEM} set for X11\
	distribution. See The X Window System and Virtual Consoles chapter\
	of FAQ for more information
.endif

.include "${FILESDIR}/manpages"

.include <bsd.port.post.mk>
