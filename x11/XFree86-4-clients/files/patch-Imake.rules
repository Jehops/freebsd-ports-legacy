--- config/cf/Imake.rules.orig	Sat Jan  3 16:16:06 2004
+++ config/cf/Imake.rules	Sat Jan  3 16:18:47 2004
@@ -3148,7 +3148,12 @@
  * Also delete line numbers from the cpp output (-P is not portable, I guess).
  */
 #ifndef CppSedMagic
-#define CppSedMagic sed -e '/^#  *[0-9][0-9]*  *.*$$/d' -e '/^XCOMM$$/s//#/' -e '/^XCOMM[^a-zA-Z0-9_]/s/^XCOMM/#/'
+#define CppSedMagic sed -e '/^#  *[0-9][0-9]*  *.*$$/d' \
+			-e '/^#line  *[0-9][0-9]*  *.*$$/d' \
+			-e '/^[ 	]*XCOMM$$/s/XCOMM/#/' \
+			-e '/^[ 	]*XCOMM[^a-zA-Z0-9_]/s/XCOMM/#/' \
+			-e '/^[ 	]*XHASH/s/XHASH/#/' \
+			-e '/\@\@$$/s/\@\@$$/\\/'
 #endif /* CppSedMagic */
 
 #ifndef CppFileTarget
