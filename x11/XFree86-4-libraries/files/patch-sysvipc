--- programs/Xserver/hw/xfree86/os-support/bsd/Imakefile.orig	Fri Aug  2 00:27:08 2002
+++ programs/Xserver/hw/xfree86/os-support/bsd/Imakefile	Fri Aug  2 00:28:25 2002
@@ -62,6 +62,10 @@
 MTRRDEFINES = -DHAS_MTRR_BUILTIN
 #endif
 
+#if defined(FreeBSDArchitecture)
+SYSVIPCDEFINES = -DHAVE_SYSV_IPC
+#endif
+
 #if UsbMouseSupport
 USBMOUSEDEFINES1 = -DUSBMOUSE_SUPPORT
 #if !HasLibUsb
@@ -142,7 +146,7 @@
 #endif
 
 DEFINES = $(CONSDEFINES) $(APDEFINES) $(IOPERMDEFINES) $(RESDEFINES) \
-	  $(MTRRDEFINES) $(USBMOUSEDEFINES)
+	  $(MTRRDEFINES) $(USBMOUSEDEFINES) $(SYSVIPCDEFINES)
 
 #if defined(AlphaArchitecture)
 SpecialObjectRule(bsd_ev56.o, bsd_ev56.c, -mcpu=ev56)
--- programs/Xserver/hw/xfree86/os-support/shared/libc_wrapper.c.orig	Fri Aug  2 00:25:26 2002
+++ programs/Xserver/hw/xfree86/os-support/shared/libc_wrapper.c	Fri Aug  2 00:25:48 2002
@@ -1879,7 +1879,9 @@
     
     if (xf86shmflg & XF86SHM_RDONLY) shmflg |= SHM_RDONLY;
     if (xf86shmflg & XF86SHM_RND) shmflg    |= SHM_RND;
+#ifdef SHM_REMAP
     if (xf86shmflg & XF86SHM_REMAP) shmflg  |= SHM_REMAP;
+#endif
 
     return shmat(id,addr,shmflg);
 }
