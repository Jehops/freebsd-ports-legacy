--- Makefile.orig	Mon May 19 06:04:28 1997
+++ Makefile	Sun Apr 11 20:42:32 1999
@@ -1,11 +1,13 @@
-CC = cc 
-CFLAGS = -O3 -Wall -DNETWORK_DB -I./st
-LDFLAGS = -lscsi 
-STLIB = ./st/libst.a
+CC ?= cc 
+CFLAGS ?= -O3
+CFLAGS += -Wall -DNETWORK_DB -I./st -I.
+LDFLAGS =
+STLIB = st/libst.a
 
 CDD_OBJECTS = cdd.o cdd_util.o cdd_cdcmds.o cdd_xmcddiscid.o cdd_cddb.o \
               cdd_plextorcmds.o \
               cdd_hpcmds.o \
+              cdd_atapicmds.o \
               cdd_toshibacmds.o 
 
 PCMPLAY_OBJECTS = pcmplay.o
@@ -14,6 +16,9 @@
 
 all: cdd pcmplay stripzeros
 
+st/libst.a:
+	cd st ; make
+
 $(CDD_OBJECTS): cdd.h
 
 pcmplay: $(PCMPLAY_OBJECTS)
@@ -22,7 +27,7 @@
 stripzeros: $(STRIPZEROS_OBJECTS)
 	$(CC) $(CFLAGS) -o $@ $(STRIPZEROS_OBJECTS) $(LDFLAGS)
 
-cdd: $(CDD_OBJECTS) 
+cdd: $(CDD_OBJECTS) $(STLIB)
 	$(CC) $(CFLAGS) -o $@ $(CDD_OBJECTS) $(LDFLAGS) $(STLIB) -DDEBUG
 
 clean:
