# New ports collection makefile for:	musicpd
# Date created:		Tue Oct 02 2003
# Whom:			Mark Reidel <ports@mark.reidel.info>
#
# $FreeBSD$
#

PORTNAME=	musicpd
PORTVERSION=	0.13.1
PORTREVISION=	3
CATEGORIES=	audio ipv6
MASTER_SITES=	http://musicpd.org/uploads/files/ \
		http://redundancy.redundancy.org/mirror/
MASTER_SITE_SUBDIR=	${PORTNAME}
DISTNAME=	mpd-${PORTVERSION}

MAINTAINER=	jo.lindqvist@gmail.com
COMMENT=	A remote-controllable music-daemon

LIB_DEPENDS+=	mad.2:${PORTSDIR}/audio/libmad

USE_BZIP2=	yes
GNU_CONFIGURE=	yes
USE_RC_SUBR=	musicpd.sh
PKGMESSAGE=	${WRKDIR}/pkg-message
CONFIGURE_ENV=	CPPFLAGS="-I${LOCALBASE}/include" \
		LDFLAGS="-L${LOCALBASE}/lib"

CFLAGS+=	-I${PREFIX}/include

MAN1=		mpd.1
MAN5=		mpd.conf.5

DOCSDIR=	${PREFIX}/share/doc/mpd

SUB_FILES=	pkg-message

OPTIONS=	FLAC "Support for FLAC Audio" on \
		VORBIS "Support for OGG Vorbis Audio" on \
		WAV "Support for WAV Audio" on \
		AAC "Support for MP4/AAC Audio" off \
		MUSEPACK "Support for MPC Audio" off \
		MOD "Support for MOD Audio" off \
		ICONV "Support for international characters" on \
	        ID3TAG "Support for id3v1 tag encoding" off \
		IPV6 "Support for IPV6" on \
		AO "Support for libao" off \
		PULSE "Support for PulseAudio" off \
		JACK "Support for JACK" off \
		SHOUT "Support for Icecast and Shoutcast" on \
		SAMPLERATE "Support for ibsamplerate" on

.include <bsd.port.pre.mk>

.ifdef(WITHOUT_FLAC)
CONFIGURE_ARGS+=--disable-flac \
		--disable-oggflac
.else
LIB_DEPENDS+=	FLAC.10:${PORTSDIR}/audio/flac
.endif

.ifdef(WITHOUT_VORBIS)
CONFIGURE_ARGS+=--disable-ogg
.else
LIB_DEPENDS+=	vorbis.4:${PORTSDIR}/audio/libvorbis
.endif

.ifdef(WITHOUT_WAV)
CONFIGURE_ARGS+=--disable-audiofile
.else
LIB_DEPENDS+=	audiofile.0:${PORTSDIR}/audio/libaudiofile
.endif

.ifdef(WITH_AAC)
LIB_DEPENDS+=	faad.0:${PORTSDIR}/audio/faad
.else
CONFIGURE_ARGS+=--disable-aac
.endif

.ifdef(WITH_MUSEPACK)
LIB_DEPENDS+=	mpcdec.5:${PORTSDIR}/audio/libmpcdec
.else
CONFIGURE_ARGS+=--disable-mpc
.endif

.ifdef(WITH_MOD)
LIB_DEPENDS+=	mikmod.2:${PORTSDIR}/audio/libmikmod
.else
CONFIGURE_ARGS+=--disable-mod
.endif

.ifdef(WITHOUT_ICONV)
CONFIGURE_ARGS+=--disable-iconv
.else
USE_ICONV=	yes
.endif

.ifdef(WITH_ID3TAG)
LIB_DEPENDS+=	id3tag.0:${PORTSDIR}/audio/libid3tag
CONFIGURE_ARGS+=--enable-mpd-id3tag
.endif

.ifdef(WITHOUT_IPV6)
CONFIGURE_ARGS+=--disable-ipv6
.endif

.ifdef(WITH_AO)
CONFIGURE_ARGS+=--enable-ao
LIB_DEPENDS+=	ao.3:${PORTSDIR}/audio/libao
.endif

.ifdef(WITH_PULSE)
LIB_DEPENDS+=	pulse.0:${PORTSDIR}/audio/pulseaudio
.else
CONFIGURE_ARGS+=--disable-pulse
.endif

.ifdef(WITH_JACK)
LIB_DEPENDS+=	jack.0:${PORTSDIR}/audio/jack
.else
CONFIGURE_ARGS+=--disable-jack
.endif

.ifdef(WITHOUT_SHOUT)
CONFIGURE_ARGS+=--disable-shout
.endif

.ifdef(WITHOUT_SAMPLERATE)
CONFIGURE_ARGS+=--disable-lsr
.else
LIB_DEPENDS+=	samplerate.1:${PORTSDIR}/audio/libsamplerate
.endif

.if defined(NOPORTDOCS)
post-patch:
	@${REINPLACE_CMD} -e '/^install-data-am:/ s|install-docDATA||' \
		${WRKSRC}/Makefile.in ${WRKSRC}/doc/Makefile.in
.endif

post-install:
	@${CAT} ${PKGMESSAGE}

.include <bsd.port.post.mk>
