#!/bin/sh
#
# $FreeBSD$
#

# PROVIDE: squeezecenter
# REQUIRE: LOGIN
# KEYWORD: shutdown

#
# Add the following lines to /etc/rc.conf to enable squeezecenter:
#
#squeezecenter_enable="YES"
#

. %%RC_SUBR%%

name=squeezecenter
start_precmd="squeezecenter_start_precmd"
rcvar=`set_rcvar`

command=%%PREFIX%%/%%SLIMDIR%%/slimserver.pl
command_interpreter=%%PERL%%
pidfile=/var/run/${name}.pid
logfile=/var/log/squeezecenter.log
statedir=%%SLIMDBDIR%%
cachedir=${statedir}/cache
prefsdir=${statedir}/prefs
playlistdir=${statedir}/playlists
conffile=${statedir}/squeezecenter.conf
u=%%SLIMUSER%%
g=%%SLIMGROUP%%
command_args="--daemon --prefsfile=${conffile} --logfile=${logfile} --user=${u} --group=${g} --pidfile=${pidfile}"

squeezecenter_start_precmd()
{
	if [ ! -d ${statedir} ]; then
		mkdir -p ${statedir}
		chown -R ${u}:${g} ${statedir}
	fi
	if [ ! -d ${cachedir} ]; then
		mkdir -p ${cachedir}
		chown -R ${u}:${g} ${cachedir}
	fi
	if [ ! -d ${prefsdir} ]; then
		mkdir -p ${prefsdir}
		chown -R ${u}:${g} ${prefsdir}
	fi
	if [ ! -d ${playlistdir} ]; then
		mkdir -p ${playlistdir}
		chown -R ${u}:${g} ${playlistdir}
	fi
	if [ ! -f ${conffile} ]; then
		touch ${conffile}
		chown ${u}:${g} ${conffile}
	fi
	if [ ! -f ${logfile} ]; then
		touch ${logfile}
		chown ${u}:${g} ${logfile}
	fi
}

load_rc_config ${name}

squeezecenter_enable=${squeezecenter_enable:-"NO"}
squeezecenter_flags=${squeezecenter_flags:-""}

run_rc_command "$1"
