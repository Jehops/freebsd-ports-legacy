--- Makefile.orig	Fri Jan 28 16:56:12 2005
+++ Makefile	Sun Mar  6 12:56:51 2005
@@ -98,7 +98,7 @@
 
 ifndef MINGW
 LDADD    = -lm
-#LDADD   += -lesd
+LDADD   += -L$(LOCALBASE)/lib -lesd
 else
 LDADD    = -lwinmm -lws2_32
 endif
@@ -161,7 +161,7 @@
 
 FLAGS = \
 	-fomit-frame-pointer -funroll-loops \
-	-mno-ieee-fp -ffast-math -pipe
+	-pipe
 
 ifneq ($(CC_MAJ),4)
 FLAGS += -fmove-all-movables
@@ -211,9 +211,9 @@
 
 # Merge all options together for CFLAGS and CFLAG_SIZE
 
-CFLAGS        += $(ARCH) $(FEATURE) $(WARN) $(PROFILE) $(DEBUG) -DMPPDEC_VERSION=\"$(MPPDEC_VERSION)\" -DMPPENC_VERSION=\"$(MPPENC_VERSION)\"
+CFLAGS        += $(FEATURE) $(WARN) $(PROFILE) $(DEBUG) -DMPPDEC_VERSION=\"$(MPPDEC_VERSION)\" -DMPPENC_VERSION=\"$(MPPENC_VERSION)\"
 ifndef MINGW
-CFLAGS       += -I$(XINCLDIR) -L$(XLIBDIR)
+CFLAGS       += -I$(LOCALBASE)/include
 endif
 #CFLAGS      += $(ASSEM)
 CFLAGS_SIZE   = $(CFLAGS) $(OPTIM_SIZE)
@@ -254,12 +254,15 @@
 
 # Lists of object and C files
 
-MPPDEC_OBJ = cpu_feat.o decode.o http.o huffsv7.o huffsv46.o id3tag.o mppdec.o profile.o requant.o synth.o synthasm.o synthtab.o toolsd.o wave_out.o stderr.o _setargv.o
+MPPDEC_OBJ = decode.o http.o huffsv7.o huffsv46.o id3tag.o mppdec.o profile.o requant.o synth.o synthtab.o toolsd.o wave_out.o stderr.o _setargv.o
 MPPDEC_SRC =            decode.c http.c huffsv7.c huffsv46.c id3tag.c mppdec.c profile.c requant.c synth.c            synthtab.c tools.c  wave_out.c stderr.c _setargv.c
 MPPDEC_ASO = cpu_feat.o                                                                                     synthasm.o
+ifeq ($(ARCH),i386)
+MPPDEC_OBJ+= cpu_feat.o synthasm.o
+endif
 
 
-MPPENC_OBJ = analy_filter.o ans.o bitstream.o cvd.o fft4g.o fft4gasm.o fft_routines.o mppenc.o profile.o psy.o psy_tab.o quant.o huffsv7e.o encode_sv7.o wave_in.o tags.o toolse.o fastmath.o pipeopen.o stderr.o regress.o keyboard.o
+MPPENC_OBJ = analy_filter.o ans.o bitstream.o cvd.o fft4g.o fft_routines.o mppenc.o profile.o psy.o psy_tab.o quant.o huffsv7e.o encode_sv7.o wave_in.o tags.o toolse.o fastmath.o pipeopen.o stderr.o regress.o keyboard.o
 ifdef MINGW
 MPPENC_OBJ += winmsg.o
 endif
@@ -268,6 +271,9 @@
 MPPENC_SRC += winmsg.c
 endif
 MPPENC_ASO =                                                fft4gasm.o
+ifeq ($(ARCH),i386)
+MPPENC_OBJ+= fft4gasm.o
+endif
 
 
 REPLAY_OBJ = replaygain.o gain_analysis.o pipeopen.o stderr.o _setargv.o
@@ -393,8 +399,10 @@
 #
 # Compile mppdec source code files
 
-config.h: mpp.h config.c
-	$(CC) -DMPP_DECODER $(CFLAGS) -o config config.c   $(LDADD) &> $(LOGFILE)
+config: mpp.h config.c
+	$(CC) -DMPP_DECODER $(CFLAGS) -o config config.c   $(LDADD)
+
+config.h: config
 	@$(RM_F) config.h
 	@./config "$(CC) $(CFLAGS) -o <<EXE>> <<SRC>> $(LDADD)" "./<<EXE>>"
 	@$(RM_F) config
