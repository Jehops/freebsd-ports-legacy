--- tcd/callbacks.c.orig	Thu Jan 13 22:27:52 2000
+++ tcd/callbacks.c	Tue May 30 15:17:17 2000
@@ -12,3 +12,3 @@
 {
-    if(cd.sc.cdsc_audiostatus==CDROM_AUDIO_PAUSED)
+    if(SC_AUDIOSTATUS(cd.sc)==CDROM_AUDIO_PAUSED)
 	tcd_pausecd(&cd);
@@ -44,3 +44,3 @@
     /* SDH: Make sure play/pause state change is noticed */
-    cd.sc.cdsc_audiostatus = -1;
+    SC_AUDIOSTATUS(cd.sc) = -1;
     if(cd.isplayable)
--- tcd/cddb.c.orig	Thu Jan 13 22:27:52 2000
+++ tcd/cddb.c	Tue May 30 15:17:17 2000
@@ -201,7 +201,7 @@
 		
-		min = cd->trk[trk].toc.cdte_addr.msf.minute;
-		sec = cd->trk[trk].toc.cdte_addr.msf.second;
+		min = TOC_MINUTE(cd->trk[trk]);
+		sec = TOC_SECOND(cd->trk[trk]);
 	
 		n = (min*60)+sec;
-		fprintf( fp, "# %u\n", (n*75)+cd->trk[trk].toc.cdte_addr.msf.frame );
+		fprintf( fp, "# %u\n", (n*75)+TOC_FRAME(cd->trk[trk]) );
 	}
@@ -209,4 +209,4 @@
 	fprintf( fp, "#\n# Disc length: %i seconds\n", 
-		(cd->trk[cd->last_t+1].toc.cdte_addr.msf.minute*60)
-                +(cd->trk[cd->last_t+1].toc.cdte_addr.msf.second) );
+		(TOC_MINUTE(cd->trk[cd->last_t+1])*60)
+                +(TOC_SECOND(cd->trk[cd->last_t+1])) );
 
@@ -247,6 +247,6 @@
 	
-	min = cd->trk[i].toc.cdte_addr.msf.minute;
-	sec = cd->trk[i].toc.cdte_addr.msf.second;
+	min = TOC_MINUTE(cd->trk[i]);
+	sec = TOC_SECOND(cd->trk[i]);
         
-	l=sprintf( tmp, "%u ", calc_offset(min,sec,cd->trk[i].toc.cdte_addr.msf.frame));
+	l=sprintf( tmp, "%u ", calc_offset(min,sec,TOC_FRAME(cd->trk[i])));
 	
@@ -259,4 +259,4 @@
     l=sprintf( tmp, "%i\n",
-	       (cd->trk[cd->last_t+1].toc.cdte_addr.msf.minute*60)
-	       +(cd->trk[cd->last_t+1].toc.cdte_addr.msf.second) );
+	       (TOC_MINUTE(cd->trk[cd->last_t+1])*60)
+	       +(TOC_SECOND(cd->trk[cd->last_t+1])) );
     if(blen>l)
@@ -300,5 +300,5 @@
 	{
- 		cdtoc[i].frame = cd->trk[i+1].toc.cdte_addr.msf.frame;
- 		cdtoc[i].min = cd->trk[i+1].toc.cdte_addr.msf.minute;
- 		cdtoc[i].sec = cd->trk[i+1].toc.cdte_addr.msf.second;
+ 		cdtoc[i].frame = TOC_FRAME(cd->trk[i+1]);
+ 		cdtoc[i].min = TOC_MINUTE(cd->trk[i+1]);
+ 		cdtoc[i].sec = TOC_SECOND(cd->trk[i+1]);
  	}
--- tcd/gtcd.c.orig	Sun May 21 15:13:04 2000
+++ tcd/gtcd.c	Tue May 30 15:17:17 2000
@@ -157,3 +157,7 @@
 	cd.time_lock = TRUE;
+#ifdef TCD_BSD
+	ioctl(cd.cd_dev, CDIOCPAUSE);
+#else
 	ioctl(cd.cd_dev, CDROMPAUSE);
+#endif
 
@@ -421,4 +425,4 @@
 		cur = cd.cur_pos_abs;
-		end = (cd.trk[cd.last_t+1].toc.cdte_addr.msf.minute
-		       *60)+cd.trk[cd.last_t+1].toc.cdte_addr.msf.second;
+		end = (TOC_MINUTE(cd.trk[cd.last_t+1])*60
+		        +TOC_SECOND(cd.trk[cd.last_t+1]));
 		pos = end-cur;
@@ -524,3 +528,3 @@
 	{
-		switch( cd.sc.cdsc_audiostatus )
+		switch( SC_AUDIOSTATUS(cd.sc) )
 		{
@@ -620,4 +624,4 @@
 	/* see if we need to repeat */
-	if( cd.sc.cdsc_audiostatus != CDROM_AUDIO_PLAY &&
-	    cd.sc.cdsc_audiostatus != CDROM_AUDIO_PAUSED )
+	if( SC_AUDIOSTATUS(cd.sc) != CDROM_AUDIO_PLAY &&
+	    SC_AUDIOSTATUS(cd.sc) != CDROM_AUDIO_PAUSED )
 	{
@@ -638,3 +642,3 @@
 {
-	if(old_status != cd.sc.cdsc_audiostatus)
+	if(old_status != SC_AUDIOSTATUS(cd.sc))
 	{
@@ -645,3 +649,3 @@
 	
-		old_status = cd.sc.cdsc_audiostatus;
+		old_status = SC_AUDIOSTATUS(cd.sc);
 		g_snprintf(tmp, 255, "tcd/%s.xpm", 
--- tcd/gtracked.c.orig	Sun May 21 15:13:05 2000
+++ tcd/gtracked.c	Tue May 30 15:17:17 2000
@@ -211,4 +211,4 @@
     g_snprintf(tmp, 63, _("Disc Information (%02u:%02u minutes)"),
-	       cd.trk[cd.last_t+1].toc.cdte_addr.msf.minute,
-	       cd.trk[cd.last_t+1].toc.cdte_addr.msf.second);
+	       TOC_MINUTE(cd.trk[cd.last_t+1]),
+	       TOC_SECOND(cd.trk[cd.last_t+1]));
 
--- tcd/linux-cdrom.c.orig	Thu Jan 13 22:27:52 2000
+++ tcd/linux-cdrom.c	Tue May 30 15:29:32 2000
@@ -73,3 +73,3 @@
     
-#if defined(TCD_CHANGER_ENABLED)
+#if defined(TCD_CHANGER_ENABLED) && !defined(TCD_BSD)
     cd->nslots = ioctl( cd->cd_dev, CDROM_CHANGER_NSLOTS );
@@ -116,4 +116,7 @@
 {
-    int tmp,i;
+    int i;
     int delsecs;
+#ifdef TCD_BSD
+    struct ioc_read_toc_single_entry tocentry;
+#endif
 
@@ -127,3 +130,7 @@
     /* read the TOC header */
+#ifdef TCD_BSD
+    if((ioctl( cd->cd_dev, CDIOREADTOCHEADER, &cd->tochdr))==-1)
+#else
     if(ioctl( cd->cd_dev, CDROMREADTOCHDR, &cd->tochdr))
+#endif
     {
@@ -134,2 +141,5 @@
 	cd->cddb_id = 0;
+#ifdef TCD_BSD
+	ioctl( cd->cd_dev, CDIOCALLOW);
+#endif
 	return(-1);		
@@ -138,11 +148,25 @@
     /* grab first & last tracks */
+#ifdef TCD_BSD
+    cd->first_t = cd->tochdr.starting_track;
+    cd->last_t = cd->tochdr.ending_track;
+#else
     cd->first_t = cd->tochdr.cdth_trk0;
     cd->last_t = cd->tochdr.cdth_trk1;
+#endif
 
     /* read the leadout track */
+#ifdef TCD_BSD
+    tocentry.track = 0xaa;   /* Magic last track */
+    tocentry.address_format = CD_MSF_FORMAT;
+#else
     cd->trk[C(cd->last_t+1)].toc.cdte_track = CDROM_LEADOUT;
     cd->trk[C(cd->last_t+1)].toc.cdte_format = CDROM_MSF;
+#endif
 
     /* read the leadout toc */
+#ifdef TCD_BSD
+    if((ioctl(cd->cd_dev, CDIOREADTOCENTRY, &tocentry)) == -1)
+#else
     if(ioctl(cd->cd_dev, CDROMREADTOCENTRY, &cd->trk[C(cd->last_t+1)].toc))
+#endif
     {
@@ -154,4 +178,15 @@
 	cd->cddb_id = 0;
+#ifdef TCD_BSD
+	ioctl( cd->cd_dev, CDIOCALLOW);
+#endif
 	return(-1);
-    }                                         
+    } 
+
+#ifdef TCD_BSD
+    cd->trk[C(cd->last_t+1)].toc = tocentry.entry;
+#endif
+    cd->trk[C(cd->last_t+1)].length = TOC_MINUTE(cd->trk[C(cd->last_t+1)]) * 60 +
+	TOC_SECOND(cd->trk[C(cd->last_t+1)]);
+    cd->trk[C(cd->last_t+1)].start = cd->trk[C(cd->last_t+1)].length * 75 +
+	TOC_FRAME(cd->trk[C(cd->last_t+1)]);
 
@@ -160,6 +195,15 @@
     {
+#ifdef TCD_BSD
+	tocentry.track = i;
+	tocentry.address_format = CD_MSF_FORMAT;
+#else
 	cd->trk[C(i)].toc.cdte_track = i;
 	cd->trk[C(i)].toc.cdte_format = CDROM_MSF;
+#endif
 	
+#ifdef TCD_BSD
+	if((ioctl(cd->cd_dev, CDIOREADTOCENTRY, &tocentry)) == -1)
+#else
 	if(ioctl(cd->cd_dev, CDROMREADTOCENTRY, &cd->trk[C(i)].toc))
+#endif
 	{
@@ -170,2 +214,5 @@
 	    cd->cddb_id = 0;
+#ifdef TCD_BSD
+	    ioctl( cd->cd_dev, CDIOCALLOW);
+#endif
 	    return(-1);
@@ -173,7 +220,12 @@
 
+#ifdef TCD_BSD
+	cd->trk[C(i)].toc = tocentry.entry;
+	cd->trk[C(i)].type = cd->trk[C(i)].toc.control;
+#else
 	cd->trk[C(i)].type = cd->trk[C(i)].toc.cdte_ctrl;
-	cd->trk[C(i)].length = cd->trk[C(i)].toc.cdte_addr.msf.minute * 60 +
-	    cd->trk[C(i)].toc.cdte_addr.msf.second;
+#endif
+	cd->trk[C(i)].length = TOC_MINUTE(cd->trk[C(i)]) * 60 +
+	    TOC_SECOND(cd->trk[C(i)]);
 	cd->trk[C(i)].start = cd->trk[C(i)].length * 75 + 
-	    cd->trk[C(i)].toc.cdte_addr.msf.frame;
+	    TOC_FRAME(cd->trk[C(i)]);
     }
@@ -184,6 +236,3 @@
 	/* Taken from cdtool...Thanks Thomas I.! */
-	delsecs = cd->trk[C(i+1)].toc.cdte_addr.msf.minute * 60
-	    + cd->trk[C(i+1)].toc.cdte_addr.msf.second
-	    - cd->trk[C(i)].toc.cdte_addr.msf.minute * 60
-	    - cd->trk[C(i)].toc.cdte_addr.msf.second;
+	delsecs = cd->trk[C(i+1)].length - cd->trk[C(i)].length;
 
@@ -206,3 +255,3 @@
     debug("cdrom.c: tcd_readtoc exiting normally\n" );
-    return tmp;
+    return 0;
 }
@@ -216,5 +265,4 @@
     /* calculate various timing values */
-    cd->cur_pos_abs = cd->sc.cdsc_absaddr.msf.minute * 60 +
-	cd->sc.cdsc_absaddr.msf.second;
-    cd->cur_frame = cd->cur_pos_abs * 75 + cd->sc.cdsc_absaddr.msf.frame;
+    cd->cur_pos_abs = SC_MINUTE(cd->sc) * 60 + SC_SECOND(cd->sc);
+    cd->cur_frame = cd->cur_pos_abs * 75 + SC_FRAME(cd->sc);
         
@@ -237,4 +285,6 @@
 #ifdef TCD_CHANGER_ENABLED
+#ifndef TCD_BSD
     cd->cur_disc = ioctl( cd->cd_dev, CDROM_SELECT_DISC, CDSL_CURRENT );
 #endif
+#endif
 }
@@ -284,4 +334,16 @@
 {
+#ifdef TCD_BSD
+    struct ioc_read_subchannel subch;
+#endif
+
 	cd->err = FALSE;
+#ifdef TCD_BSD
+	subch.address_format = CD_MSF_FORMAT;
+	subch.data_format = CD_CURRENT_POSITION;
+	subch.data_len = sizeof(cd->sc);
+      subch.track = 0;
+	subch.data = &(cd->sc);
+#else
 	cd->sc.cdsc_format = CDROM_MSF;
+#endif
 	
@@ -289,3 +351,7 @@
 	{
+#ifdef TCD_BSD
+		if((ioctl( cd->cd_dev, CDIOCREADSUBCHANNEL, &subch)) == -1)
+#else
 		if(ioctl( cd->cd_dev, CDROMSUBCHNL, &cd->sc))
+#endif
 		{
@@ -295,8 +361,21 @@
 			cd->cur_t = 0;
+#ifdef TCD_BSD
+			ioctl( cd->cd_dev, CDIOCALLOW);
+#endif
 			return;
 		}
-		if(cd->sc.cdsc_audiostatus==CDROM_AUDIO_PLAY)
-			cd->cur_t = cd->sc.cdsc_trk;
+		if( SC_AUDIOSTATUS(cd->sc)==CDROM_AUDIO_PLAY )
+		{
+#ifdef TCD_BSD
+		    ioctl( cd->cd_dev, CDIOCPREVENT);
+#endif
+		    cd->cur_t = SC_TRACK(cd->sc);
+		}
 		else
+		{
+#ifdef TCD_BSD
+			ioctl( cd->cd_dev, CDIOCALLOW);
+#endif
 			cd->cur_t = 0;
+		}
 		tcd_recalculate(cd);
@@ -307,8 +386,21 @@
 {
+#ifdef TCD_BSD
+    struct ioc_vol vol;
+#else
     struct cdrom_volctrl vol;
+#endif
 
+#ifdef TCD_BSD
+    vol.vol[0] = volume;
+    vol.vol[1] = vol.vol[2] = vol.vol[3] = vol.vol[0];
+#else
     vol.channel0 = volume;
     vol.channel1 = vol.channel2 = vol.channel3 = vol.channel0;
-	
+#endif
+
+#ifdef TCD_BSD
+    if(ioctl(cd->cd_dev, CDIOCSETVOL, &vol) < 0)
+#else	
     if(ioctl(cd->cd_dev, CDROMVOLCTRL, &vol) < 0)
+#endif
 	return FALSE;
@@ -320,2 +412,10 @@
 {
+#ifdef TCD_BSD
+    struct ioc_vol vol;
+
+    if(ioctl(cd->cd_dev, CDIOCGETVOL, &vol) < 0)
+	return -1;
+
+    return vol.vol[0];
+#else
 #ifdef CDROMVOLREAD
@@ -330,2 +430,3 @@
 #endif
+#endif
 }	
@@ -334,4 +435,30 @@
 {
+#ifdef TCD_BSD
+    struct ioc_play_msf msf;
+#define MSF_START_MIN  (msf.start_m)
+#define MSF_START_SEC  (msf.start_s)
+#define MSF_START_FRM  (msf.start_f)
+#define MSF_END_MIN    (msf.end_m)
+#define MSF_END_SEC    (msf.end_s)
+#define MSF_END_FRM    (msf.end_f)
+    struct ioc_play_track trkind;
+#define TI_START_TRK   (trkind.start_track)
+#define TI_START_IND   (trkind.start_index)
+#define TI_END_TRK     (trkind.end_track)
+#define TI_END_IND     (trkind.end_index)
+#else
     struct cdrom_msf msf;
+#define MSF_START_MIN  (msf.cdmsf_min0)
+#define MSF_START_SEC  (msf.cdmsf_sec0)
+#define MSF_START_FRM  (msf.cdmsf_frame0)
+#define MSF_END_MIN    (msf.cdmsf_min1)
+#define MSF_END_SEC    (msf.cdmsf_sec1)
+#define MSF_END_FRM    (msf.cdmsf_frame0)
     struct cdrom_ti trkind;
+#define TI_START_TRK   (trkind.cdti_trk0)
+#define TI_START_IND   (trkind.cdti_ind0)
+#define TI_END_TRK     (trkind.cdti_trk1)
+#define TI_END_IND     (trkind.cdti_ind1)
+#endif
+
     int tmp;
@@ -344,3 +471,3 @@
     {
-	/* try and inject cd */
+	/* try and eject cd */
 	tcd_ejectcd(cd);
@@ -354,2 +481,5 @@
 
+#ifdef TCD_BSD
+    ioctl(cd->cd_dev, CDIOCCLOSE);
+#else
 #if defined(CDROMCLOSETRAY)
@@ -358,9 +488,15 @@
 #endif	        
-	
+#endif
+
+    /* bad hack. most data tracks are the first track... */
+#ifdef TCD_BSD
+    if(cd->trk[start_t].toc.control == 0x04)
+#else
     if(cd->trk[start_t].toc.cdte_ctrl == CDROM_DATA_TRACK)
-	start_t++;		/* bad hack. most data tracks are the first track... */
+#endif
+	start_t++;
 
-    msf.cdmsf_min0 = cd->trk[start_t].toc.cdte_addr.msf.minute;
-    msf.cdmsf_sec0 = cd->trk[start_t].toc.cdte_addr.msf.second;
-    msf.cdmsf_frame0 = cd->trk[start_t].toc.cdte_addr.msf.frame;
+    MSF_START_MIN = TOC_MINUTE(cd->trk[start_t]);
+    MSF_START_SEC = TOC_SECOND(cd->trk[start_t]);
+    MSF_START_FRM = TOC_FRAME(cd->trk[start_t]);
 	
@@ -368,5 +504,5 @@
     {
-	msf.cdmsf_min1 = cd->trk[start_t].tot_min+msf.cdmsf_min0;
-	msf.cdmsf_sec1 = cd->trk[start_t].tot_sec+msf.cdmsf_sec0;
-	msf.cdmsf_frame1=0;
+	MSF_END_MIN = cd->trk[start_t].tot_min+MSF_START_MIN;
+	MSF_END_SEC = cd->trk[start_t].tot_sec+MSF_START_SEC;
+	MSF_END_FRM = 0;
     }
@@ -374,20 +510,20 @@
     {
-	msf.cdmsf_min1 = cd->trk[end_t+1].toc.cdte_addr.msf.minute;
-	msf.cdmsf_sec1 = cd->trk[end_t+1].toc.cdte_addr.msf.second;
-	msf.cdmsf_frame1 = cd->trk[end_t+1].toc.cdte_addr.msf.frame - 1;
+	MSF_END_MIN = TOC_MINUTE(cd->trk[end_t+1]);
+	MSF_END_SEC = TOC_SECOND(cd->trk[end_t+1]);
+	MSF_END_FRM = TOC_FRAME(cd->trk[end_t+1]) - 1;
 
 #ifdef UNSIGNED_NUMBERS_CAN_BE_NEGATIVE
-	if(msf.cdmsf_frame1 < 0)
+	if(MSF_END_FRM < 0)
 	{
-	    msf.cdmsf_sec1 += msf.cdmsf_frame1;
-	    msf.cdmsf_frame1 = 0;
+	    MSF_END_SEC += MSF_END_FRM;
+	    MSF_END_FRM = 0;
 	}
-	if(msf.cdmsf_sec1 < 0)
+	if(MSF_END_SEC < 0)
 	{
-	    msf.cdmsf_min1 += msf.cdmsf_sec1;
-	    msf.cdmsf_sec1 = 0;
+	    MSF_END_MIN += MSF_END_SEC;
+	    MSF_END_SEC = 0;
 	}
-	if(msf.cdmsf_min1 < 0)
+	if(MSF_END_MIN < 0)
 	{
-	    msf.cdmsf_min1 = 0;
+	    MSF_END_MIN = 0;
 	}
@@ -395,6 +531,11 @@
     }
-    msf.cdmsf_min1 += (msf.cdmsf_sec1 / 60);
-    msf.cdmsf_sec1 %= 60;
+    MSF_END_MIN += (MSF_END_SEC / 60);
+    MSF_END_SEC %= 60;
 
+#ifdef TCD_BSD
+    ioctl( cd->cd_dev, CDIOCPREVENT);
+    if(only_use_trkind || ioctl( cd->cd_dev, CDIOCPLAYMSF, &msf))
+#else
     if(ioctl( cd->cd_dev, CDROMPLAYMSF, &msf) || only_use_trkind)
+#endif
     {
@@ -403,8 +544,12 @@
 	/* Try alternate method of playing */
-	trkind.cdti_trk0 = start_t;     /* start track */
-	trkind.cdti_ind0 = 0;      	/* start index */
-	trkind.cdti_trk1 = end_t;      	/* end track */
-	trkind.cdti_ind1 = 0;      	/* end index */
+	TI_START_TRK = start_t;		/* start track */
+	TI_START_IND = 0;		/* start index */
+	TI_END_TRK = end_t;		/* end track */
+	TI_END_IND = 0;			/* end index */
 		                                
+#ifdef TCD_BSD
+	if(ioctl(cd->cd_dev, CDIOCPLAYTRACKS, &trkind))
+#else
 	if(ioctl(cd->cd_dev, CDROMPLAYTRKIND, &trkind))
+#endif
 	{
@@ -413,2 +558,5 @@
 	    debug("cdrom.c: tcd_playtracks error. CDROMPLAYTRKIND ioctl error.\n");
+#ifdef TCD_BSD
+	    ioctl( cd->cd_dev, CDIOCALLOW);
+#endif
 	    return -1;
@@ -422,21 +570,10 @@
 
-static int msf_2_frame( cd_min_sec_frame *msf )
-{
-	return( ( msf->minute * CD_SECS + msf->second )
-			* CD_FRAMES + msf->frame );
-}
-
-static void frame_2_msf( int frame, cd_min_sec_frame *msf )
-{
-	msf->frame = frame % CD_FRAMES;
-	frame /= CD_FRAMES;
-	msf->second = frame % CD_SECS;
-	msf->minute = frame / CD_SECS;
-}
-
 int tcd_play_seconds( cd_struct *cd, long int offset )
 {
+#ifdef TCD_BSD
+    struct ioc_play_msf msf;
+#else
     struct cdrom_msf msf;
-    cd_min_sec_frame msf0;
-    int cur_frame, start_frame, end_frame;
+#endif
+    int tmp;
 
@@ -447,41 +584,42 @@
 
-    /* converting msf to frames makes life much easier */
-    start_frame = msf_2_frame( &cd->trk[C(cd->first_t)].toc.cdte_addr.msf );
-    end_frame = msf_2_frame( &cd->trk[C(cd->last_t+1)].toc.cdte_addr.msf ) - 1;
-    cur_frame = cd->cur_frame + ( offset * CD_FRAMES );
-
-    /* keep the cur_frame within the boundaries of the first and last track */
-    if ( cur_frame < start_frame ) {
-	    cur_frame = start_frame;
-    } else if ( cur_frame > end_frame ) {
-	    cur_frame = end_frame;
-    }
-
-    /* convert frames back to msf */
-    frame_2_msf( cur_frame, &msf0 );
-    msf.cdmsf_min0 = msf0.minute;
-    msf.cdmsf_sec0 = msf0.second;
-    msf.cdmsf_frame0 = msf0.frame;
-    msf.cdmsf_min1 = cd->trk[C(cd->last_t+1)].toc.cdte_addr.msf.minute;
-    msf.cdmsf_sec1 = cd->trk[C(cd->last_t+1)].toc.cdte_addr.msf.second;
-    msf.cdmsf_frame1 = cd->trk[C(cd->last_t+1)].toc.cdte_addr.msf.frame - 1;
+    /* got subchannel? */
+    MSF_START_SEC = SC_SECOND(cd->sc)+offset;
+    MSF_START_MIN = SC_MINUTE(cd->sc);
+    MSF_START_FRM = SC_FRAME(cd->sc);
+    MSF_END_MIN = TOC_MINUTE(cd->trk[C(cd->last_t+1)]);
+    MSF_END_SEC = TOC_SECOND(cd->trk[C(cd->last_t+1)]);
+    MSF_END_FRM = TOC_FRAME(cd->trk[C(cd->last_t+1)]) - 1;
  
 #ifdef UNSIGNED_NUMBERS_CAN_BE_NEGATIVE
-    if(msf.cdmsf_frame1 < 0)
+    if((MSF_END_FRM < 0)
     {
-	msf.cdmsf_sec1 += msf.cdmsf_frame1;
-	msf.cdmsf_frame1 = 0;
+	MSF_END_SEC += MSF_END_FRM;
+	MSF_END_FRM = 0;
     }
-    if(msf.cdmsf_sec1 < 0)
+    if(MSF_END_SEC < 0)
     {
-	msf.cdmsf_min1 += msf.cdmsf_sec1;
-	msf.cdmsf_sec1 = 0;
+	MSF_END_MIN += MSF_END_SEC;
+	MSF_END_SEC = 0;
     }
-    if(msf.cdmsf_min1 < 0)
+    if(MSF_END_MIN < 0)
     {
-	msf.cdmsf_min1 = 0;
+	MSF_END_MIN = 0;
     }
 #endif
+
+    if(MSF_START_SEC > 60 && (offset<0))
+    {
+	MSF_START_SEC = 60-abs(offset);
+	MSF_START_MIN--;
+    }
+
+#ifdef TCD_BSD
+    ioctl( cd->cd_dev, CDIOCPREVENT );
+#endif
 	
+#ifdef TCD_BSD
+    if(ioctl(cd->cd_dev, CDIOCPLAYMSF, &msf))
+#else
     if(ioctl(cd->cd_dev, CDROMPLAYMSF, &msf))
+#endif
     {
@@ -491,2 +629,5 @@
 	debug("cdrom.c: tcd_play_seconds error. CDROMPLAYMSF ioctl error.\n" );
+#ifdef TCD_BSD
+	ioctl( cd->cd_dev, CDIOCALLOW );
+#endif
 	return(-1);
@@ -507,3 +648,11 @@
 
+#ifdef TCD_BSD
+    ioctl( cd->cd_dev, CDIOCALLOW);
+#endif
+
+#ifdef TCD_BSD
+    if(!ioctl(cd->cd_dev, CDIOCEJECT))
+#else
     if(!ioctl(cd->cd_dev, CDROMEJECT))
+#endif
     {
@@ -515,2 +664,5 @@
     {
+#ifdef TCD_BSD
+	tmp = ioctl( cd->cd_dev, CDIOCCLOSE );
+#else
 #ifdef CDROMCLOSETRAY
@@ -518,2 +670,7 @@
 #endif
+#endif
+
+#ifdef TCD_BSD
+	ioctl( cd->cd_dev, CDIOCPREVENT);
+#endif
 
@@ -527,2 +684,5 @@
 
+#ifdef TCD_BSD
+	    ioctl( cd->cd_dev, CDIOCALLOW);
+#endif
 	    return(-1);
@@ -544,7 +704,15 @@
     /* SDH: Makes things cleaner on eject */
-    if( cd->sc.cdsc_audiostatus==CDROM_AUDIO_PAUSED )
+    if( SC_AUDIOSTATUS(cd->sc)==CDROM_AUDIO_PAUSED )
 	tcd_pausecd(cd);
 
+#ifdef TCD_BSD
+    ioctl( cd->cd_dev, CDIOCALLOW);
+#endif
+
     cd->err = FALSE;
+#ifdef TCD_BSD
+    if(ioctl(cd->cd_dev, CDIOCSTOP))
+#else
     if(ioctl(cd->cd_dev, CDROMSTOP))
+#endif
     {
@@ -566,5 +734,9 @@
 	
-    if(cd->sc.cdsc_audiostatus==CDROM_AUDIO_PAUSED)
-    {       
+    if(SC_AUDIOSTATUS(cd->sc)==CDROM_AUDIO_PAUSED)
+    {
+#ifdef TCD_BSD
+	if((tmp=ioctl(cd->cd_dev, CDIOCRESUME)))
+#else       
 	if((tmp=ioctl(cd->cd_dev, CDROMRESUME)))
+#endif
 	{
@@ -572,4 +744,10 @@
 	    cd->err = TRUE;
+#ifdef TCD_BSD
+	    ioctl( cd->cd_dev, CDIOCALLOW);
+#endif
 	    return(-1);
 	}
+#ifdef TCD_BSD
+	ioctl( cd->cd_dev, CDIOCPREVENT);
+#endif
 	return tmp;
@@ -578,3 +756,7 @@
     {
+#ifdef TCD_BSD
+	if((tmp=ioctl(cd->cd_dev, CDIOCPAUSE)))
+#else
 	if((tmp=ioctl(cd->cd_dev, CDROMPAUSE)))
+#endif
 	{
@@ -582,4 +764,10 @@
 	    cd->err = TRUE;
+#ifdef TCD_BSD
+	    ioctl( cd->cd_dev, CDIOCALLOW);
+#endif
 	    return(-1);
 	}
+#ifdef TCD_BSD
+	ioctl( cd->cd_dev, CDIOCPREVENT);
+#endif
 	return tmp;
@@ -591,2 +779,3 @@
 #ifdef TCD_CHANGER_ENABLED
+#ifndef TCD_BSD
     int tmp;
@@ -599,6 +788,6 @@
     return tmp;
-#else
+#endif
+#endif
     debug("tcd_change_disc called, but changer support isn't compiled in. Ickyblah.\n" );
     return 0;
-#endif
 }
--- tcd/linux-cdrom.h.orig	Thu Jan 13 22:27:52 2000
+++ tcd/linux-cdrom.h	Tue May 30 15:34:32 2000
@@ -29,4 +29,16 @@
 #include <glib.h>
-#if !defined(linux) && !defined(sun) && !defined(__sun__)
-# error TCD only builds on linux and Solaris/SunOs
+#if !defined(linux) && !defined(sun) && !defined(__sun__) && !defined(__FreeBSD__)
+# error TCD only builds on Linux, Solaris, SunOS, and FreeBSD
+#endif
+
+#ifdef __FreeBSD__
+#define TCD_BSD
+#include <sys/cdio.h>
+#define CDROM_AUDIO_INVALID	CD_AS_AUDIO_INVALID
+#define CDROM_AUDIO_PLAY	CD_AS_PLAY_IN_PROGRESS
+#define	CDROM_AUDIO_PAUSED	CD_AS_PLAY_PAUSED
+#define	CDROM_AUDIO_COMPLETED	CD_AS_PLAY_COMPLETED
+#define	CDROM_AUDIO_ERROR	CD_AS_PLAY_ERROR
+#define	CDROM_AUDIO_NO_STATUS	CD_AS_NO_STATUS
+#define CDROM
 #endif
@@ -128,3 +140,13 @@
 	char extd[EXT_DATA_LEN+1];      /* extra information for this track */
+#ifdef TCD_BSD
+        struct cd_toc_entry toc;
+#define TOC_MINUTE(trk)		(trk.toc.addr.msf.minute)
+#define	TOC_SECOND(trk)		(trk.toc.addr.msf.second)
+#define TOC_FRAME(trk)		(trk.toc.addr.msf.frame)
+#else
 	struct cdrom_tocentry toc;
+#define TOC_MINUTE(trk)		(trk.toc.cdte_addr.msf.minute)
+#define	TOC_SECOND(trk)		(trk.toc.cdte_addr.msf.second)
+#define TOC_FRAME(trk)		(trk.toc.cdte_addr.msf.frame)
+#endif
 	int titled;
@@ -154,2 +176,14 @@
 
+#ifdef TCD_BSD
+        /* See /usr/include/sys/cdio.h */
+	struct ioc_play_track ti;
+	struct ioc_toc_header tochdr;
+	struct cd_sub_channel_info sc;
+#define SC_AUDIOSTATUS(sc)	(sc.header.audio_status)
+#define SC_TRACK(sc)		(sc.what.position.track_number)
+#define SC_MINUTE(sc)		(sc.what.position.absaddr.msf.minute)
+#define SC_SECOND(sc)		(sc.what.position.absaddr.msf.second)
+#define SC_FRAME(sc)		(sc.what.position.absaddr.msf.frame)
+#else
+
 	/* See /usr/src/linux/include/linux/cdrom.h */
@@ -158,2 +192,8 @@
 	struct cdrom_subchnl sc;	/* Subchannel, for time */
+#define SC_AUDIOSTATUS(sc)	(sc.cdsc_audiostatus)
+#define SC_TRACK(sc)		(sc.cdsc_trk)
+#define SC_MINUTE(sc)		(sc.cdsc_absaddr.msf.minute)
+#define SC_SECOND(sc)		(sc.cdsc_absaddr.msf.second)
+#define SC_FRAME(sc)		(sc.cdsc_absaddr.msf.frame)
+#endif
 	int volume;			/* Must range 0-100 */
--- tcd/tcd.c.orig	Thu Jan 13 22:27:52 2000
+++ tcd/tcd.c	Tue May 30 15:17:17 2000
@@ -141,4 +141,4 @@
 	   stopped anyway, fix it. */
-	if( cd->sc.cdsc_audiostatus != CDROM_AUDIO_PLAY &&
-	    cd->sc.cdsc_audiostatus != CDROM_AUDIO_PAUSED )
+	if( SC_AUDIOSTATUS(cd->sc) != CDROM_AUDIO_PLAY &&
+	    SC_AUDIOSTATUS(cd->sc) != CDROM_AUDIO_PAUSED )
 	{
@@ -172,3 +172,3 @@
 	    if(cd->isplayable) {
-		if( cd->sc.cdsc_audiostatus == CDROM_AUDIO_PAUSED )
+		if( SC_AUDIOSTATUS(cd->sc) == CDROM_AUDIO_PAUSED )
 		    tcd_pausecd(cd);
@@ -442,4 +442,4 @@
     mvwprintw(win,maxy-4,38,"%02u:%02u",
-	      cd->trk[C(cd->last_t+1)].toc.cdte_addr.msf.minute,
-	      cd->trk[C(cd->last_t+1)].toc.cdte_addr.msf.second );
+	      TOC_MINUTE(cd->trk[C(cd->last_t+1)]),
+	      TOC_SECOND(cd->trk[C(cd->last_t+1)]) );
     mvwprintw(win,maxy-3,38,cd->dtitle );
@@ -480,3 +480,3 @@
     {
-	if(cd->cur_t == i && cd->sc.cdsc_audiostatus == CDROM_AUDIO_PLAY)
+	if(cd->cur_t == i && SC_AUDIOSTATUS(cd->sc) == CDROM_AUDIO_PLAY)
 	    stat = 'P';
@@ -484,3 +484,7 @@
 	    stat = 'R';
+#if defined(TCD_BSD)
+	else if(cd->trk[i].toc.control == 0x04)
+#else
 	else if(cd->trk[i].toc.cdte_ctrl == CDROM_DATA_TRACK)
+#endif
 	    stat = 'd';
@@ -500,3 +504,3 @@
 	
-	if( cd->sc.cdsc_audiostatus == CDROM_AUDIO_PLAY && cd->cur_t == i )
+	if( SC_AUDIOSTATUS(cd->sc) == CDROM_AUDIO_PLAY && cd->cur_t == i )
 	    attron( A_BOLD );
@@ -507,3 +511,3 @@
 	
-	if(cd->sc.cdsc_audiostatus == CDROM_AUDIO_PLAY && cd->cur_t == i)
+	if(SC_AUDIOSTATUS(cd->sc) == CDROM_AUDIO_PLAY && cd->cur_t == i)
 	    attroff( A_BOLD );
@@ -518,3 +522,3 @@
     {
-	switch( cd->sc.cdsc_audiostatus )
+	switch( SC_AUDIOSTATUS(cd->sc) )
 	{
