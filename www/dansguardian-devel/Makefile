# New ports collection makefile for:	dansguardian
# Date created:				April 02, 2002
# Whom:					Freddie Cash <fcash@bigfoot.com>
#
# $FreeBSD$
#

PORTNAME=	dansguardian
PORTVERSION=	2.9.7.0
#PORTREVISION=	1
CATEGORIES=	www
MASTER_SITES=	# empty, see below
DISTNAME=	${PORTNAME}-${PORTVERSION}

MAINTAINER=	fcash@sd73.bc.ca
COMMENT=	A fast, feature-rich web content filter for Squid proxy servers

LIB_DEPENDS=	pcre.0:${PORTSDIR}/devel/pcre
RUN_DEPENDS=	${LOCALBASE}/sbin/squid:${PORTSDIR}/www/squid

USE_GCC=	3.4+
USE_ICONV=	yes

USE_RC_SUBR=	dansguardian.sh

CONFLICTS=	dansguardian-2.[678]*
LATEST_LINK=	dansguardian-devel

GNU_CONFIGURE=	yes
CONFIGURE_ARGS=	--localstatedir=/var \
		--with-logdir=/var/log \
		--with-piddir=/var/run

MAN8=		dansguardian.8

OPTIONS=	DG_APACHE  "Enable Apache support for access denied page" on \
		DG_DMGR    "Enable the fancy download manager" on \
		DG_CLAMD   "Enable ClamAV daemon support (clamd)" off \
		DG_CLAMAV  "Enable ClamAV library support (libclamav)" off \
		DG_ICAP    "Enable ICAP AV content scanner support (testing)" off \
		DG_KASP    "Enable Kaspersky AV support (testing)" off \
		DG_NTLM    "Enable NTLM authentication plugin" off \
		DG_EMAIL   "Enable e-mail reporting support" off

DG_URL=		http://dansguardian.org/index.php?page=copyright2
CONFDIR=	${PREFIX}/etc/dansguardian

RESTRICTED=	Redistribution and commercial download is restricted. Check ${DG_URL} for more info ${NO_PACKAGE}

.include <bsd.port.pre.mk>

.if !defined(WITHOUT_DG_APACHE)
USE_APACHE=	1.3+
.endif

.if defined(WITH_DG_CLAMAV)
#IGNORE=		please use the clamd plugin support.  It's much more flexible, usable, tested, and just generally better
CONFIGURE_ARGS+=	--enable-clamav=yes
LIB_DEPENDS+=		clamav.1:${PORTSDIR}/security/clamav
PLIST_SUB+=		CLAMAVCONF=""
.else
PLIST_SUB+=		CLAMAVCONF="@comment "
.endif

.if defined(WITH_DG_CLAMD)
CONFIGURE_ARGS+=	--enable-clamd=yes
RUN_DEPENDS+=		${LOCALBASE}/sbin/clamd:${PORTSDIR}/security/clamav
PLIST_SUB+=		CLAMDCONF=""
.else
PLIST_SUB+=		CLAMDCONF="@comment "
.endif

.if defined(WITH_DG_ICAP)
#IGNORE=		I don't have access to ICAP AV, so I can't test this.  If you have access to it, drop me an e-mail.  Thanks
CONFIGURE_ARGS+=	--enable-icap
PLIST_SUB+=		ICAPCONF=""
.else
PLIST_SUB+=		ICAPCONF="@comment "
.endif

.if defined(WITH_DG_KASP)
#IGNORE=		I don't have access to Kaspersky AV, so I can't test this.  If you have access to it, drop me an e-mail.  Thanks
CONFIGURE_ARGS+=	--enable-kavd
PLIST_SUB+=		KAVDCONF=""
.else
PLIST_SUB+=		KAVDCONF="@comment "
.endif

.if defined(WITH_DG_CLAMD) || defined(WITH_DG_CLAMAV) || defined(WITH_DG_ICAP) || defined(WITH_DG_KASP)
PLIST_SUB+=		SCANNERS=""
.else
PLIST_SUB+=		SCANNERS="@comment "
.endif

.if !defined(WITHOUT_DG_DMGR)
CONFIGURE_ARGS+=	--enable-fancydm
#PLIST_SUB+=		DMGR=""
#.else
#PLIST_SUB+=		DMGR="@comment "
.endif

.if defined(WITH_DG_NTLM)
CONFIGURE_ARGS+=	--enable-ntlm
PLIST_SUB+=		NTLMCONF=""
.else
PLIST_SUB+=		NTLMCONF="@comment "
.endif

.if defined(WITH_DG_EMAIL)
CONFIGURE_ARGS+=	--enable-email
PLIST_SUB+=		EMAILCONF=""
.else
PLIST_SUB+=		EMAILCONF="@comment "
.endif

# User needs to manually download the distfile
.if !(exists(${DISTDIR}/${DISTNAME}${EXTRACT_SUFX})) && !defined(PACKAGE_BUILDING)
IGNORE=	commercial source download is restricted.  Please visit and read ${DG_URL} and download ${DISTNAME}${EXTRACT_SUFX} into ${DISTDIR} before running make
.endif

post-install:
# Display post-install message
	@${CAT} pkg-message

.include <bsd.port.post.mk>
