commit 46e3052bc347
Author: Kannan Vijayan <kvijayan@mozilla.com>
Date:   Thu Jan 4 14:36:07 2018 -0500

    Bug 1423173 - Check for shadowing indexed properties when adding elements. r=jandem
---
 js/src/jit-test/tests/arrays/bug1423173.js | 13 +++++++++++++
 js/src/jit/CacheIR.cpp                     |  3 +++
 2 files changed, 16 insertions(+)

diff --git js/src/jit-test/tests/arrays/bug1423173.js js/src/jit-test/tests/arrays/bug1423173.js
new file mode 100644
index 000000000000..38e584ce3655
--- /dev/null
+++ js/src/jit-test/tests/arrays/bug1423173.js
@@ -0,0 +1,13 @@
+// |jit-test| --baseline-eager
+Array.prototype.push(1);
+Object.freeze([].__proto__);
+var x = [];
+var c = 0;
+for (var j = 0; j < 5; ++j) {
+    try {
+        x.push(function() {});
+    } catch (e) {
+        c++;
+    }
+}
+assertEq(c, j);
diff --git js/src/jit/CacheIR.cpp js/src/jit/CacheIR.cpp
index 507788a7c182..fa5fc6bc6f91 100644
--- js/src/jit/CacheIR.cpp
+++ js/src/jit/CacheIR.cpp
@@ -3406,6 +3406,9 @@ CanAttachAddElement(JSObject* obj, bool isInit)
         if (!proto->isNative())
             return false;
 
+        if (proto->as<NativeObject>().denseElementsAreFrozen())
+            return false;
+
         obj = proto;
     } while (true);
 
