--- src/galeon.in.orig	Thu Dec 27 19:13:42 2001
+++ src/galeon.in	Mon Mar 10 11:20:39 2003
@@ -4,18 +4,14 @@
 
 if test -n "$MOZILLA_FIVE_HOME"; then
 	MOZILLA_HOME=$MOZILLA_FIVE_HOME
-elif [ -f @MOZILLA_HOME@/chrome/comm.jar ]; then
+elif [ -f @MOZILLA_HOME@/libgtkembedmoz.so ]; then
 	MOZILLA_HOME=@MOZILLA_HOME@
-elif [ -f /usr/local/mozilla/chrome/comm.jar ]; then
-	MOZILLA_HOME=/usr/local/mozilla
-elif [ -f /usr/lib/mozilla/chrome/comm.jar ]; then
-	MOZILLA_HOME=/usr/lib/mozilla
-elif [ -f /opt/mozilla/chrome/comm.jar ]; then
-	MOZILLA_HOME=/opt/mozilla
-elif [ -f /usr/lib/mozilla-0.9.7/chrome/comm.jar ]; then
-	MOZILLA_HOME=/usr/lib/mozilla-0.9.7/
-elif [ -f /opt/gnome/lib/mozilla/chrome/comm.jar ]; then
-        MOZILLA_HOME=/opt/gnome/lib/mozilla/
+elif [ -f %%LOCALBASE%%/lib/%%MOZILLA%%/libgtkembedmoz.so ]; then
+    	MOZILLA_HOME=%%LOCALBASE%%/lib/%%MOZILLA%%
+elif [ -f %%X11BASE%%/lib/%%MOZILLA%%/libgtkembedmoz.so ]; then
+    	MOZILLA_HOME=%%X11BASE%%/lib/%%MOZILLA%%
+elif [ -f %%PREFIX%%/lib/%%MOZILLA%%/libgtkembedmoz.so ]; then
+    	MOZILLA_HOME=%%PREFIX%%/lib/%%MOZILLA%%
 else
 	echo "Cannot find mozilla installation directory. Please set MOZILLA_FIVE_HOME to your mozilla directory"
 	exit
@@ -27,16 +23,17 @@
 MOZILLA_FIVE_HOME=$MOZILLA_HOME
 export MOZILLA_FIVE_HOME
 
-# for some reason this lets Galeon start properly on Red Hat 7.1 systems
-if [ -f /etc/redhat-release ]; then
-	if [ "`cat /etc/redhat-release`" = "Red Hat Linux release 7.1 (Seawolf)"  ]; then
-   	 export LD_ASSUME_KERNEL=2.2.5
-	fi
+MOZ_PLUGIN_PATH=%%PREFIX%%/lib/browser_plugins
+export MOZ_PLUGIN_PATH
+
+if [ -f %%FLASHPLAYER%% ]; then
+    LD_PRELOAD=%%FLASHPLAYER%%
+    export LD_PRELOAD
 fi
 
 if [ -f ./galeon-bin ]; then
 exec ./galeon-bin "$@"
 else
-exec $dist_bin/galeon-bin "$@"
+exec %%PREFIX%%/bin/galeon-bin "$@"
 fi
 
