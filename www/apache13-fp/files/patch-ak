--- src/support/apachectl.orig	Tue Apr  6 15:36:33 1999
+++ src/support/apachectl	Thu Feb 24 22:20:05 2000
@@ -27,6 +27,10 @@
 # the path to your httpd binary, including options if necessary
 HTTPD='/usr/local/apache/src/httpd'
 #
+# shared object search path
+LD_LIBRARY_PATH=
+export LD_LIBRARY_PATH
+#
 # a command that outputs a formatted text version of the HTML at the
 # url given on the command line.  Designed for lynx, however other
 # programs may work.  
@@ -39,6 +43,8 @@
 # --------------------                              --------------------
 # ||||||||||||||||||||   END CONFIGURATION SECTION  ||||||||||||||||||||
 
+eval `limits -e -C daemon` >/dev/null 2>&1
+
 ERROR=0
 ARGV="$@"
 if [ "x$ARGV" = "x" ] ; then 
@@ -47,6 +53,9 @@
 
 for ARG in $@ $ARGS
 do
+
+    MODULES=`echo $ARG | awk 'BEGIN { RS="_"}!($1 == "start" || $1 == "stop" || $1 == "restart" || $1 == "fullstatus" || $1 == "status" || $1 == "graceful" || $1 == "configtest"){ s = sprintf("%s -DMOD_%s", s, $1)}END{ printf s}'`
+
     # check for pidfile
     if [ -f $PIDFILE ] ; then
 	PID=`cat $PIDFILE`
@@ -63,12 +72,12 @@
     fi
 
     case $ARG in
-    start)
+    start*)
 	if [ $RUNNING -eq 1 ]; then
 	    echo "$0 $ARG: httpd (pid $PID) already running"
 	    continue
 	fi
-	if $HTTPD ; then
+	if $HTTPD $MODULES; then
 	    echo "$0 $ARG: httpd started"
 	else
 	    echo "$0 $ARG: httpd could not be started"
@@ -82,22 +91,23 @@
 	fi
 	if kill $PID ; then
 	    echo "$0 $ARG: httpd stopped"
+	    rm $PIDFILE
 	else
 	    echo "$0 $ARG: httpd could not be stopped"
 	    ERROR=4
 	fi
 	;;
-    restart)
+    restart*)
 	if [ $RUNNING -eq 0 ]; then
 	    echo "$0 $ARG: httpd not running, trying to start"
-	    if $HTTPD ; then
+	    if $HTTPD $MODULES; then
 		echo "$0 $ARG: httpd started"
 	    else
 		echo "$0 $ARG: httpd could not be started"
 		ERROR=5
 	    fi
 	else
-	    if $HTTPD -t >/dev/null 2>&1; then
+	    if $HTTPD -t ${MODULES} >/dev/null 2>&1; then
 		if kill -HUP $PID ; then
 		    echo "$0 $ARG: httpd restarted"
 		else
@@ -111,17 +121,17 @@
 	    fi
 	fi
 	;;
-    graceful)
+    graceful*)
 	if [ $RUNNING -eq 0 ]; then
 	    echo "$0 $ARG: httpd not running, trying to start"
-	    if $HTTPD ; then
+	    if $HTTPD $MODULES; then
 		echo "$0 $ARG: httpd started"
 	    else
 		echo "$0 $ARG: httpd could not be started"
 		ERROR=5
 	    fi
 	else
-	    if $HTTPD -t >/dev/null 2>&1; then
+	    if $HTTPD -t ${MODULES} >/dev/null 2>&1; then
 		if kill -USR1 $PID ; then
 		    echo "$0 $ARG: httpd gracefully restarted"
 		else
@@ -141,8 +151,8 @@
     fullstatus)
 	$LYNX $STATUSURL
 	;;
-    configtest)
-	if $HTTPD -t; then
+    configtest*)
+	if $HTTPD -t ${MODULES}; then
 	    :
 	else
 	    ERROR=8
@@ -161,6 +171,10 @@
 graceful   - do a graceful restart by sending a SIGUSR1 or start if not running
 configtest - do a configuration syntax test
 help       - this screen
+
+
+    NOTE: You may also use (start|restart|graceful|configtest)_MODULE1[_MODULE2[..]]
+	  to start the server with -DMOD_MODULE1[ -DMOD_MODULE2[..]].
 
 EOF
 	ERROR=2
