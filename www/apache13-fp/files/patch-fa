--- frontpage/version4.0/change_server.sh.orig	Tue May  2 15:41:43 2000
+++ frontpage/version4.0/change_server.sh	Thu Jul  6 21:45:52 2000
@@ -38,9 +38,12 @@
 {
   VERSION="4.0"
   PATH=".:/bin:/usr/bin:/sbin:/usr/sbin:/usr/ucb:/etc:/usr/bsd"
-  NEWHTTPDNEW="/usr/local/frontpage/version${VERSION}/apache-fp/httpd"
-  NEWHTTPDCOMPAT="/usr/local/frontpage/version${VERSION}/apache-fp/httpd.Compat"
-  DEFAULTHTTPD="/usr/local/apache/sbin/httpd"
+  AP_TARGET=`PREFIX/sbin/apxs -q TARGET`
+  NEWHTTPDNEW="PREFIX/sbin/${AP_TARGET}"
+  NEWMODFPNEW="PREFIX/libexec/apache/mod_frontpage.so"
+  NEWHTTPDCOMPAT="${NEWHTTPDNEW}"
+  NEWMODFPCOMAPT="${NEWMODFPNEW}"
+  DEFAULTHTTPD="PREFIX/sbin/${AP_TARGET}"
 
 case "`echo 'x\c'`" in
    'x\c')   echo="echo -n"    nnl= ;;      #BSD
@@ -62,7 +65,7 @@
      SunOS*5.*i386*)   machine="solarisx86" ;;
      BSD/OS*)          machine="bsdi" ;;
      SCO_SV*)          machine="sco5" ;;
-     FreeBSD*)         machine="freebsd" ;;
+     FreeBSD*)         machine="bsdi" ;;
      UnixWare\ *\ *\ 7*\ i*) machine="uware7" ;;
      *)                echo "ERROR:  Unsupported platform!  Uname is $system." 
                        return 1
@@ -217,8 +220,22 @@
 
  clear
 
+ if ($strings $httpdfile | $fgrep "etc/apache/${AP_TARGET}.conf" > /dev/null)
+ then
+    NEWHTTPD=$NEWHTTPDNEW
+    NEWMODFP=$NEWMODFPNEW
+    echo "Selected server uses FreeBSD directory structure:"
+
+    targetVersionNumber=`$httpdfile -v | sed 's%^.*Apache/\([0-9\.]*\).*%\1%' | head -1`
+    targetFPVersionNumber=`$strings \`dirname \\\`dirname $httpdfile\\\`\`/libexec/apache/mod_frontpage.so | \
+	$fgrep "FrontPage/" 2> /dev/null | sed -e 's%^.*FrontPage/\([0-9\.]*\).*%\1%' | tail -1`
+
+    sourceVersionNumber=`$NEWHTTPD -v | sed 's%^.*Apache/\([0-9\.]*\).*%\1%' | head -1`
+    sourceFPVersionNumber=`$strings $NEWMODFP | $fgrep "FrontPage/" 2> /dev/null | \
+	 sed -e 's%^.*FrontPage/\([0-9\.]*\).*%\1%' | tail -1`
+ else
 
- if ($strings $httpdfile | $fgrep "etc/httpd.conf" > /dev/null)
+ if ($strings $httpdfile | $fgrep "etc/${AP_TARGET}.conf" > /dev/null)
  then
     NEWHTTPD=$NEWHTTPDNEW
     echo "Selected server uses NEW directory structure:"
@@ -235,7 +252,8 @@
  sourceVersionNumber=`$NEWHTTPD -v | sed 's%^.*Apache/\([0-9\.]*\).*%\1%' | head -1`
  sourceFPVersionNumber=`$strings $NEWHTTPD | $fgrep "FrontPage/" 2> /dev/null | sed -e '
                               s%^.*FrontPage/\([0-9\.]*\).*%\1%' | tail -1`
-            
+ fi
+
  echo
  echo "Currently running Apache/${targetVersionNumber} FrontPage/${nnl}" 
  if [ "${targetFPVersionNumber}" = "" ]
