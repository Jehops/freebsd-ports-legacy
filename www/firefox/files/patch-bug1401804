commit 38e6bb85066b
Author: Jon Coppeard <jcoppeard@mozilla.com>
Date:   Fri Sep 22 13:09:44 2017 +0100

    Bug 1401804 - Fix IsMarkedBlack check used in gray marking asserts r=sfink a=sylvestre
---
 js/src/gc/Barrier.cpp | 11 ++---------
 1 file changed, 2 insertions(+), 9 deletions(-)

diff --git js/src/gc/Barrier.cpp js/src/gc/Barrier.cpp
index 5a5dfbe9bed0..0c42d16e7117 100644
--- js/src/gc/Barrier.cpp
+++ js/src/gc/Barrier.cpp
@@ -33,15 +33,8 @@ RuntimeFromActiveCooperatingThreadIsHeapMajorCollecting(JS::shadow::Zone* shadow
 bool
 IsMarkedBlack(JSObject* obj)
 {
-    // Note: we assume conservatively that Nursery things will be live.
-    if (!obj->isTenured())
-        return true;
-
-    gc::TenuredCell& tenured = obj->asTenured();
-    if (tenured.isMarkedAny() || tenured.arena()->allocatedDuringIncremental)
-        return true;
-
-    return false;
+    return obj->isMarkedBlack() ||
+           (obj->isTenured() && obj->asTenured().arena()->allocatedDuringIncremental);
 }
 
 bool
