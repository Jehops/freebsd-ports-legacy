# New ports collection makefile for:	plugger
# Date created:		11 Februrary 1999
# Whom:			Jay Sachs <sachs@cs.williams.edu>
#
# $FreeBSD$
#

PORTNAME=	plugger
PORTVERSION=	5.0
CATEGORIES=	www audio graphics multimedia
MASTER_SITES=	http://fredrik.hubbe.net/plugger/

MAINTAINER=	coop9211@uidaho.edu
COMMENT=	A multimedia front-end plugin for Mozilla or Opera

USE_X_PREFIX=	yes
USE_REINPLACE=	yes

MAN7=		plugger.7
ALL_TARGET=	freebsd-elf
PKGDEINSTALL=	${PKGINSTALL}

.include <bsd.port.pre.mk>

post-patch:
	@${REINPLACE_CMD} -e 's|/usr/local/|${PREFIX}/|g' \
		${WRKSRC}/plugger.c
	@${REINPLACE_CMD} -e 's|CC=gcc|CC=${CC}|g' \
		-e 's|LD=gcc|LD=${CC}|g' ${WRKSRC}/Makefile
	@${REINPLACE_CMD} -e 's|/usr/X11R6/|${X11BASE}|g' \
		${WRKSRC}/Makefile

pre-install:
	@${SETENV} PKG_PREFIX=${PREFIX} ${SH} \
		${PKGINSTALL} ${PKGNAME} PRE-INSTALL

do-install:
	@${INSTALL_PROGRAM} ${WRKSRC}/plugger-${PORTVERSION} \
		${PREFIX}/bin
	@${MKDIR} ${PREFIX}/lib/browser_plugins
	@${INSTALL_PROGRAM} ${WRKSRC}/plugger-${PORTVERSION} \
		${PREFIX}/bin
	@${INSTALL_PROGRAM} ${WRKSRC}/plugger-controller \
		${PREFIX}/bin
	@${INSTALL_PROGRAM} ${WRKSRC}/plugger.so \
		${PREFIX}/lib/browser_plugins/npplugger.so
	@if [ -f ${PREFIX}/etc/pluggerrc-${PORTVERSION} ]; then \
		${MV} ${PREFIX}/etc/pluggerrc-${PORTVERSION} \
			${PREFIX}/etc/pluggerrc-${PORTVERSION}.old; \
	fi
	@${INSTALL_DATA} ${WRKSRC}/pluggerrc \
		${PREFIX}/etc/pluggerrc-${PORTVERSION}.sample
	@${INSTALL_MAN} ${WRKSRC}/plugger.7 ${MANPREFIX}/man/man7

local-install:
	@${MKDIR} ${HOME}/.mozilla/plugins
	@${INSTALL_PROGRAM} ${WRKSRC}/plugger.so \
		${HOME}/.mozilla/plugins/npplugger.so
	@${INSTALL_PROGRAM} ${WRKSRC}/plugger-${PORTVERSION} \
		${HOME}/.mozilla
	@${INSTALL_PROGRAM} ${WRKSRC}/plugger-controller \
		${HOME}/.mozilla
	@if [ -f ${HOME}/.mozilla/pluggerrc-${PORTVERSION} ]; then \
		${MV} ${HOME}/.mozilla/pluggerrc-${PORTVERSION} \
			${HOME}/.mozilla/pluggerrc-${PORTVERSION}.old; \
	fi
	@${INSTALL_DATA} ${WRKSRC}/pluggerrc \
		${HOME}/.mozilla/pluggerrc-${PORTVERSION}

local-opera-install:
	@${MKDIR} ${HOME}/.opera/plugins
	@${INSTALL_PROGRAM} ${WRKSRC}/plugger.so \
		${HOME}/.opera/plugins/npplugger.so
	@${INSTALL_PROGRAM} ${WRKSRC}/plugger-${PORTVERSION} \
		${HOME}/.opera
	@if [ -f ${HOME}/.opera/pluggerrc-${PORTVERSION} ]; then \
		${MV} ${HOME}/.opera/pluggerrc-${PORTVERSION} \
			${HOME}/.opera/pluggerrc-${PORTVERSION}.old; \
	fi
	@${INSTALL_DATA} ${WRKSRC}/pluggerrc \
		${HOME}/.opera/pluggerrc-${PORTVERSION}

post-install:
	@${SETENV} PKG_PREFIX=${PREFIX} ${SH} \
		${PKGINSTALL} ${PKGNAME} POST-INSTALL

.include <bsd.port.post.mk>
