# New ports collection makefile for:	ikiwiki
# Date created:		21 Apr 2007
# Whom:			Henrik Brix Andersen <henrik@brixandersen.dk>
#
# $FreeBSD$

PORTNAME=	ikiwiki
PORTVERSION=	2.1
CATEGORIES=	www
MASTER_SITES=	${MASTER_SITE_DEBIAN_POOL}
DISTNAME=	${PORTNAME}_${PORTVERSION}

MAINTAINER=	henrik@brixandersen.dk
COMMENT=	A wiki compiler

BUILD_DEPENDS=	markdown:${PORTSDIR}/textproc/markdown \
		${SITE_PERL}/HTML/Scrubber.pm:${PORTSDIR}/www/p5-HTML-Scrubber \
		${SITE_PERL}/HTML/Template.pm:${PORTSDIR}/www/p5-HTML-Template \
		${SITE_PERL}/URI.pm:${PORTSDIR}/net/p5-URI \
		${SITE_PERL}/${PERL_ARCH}/HTML/Parser.pm:${PORTSDIR}/www/p5-HTML-Parser \
		${SITE_PERL}/${PERL_ARCH}/Locale/gettext.pm:${PORTSDIR}/devel/p5-Locale-gettext
RUN_DEPENDS=	${BUILD_DEPENDS} \
		${SITE_PERL}/CGI/FormBuilder.pm:${PORTSDIR}/www/p5-CGI-FormBuilder \
		${SITE_PERL}/CGI/Session.pm:${PORTSDIR}/www/p5-CGI-Session \
		${SITE_PERL}/Date/Parse.pm:${PORTSDIR}/devel/p5-TimeDate \
		${SITE_PERL}/File/MimeInfo.pm:${PORTSDIR}/devel/p5-File-MimeInfo \
		${SITE_PERL}/Mail/Sendmail.pm:${PORTSDIR}/mail/p5-Mail-Sendmail \
		${SITE_PERL}/RPC/XML.pm:${PORTSDIR}/net/p5-RPC-XML \
		${SITE_PERL}/Time/Duration.pm:${PORTSDIR}/devel/p5-Time-Duration \
		${SITE_PERL}/XML/Feed.pm:${PORTSDIR}/textproc/p5-XML-Feed \
		${SITE_PERL}/XML/Simple.pm:${PORTSDIR}/textproc/p5-XML-Simple

WRKSRC=		${WRKDIR}/${PORTNAME}

PERL_CONFIGURE=	yes
USE_GMAKE=	yes
USE_GETTEXT=	yes

OPTIONS=	W3M "Install w3m CGI wrapper" off

MAN1=		ikiwiki.1
MAN8=		ikiwiki-mass-rebuild.8
PORTDOCS=	CHANGELOG NEWS README

.include <bsd.port.pre.mk>

.if defined(WITH_W3M)
PLIST_SUB=	W3M=""
.else
PLIST_SUB=	W3M="@comment "
.endif

post-patch:
	@${REINPLACE_CMD} -e "s|/usr/bin/markdown|${LOCALBASE}/bin/markdown|" \
		${WRKSRC}/IkiWiki/Plugin/mdwn.pm
	@${REINPLACE_CMD} \
		-e 's|$$(PREFIX)/share/man|$$(PREFIX)/man|' \
		-e 's|$$(PREFIX)/lib/w3m|$$(PREFIX)/libexec/w3m|' \
		${WRKSRC}/Makefile.PL
.ifndef(WITH_W3M)
	@${REINPLACE_CMD} -e '/w3m/d' ${WRKSRC}/Makefile.PL
.endif

post-install:
.if !defined(NOPORTDOCS)
	${MKDIR} ${DOCSDIR}
	${INSTALL_DATA} ${PORTDOCS:S@^@${WRKSRC}/@} ${DOCSDIR}
.endif
	@${CAT} ${PKGMESSAGE}

.include <bsd.port.post.mk>
