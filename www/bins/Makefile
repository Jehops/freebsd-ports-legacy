# New ports collection makefile for:	bins
# Date created:		Sat Nov 23 01:17:35 UTC 2002
# Whom:			Mario Sergio Fujikawa Ferreira <lioux@FreeBSD.org>
#
# $FreeBSD$
#

PORTNAME=	bins
PORTVERSION=	1.1.29
CATEGORIES=	www
MASTER_SITES=	http://download.gna.org/bins/

MAINTAINER=	araujo@bsdmail.org
COMMENT=	Tool to generate HTML photo albums with XML support

RUN_DEPENDS=	\
	${PBASE}/${PERL_ARCH}/HTML/Parser.pm:${PORTSDIR}/www/p5-HTML-Parser \
	${PBASE}/${PERL_ARCH}/Image/Magick.pm:${PORTSDIR}/graphics/ImageMagick \
	${PBASE}/${PERL_ARCH}/Text/Iconv.pm:${PORTSDIR}/converters/p5-Text-Iconv \
	${PBASE}/${PERL_ARCH}/Text/Unaccent.pm:${PORTSDIR}/textproc/p5-Text-Unaccent \
	${PBASE}/Date/Parse.pm:${PORTSDIR}/devel/p5-TimeDate \
	${PBASE}/Getopt/Long.pm:${PORTSDIR}/devel/p5-Getopt-Long \
	${PBASE}/HTML/Clean.pm:${PORTSDIR}/www/p5-HTML-Clean \
	${PBASE}/HTML/Template.pm:${PORTSDIR}/www/p5-HTML-Template \
	${PBASE}/IO/String.pm:${PORTSDIR}/devel/p5-IO-String \
	${PBASE}/Image/Info.pm:${PORTSDIR}/graphics/p5-Image-Info \
	${PBASE}/Image/Size.pm:${PORTSDIR}/graphics/p5-Image-Size \
	${PBASE}/URI/Escape.pm:${PORTSDIR}/net/p5-URI \
	${PBASE}/XML/Grove.pm:${PORTSDIR}/textproc/p5-XML-Grove \
	${PBASE}/XML/Handler/YAWriter.pm:${PORTSDIR}/textproc/p5-XML-Handler-YAWriter \
	${PBASE}/XML/Parser/PerlSAX.pm:${PORTSDIR}/textproc/p5-libxml

USE_BZIP2=	yes
USE_PERL5_RUN=	yes
NO_BUILD=	yes

# perlbase
PBASE=	${SITE_PERL}

# additional scripts
BINS_SCRIPTS=	tools/bins_txt2xml
# doc file extension
DOC_EXTS=	html sgml xml

MAN1=	bins-edit-gui.1 bins.1 bins_edit.1

post-patch::
# perl PREFIX safeness
	@${FIND} ${WRKSRC} -type f | \
		${XARGS} -n 10 -x ${REINPLACE_CMD} -E \
		-e 's|/usr/bin/perl|${PERL}|'
# prefix safeness
	@${REINPLACE_CMD} -E \
		-e 's|(bins_edit=)".+"(.*)$$|\1"${PREFIX}/bin/bins_edit"\2|' \
		${WRKSRC}/tools/bins_txt2xml

do-install:
	@${SETENV} PREFIX=${PREFIX} RC=${PREFIX}/share/bins ${WRKSRC}/install.sh

post-install:
.for file in ${BINS_SCRIPTS}
	@${INSTALL_SCRIPT} ${WRKSRC}/${file} ${PREFIX}/bin
.endfor
.ifndef(NOPORTDOCS)
	@${MKDIR} ${DOCSDIR}
.for ext in ${DOC_EXTS}
	@${INSTALL_DATA} ${WRKSRC}/doc/*.${ext} ${DOCSDIR}
.endfor
.endif

.include <bsd.port.pre.mk>

##
## default for either pointyhat or unattended builds
##
.if defined(PACKAGE_BUILDING) || defined(BATCH)
WITH_I18N=	yes

post-patch::
	@${REINPLACE_CMD} -e 's,read dummy,,' ${WRKSRC}/install.sh
.endif

EXTRA_PATCHES+=	${FILESDIR}/extra-patch-install.sh

# localization support
.if defined(WITH_I18N)
RUN_DEPENDS+=	\
	${PBASE}/${PERL_ARCH}/Locale/gettext.pm:${PORTSDIR}/devel/p5-Locale-gettext
.endif

pre-everything::
.if !defined(WITH_I18N)
	@${ECHO_MSG} '===>'
	@${ECHO_MSG} '===> Define WITH_I18N to enable localization support.'
	@${ECHO_MSG} '===>   Support for languages other than english.'
.endif
	@${ECHO_MSG} '===>'

.include <bsd.port.post.mk>
