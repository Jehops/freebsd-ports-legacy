--- mod_neoscript.c	Fri Jul 21 19:49:29 2000
+++ mod_neoscript.c	Fri Aug 17 11:41:58 2001
@@ -68,1 +68,1 @@
-#include <db.h>
+#include <db2/db.h>
@@ -72,3 +72,5 @@
 #include "tcl.h"
-#include "tclExtend.h"
+#ifdef STATIC_TCLX
+#	include "tclExtend.h"
+#endif
 
@@ -862,2 +864,3 @@
 
+#ifdef STATIC_TCLX
     /* Extended Tcl */
@@ -871,2 +874,3 @@
     /* Tclx does its own call to Tcl_StaticPackage */
+#endif
 
@@ -908,6 +908,6 @@
 #endif
 
-#ifdef GDTCL
-    /* GIF generation*/
+#ifdef STATIC_GDTCL
+    /* Image generation */
     if (Gd_Init(interp) == TCL_ERROR) {
 	fprintf(stderr,
@@ -916,2 +920,3 @@
 
+#ifdef STATIC_NEO
     /* NeoSoft Extensions */
@@ -924,2 +929,3 @@
     Tcl_StaticPackage(interp, "Neo", Neo_Init, NULL);
+#endif
 
@@ -956 +956 @@
-	ap_server_root_relative(p, "neowebscript/init.tcl"), (char *)NULL)
+	ap_server_root_relative(p, "share/neowebscript/init.tcl"), (char *)NULL)
@@ -1687,2 +1687,3 @@
-	srand((int)(getpid() * 17 + time((long *) 0)));
-	for (whichLine = rand() % nLines; whichLine-- >= 0; ) {
+	/* Use BSD's random(4) device and the random(3) functions */
+	srandomdev();
+	for (whichLine = random() % nLines; whichLine-- >= 0; ) {
@@ -2164 +2165,6 @@
-    if (!(ap_allow_options(r) & OPT_INCLUDES)) return DECLINED;
+    if (!(ap_allow_options(r) & OPT_INCLUDES)) {
+	ap_log_rerror(APLOG_MARK, APLOG_ERR, r, "Apache configuration "
+		     "does not allow SSI parsing for ``%s''",
+		     r->filename, mode);
+	return DECLINED;
+    }
