--- ../passenger-3.0.1/ext/nginx/config.orig	2010-12-07 14:18:47.000000000 +0300
+++ ../passenger-3.0.1/ext/nginx/config	2010-12-07 14:19:38.000000000 +0300
@@ -2,13 +2,11 @@
    ! test -f "$ngx_addon_dir/../common/libboost_oxt.a"; then
     echo "*** The Phusion Passenger support files are not yet compiled. Compiling them for you... ***"
     echo "*** Running 'rake nginx RELEASE=yes' in $ngx_addon_dir... ***"
-    if ! cd $ngx_addon_dir; then
+    if ! (cd $ngx_addon_dir; rake nginx RELEASE=yes); then
         exit 1
+    else
+        echo "*** Phusion Passenger support files have been successfully compiled. ***"
     fi
-    if ! rake nginx RELEASE=yes; then
-        exit 1
-    fi
-    echo "*** Phusion Passenger support files have been successfully compiled. ***"
 fi
 
 ngx_feature="Math library"
