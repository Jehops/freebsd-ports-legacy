--- c/Makefile.PL.orig	Tue Mar 14 09:16:14 2000
+++ c/Makefile.PL	Tue Mar 14 16:31:06 2000
@@ -7,49 +7,41 @@
     win32_setup();
 }
 else {
-    require Apache::src;
-    my $src = Apache::src->new;
+    my $inc = `apxs -q INCLUDEDIR`;
 
     use Cwd;
     my $pwd = fastcwd;
     my @objs = qw(apache_request.o apache_cookie.o multipart_buffer.o);
-    $MY_LD_RUN_PATH = "$Config{installsitearch}/auto/libapreq:$pwd"; 
 
     WriteMakefile(
-       #grr, problems with things finding libapreq.so, sort out later.
-       'LINKTYPE' => 'static',
-#       'SKIP' => [qw(dynamic_lib dynamic_bs)],
+       'LINKTYPE' => 'dynamic',
        'NAME'	 => 'libapreq',
-       'INC' 	 => $src->inc,
-       'TYPEMAPS'   => $src->typemaps,
+       'INC' 	 => "-I$inc",
        'OBJECT' => "@objs",
     );
 }
 
 use Cwd;
 my $pwd = fastcwd;
-$ENV{LD_RUN_PATH} = 
-    "$ENV{LD_RUN_PATH}:$Config{installsitearch}/auto/libapr:$pwd";
 
-sub MY::dynamic {
-    my $self = shift;
-    my $string = $self->MM::dynamic;
-    $string =~ s/(Makefile\s+).*/$1/g;
-    $string;
-}
-
-sub MY::top_targets { 
-    my $self = shift; 
-    my $string = $self->MM::top_targets; 
-    my $libapreq = <<"EOF";
-LD_RUN_PATH = $ENV{LD_RUN_PATH}
-EOF
-
-    my $so = "\n".'$(DLBASE).$(DLEXT): $(INST_DYNAMIC)'."\n";
-
-    $string =~ s/(pure_all\s+::\s+)(.*)/$1 static $2/; 
-    return $libapreq . $so . $string;
-}
+#sub MY::dynamic {
+#    my $self = shift;
+#    my $string = $self->MM::dynamic;
+#    $string =~ s/(Makefile\s+).*/$1/g;
+#    $string;
+#}
+
+#sub MY::top_targets { 
+#    my $self = shift; 
+#    my $string = $self->MM::top_targets; 
+#    my $libapreq = <<"EOF";
+#EOF
+#
+#    my $so = "\n".'$(DLBASE).$(DLEXT): $(INST_DYNAMIC)'."\n";
+#
+#    $string =~ s/(pure_all\s+::\s+)(.*)/$1 static $2/; 
+#    return $libapreq . $so . $string;
+#}
 
 sub MY::post_initialize { 
     my $self = shift; 
--- Cookie/Makefile.PL.orig	Tue Mar 14 16:02:52 2000
+++ Cookie/Makefile.PL	Tue Mar 14 16:05:01 2000
@@ -15,9 +15,8 @@
     xsubpp("Cookie");
 }
 else {
-    require Apache::src;
-    my $src = Apache::src->new;
     use File::Path 'mkpath';
+    my $inc = `apxs -q INCLUDEDIR`;
     my $root = "../blib/arch/auto/libapreq";
     mkpath $root, 1, 0755 unless -d $root;
 
@@ -25,8 +24,7 @@
     system "touch $root/libapreq.a";
     WriteMakefile(
         @mm_args,
-        'INC'	=> "-I../c ". $src->inc,
-        'TYPEMAPS'  => $src->typemaps,
+        'INC'	=> "-I../c -I$inc -I$ENV{'PORTSDIR'}/www/p5-Apache/work/mod_perl-1.21/src/modules/perl",
         'LIBS' => "-L$root -lapreq",
     );
     unlink "$root/libapreq.a";
--- Request/Makefile.PL.orig	Tue Mar 14 09:53:01 2000
+++ Request/Makefile.PL	Tue Mar 14 16:01:06 2000
@@ -15,9 +15,8 @@
     xsubpp("Request");
 }
 else {
-    require Apache::src;
-    my $src = Apache::src->new;
     use File::Path 'mkpath';
+    my $inc = `apxs -q INCLUDEDIR`;
     my $root = "../blib/arch/auto/libapreq";
     mkpath $root, 1, 0755 unless -d $root;
 
@@ -25,8 +24,7 @@
     system "touch $root/libapreq.a";
     WriteMakefile(
 	  @mm_args,
-	  'INC'	=> "-I../c ". $src->inc,
-	  'TYPEMAPS'  => $src->typemaps,
+	  'INC'	=> "-I../c -I$inc -I$ENV{'PORTSDIR'}/www/p5-Apache/work/mod_perl-1.21/src/modules/perl",
           'LIBS' => "-L$root -lapreq",
     );
     unlink "$root/libapreq.a";
