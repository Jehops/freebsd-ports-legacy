# New ports collection makefile for:	dansguardian
# Date created:				March 26, 2002
# Whom:					Freddie Cash <fcash@sd73.bc.ca>
#
# $FreeBSD$
#

PORTNAME=	dansguardian
PORTVERSION=	2.8.0.6
PORTREVISION=	2
CATEGORIES=	www
MASTER_SITES=	# empty, see below
DISTNAME=	${PORTNAME}-${PORTVERSION}.source

MAINTAINER=	fcash@sd73.bc.ca
COMMENT=	A fast, feature-rich web content filter for Squid proxy servers

RUN_DEPENDS=	${LOCALBASE}/sbin/squid:${PORTSDIR}/www/squid

USE_RC_SUBR=	dansguardian.sh

CONFLICTS=	dansguardian-2.[67]*
LATEST_LINK=	dansguardian

WRKSRC=		${WRKDIR}/${PORTNAME}-${PORTVERSION}
GNU_CONFIGURE=	yes
CONFIGURE_ARGS=	--bindir=/sbin/ \
		--sysconfdir=/etc/dansguardian/ \
		--sysvdir=/etc/rc.d/ \
		--mandir=/man/ \
		--logdir=/var/log/ \
		--cgidir=/www/cgi-bin/ \
		--piddir=/var/run/ \
		--gccver=3

MAN8=		dansguardian.8
NOMANCOMPRESSED=	yes

OPTIONS=	DG_APACHE "Enable Apache support for access denied page" on \
		DG_PHRASELISTS "Install new phraselists over the old ones." off

DG_URL=		http://dansguardian.org/index.php?page=copyright2
CONFDIR=	${PREFIX}/etc/dansguardian

RESTRICTED=	Redistribution and commercial download is restricted.  Check ${DG_URL} for more info

.include <bsd.port.pre.mk>

.if !defined(WITHOUT_DG_APACHE)
USE_APACHE=	1.3+
.endif

# User needs to manually download the distfile
.if !(exists(${DISTDIR}/${DISTNAME}${EXTRACT_SUFX})) && !defined(PACKAGE_BUILDING)
IGNORE="Commercial source download is restricted.  Please visit and read ${DG_URL} and download ${DISTNAME}${EXTRACT_SUFX} into ${DISTDIR} before running make"
.endif

pre-install:
# Configure pkg-plist based on whether phraselists are to be installed or not
.if defined(WITH_DG_PHRASELISTS)
PLIST_SUB=	PHRASELISTS=""
.else
PLIST_SUB=	PHRASELISTS="@comment "
.endif

post-install:
# Check whether to install default phraselists
.if defined(WITH_DG_PHRASELISTS)
	@${ECHO_MSG} "===>   Installing default phraselists into ${CONFDIR}/phraselists"
	@${CP} -R ${WRKSRC}/phraselists ${CONFDIR}
.else
	@${ECHO_MSG} "===>   Skipping installation of phraselists."
.endif

# Display post-install message
	@${CAT} pkg-message

.include <bsd.port.post.mk>
