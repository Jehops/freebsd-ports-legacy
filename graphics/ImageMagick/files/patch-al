--- configure.in.orig	Fri Aug 24 04:50:46 2001
+++ configure.in	Fri Aug 24 04:51:11 2001
@@ -67,7 +67,7 @@
 #
 AC_ENABLE_SHARED(no)
 AC_ENABLE_STATIC(yes)
-AC_LIBLTDL_CONVENIENCE
+AC_LIBLTDL_INSTALLABLE
 # Substitute INCLTDL and LIBLTDL in the Makefiles
 AC_SUBST(INCLTDL)
 AC_SUBST(LIBLTDL)
@@ -714,7 +714,7 @@
     AC_MSG_RESULT()
     failed=0;
     passed=0;
-    AC_CHECK_HEADER(lcms/lcms.h,passed=`expr $passed + 1`,failed=`expr $failed + 1`,)
+    AC_CHECK_HEADER(lcms.h,passed=`expr $passed + 1`,failed=`expr $failed + 1`,)
     AC_CHECK_LIB(lcms,cmsOpenProfileFromMem,passed=`expr $passed + 1`,failed=`expr $failed + 1`,)
     AC_MSG_CHECKING(if LCMS package is complete)
     if test $passed -gt 0
@@ -1099,6 +1099,22 @@
     AC_MSG_RESULT()
     failed=0;
     passed=0;
+
+    OLD_LDFLAGS="$LDFLAGS"
+    OLD_CPPFLAGS="$CPPFLAGS"
+    if test -d "$builddir/libxml/include"
+    then
+       :
+    else
+       xml_config=''
+       AC_CHECK_PROGS(xml_config,xml2-config,)dnl
+       if test -n "$xml_config"
+       then
+          LDFLAGS=-L`$xml_config --prefix`/lib" $LDFLAGS" 2> /dev/null
+          CPPFLAGS=`$xml_config --cflags`" $CPPFLAGS" 2> /dev/null
+       fi
+    fi
+
     AC_CHECK_HEADER(libxml/parser.h,passed=`expr $passed + 1`,failed=`expr $failed + 1`)
     AC_CHECK_LIB(xml2,xmlParseExternalEntity,passed=`expr $passed + 1`,failed=`expr $failed + 1`,)
     AC_MSG_CHECKING(if XML package is complete)
@@ -1108,6 +1124,8 @@
     then
 	AC_MSG_RESULT(no -- some components failed test)
         have_xml='no (failed tests)'
+        CPPFLAGS="$OLD_CPPFLAGS"
+        LDFLAGS="$OLD_LDFLAGS"
     else
 	LIB_XML='-lxml2'
 	LIBS="$LIB_XML $LIBS"
