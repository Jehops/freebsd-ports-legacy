--- configure.in.orig	Sun Mar  4 11:07:42 2001
+++ configure.in	Wed Mar 28 05:33:09 2001
@@ -65,7 +65,7 @@
 #
 AC_ENABLE_SHARED(no)
 AC_ENABLE_STATIC(yes)
-AC_LIBLTDL_CONVENIENCE
+AC_LIBLTDL_INSTALLABLE
 # Substitute INCLTDL and LIBLTDL in the Makefiles
 AC_SUBST(INCLTDL)
 AC_SUBST(LIBLTDL)
@@ -1021,6 +1027,22 @@
     AC_MSG_RESULT()
     failed=0;
     passed=0;
+
+    OLD_LDFLAGS="$LDFLAGS"
+    OLD_CPPFLAGS="$CPPFLAGS"
+    if test -d "$builddir/libxml/include"
+    then
+       :
+    else
+       xml_config=''
+       AC_CHECK_PROGS(xml_config,xml2-config,)dnl
+       if test -n "$xml_config"
+       then
+          LDFLAGS=-L`$xml_config --prefix`/lib" $LDFLAGS" 2> /dev/null
+          CPPFLAGS=`$xml_config --cflags`" $CPPFLAGS" 2> /dev/null
+       fi
+    fi
+
     AC_CHECK_HEADER(libxml/parser.h,passed=`expr $passed + 1`,failed=`expr $failed + 1`)
     AC_CHECK_LIB(xml2,xmlParseExternalEntity,passed=`expr $passed + 1`,failed=`expr $failed + 1`,)
     AC_MSG_CHECKING(if XML package is complete)
@@ -1030,6 +1052,8 @@
     then
 	AC_MSG_RESULT(no -- some components failed test)
         have_xml='no (failed tests)'
+        CPPFLAGS="$OLD_CPPFLAGS"
+        LDFLAGS="$OLD_LDFLAGS"
     else
 	LIB_XML='-lxml2'
 	LIBS="$LIB_XML $LIBS"
