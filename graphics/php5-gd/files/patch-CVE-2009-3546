--- ./libgd/gd_gd.c.orig	2007-08-09 07:21:38.000000000 -0700
+++ ./libgd/gd_gd.c	2009-11-08 23:13:19.144908056 -0800
@@ -39,6 +39,9 @@
 			if (!gdGetWord(&im->colorsTotal, in)) {
 				goto fail1;
 			}
+			if (im->colorsTotal > gdMaxColors) {
+				goto fail1;
+			}
 		}
 		/* Int to accommodate truecolor single-color transparency */
 		if (!gdGetInt(&im->transparent, in)) {
