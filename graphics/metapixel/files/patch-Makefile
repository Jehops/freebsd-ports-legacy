--- Makefile.orig	Sun May  8 18:25:51 2005
+++ Makefile	Sun Jul 31 13:55:22 2005
@@ -1,5 +1,5 @@
-PREFIX = /usr/local
-INSTALL = install
+#PREFIX = /usr/local
+#INSTALL = install
 MANPAGE_XSL = /sw/share/xml/xsl/docbook-xsl/manpages/docbook.xsl
 
 BINDIR = $(PREFIX)/bin
@@ -8,24 +8,24 @@
 VERSION = 1.0.0
 
 #DEBUG = -g
-OPTIMIZE = -O2
+#OPTIMIZE = -O2
 #PROFILE = -pg
 
-MACOS_LDOPTS = -L/sw/lib
-MACOS_CCOPTS = -I/sw/include
+#MACOS_LDOPTS = -L/sw/lib
+#MACOS_CCOPTS = -I/sw/include
 
-LDOPTS = $(MACOS_LDOPTS) -L/usr/X11R6/lib $(PROFILE) $(DEBUG)
-CCOPTS = $(MACOS_CCOPTS) -I/usr/X11R6/include -I/usr/X11R6/include/X11 -I. -Wall $(OPTIMIZE) $(DEBUG) $(PROFILE) -DMETAPIXEL_VERSION=\"$(VERSION)\"
-CC = gcc
+LDOPTS = ${LDFLAGS} $(PROFILE) $(DEBUG)
+CCOPTS = ${CFLAGS} ${CPPFLAGS} -Wall $(OPTIMIZE) $(DEBUG) $(PROFILE) -DMETAPIXEL_VERSION=\"$(VERSION)\"
+#CC = gcc
 #LIBFFM = -lffm
 
 LISPREADER_OBJS = lispreader.o pools.o allocator.o
 OBJS = metapixel.o vector.o zoom.o rwpng.o rwjpeg.o readimage.o writeimage.o \
-       $(LISPREADER_OBJS) getopt.o getopt1.o
-CONVERT_OBJS = convert.o $(LISPREADER_OBJS) getopt.o getopt1.o
+       $(LISPREADER_OBJS)
+CONVERT_OBJS = convert.o $(LISPREADER_OBJS)
 IMAGESIZE_OBJS = imagesize.o rwpng.o rwjpeg.o readimage.o
 
-all : metapixel metapixel.1 convert imagesize
+all : metapixel metapixel.1 metapixel-convert metapixel-imagesize metapixel-zoom
 
 metapixel : $(OBJS)
 	$(CC) $(LDOPTS) -o metapixel $(OBJS) -lpng -ljpeg $(LIBFFM) -lm -lz
@@ -33,14 +33,14 @@
 metapixel.1 : metapixel.xml
 	xsltproc --nonet $(MANPAGE_XSL) metapixel.xml
 
-convert : $(CONVERT_OBJS)
-	$(CC) $(LDOPTS) -o convert $(CONVERT_OBJS)
+metapixel-convert : $(CONVERT_OBJS)
+	$(CC) $(LDOPTS) -o $@ $(CONVERT_OBJS)
 
-imagesize : $(IMAGESIZE_OBJS)
-	$(CC) $(LDOPTS) -o imagesize $(IMAGESIZE_OBJS) -lpng -ljpeg -lm -lz
+metapixel-imagesize : $(IMAGESIZE_OBJS)
+	$(CC) $(LDOPTS) -o $@ $(IMAGESIZE_OBJS) -lpng -ljpeg -lm -lz
 
-zoom : zoom.c rwjpeg.c rwpng.c readimage.c writeimage.c
-	$(CC) -o zoom $(OPTIMIZE) $(PROFILE) $(MACOS_CCOPTS) -DTEST_ZOOM zoom.c rwjpeg.c rwpng.c readimage.c writeimage.c $(MACOS_LDOPTS) -lpng -ljpeg -lm -lz
+metapixel-zoom : zoom.c rwjpeg.c rwpng.c readimage.c writeimage.c
+	$(CC) $(CCOPTS) $(LDFLAGS) -o $@ -DTEST_ZOOM zoom.c rwjpeg.c rwpng.c readimage.c writeimage.c -lpng -ljpeg -lm -lz
 
 %.o : %.c
 	$(CC) $(CCOPTS) -c $<
