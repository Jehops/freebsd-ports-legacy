--- ppm/Makefile.orig	Sat Jul  1 03:26:39 2000
+++ ppm/Makefile	Sat Jul  1 12:00:00 2000
@@ -3,8 +3,7 @@
 
 LIBROOT = ppm
 LIBPPM = lib$(LIBROOT).$(NETPBMLIBSUFFIX)
-MAJ = 9
-MIN = 5
+SOVER = 1
 
 PGMDIR = $(SRCDIR)/pgm
 LIBPGM = libpgm.$(NETPBMLIBSUFFIX)
@@ -24,23 +23,25 @@
 PORTBINARIES =	bmptoppm eyuvtoppm gouldtoppm hpcdtoppm ilbmtoppm imgtoppm \
 		leaftoppm mtvtoppm pcxtoppm pgmtoppm pi1toppm picttoppm \
 		pjtoppm \
-		ppm3d ppmbrighten ppmchange ppmcolormask \
+		ppm3d ppmbrighten ppmchange \
 		ppmdim ppmdist ppmdither \
 		ppmflash ppmhist ppmmake ppmmix ppmnorm \
 		ppmquant ppmrelief ppmshift ppmspread ppmtoacad \
-		ppmtobmp ppmtoeyuv ppmtogif ppmtoleaf \
+		ppmtoeyuv ppmtogif ppmtoleaf \
 		ppmtoicr ppmtoilbm ppmtomitsu \
 		ppmtopcx ppmtopgm ppmtopi1 ppmtopict ppmtopj \
 		ppmtopjxl ppmtopuzz ppmtorgb3 ppmtosixel \
 		ppmtotga ppmtouil ppmtowinicon ppmtoxpm ppmtoyuv \
 		ppmtoyuvsplit ppmtv \
 		qrttoppm rawtoppm rgb3toppm sldtoppm spctoppm \
-		sputoppm tgatoppm winicontoppm ximtoppm xpmtoppm xvminitoppm \
+		sputoppm winicontoppm xpmtoppm xvminitoppm \
 		yuvtoppm yuvsplittoppm
+SHHOPTBINARIES = ppmcolormask ppmtobmp tgatoppm ximtoppm
 
 # We don't build vidtoppm by default, because it requires special libraries
 # and there is no known requirement for vidtoppm.
 
+NOMERGEBINARIES = $(SHHOPTBINARIES) ppmntsc
 ifneq ($(JPEGLIB_DIR), NONE)
   ifneq ($(JPEGHDR_DIR), NONE)
       NOMERGEBINARIES += ppmtojpeg
@@ -49,7 +50,7 @@
 
 MERGEBINARIES = $(PORTBINARIES) $(MATHBINARIES)
 
-MATHBINARIES = ppmcie ppmforge ppmlabel ppmntsc ppmpat ppmqvga ppmtomap
+MATHBINARIES = ppmcie ppmforge ppmlabel ppmpat ppmqvga ppmtomap
 BINARIES = $(MERGEBINARIES) $(NOMERGEBINARIES) 
 SCRIPTS = ppmquantall ppmshadow ppmfade
 
@@ -58,6 +59,8 @@
 MERGE_OBJECTS = $(patsubst %,%.o2, $(MERGEBINARIES))
 
 LIBOBJECTS = libppm1.o libppm2.o libppm3.o libppm4.o libppm5.o bitio.o
+LIBSOBJECTS = $(patsubst %.o, %.so, $(LIBOBJECTS))
+LIBSHHOPT = $(SRCDIR)/shhopt/libshhopt.a
 
 MANUALS1 = $(BINARIES) $(SCRIPTS)
 MANUALS3 = libppm
@@ -65,18 +68,24 @@
 
 MERGENAME= ppmmerge
 
-INTERFACE_HEADERS = ppm.h ppmcmap.h
+INTERFACE_HEADERS = ppm.h ppmcmap.h ppmdraw.h
 
 .PHONY: all
 all:        $(BINARIES)
-	$(MAKE) -C ppmtompeg all
 .PHONY: merge
 merge:      $(MERGENAME) $(NOMERGEBINARIES)
-	$(MAKE) -C ppmtompeg all
 
-ppmtojpeg: %: %.o $(NETPBMLIBS) $(LIBOPT)
+$(SHHOPTBINARIES): %: %.o $(NETPBMLIBS) $(LIBOPT) $(LIBSHHOPT)
 	$(LD) $(LDFLAGS) -o $@ $@.o `$(LIBOPT) $(NETPBMLIBS)` \
-	  -L$(JPEGLIB_DIR) -ljpeg $(CDEBUG)
+	  $(LIBSHHOPT) $(CDEBUG)
+
+ppmntsc: %: %.o $(NETPBMLIBS) $(LIBOPT) $(LIBSHHOPT)
+	$(LD) $(LDFLAGS) -o $@ $@.o `$(LIBOPT) $(NETPBMLIBS)` \
+	  -lm $(LIBSHHOPT) $(CDEBUG)
+
+ppmtojpeg: %: %.o $(NETPBMLIBS) $(LIBOPT) $(LIBSHHOPT)
+	$(LD) $(LDFLAGS) -o $@ $@.o `$(LIBOPT) $(NETPBMLIBS)` \
+	  -L$(JPEGLIB_DIR) -ljpeg $(LIBSHHOPT) $(CDEBUG)
 
 # And libraries.
 $(PBMDIR)/$(LIBPBM): FORCE
@@ -89,19 +98,19 @@
 
 .PHONY: install.merge
 install.merge: install.merge.common
-	$(MAKE) -C ppmtompeg install.bin
 
 .PHONY: install.lib
 install.lib: install.lib.common
 
 .PHONY: install.man
 install.man: install.man.common
-	$(MAKE) -C ppmtompeg install.man
 
 include $(SRCDIR)/Makefile.common
 
+$(SRCDIR)/shhopt/libshhopt.a:
+	cd ../shhopt; $(MAKE) libshhopt.a
+
 .PHONY: clean
 clean: clean.common
-	$(MAKE) -C ppmtompeg clean
 
 FORCE:
