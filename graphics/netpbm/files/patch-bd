--- pbm/Makefile.orig	Fri Mar 24 07:43:30 2000
+++ pbm/Makefile	Sat Apr  1 12:00:00 2000
@@ -4,7 +4,7 @@
 include $(SRCDIR)/Makefile.config
 
 
-INCLUDE = -I$(SRCDIR)
+INCLUDE = -I$(SRCDIR) -I$(SRCDIR)/shhopt
 
 # Shared library naming
 LIBROOT = pbm
@@ -14,6 +14,7 @@
 
 LIBLIBS = $(SRCDIR)/shhopt/libshhopt.a
 NETPBMLIBS = $(LIBPBM)
+NETPBMLD = -L. -lpbm
 
 PORTBINARIES =	atktopbm brushtopbm cmuwmtopbm g3topbm \
 		icontopbm gemtopbm macptopbm mgrtopbm \
@@ -35,6 +36,7 @@
 MERGE_OBJECTS = $(patsubst %,%.o2, $(BINARIES))
 
 LIBOBJECTS = libpbm1.o libpbm2.o libpbm3.o libpbm4.o libpbm5.o
+LIBSOBJECTS = libpbm1.so libpbm2.so libpbm3.so libpbm4.so libpbm5.so
 
 MANUALS1 =	$(BINARIES)
 MANUALS3 =	libpbm
@@ -42,7 +44,7 @@
 
 MERGENAME = pbmmerge
 
-INTERFACE_HEADERS = pbm.h
+INTERFACE_HEADERS = pbm.h ../pbmplus.h
 
 .PHONY: all
 all:		$(BINARIES)
@@ -52,15 +54,18 @@
 
 # Rules for plain programs.
 $(PORTBINARIES): %: %.o $(NETPBMLIBS)
-	$(LD) $(LDFLAGS) -o $@ $@.o $(NETPBMLIBS) $(CDEBUG)
+	$(LD) $(LDFLAGS) -o $@ $@.o $(NETPBMLD) $(CDEBUG)
 
 # Rule for math-dependent programs.
 $(MATHBINARIES): %: %.o $(NETPBMLIBS)
-	$(LD) $(LDFLAGS) -o $@ $@.o -lm $(NETPBMLIBS) $(CDEBUG)
+	$(LD) $(LDFLAGS) -o $@ $@.o -lm $(NETPBMLD) $(CDEBUG)
 
 # Rule for objects.
 $(OBJECTS) $(LIBOBJECTS): %.o: %.c
 	$(CC) -c $(CFLAGS) $(INCLUDE) -o $@ $<
+
+$(LIBSOBJECTS): %.so: %.c
+	$(CC) -c -fpic -DPIC $(CFLAGS) $(INCLUDE) -o $@ $<
 
 $(MERGE_OBJECTS): %.o2: %.c
 	$(CC) -c $(CFLAGS) $(INCLUDE) "-Dmain=$*_main" -o $@ $<
