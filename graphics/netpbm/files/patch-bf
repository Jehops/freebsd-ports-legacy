--- pnm/Makefile.orig	Fri Jul  7 15:24:20 2000
+++ pnm/Makefile	Sat Jul 15 00:00:00 2000
@@ -3,8 +3,7 @@
 
 LIBROOT = pnm
 LIBPNM = lib$(LIBROOT).$(NETPBMLIBSUFFIX)
-MAJ = 9
-MIN = 5
+SOVER = 1
 
 PPMDIR = $(SRCDIR)/ppm
 LIBPPM = libppm.$(NETPBMLIBSUFFIX)
@@ -55,20 +54,21 @@
 # build.
 
 PORTBINARIES = fitstopnm gemtopnm giftopnm \
-		pnmalias pnmarith pnmcat pnmcomp pnmconvol pnmcrop \
-		pnmcut pnmdepth pnmenlarge pnmfile pnmflip pnmhisteq \
+		pnmalias pnmarith pnmcat pnmcomp pnmconvol \
+		pnmdepth pnmenlarge pnmflip pnmhisteq \
 		pnmhistmap pnminterp pnminvert pnmpad pnmpaste \
-		pnmsmooth pnmsplit pnmtile pnmtoddif pnmtofits \
+		pnmsmooth pnmtile pnmtoddif pnmtofits \
 		pnmtoplainpnm pnmtops pnmtorast \
-		pnmtosgi pnmtosir pnmtoxwd pstopnm \
-		rasttopnm sgitopnm sirtopnm xwdtopnm zeisstopnm
+		pnmtosgi pnmtosir pnmtoxwd \
+		rasttopnm sgitopnm sirtopnm zeisstopnm
 MATHBINARIES =	pnmgamma pnmnlfilt pnmrotate pnmscale pnmshear
+SHHOPTBINARIES = pnmcrop pnmcut pnmfile pnmsplit pstopnm xwdtopnm
 
 # We don't include programs that have special library dependencies in the
 # merge scheme, because we don't want those dependencies to prevent us
 # from building all the other programs.
 
-NOMERGEBINARIES = 
+NOMERGEBINARIES = $(SHHOPTBINARIES)
 ifneq ($(PNGHDR_DIR),NONE)
   ifneq ($(PNGLIB_DIR),NONE)
     NOMERGEBINARIES += pnmtopng pngtopnm
@@ -105,6 +105,8 @@
 MERGE_OBJECTS = $(patsubst %,%.o2, $(MERGEBINARIES))
 
 LIBOBJECTS = libpnm1.o libpnm2.o libpnm3.o libpnm4.o
+SHLIBOBJECTS = $(patsubst %.o, %.lo, $(LIBOBJECTS))
+LIBSHHOPT = $(SRCDIR)/shhopt/libshhopt.a
 
 MANUALS1 = $(BINARIES) $(SCRIPTS)
 MANUALS3 = libpnm
@@ -116,12 +118,12 @@
 
 .PHONY: all
 all:      $(BINARIES)
-	$(MAKE) -C jbig all
-	$(MAKE) -C fiasco all
 PHONY: merge
 merge:    $(MERGENAME) $(NOMERGEBINARIES)
-	$(MAKE) -C jbig all
-	$(MAKE) -C fiasco all
+
+$(SHHOPTBINARIES): %: %.o $(NETPBMLIBS) $(LIBOPT) $(LIBSHHOPT)
+	$(LD) $(LDFLAGS) -o $@ $@.o `$(LIBOPT) $(NETPBMLIBS)` \
+	  $(LIBSHHOPT) $(CDEBUG)
 
 ifeq ($(TIFFLIB_DIR),$(TIFFDIR))
 # We're using the internal Tiff library, so make sure it's built
@@ -132,18 +134,18 @@
 endif
 
 # The Tiff library references math functions.
-tifftopnm pnmtotiff pnmtotiffcmyk: %: %.o \
-  $(NETPBMLIBS) $(TIFFLIB_DIR)/libtiff.$(LIBTIFFSUFFIX) $(LIBOPT)
+tifftopnm pnmtotiff pnmtotiffcmyk: %: %.o $(NETPBMLIBS) $(LIBOPT) \
+	$(TIFFLIB_DIR)/libtiff.$(LIBTIFFSUFFIX) $(LIBSHHOPT)
 	$(LD) $(LDFLAGS) -o $@ $@.o `$(LIBOPT) $(NETPBMLIBS)` \
-	  -L$(TIFFLIB_DIR) -ltiff $(JPEGLD) -lm $(CDEBUG)
+	  -L$(TIFFLIB_DIR) -ltiff $(JPEGLD) -lm $(LIBSHHOPT) $(CDEBUG)
 
 pngtopnm pnmtopng: %: %.o $(NETPBMLIBS) $(LIBOPT)
 	$(LD) $(LDFLAGS) -o $@ $@.o `$(LIBOPT) $(NETPBMLIBS)` \
 	  -L$(PNGLIB_DIR) -lpng -lz -lm $(CDEBUG)
 
-jpegtopnm: %: %.o $(NETPBMLIBS) $(LIBOPT)
+jpegtopnm: %: %.o $(NETPBMLIBS) $(LIBOPT) $(LIBSHHOPT)
 	$(LD) $(LDFLAGS) -o $@ $@.o `$(LIBOPT) $(NETPBMLIBS)` $(JPEGLD) \
-	   $(CDEBUG)
+	  $(LIBSHHOPT) $(CDEBUG)
 
 ifeq ($(URTLIB_DIR),$(URTDIR))
 # We're using the internal URT library, so make sure it's built
@@ -180,25 +182,20 @@
 # backward compatibility: program used to be gemtopbm
 	rm -f $(INSTALLBINARIES)/gemtopbm
 	ln -s $(INSTALLBINARIES)/gemtopnm$(EXE) $(INSTALLBINARIES)/gemtopbm
-	$(MAKE) -C jbig install.bin
-	$(MAKE) -C fiasco install.bin
 
 .PHONY: install.merge
 install.merge: install.merge.common
-	$(MAKE) -C jbig install.bin
-	$(MAKE) -C fiasco install.bin
 
 .PHONY: install.lib
 install.lib: install.lib.common
 
 .PHONY: install.man
 install.man: install.man.common
-	$(MAKE) -C jbig install.man
-	$(MAKE) -C fiasco install.man
+
+$(SRCDIR)/shhopt/libshhopt.a:   
+	cd ../shhopt; $(MAKE) libshhopt.a
 
 .PHONY: clean
 clean: clean.common
-	$(MAKE) -C jbig clean
-	$(MAKE) -C fiasco clean
 
 FORCE:
