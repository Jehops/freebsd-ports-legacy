--- configure.in.orig	Thu Aug 24 09:53:45 2000
+++ configure.in	Mon Oct  9 21:39:56 2000
@@ -846,19 +846,19 @@
 AC_HEADER_STDC
 AC_CHECK_HEADERS(fcntl.h limits.h sys/ioctl.h unistd.h floatingpoint.h \
        sys/types.h sys/mman.h sys/perm.h asm/sigcontext.h)
-AC_CHECK_HEADER(asm/mtrr.h,
+AC_CHECK_HEADER(sys/memrange.h,
 [
   if test "$enable_mtrr" = "no"
    then
     echo "disabling mtrr (manual override)"
     cflags="$cflags -DNO_MTRR"
    else
-    dnl For some reason, some <asm/mtrr.h> files are incomplete
+    dnl For some reason, some <sys/memrange.h> files are incomplete
     dnl Verify the validity of the file here
-    AC_MSG_CHECKING(validity of asm/mtrr.h)
+    AC_MSG_CHECKING(validity of sys/memrange.h)
     AC_EGREP_CPP([GLX_maGiC_VALID],[
-#include <asm/mtrr.h>
-#ifdef MTRRIOC_ADD_ENTRY
+#include <sys/memrange.h>
+#ifdef MDF_WRITECOMBINE
 GLX_maGiC_VALID
 #endif
     ],
@@ -879,7 +879,7 @@
 ])
 
 dnl agp driver support
-AC_CHECK_HEADER(linux/agpgart.h,
+AC_CHECK_HEADER(sys/agpio.h,
 [
   if test "$enable_agp" = "no"
    then
@@ -887,9 +887,9 @@
    else
     dnl see which version of the gart module we've found
     AC_MSG_CHECKING(validity of agpgart.h)
-    AC_EGREP_CPP([/dev/agpgart],[
-#include <linux/agpgart.h>
-AGP_DEVICE
+    AC_EGREP_CPP([],[
+#include <sys/agpio.h>
+AGPIOC_INFO
     ],
     [
       AC_MSG_RESULT([new agpgart module])
@@ -906,7 +906,7 @@
   fi
 ],
 [
-  dnl *didn't* find linux/agpgart.h on the system
+  dnl *didn't* find sys/agpio.h on the system
   if test "$enable_agp" = "yes"
    then
     AC_MSG_RESULT([  enabling agpgart support anyway (manual override)])
