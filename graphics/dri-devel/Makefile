# Ports collection makefile for:	dri-devel
# Date created:				Wed Aug 21 14:47:34 PDT 2002
# Whom:					Eric Anholt <anholt@FreeBSD.org>
#
# $FreeBSD$
#

PORTNAME=	dri
PORTVERSION=	6.1.p20040507
PORTEPOCH=	1
CATEGORIES=	graphics
MASTER_SITES=	${MASTER_SITE_LOCAL}
MASTER_SITE_SUBDIR=	anholt/dri-devel
DISTFILES=	dri-20040507.tar.bz2	\
		Mesa-20040507.tar.bz2	\
		drm-20040507.tar.bz2

MAINTAINER=	anholt@FreeBSD.org
COMMENT=	OpenGL hardware acceleration drivers snapshot for XFree86

WRKSRC=		${WRKDIR}/xc
BUILD_WRKSRC=	${WRKSRC}/lib/GL
INSTALL_WRKSRC=	${WRKSRC}/lib/GL/mesa/drivers/dri
USE_BZIP2=	yes
USE_X_PREFIX=	yes
MAKE_ENV=	FBSDCFLAGS="${CFLAGS}" FBSDCC="${CC}" FBSDCXX="${CXX}"
LATEST_LINK=	${PORTNAME}-devel

ONLY_FOR_ARCHS=	alpha i386

do-configure:
	@${RM} -f ${WRKSRC}/config/cf/projectroot.def
	@${ECHO} "#define ProjectRoot ${X11BASE}" > ${WRKSRC}/config/cf/projectroot.def
	@${RM} -f  ${WRKSRC}/config/cf/version.def
	@${RM} -f  ${WRKSRC}/config/cf/date.def
	@${TOUCH} ${WRKSRC}/config/cf/version.def
	@${TOUCH} ${WRKSRC}/config/cf/date.def
	@cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} ${MAKE} Makefile.boot
.for target in VerifyOS version.def Makefiles includes depend
	@cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} ${MAKE} -f xmakefile ${target}
.endfor

pre-build:
	cd ${WRKSRC}/config && ${SETENV} ${MAKE_ENV} ${MAKE} ${MAKE_FLAGS} \
		${MAKEFILE} ${MAKE_ARGS} ${ALL_TARGET}

.include <bsd.port.pre.mk>
.if ${ARCH} == i386
PLIST_SUB+=	I386=""
.else
PLIST_SUB+=	I386="@comment "
.endif

.include <bsd.port.post.mk>
