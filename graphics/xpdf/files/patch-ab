--- goo/gfile.cc.orig	Fri Feb  1 15:15:45 2002
+++ goo/gfile.cc	Sun Feb 10 17:42:52 2002
@@ -489,6 +489,16 @@
   int fd;
 
   if (ext) {
+# if HAVE_MKSTEMPS
+    if ((s = getenv("TMPDIR"))) {
+      *name = new GString(s);
+    } else {
+      *name = new GString("/tmp");
+    }
+    (*name)->append("/XXXXXX");
+    (*name)->append(ext);
+    fd = mkstemps((*name)->getCString(), strlen(ext));
+# else
     if (!(s = tmpnam(NULL))) {
       return gFalse;
     }
@@ -499,6 +509,7 @@
     }
     (*name)->append(ext);
     fd = open((*name)->getCString(), O_WRONLY | O_CREAT | O_EXCL, 0600);
+# endif
   } else {
 #if HAVE_MKSTEMP
     if ((s = getenv("TMPDIR"))) {
