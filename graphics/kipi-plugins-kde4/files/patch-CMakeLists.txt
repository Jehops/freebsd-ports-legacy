--- ./CMakeLists.txt.orig	2009-03-17 04:59:48.000000000 -0400
+++ ./CMakeLists.txt	2009-06-08 04:36:50.000000000 -0400
@@ -32,15 +32,53 @@
 INCLUDE(FindPackageHandleStandardArgs)
 INCLUDE(KDE4Defaults)
 INCLUDE(MacroLibrary)
+INCLUDE(FindPkgConfig)
 
 # Depencies detection required by all plugins
-FIND_PACKAGE(Kexiv2 REQUIRED)
-FIND_PACKAGE(Kdcraw REQUIRED)
-FIND_PACKAGE(Kipi REQUIRED)
 FIND_PACKAGE(JPEG REQUIRED)
 FIND_PACKAGE(PNG REQUIRED)
 FIND_PACKAGE(TIFF REQUIRED)
 
+# Check for KExiv2
+PKG_CHECK_MODULES(LIBKEXIV2 libkexiv2-kde4>=0.5.0)
+FIND_PATH(KEXIV2_INCLUDE_DIR NAMES libkexiv2/version.h
+  PATHS ${LIBKEXIV2_INCLUDE_DIRS} ${KDE4_INCLUDE_DIR} NO_DEFAULT_PATH)
+FIND_LIBRARY(KEXIV2_LIBRARY NAMES kexiv2
+  PATHS ${LIBKEXIV2_LIBRARY_DIRS} ${KDE4_LIB_DIR} NO_DEFAULT_PATH)
+
+FIND_PACKAGE_HANDLE_STANDARD_ARGS(KEXIV2 DEFAULT_MSG KEXIV2_LIBRARY KEXIV2_INCLUDE_DIR)
+
+IF(KEXIV2_FOUND)
+  SET(KEXIV2_LIBRARIES ${KEXIV2_LIBRARY})
+ENDIF(KEXIV2_FOUND)
+
+# Check for Kdcraw
+PKG_CHECK_MODULES(LIBKDCRAW libkdcraw-kde4>=0.4.0)
+FIND_PATH(KDCRAW_INCLUDE_DIR NAMES libkdcraw/version.h
+  PATHS ${LIBKDCRAW_INCLUDE_DIRS} ${KDE4_INCLUDE_DIR} NO_DEFAULT_PATH)
+FIND_LIBRARY(KDCRAW_LIBRARY NAMES kdcraw
+  PATHS ${LIBKDCRAW_LIBRARY_DIRS} ${KDE4_LIB_DIR} NO_DEFAULT_PATH)
+
+FIND_PACKAGE_HANDLE_STANDARD_ARGS(KDCRAW DEFAULT_MSG KDCRAW_LIBRARY KDCRAW_INCLUDE_DIR)
+
+IF(KDCRAW_FOUND)
+  SET(KDCRAW_LIBRARIES ${KDCRAW_LIBRARY})
+  SET(KDCRAW_FOR_DNGCONVERTER TRUE)
+ENDIF(KDCRAW_FOUND)
+
+# Check for Kipi
+PKG_CHECK_MODULES(LIBKIPI libkipi-kde4>=0.2.0)
+FIND_PATH(KIPI_INCLUDE_DIR NAMES libkipi/version.h
+  PATHS ${LIBKIPI_INCLUDE_DIRS} ${KDE4_INCLUDE_DIR} NO_DEFAULT_PATH)
+FIND_LIBRARY(KIPI_LIBRARY NAMES kipi
+  PATHS ${LIBKIPI_LIBRARY_DIRS} ${KDE4_LIB_DIR} NO_DEFAULT_PATH)
+
+FIND_PACKAGE_HANDLE_STANDARD_ARGS(KIPI DEFAULT_MSG KIPI_LIBRARY KIPI_INCLUDE_DIR)
+
+IF(KIPI_FOUND)
+  SET(KIPI_LIBRARIES ${KIPI_LIBRARY})
+ENDIF(KIPI_FOUND)
+
 # Optional depencies detection required by some plugins
 
 SET(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} ${CMAKE_CURRENT_SOURCE_DIR}/cmake/modules)
@@ -63,19 +101,6 @@
     MACRO_OPTIONAL_FIND_PACKAGE(X11)   # For AdvancedSlideshow and ImageViewer.
 ENDIF(NOT WIN32 AND NOT APPLE)
 
-IF(NOT WIN32)
-    # Check KDcraw version installed to compile fine DngConverter plugin.
-    FIND_PACKAGE(PkgConfig)
-    PKG_CHECK_MODULES(Kdcraw libkdcraw>=0.4.0)
-    IF(Kdcraw_FOUND)
-        SET(KDCRAW_FOR_DNGCONVERTER TRUE)
-    ELSE(Kdcraw_FOUND)
-        SET(KDCRAW_FOR_DNGCONVERTER FALSE)
-    ENDIF(Kdcraw_FOUND)
-ELSE(NOT WIN32)
-    SET(KDCRAW_FOR_DNGCONVERTER TRUE)
-ENDIF(NOT WIN32)
-
 INCLUDE(MacroOptionalDependPackage)
 
 # LINUX Only.
