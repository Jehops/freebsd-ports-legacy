--- libdib/Makefile.in.orig	Fri Sep 22 04:14:36 2000
+++ libdib/Makefile.in	Sat Nov  4 20:27:35 2000
@@ -22,30 +22,34 @@
 libdir = @libdir@
 mandir = @mandir@
 
-CFLAGS = @CFLAGS@ @DEFS@ -I.
+CFLAGS = @CFLAGS@ @DEFS@ -I. -I..
 
 MKINSTALLDIRS = $(srcdir)/mkinstalldirs
 
 SHELL = /bin/sh
 
-.SUFFIXES: .C .o
+.SUFFIXES: .c .o .so
 
 MYOBJECTS = \
-    ../bytelevel.o \
+    bytelevel.o \
     bintree.o \
     dibtoxpm.o
 
-all: libdib.a test_dibtoxpm
+all: libdib.a libdib.so.1 test_dibtoxpm
 
 libdib.a:  $(MYOBJECTS)
 	$(AR) rc libdib.a $(MYOBJECTS)
 	$(RANLIB) libdib.a 
 
+libdib.so.1:	$(MYOBJECTS:.o=.so)
+	$(CC) -shared -Wl,-soname,$@ -o $@ $(MYOBJECTS:.o=.so) $(LIBS)
+	ln -sf libdib.so.1 libdib.so
+
 test_dibtoxpm:  libdib.a test_dibtoxpm.o
 	$(CC) $(LDFLAGS) -o test_dibtoxpm test_dibtoxpm.o -ldib
 
-%.o: %.c
-	$(CC) $(CFLAGS) -c $*.c
+.c.so:
+	$(CC) $(CFLAGS) -fPIC -DPIC -o $@ -c $<
 
 clean:
 	rm -rf *.o *.a test_dibtoxpm a.out core
@@ -60,6 +64,8 @@
 install: all installdirs
 	$(INSTALL_DATA) dibtoxpm.h $(INCLUDEDIR)/dibtoxpm.h
 	$(INSTALL_DATA) libdib.a @libdir@/libdib.a
+	$(INSTALL_DATA) libdib.so.1 @libdir@/libdib.so.1
+	ln -sf libdib.so.1 @libdir@/libdib.so
 
 
 #  DO  NOT  DELETE THIS LINE -- make depend depends on it.
