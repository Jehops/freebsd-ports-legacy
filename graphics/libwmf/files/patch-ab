--- xgd-1.7.3/Makefile.in.orig	Thu Dec 16 13:31:47 1999
+++ xgd-1.7.3/Makefile.in	Fri May 26 00:46:31 2000
@@ -29,14 +29,14 @@
 
 #If you don't have FreeType and/or Xpm installed, including the
 #header files, uncomment this (default).
-CFLAGS=@CFLAGS@ @DEFS@ -I../ @ZLIB_CFLAGS@ @TTF_CFLAGS@ @XPM_CFLAGS@
+CFLAGS=@CFLAGS@ @DEFS@ -I../ @ZLIB_CFLAGS@ @TTF_CFLAGS@ @XPM_CFLAGS@ @CPPFLAGS@
 #If you do have FreeType and/or Xpm fully installed, uncomment a
 #variation of this and comment out the line above. See also LIBS below.
 #CFLAGS=-O -DHAVE_XPM -DHAVE_LIBTTF
 
 #If you don't have FreeType and/or Xpm fully installed, uncomment this
 #(default).
-LIBS= -lxgd @LIB_PNG@ @ZLIB_LIBS@ @TTF_LIBS@ @XPM_LIBS@ @X_LIBS@ @X11@ @X_EXTRA_LIBS@ -lm
+LIBS= -lxgd @LIB_PNG@ @ZLIB_LIBS@ @TTF_LIBS@ @XPM_LIBS@ @X_LIBS@ @X11@ @X_EXTRA_LIBS@ @LIBS@ -lm
 
 #If you do have FreeType and/or Xpm fully installed, uncomment a 
 #variation of this and comment out the line above. Note that
@@ -80,26 +80,18 @@
 BIN_PROGRAMS=pngtogd pngtogd2 gdtopng gd2topng gd2copypal gdparttopng webpng
 TEST_PROGRAMS=gdtest gddemo gd2time gdtestttf
 
-all: libxgd.a $(PROGRAMS)
+.SUFFIXES: .c .so .o
 
-install: libxgd.a $(BIN_PROGRAMS)
-	$(INSTALL) libxgd.a $(INSTALL_LIB)/libxgd.a
-	$(INSTALL) pngtogd $(INSTALL_BIN)/pngtogd
-	$(INSTALL) pngtogd2 $(INSTALL_BIN)/pngtogd2
-	$(INSTALL) gdtopng $(INSTALL_BIN)/gdtopng
-	$(INSTALL) gd2topng $(INSTALL_BIN)/gd2topng
-	$(INSTALL) gd2copypal $(INSTALL_BIN)/gd2copypal
-	$(INSTALL) gdparttopng $(INSTALL_BIN)/gdparttopng
-	$(INSTALL) webpng $(INSTALL_BIN)/webpng
-	$(INSTALL) bdftogd $(INSTALL_BIN)/bdftogd
-	$(INSTALL_DATA) gd.h $(INSTALL_INCLUDE)/gd.h
-	$(INSTALL_DATA) gdcache.h $(INSTALL_INCLUDE)/gdcache.h
-	$(INSTALL_DATA) gd_io.h $(INSTALL_INCLUDE)/gd_io.h
-	$(INSTALL_DATA) gdfontg.h $(INSTALL_INCLUDE)/gdfontg.h
-	$(INSTALL_DATA) gdfontl.h $(INSTALL_INCLUDE)/gdfontl.h
-	$(INSTALL_DATA) gdfontmb.h $(INSTALL_INCLUDE)/gdfontmb.h
-	$(INSTALL_DATA) gdfonts.h $(INSTALL_INCLUDE)/gdfonts.h
-	$(INSTALL_DATA) gdfontt.h $(INSTALL_INCLUDE)/gdfontt.h
+.c.so:
+	$(CC) -fpic -DPIC $(CFLAGS) -c $(.IMPSRC) -o $(.TARGET)
+
+all: libxgd.a libxgd.so.0
+
+install: libxgd.a libxgd.so.0
+	$(INSTALL_DATA) libxgd.a $(INSTALL_LIB)/libxgd.a
+	$(INSTALL_DATA) libxgd.so.0 $(INSTALL_LIB)/libxgd.so.0
+	ln -sf libxgd.so.0 $(INSTALL_LIB)/libxgd.so
+	$(INSTALL_DATA) gd.h $(INSTALL_INCLUDE)/xgd.h
 
 gddemo: gddemo.o libxgd.a
 	$(CC) gddemo.o -o gddemo	$(LIBDIRS) $(LIBS)
@@ -134,16 +126,19 @@
 gdtestttf: gdtestttf.o libxgd.a
 	$(CC) gdtestttf.o -o gdtestttf	$(LIBDIRS) $(LIBS)
 
-libxgd.a: gd.o gd_gd.o gd_gd2.o gd_io.o gd_io_dp.o gd_io_file.o gd_ss.o \
+OBJS=	gd.o gd_gd.o gd_gd2.o gd_io.o gd_io_dp.o gd_io_file.o gd_ss.o \
 	gd_io_ss.o gd_png.o gdxpm.o gdfontt.o gdfonts.o gdfontmb.o gdfontl.o \
-	gdfontg.o gdtables.o gdttf.o gdcache.o gdkanji.o \
-	gd.h gdfontt.h gdfonts.h gdfontmb.h gdfontl.h gdfontg.h
+	gdfontg.o gdtables.o gdttf.o gdcache.o gdkanji.o
+INCS=	gd.h gdfontt.h gdfonts.h gdfontmb.h gdfontl.h gdfontg.h
+
+libxgd.a: $(INCS) $(OBJS)
 	rm -f libxgd.a
-	$(AR) rc libxgd.a gd.o gd_gd.o gd_gd2.o gd_io.o gd_io_dp.o \
-		gd_io_file.o gd_ss.o gd_io_ss.o gd_png.o gdxpm.o \
-		gdfontt.o gdfonts.o gdfontmb.o gdfontl.o gdfontg.o \
-		gdtables.o gdttf.o gdcache.o gdkanji.o
+	$(AR) rc libxgd.a $(OBJS)
 	-ranlib libxgd.a
+
+libxgd.so.0:	$(INCS) $(OBJS:S/o$/so/g)
+	$(CC) -shared -Wl,-x -Wl,-assert -Wl,pure-text -Wl,-soname,$@ -o $@ $(OBJS:S/o$/so/g) $(LIBDIRS) $(LIBS)
+	ln -sf libxgd.so.0 libxgd.so
 
 clean:
 	rm -f *.o *.a ${PROGRAMS}
