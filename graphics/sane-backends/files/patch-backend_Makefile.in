--- backend/Makefile.in.orig	Thu Nov 30 20:05:49 2000
+++ backend/Makefile.in	Mon Apr  2 09:15:36 2001
@@ -69,7 +69,7 @@
 LIBOBJS = $(addprefix ../lib/,$(addsuffix .lo,$(LIBLIB_FUNCS)))
 
 libsane-%.la: %.lo %-s.lo $(EXTRA) $(LIBOBJS)
-	@$(LIBTOOL) $(MLINK) $(CC) -export-dynamic -o $@ $($*_LIBS) \
+	@$(LIBTOOL) $(MLINK) $(CC) -avoid-version -module -o $@ $($*_LIBS) \
 	$(LDFLAGS) $(BACKENDLIBS) $^ -rpath $(libsanedir) \
 	-version-info $(V_MAJOR):$(V_REV):$(V_MINOR)
 
@@ -99,9 +99,10 @@
 	@$(LIBTOOL) $(MINST) --finish $(libsanedir)
 	@# Assume the dll name without any versions is last
 	@dllend=`../tools/libtool-get-dll-ext libsane-dll.la`; \
-	list="$(ALL_BACKENDS)"; cd $(libsanedir) && for be in $$list; do \
+	list="$(ALL_BACKENDS)"; origdir=`pwd`; \
+	cd $(libsanedir) && for be in $$list; do \
 	  file=libsane-$${be}.$$dllend.$(V_MAJOR); \
-	  lib=`grep dlname= libsane-$${be}.la | cut -f2 -d"'"`; \
+	  lib=`grep dlname= "$$origdir"/libsane-$${be}.la | cut -f2 -d"'"`; \
 	  if test ! -f $${file} -a -n "$${lib}"; then \
 	    $(LN_S) $${lib} $${file}; \
 	  fi; \
@@ -109,10 +110,10 @@
 	@# Assume the dll name without any versions is last
 	@dllend=`../tools/libtool-get-dll-ext libsane-dll.la`; \
 	rm -f $(libdir)/libsane.a $(libdir)/libsane.$$dllend \
-		$(libdir)/libsane.$$dllend.$(V_MAJOR)*; \
+		$(libdir)/libsane.$$dllend.$(V_MAJOR); \
 	$(LN_S) sane/libsane-dll.a $(libdir)/libsane.a; \
 	$(LN_S) sane/libsane-dll.$$dllend $(libdir)/libsane.$$dllend ; \
-	cd $(libsanedir) && for n in libsane-dll.$$dllend.$(V_MAJOR)*; do \
+	cd $(libsanedir) && for n in libsane-dll.$$dllend.$(V_MAJOR); do \
 	  nn=`echo $$n | sed 's,^libsane-dll,libsane,'`; \
 	  (cd ..; $(LN_S) sane/$$n $$nn); \
 	done || exit 1
