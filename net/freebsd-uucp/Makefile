# Ports collection makefile for:  uucp
# Date created:			  08 Sep 2001
# Whom:				  Kris Kennaway <kris@FreeBSD.org>
#
# $FreeBSD$
#

PORTNAME=	freebsd-uucp
PORTVERSION=	1.06.1.9
CATEGORIES=	net comms
MASTER_SITES=	${MASTER_SITE_LOCAL}
MASTER_SITE_SUBDIR=dinoex

MAINTAINER=	dinoex@FreeBSD.org

USE_BZIP2=	yes

MAN1=	cu.1 uuconv.1 uucp.1 uulog.1 uuname.1 uupick.1 uustat.1 \
	uuto.1 uux.1
MAN8=	uuchk.8 uucico.8 uusched.8 uuxqt.8 uucpd.8
MANCOMPRESSED=	maybe
VARLOG=	uucp/common_sources/policy.h uucp/uucico/uucico.8 \
	uucp/uucp/uucp.1 uucp/uux/uux.1 uucp/uuxqt/uuxqt.8
FIXME=	etc/periodic/daily/340.uucp etc/periodic/daily/410.status-uucp \
	etc/periodic/weekly/300.uucp

post-extract:
	@(cd ${BUILD_WRKSRC}; ${SETENV} ${MAKE_ENV} \
		${MAKE} ${MAKE_FLAGS} ${MAKEFILE} ${MAKE_ARGS} extract)

do-configure:
.for i in ${FIXME}
	@${MV} ${WRKSRC}/${i} ${WRKSRC}/${i}.sed
	${SED} -e "s=/usr/local/=${PREFIX}/=" \
		${WRKSRC}/${i}.sed > ${WRKSRC}/${i}
.endfor
.if defined(UUCP_WITH_VAR_LOG)
.for i in ${VARLOG}
	@${MV} ${WRKSRC}/${i} ${WRKSRC}/${i}.sed
	${SED} -e "s=/var/spool/uucp/Log=/var/log/uucp/Log=" \
		-e "s=/var/spool/uucp/Debug=/var/log/uucp/Debug=" \
		-e "s=/var/spool/uucp/Stats=/var/log/uucp/Stats=" \
		${WRKSRC}/${i}.sed > ${WRKSRC}/${i}
.endfor
	@${ECHO_CMD} "   .." >> ${WRKSRC}/uucp.mtree
	@${ECHO_CMD} "/set uname=root gname=wheel mode=0755" \
		>> ${WRKSRC}/uucp.mtree
	@${ECHO_CMD} "   log" >> ${WRKSRC}/uucp.mtree
	@${ECHO_CMD} "/set uname=uucp gname=uucp mode=0775" \
		>> ${WRKSRC}/uucp.mtree
	@${ECHO_CMD} "       uucp" >> ${WRKSRC}/uucp.mtree
	@${ECHO_CMD} "       .." >> ${WRKSRC}/uucp.mtree
.endif

.if ! exists(${DESTDIR}/${PREFIX}/info/dir)
pre-install:
	${INSTALL} -c -o ${INFOOWN} -g ${INFOGRP} -m ${INFOMODE} \
		${FILESDIR}/dir-tmpl ${DESTDIR}${PREFIX}/info/dir
.endif

post-install:
	@${ECHO} "Use the 'make upgrade' command to copy your old configuration"
	@${ECHO} "files from /etc/uucp to the new location in ${PREFIX}/etc/uucp"
	@${ECHO}
	@${CAT} ${PKGMESSAGE}
.if defined(WITH_PAM)
	@${ECHO} "Add this lines to your pam.conf:"
	@${CAT} ${FILESDIR}/uucp-pam.conf
.endif

upgrade:
	@${ECHO} "Copying old configuration files from /etc/uucp to ${PREFIX}/etc/uucp"
	@${CP} -rp /etc/uucp ${PREFIX}/etc/uucp

.include <bsd.port.mk>
