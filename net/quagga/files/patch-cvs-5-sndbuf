--- ospfd/ospfd.c	21 Aug 2007 16:32:57 -0000	1.51
+++ ospfd/ospfd.c	17 Sep 2007 16:45:40 -0000
@@ -33,6 +33,7 @@
 #include "sockunion.h"          /* for inet_aton () */
 #include "zclient.h"
 #include "plist.h"
+#include "sockopt.h"
 
 #include "ospfd/ospfd.h"
 #include "ospfd/ospf_network.h"
@@ -212,8 +213,7 @@
 	       "a socket");
       exit(1);
     }
-  new->maxsndbuflen = 0;
-  ospf_adjust_sndbuflen (new, OSPF_SNDBUFLEN_DEFAULT);
+  new->maxsndbuflen = getsockopt_so_sendbuf (new->fd);
   if ((new->ibuf = stream_new(OSPF_MAX_PACKET_SIZE+1)) == NULL)
     {
       zlog_err("ospf_new: fatal error: stream_new(%u) failed allocating ibuf",
