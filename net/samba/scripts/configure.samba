#!/bin/sh

if [ -f ${WRKDIRPREFIX}${REALCURDIR}/Makefile.inc ]; then
	exit
fi

tempfile=`/usr/bin/mktemp -t checklist`

if [ "${BATCH}" ]; then
	if [ "${SAMBA_OPTIONS}" ]; then
		set ${SAMBA_OPTIONS}
	fi
else
	/usr/bin/dialog --title "configuration options" --clear \
		--checklist "\n\
Please select desired options:" -1 -1 9 \
syslog		"With syslog support" OFF \
ssl		"With ssl support" OFF \
ldap		"With LDAP2 support" OFF \
nocups		"Without CUPS" OFF \
krb5		"With Kerberos support" OFF \
acl		"With ACL support" OFF \
utmp		"With UTMP support" OFF \
msdfs		"With MSDFS support" OFF \
quota		"With Quota support" OFF \
2> $tempfile

	retval=$?

	if [ -s $tempfile ]; then
		set `cat $tempfile`
	fi
	rm -f $tempfile

	case $retval in
		0)	if [ -z "$*" ]; then
				echo "Nothing selected"
			fi
			;;
		1)	echo "Cancel pressed."
			exit 1
			;;
	esac
fi

echo "SCRIPT_RUN=yes" >${WRKDIRPREFIX}${REALCURDIR}/Makefile.inc

while [ "$1" ]; do
	case $1 in
		\"syslog\")
			echo "WITH_SYSLOG=YES" >>${WRKDIRPREFIX}${REALCURDIR}/Makefile.inc
			;;
		\"ssl\")
			echo "WITH_SSL=YES" >>${WRKDIRPREFIX}${REALCURDIR}/Makefile.inc
			;;
		\"ldap\")
			echo "WITH_LDAP=YES" >>${WRKDIRPREFIX}${REALCURDIR}/Makefile.inc
			;;
		\"nocups\")
			echo "WITHOUT_CUPS=YES" >>${WRKDIRPREFIX}${REALCURDIR}/Makefile.inc
			;;
		\"krb5\")
			echo "KRB5_HOME=YES" >>${WRKDIRPREFIX}${REALCURDIR}/Makefile.inc
			;;
		\"acl\")
			echo "WITH_ACL_SUPPORT=YES" >>${WRKDIRPREFIX}${REALCURDIR}/Makefile.inc
			;;
		\"utmp\")
			echo "WITH_UTMP=YES" >>${WRKDIRPREFIX}${REALCURDIR}/Makefile.inc
			;;
		\"msdfs\")
			echo "WITH_MSDFS=YES" >>${WRKDIRPREFIX}${REALCURDIR}/Makefile.inc
			;;
		\"quota\")
			echo "WITH_QUOTA=YES" >>${WRKDIRPREFIX}${REALCURDIR}/Makefile.inc
			;;
		*)
			echo "Invalid option: $1"
			rm -f ${WRKDIRPREFIX}${REALCURDIR}/Makefile.inc
			exit 1
			;;
	esac
	shift
done
