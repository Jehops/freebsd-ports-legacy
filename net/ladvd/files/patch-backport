--- ./src/netif.c.orig	2009-06-21 12:36:07.000000000 -0700
+++ ./src/netif.c	2009-07-28 19:03:00.229811057 -0700
@@ -399,6 +399,12 @@
     memset(&drvinfo, 0, sizeof(drvinfo));
 #endif
 
+#ifdef HAVE_NET_IF_LAGG_H
+    struct lagg_reqall ra;
+#elif HAVE_NET_IF_TRUNK_H
+    struct trunk_reqall ra;
+#endif
+
 #ifdef HAVE_SYSFS
     if (snprintf(path, SYSFS_PATH_MAX,
 	    SYSFS_CLASS_NET "/%s/device", ifaddr->ifa_name) > 0) {
@@ -442,13 +448,17 @@
     if (if_data->ifi_type == IFT_ETHER) {
 
 	// bonding
+#if defined(HAVE_NET_IF_LAGG_H) || defined(HAVE_NET_IF_TRUNK_H)
+	memset(&ra, 0, sizeof(ra));
+	strlcpy(ra.ra_ifname, ifaddr->ifa_name, sizeof(ra.ra_ifname));
 #ifdef HAVE_NET_IF_LAGG_H
-	if (ioctl(sockfd, SIOCGLAGG, (caddr_t)ifr) >= 0)
+	if (ioctl(sockfd, SIOCGLAGG, &ra) >= 0)
 	    return(NETIF_BONDING);
 #elif HAVE_NET_IF_TRUNK_H
-	if (ioctl(sockfd, SIOCGTRUNK, (caddr_t)ifr) == 0)
+	if (ioctl(sockfd, SIOCGTRUNK, &ra) == 0)
 	    return(NETIF_BONDING);
 #endif
+#endif
 
 	// accept regular devices
 	return(NETIF_REGULAR);
@@ -459,8 +469,9 @@
 	return(NETIF_BRIDGE);
 #endif
 #ifdef IFT_IEEE8023ADLAG
+    // trunk ports have a special type
     } else if (if_data->ifi_type == IFT_IEEE8023ADLAG) {
-	return(NETIF_BONDING);
+	return(NETIF_REGULAR);
 #endif
     }
 
@@ -548,7 +559,7 @@
 		my_log(INFO, "found slave %s", subif->name);
 		subif->slave = 1;
 		subif->master = master;
-		subif->lacp_index = i++;
+		subif->lacp_index = i;
 		csubif->subif = subif;
 		csubif = subif;
 	    }
--- ./configure.orig	2009-06-21 12:44:00.000000000 -0700
+++ ./configure	2009-07-28 19:04:14.275354033 -0700
@@ -20062,15 +20062,12 @@
 
 	;;
     freebsd*)
-	case "$target" in
-	    x86_64-*-freebsd7.*)
-		use_pie=no
-	esac
 
 cat >>confdefs.h <<\_ACEOF
 #define TARGET_IS_FREEBSD 1
 _ACEOF
 
+	use_pie=no
 	;;
     openbsd*)
 
@@ -20479,7 +20476,7 @@
 { echo "$as_me:$LINENO: result: $ssp_cv_cc" >&5
 echo "${ECHO_T}$ssp_cv_cc" >&6; }
     if test $ssp_cv_cc = yes; then
-      WFLAGS="$WFLAGS -fstack-protector"
+      WCFLAGS="$WCFLAGS -fstack-protector"
 
 cat >>confdefs.h <<\_ACEOF
 #define ENABLE_SSP_CC 1
