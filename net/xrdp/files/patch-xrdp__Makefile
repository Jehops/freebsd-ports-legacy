--- xrdp/Makefile.orig	Fri Apr 13 00:50:59 2007
+++ xrdp/Makefile	Mon Sep 10 00:34:07 2007
@@ -18,27 +18,29 @@
 CFLAGS = -Wall -O2 -I../common -I../libxrdp $(DEFINES)
 #CFLAGS += -DXRDP_DEBUG
 C_OS_FLAGS = $(CFLAGS) -c
-LDFLAGS = -L/usr/gnu/lib -L../libxrdp -Wl,-rpath,.
+LDFLAGS = -L../libxrdp
 LIBS = -ldl -lpthread -lxrdp
 CC = gcc
 
 all: xrdp
 
 xrdp: $(XRDPOBJ)
-	$(CC) $(LDFLAGS) -o xrdp $(XRDPOBJ) $(LIBS)
+	$(CC) $(LDFLAGS) -o xrdp $(XRDPOBJ) $(LIBS) -Wl,-rpath=$(DESTDIR)
 
 clean:
 	rm -f $(XRDPOBJ) xrdp
 
 install:
-	install ad256.bmp $(DESTDIR)/ad256.bmp
-	install xrdp256.bmp $(DESTDIR)/xrdp256.bmp
-	install cursor0.cur $(DESTDIR)/cursor0.cur
-	install cursor1.cur $(DESTDIR)/cursor1.cur
-	install Tahoma-10.fv1 $(DESTDIR)/Tahoma-10.fv1
-	install xrdp.ini $(CFGDIR)/xrdp.ini
-	install rsakeys.ini $(CFGDIR)/rsakeys.ini
-	install xrdp $(DESTDIR)/xrdp
+	$(BSD_INSTALL_DATA) ad256.bmp $(DESTDIR)/ad256.bmp
+	$(BSD_INSTALL_DATA) xrdp256.bmp $(DESTDIR)/xrdp256.bmp
+	$(BSD_INSTALL_DATA) cursor0.cur $(DESTDIR)/cursor0.cur
+	$(BSD_INSTALL_DATA) cursor1.cur $(DESTDIR)/cursor1.cur
+	$(BSD_INSTALL_DATA) Tahoma-10.fv1 $(DESTDIR)/Tahoma-10.fv1
+	$(BSD_INSTALL_DATA) xrdp.ini $(CFGDIR)/xrdp.ini.sample
+	@test -f $(CFGDIR)/xrdp.ini || cp $(CFGDIR)/xrdp.ini.sample $(CFGDIR)/xrdp.ini
+	$(BSD_INSTALL_DATA) rsakeys.ini $(CFGDIR)/rsakeys.ini.sample
+	@test -f $(CFGDIR)/rsakeys.ini || cp $(CFGDIR)/rsakeys.ini.sample $(CFGDIR)/rsakeys.ini
+	$(BSD_INSTALL_PROGRAM) xrdp $(PREFIX)/bin/xrdp
 
 installdeb:
 	install ad256.bmp $(DESTDIRDEB)/usr/lib/xrdp/ad256.bmp
