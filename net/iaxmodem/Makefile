# New ports collection makefile for:	iaxmodem
# Date created:				15 Jun 2006
# Whom:					Filippo Natali <filippo.natali@gmail.com>
#
# $FreeBSD$
#

PORTNAME=	iaxmodem
PORTVERSION=	0.1.14
CATEGORIES=	comms net
MASTER_SITES=	${MASTER_SITE_SOURCEFORGE}
MASTER_SITE_SUBDIR=	${PORTNAME}

MAINTAINER=	filippo.natali@gmail.com
COMMENT=	Software modem that connects to IAX channel

LIB_DEPENDS=	tiff.4:${PORTSDIR}/graphics/tiff

MAN1=		iaxmodem.1
CFLAGS+=	-I${LOCALBASE}/include
LDFLAGS=	-L${LOCALBASE}/lib
MAKE_ENV=	LDFLAGS="${LDFLAGS}"
CONFIGURE_ENV=	LDFLAGS="${LDFLAGS}"

SUB_FILES=	pkg-message
USE_RC_SUBR=	iaxmodem
GNU_CONFIGURE=	yes

post-patch:
	@${REINPLACE_CMD} -e "s|/usr/local/etc|${PREFIX}/etc|g" ${WRKSRC}/iaxmodem.1
	@${REINPLACE_CMD} -e "s|/etc/iaxmodem|${PREFIX}/etc/iaxmodem|g" ${WRKSRC}/iaxmodem.c
	@${CP} ${FILESDIR}/configure ${FILESDIR}/Makefile.in ${WRKSRC}/
	@${CHMOD} a+x ${WRKSRC}/configure

do-install:
	${INSTALL_PROGRAM} ${WRKSRC}/iaxmodem ${PREFIX}/sbin/ && \
	${MKDIR} ${PREFIX}/etc/iaxmodem && \
	${MKDIR} /var/log/iaxmodem && \
	${MKDIR} ${EXAMPLESDIR} && \
	${INSTALL_DATA} ${WRKSRC}/config.ttyIAX ${EXAMPLESDIR}/ && \
	${INSTALL_DATA} ${WRKSRC}/iaxmodem-cfg.ttyIAX ${EXAMPLESDIR}/
	${INSTALL_MAN} ${WRKSRC}/iaxmodem.1 ${MAN1PREFIX}/man/man1
.if !defined(NOPORTDOCS)
	${MKDIR} ${DOCSDIR} && \
	${INSTALL_DATA} ${WRKSRC}/README ${WRKSRC}/TODO ${WRKSRC}/FAQ ${WRKSRC}/CHANGES ${DOCSDIR}
.endif

post-install:
.if !defined(BATCH)
	@${CAT} ${PKGMESSAGE}
.endif

.include <bsd.port.pre.mk>

.if ${OSVERSION} < 500000
BROKEN=		does not compile
.endif

.include <bsd.port.post.mk>
