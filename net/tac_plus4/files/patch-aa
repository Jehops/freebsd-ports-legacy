--- Makefile.orig	Sun Jun 18 13:26:54 2000
+++ Makefile	Sun Dec  8 15:18:58 2002
@@ -19,7 +19,7 @@
 # LIMITATION, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
 # FOR A PARTICULAR PURPOSE. 
 
-CC = gcc
+# CC = gcc
 
 # For AIX
 # See /usr/lpp/bos/bsdport on your system for details of how to define bsdcc
@@ -33,13 +33,13 @@
 # OS=-DMIPS
 
 # For Solaris (SUNOS 5.3, 5.4, 5.5, 5.6) uncomment the following two lines
-OS=-DSOLARIS
-OSLIBS=-lsocket -lnsl
+# OS=-DSOLARIS
+# OSLIBS=-lsocket -lnsl
 
 # For FreeBSD
-# OS=-DFREEBSD
+OS=-DFREEBSD
 # You may also need to add:
-# OSLIBS=-lcrypt
+OSLIBS=-lcrypt
 # NOTE: If you want your password encryption to be compatible with
 # e.g. SunOS, you may need to instead use:
 # OSLIBS=-ldescrypt
@@ -64,12 +64,19 @@
 # FLAGS   = -DTAC_PLUS_USERID=$(USERID) -DTAC_PLUS_GROUPID=$(GROUPID)
 
 # Definitions for SKEY functionality
-# DEFINES = -DSKEY
-# LIBS = ../crimelab/skey/src/libskey.a
+.if defined(WITH_SKEY)
+DEFINES = -DSKEY
+LIBS = -lskey -lmd
 # INCLUDES = -I../crimelab/skey/src
+.endif
+
+.if defined(WITH_OPIE)
+DEFINES += -DOPIE
+LIBS += -lopie -lmd
+.endif
 
 # Debugging flags
-DEBUG = -g
+# DEBUG = -g
 
 # Enforce a limit on maximum sessions per user. See the user's guide
 # for more information.
@@ -85,13 +92,13 @@
 # possible), containing its process id. Uncomment and modify the
 # following line to change this filename
 
-# PIDFILE = -DTAC_PLUS_PIDFILE=\"/var/run/tac_plus.pid\" 
+PIDFILE = -DTAC_PLUS_PIDFILE=\"/var/run/tac_plus.pid\" 
 
 #
 # End of customisable section of Makefile
 #
 
-CFLAGS = $(DEBUG) $(DEFINES) $(INCLUDES) $(FLAGS) $(OS) $(PIDFILE) $(MAXSESS)
+CFLAGS += $(DEBUG) $(DEFINES) $(INCLUDES) $(FLAGS) $(OS) $(PIDFILE) $(MAXSESS)
 
 HFILES = expire.h parse.h regmagic.h md5.h regexp.h tac_plus.h 
 
@@ -99,7 +106,7 @@
 	do_author.c dump.c encrypt.c expire.c $(MSCHAP_MD4_SRC) md5.c \
 	packet.c report.c sendauth.c tac_plus.c utils.c pw.c hash.c \
 	parse.c regexp.c programs.c enable.c pwlib.c default_fn.c \
-	skey_fn.c default_v0_fn.c sendpass.c maxsess.c
+	skey_fn.c opie_fn.c default_v0_fn.c sendpass.c maxsess.c
 
 OBJS = $(SRCS:.c=.o)
 
@@ -130,8 +137,8 @@
 	-rm -f *.o *~ *.BAK tac_plus generate_passwd
 
 install:
-	cp tac_plus /usr/local/bin
-	cp tac_plus.1 /usr/man/manl/tac_plus.1
+	cp tac_plus $(PREFIX)/sbin
+	cp tac_plus.1 $(PREFIX)/man1/tac_plus.1
 
 depend:
 	makedepend $(CFLAGS) $(SRCS)
