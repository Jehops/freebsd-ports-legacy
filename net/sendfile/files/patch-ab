--- develop/install.orig	Fri Mar 13 01:16:41 1998
+++ develop/install	Sat Apr  4 18:53:55 1998
@@ -113,17 +113,9 @@
 if [ "$INETDCONF" = "" ]; then	INETDCONF=/etc/inetd.conf; fi
 if [ "$SERVICES" = "" ]; then	SERVICES=/etc/services; fi
 
-if [ -f /usr/man/man7/locale.7 -o -f /usr/man/man7/term.7 ]; then
-  manmisc=7
-else
-  manmisc=5
-fi
+manmisc=7
 
-if [ -f /usr/man/man8/inetd.8 ]; then
-  manadmin=8
-else
-  manadmin=1m
-fi
+manadmin=8
 
 # purge old logfiles (bug from sendfile revision < 19980310)
 (cd $SPOOL && rm -f */.sendfile*.log)
@@ -132,7 +124,7 @@
 	umask 022
 	cd src || exit 1
 	cp sendfile sendmsg receive utf7encode fetchfile wlock $BINDIR/
-	[ -x $SERVERDIR/sendfiled ] && mv $SERVERDIR/sendfiled $SERVERDIR/sendfiled.old && rm $SERVERDIR/sendfiled.old
+	[ -x $SERVERDIR/sendfiled ] && mv $SERVERDIR/sendfiled $SERVERDIR/sendfiled.old && rm -f $SERVERDIR/sendfiled.old
 	cp sendfiled $SERVERDIR
 	cd ..
 	install_man
@@ -156,14 +148,6 @@
 To deinstall the sendfile-daemon, simply type: 	rm $SERVERDIR/sendfiled
 
 EOD
-echo 'If you are satisfied with these defaults, then type "ok" now:'
-read answer
-if [ "$answer" != ok ]; then
-  echo
-  echo "You can install sendfile manually, too. Please type: more doc/README"
-  echo
-  exit
-fi
 
 umask 022
 
@@ -213,7 +197,7 @@
   echo "         there is $SERVERDIR/sendfiled in makeconfig! Check it!"
 fi
 echo "installing the sendfile-daemon in $SERVERDIR"
-[ -x $SERVERDIR/sendfiled ] && mv $SERVERDIR/sendfiled $SERVERDIR/sendfiled.old && rm $SERVERDIR/sendfiled.old
+[ -x $SERVERDIR/sendfiled ] && mv $SERVERDIR/sendfiled $SERVERDIR/sendfiled.old && rm -f $SERVERDIR/sendfiled.old
 cp src/sendfiled $SERVERDIR  || exit 1
 
 NOSENDFILE=`dirname $DENY 2>/dev/null`/nosendfile
@@ -259,7 +243,6 @@
     echo "saft	487/tcp		# simple asynchronous file transfer" | niload services .
   else
     echo "configuring $SERVICES"
-    echo "#" >>$SERVICES
     echo "saft	487/tcp		# simple asynchronous file transfer" >>$SERVICES
   fi
 fi
@@ -272,8 +255,6 @@
   fi
   RESTART=true
   echo "configuring $INETDCONF"
-  echo "#" >>$INETDCONF
-  echo "# simple asynchronous file transfer" >>$INETDCONF
   echo "saft	stream	tcp	nowait	root	$SFD" >>$INETDCONF
 fi
 
@@ -337,15 +318,10 @@
 EOD
 fi
 
-echo
-echo "You may want to add the following line to your system bootup script:"
-echo "    $SERVERDIR/sendfiled -Q"
-echo "This will start an outgoing spooling sendfile daemon on boot time"
-echo "which processes any old files in the outgoing spool."
-echo
+echo "[ -x $SERVERDIR/sendfiled ] && $SERVERDIR/sendfiled -Q && echo -n ' sendfiled'">${PREFIX}/etc/rc.d/sendfiled.sh
+chmod a+x ${PREFIX}/etc/rc.d/sendfiled.sh
 
 if [ "$RESTART" = true ]; then
-  echo
-  echo "please restart now your inetd ( or simply reboot :-) )"
-  echo
+  kill -HUP `ps auxw|awk '$11 == "inetd" { print $2 } '`
+  [ -f $SERVERDIR/sendfiled.old ] && rm -f $SERVERDIR/sendfiled.old
 fi
