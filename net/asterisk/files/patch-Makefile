--- Makefile.orig	2011-01-12 16:57:43.000000000 +0100
+++ Makefile	2011-03-02 11:34:26.000000000 +0100
@@ -122,7 +122,7 @@
 OVERWRITE=y
 
 # Include debug and macro symbols in the executables (-g) and profiling info (-pg)
-DEBUG=-g3
+#DEBUG=-g3
 
 # Asterisk.conf is located in ASTETCDIR or by using the -C flag
 # when starting Asterisk
@@ -220,11 +220,13 @@
   _ASTCFLAGS+=-isystem /usr/local/include
 endif
 
+ifneq ($(OSARCH),FreeBSD)
 ifeq ($(findstring -march,$(_ASTCFLAGS) $(ASTCFLAGS)),)
   ifneq ($(PROC),ultrasparc)
     _ASTCFLAGS+=$(shell if $(CC) -march=$(PROC) -S -o /dev/null -xc /dev/null >/dev/null 2>&1; then echo "-march=$(PROC)"; fi)
   endif
 endif
+endif
 
 ifeq ($(PROC),ppc)
   _ASTCFLAGS+=-fsigned-char
@@ -235,7 +237,7 @@
     _ASTCFLAGS+=-march=i686
   endif
   # -V is understood by BSD Make, not by GNU make.
-  BSDVERSION=$(shell make -V OSVERSION -f /usr/share/mk/bsd.port.subdir.mk)
+  BSDVERSION=$(OSVERSION)
   _ASTCFLAGS+=$(shell if test $(BSDVERSION) -lt 500016 ; then echo "-D_THREAD_SAFE"; fi)
 endif
 
@@ -463,13 +465,18 @@
 	done
 	$(INSTALL) -m 644 doc/core-en_US.xml "$(DESTDIR)$(ASTDATADIR)/static-http";
 	if [ -d doc/tex/asterisk ] ; then \
-		$(INSTALL) -d "$(DESTDIR)$(ASTDATADIR)/static-http/docs" ; \
+		$(INSTALL) -d $(DESTDIR)$(DOCSDIR) ; \
+		$(INSTALL) -d $(DESTDIR)$(DOCSDIR)/images ; \
 		for n in doc/tex/asterisk/* ; do \
-			$(INSTALL) -m 644 $$n "$(DESTDIR)$(ASTDATADIR)/static-http/docs" ; \
+			$(INSTALL) -m 644 $$n $(DESTDIR)$(DOCSDIR) ; \
 		done \
 	fi
+	if [ ! -d $(DESTDIR)$(DOCSDIR)/images ]; then \
+		$(MKDIR) $(DESTDIR)$(DOCSDIR)/images; \
+	fi
+
 	for x in images/*.jpg; do \
-		$(INSTALL) -m 644 $$x "$(DESTDIR)$(ASTDATADIR)/images" ; \
+		$(INSTALL) -m 644 $$x $(DESTDIR)$(DOCSDIR)/images ; \
 	done
 	$(MAKE) -C sounds install
 
@@ -529,6 +536,7 @@
 	$(INSTALL) -d "$(DESTDIR)$(ASTSPOOLDIR)/dictate"
 	$(INSTALL) -d "$(DESTDIR)$(ASTSPOOLDIR)/meetme"
 	$(INSTALL) -d "$(DESTDIR)$(ASTSPOOLDIR)/monitor"
+	$(INSTALL) -d "$(DESTDIR)$(ASTSPOOLDIR)/outgoing"
 	$(INSTALL) -d "$(DESTDIR)$(ASTSPOOLDIR)/system"
 	$(INSTALL) -d "$(DESTDIR)$(ASTSPOOLDIR)/tmp"
 	$(INSTALL) -d "$(DESTDIR)$(ASTSPOOLDIR)/voicemail"
@@ -550,6 +558,7 @@
 	$(INSTALL) -d "$(DESTDIR)$(ASTDATADIR)/static-http"
 	$(INSTALL) -d "$(DESTDIR)$(ASTMANDIR)/man8"
 	$(INSTALL) -d "$(DESTDIR)$(AGI_DIR)"
+	$(INSTALL) -d "$(DESTDIR)$(ASTDBDIR)"
 
 bininstall: _all installdirs $(SUBDIRS_INSTALL)
 	$(INSTALL) -m 755 main/asterisk $(DESTDIR)$(ASTSBINDIR)/
@@ -609,7 +618,7 @@
 	@exit 1
 endif
 
-install: badshell bininstall datafiles
+install: badshell bininstall datafiles samples
 	@if [ -x /usr/sbin/asterisk-post-install ]; then \
 		/usr/sbin/asterisk-post-install $(DESTDIR) . ; \
 	fi
@@ -651,29 +660,18 @@
 		else \
 			echo "Installing $$x" ; \
 		fi ; \
-		$(INSTALL) -m 644 $$x $(DESTDIR)$(ASTETCDIR)/`$(BASENAME) $$x` ; \
+		$(INSTALL) -m 644 $$x $(DESTDIR)$(ASTETCDIR)/`$(BASENAME) $$x`-dist ; \
 	done
 
 samples: adsi
 	@echo Installing other config files...
 	@for x in configs/*.sample; do \
-		dst="$(DESTDIR)$(ASTETCDIR)/`$(BASENAME) $$x .sample`" ;	\
-		if [ -f $${dst} ]; then \
-			if [ "$(OVERWRITE)" = "y" ]; then \
-				if cmp -s $${dst} $$x ; then \
-					echo "Config file $$x is unchanged"; \
-					continue; \
-				fi ; \
-				mv -f $${dst} $${dst}.old ; \
-			else \
-				echo "Skipping config file $$x"; \
-				continue; \
-			fi ;\
+		$(INSTALL) -m 644 $$x $(DESTDIR)$(ASTETCDIR)/`$(BASENAME) $$x .sample`-dist ; \
+		if [ ! -f $(DESTDIR)$(ASTETCDIR)/`$(BASENAME) $$x .sample` ]; then \
+			$(INSTALL) -m 644 $$x $(DESTDIR)$(ASTETCDIR)/`$(BASENAME) $$x .sample`; \
 		fi ; \
-		echo "Installing file $$x"; \
-		$(INSTALL) -m 644 $$x $${dst} ;\
 	done
-	if [ "$(OVERWRITE)" = "y" ]; then \
+	@if true; then \
 		echo "Updating asterisk.conf" ; \
 		sed -e 's|^astetcdir.*$$|astetcdir => $(ASTETCDIR)|' \
 			-e 's|^astmoddir.*$$|astmoddir => $(MODULES_DIR)|' \
