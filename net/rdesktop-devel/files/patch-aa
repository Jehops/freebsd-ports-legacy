--- secure.c~	Mon Aug 27 16:33:56 2001
+++ secure.c	Mon Aug 27 16:36:19 2001
@@ -387,6 +387,9 @@
 {
   int hostlen = 2 * ( hostname == 0 ? 0 : strlen (hostname));
 
+  if (hostlen > 30)
+      hostlen = 30;
+
   out_uint16_be (s, 5);		/* unknown */
   out_uint16_be (s, 0x14);
   out_uint8 (s, 0x7c);
