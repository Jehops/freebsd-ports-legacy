--- Makefile.orig	Thu Sep 24 17:50:59 1998
+++ Makefile	Tue Feb  1 11:11:24 2000
@@ -47,7 +47,7 @@
 
 # the location where SSLeay is installed ... 
 # - expect a include and lib directory under here 
-SSLTOP=/usr/local/ssl
+SSLTOP=$(PREFIX)
 
 INSTALLTOP=$(SSLTOP)
 
@@ -83,8 +83,8 @@
 #LDADD=$(sockslib) -ltermcap -lcurses
   
 # uncomment the next two lines for linux
-CC = gcc -DLINUX -DTERMIOS $(socksflags)
-LDADD = $(sockslib) -lbsd -lncurses
+#CC = gcc -DLINUX -DTERMIOS $(socksflags)
+#LDADD = $(sockslib) -lbsd -lncurses
 
 ##OLD Linux stuff
 #CC = gcc -DLINUX -DUSE_SHADOW $(socksflags) 
@@ -95,6 +95,11 @@
 #BSD386
 #CC = gcc -DBSD386 -DTERMCAP $(socksflags)
 #LDADD = -ltermcap $(sockslib) 
+
+#FreeBSD
+CC += -DTERMCAP $(socksflags)
+LDADD = -L$(OPENSSLLIB) -lssl -lcrypto $(EXTRA_SSL_LIBS) \
+	 -ltermcap $(sockslib)
   
 all:
 	@-mkdir bin 2>/dev/null
@@ -145,12 +150,11 @@
 tar:    clean
 	(cd ..; tar cf $(TARFILE) $(DIRECTORY); /bin/rm -f $(TARFILE).Z $(TARFILE).gz >/dev/null 2>&1 ; $(COMPRESS) $(TARFILE) )
 
-install: telnet telnetd /dev/null
-	@-mkdir -p $(INSTALLTOP)/bin 2>/dev/null
+install: telnet telnetd
 	cp bin/telnet $(INSTALLTOP)/bin/telnet
 	chmod 755 $(INSTALLTOP)/bin/telnet
-	cp bin/telnetd $(INSTALLTOP)/bin/telnetd
-	chmod 755 $(INSTALLTOP)/bin/telnetd
+	cp bin/telnetd $(INSTALLTOP)/libexec/telnetd
+	chmod 755 $(INSTALLTOP)/libexec/telnetd
 	@echo "*****************************************************"
 	@echo "* Do not forget to make the certificate for telnetd *"
 	@echo "* either manually or via \"make certificate\"       *"
@@ -158,9 +162,10 @@
 
 certificate:
 	(\
-	cd $(INSTALLTOP)/certs; \
-	ssleay req -new -x509 -nodes -days 365 -out telnetd.pem -keyout telnetd.pem; \
-	ln -s telnetd.pem `ssleay x509 -noout -hash < telnetd.pem`.0 ;\
-	chmod 600 $(INSTALLTOP)/certs/telnetd.pem; \
+	[ -f $(OPENSSLDIR)/certs/telnetd.pem ] && exit; \
+	cd $(OPENSSLDIR)/certs; \
+	openssl req -new -x509 -nodes -days 365 -out telnetd.pem -keyout telnetd.pem; \
+	ln -s telnetd.pem `openssl x509 -noout -hash < telnetd.pem`.0 ;\
+	chmod 600 $(OPENSSLDIR)/certs/telnetd.pem; \
 	)
 
