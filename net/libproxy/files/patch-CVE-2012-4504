commit c440553c12836664afd24a24fb3a4d10a2facd2c
Author: nicolas.dufresne@gmail.com <nicolas.dufresne@gmail.com@c587cffe-e639-0410-9787-d7902ae8ed56>
Date:   Wed Oct 10 16:14:27 2012 +0000

    Fix buffer overflow downloading large pac file

    This fixes CVE CVE-2012-4504

--- libproxy/url.cpp
+++ libproxy/url.cpp
@@ -474,9 +474,10 @@ char* url::get_pac() {
 				// Add this chunk to our content length,
 				// ensuring that we aren't over our max size
 				content_length += chunk_length;
-				if (content_length >= PAC_MAX_SIZE) break;
 			}
 
+			if (content_length >= PAC_MAX_SIZE) break;
+
 			while (recvd != content_length) {
 				int r = recv(sock, buffer + recvd, content_length - recvd, 0);
 				if (r < 0) break;
