--- Makefile.in.orig	Fri Jan  3 15:02:55 1997
+++ Makefile.in	Mon Oct  4 12:29:32 1999
@@ -24,17 +24,24 @@
 ALL_CFLAGS=-I. -DSYSCONFDIR=\"${sysconfdir}\" ${CPPFLAGS} ${CFLAGS}
 OBJS=hesiod.o hesmailhost.o hespwnam.o hesservbyname.o hescompat.o
 
-all: libhesiod.a hesinfo hestest
+all: libhesiod.so.${VERSION} libhesiod.so hesinfo hestest libhesiod.a
 
 libhesiod.a: ${OBJS}
 	ar cru $@ ${OBJS}
 	${RANLIB} $@
 
-hesinfo: hesinfo.o libhesiod.a
-	${CC} ${LDFLAGS} -o $@ hesinfo.o libhesiod.a ${LIBS}
+libhesiod.so.${VERSION}: ${OBJS}
+	${CC} -shared ${LDFLAGS} ${SONAME} ${OBJS} -o $@
 
-hestest: hestest.o libhesiod.a
-	${CC} ${LDFLAGS} -o $@ hestest.o libhesiod.a ${LIBS}
+libhesiod.so: libhesiod.so.${VERSION}
+	rm -f $@
+	ln $> $@
+
+hesinfo: hesinfo.o ${SHLIB}
+	${CC} ${LDFLAGS} -o $@ hesinfo.o -L. -lhesiod ${LIBS}
+
+hestest: hestest.o ${SHLIB}
+	${CC} ${LDFLAGS} -o $@ hestest.o -L. -lhesiod ${LIBS}
 
 ${OBJS}: hesiod.h resscan.h
 
@@ -55,6 +62,9 @@
 	${INSTALL} -c -m 644 libhesiod.a ${DESTDIR}${libdir}
 	${RANLIB} ${DESTDIR}${libdir}/libhesiod.a
 	chmod u-w ${DESTDIR}${libdir}/libhesiod.a
+	${INSTALL} -c -m 444 libhesiod.so.${VERSION} ${DESTDIR}${libdir}
+	ln -f -s ${DESTDIR}${libdir}/libhesiod.so.${VERSION} \
+		${DESTDIR}${libdir}/libhesiod.so
 	${INSTALL_PROGRAM} -c -m 555 hesinfo ${DESTDIR}${lbindir}
 	${INSTALL} -c -m 444 ${srcdir}/hesiod.h ${DESTDIR}${includedir}
 	${INSTALL} -c -m 444 ${srcdir}/hesinfo.1 ${DESTDIR}${mandir}/man1
@@ -85,7 +95,8 @@
 	${INSTALL} -c -m 444 ${srcdir}/hesiod.conf.5 ${DESTDIR}${mandir}/man5
 
 clean:
-	rm -f ${OBJS} libhesiod.a hesinfo.o hesinfo hestest.o hestest
+	rm -f ${OBJS} libhesiod.a hesinfo.o hesinfo hestest.o hestest \
+		libhesiod.so.3
 
 distclean: clean
 	rm -f config.cache config.log config.status Makefile config.h
