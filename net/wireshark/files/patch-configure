--- configure.orig	Thu Jul  5 15:26:25 2007
+++ configure	Sat Jul  7 14:38:55 2007
@@ -21771,7 +21771,7 @@ echo $ECHO_N "checking whether we should
 # Check whether --enable-warnings-as-errors was given.
 if test "${enable_warnings_as_errors+set}" = set; then
   enableval=$enable_warnings_as_errors;
-  if test "x$GCC" = "xyes" -a "x$enableval" == "xyes" -a "x$wireshark_extra_gcc_flags" != "xyes"; then
+  if test "x$GCC" = "xyes" -a "x$enableval" = "xyes" -a "x$wireshark_extra_gcc_flags" != "xyes"; then
     with_warnings_as_errors="yes"
     { echo "$as_me:$LINENO: result: yes" >&5
 echo "${ECHO_T}yes" >&6; }
@@ -23308,6 +23308,7 @@ echo $ECHO_N "checking for GLIB - versio
   else
     GLIB_CFLAGS=`$GLIB_CONFIG $glib_config_args --cflags`
     GLIB_LIBS=`$GLIB_CONFIG $glib_config_args --libs`
+    GLIB_LIBS="-liconv $GLIB_LIBS"
     glib_config_major_version=`$GLIB_CONFIG $glib_config_args --version | \
            sed 's/\([0-9]*\).\([0-9]*\).\([0-9]*\)/\1/'`
     glib_config_minor_version=`$GLIB_CONFIG $glib_config_args --version | \
@@ -23318,7 +23319,8 @@ echo $ECHO_N "checking for GLIB - versio
       ac_save_CFLAGS="$CFLAGS"
       ac_save_LIBS="$LIBS"
       CFLAGS="$CFLAGS $GLIB_CFLAGS"
-      LIBS="$GLIB_LIBS $LIBS"
+      LIBS="$GLIB_LIBS -liconv $LIBS"
+      LIBS="$GLIB_LIBS -liconv $LIBS"
       rm -f conf.glibtest
       if test "$cross_compiling" = yes; then
   echo $ac_n "cross compiling; assumed OK... $ac_c"
@@ -24211,7 +24213,7 @@ echo $ECHO_N "checking whether GLib supp
 ac_save_CFLAGS="$CFLAGS"
 ac_save_LIBS="$LIBS"
 CFLAGS="$CFLAGS $GLIB_CFLAGS"
-LIBS="$GLIB_LIBS $LIBS"
+LIBS="$GLIB_LIBS -liconv $LIBS"
 if test "$cross_compiling" = yes; then
   echo $ac_n "cross compiling; assumed OK... $ac_c"
     ac_cv_glib_supports_modules=yes
@@ -30140,7 +30142,7 @@ echo "${ECHO_T}yes" >&6; }
 	  #
 	  CFLAGS="$CFLAGS -I$krb5_dir/include"
 	  CPPFLAGS="$CPPFLAGS -I$krb5_dir/include"
-	  ac_heimdal_version=`grep heimdal $krb5_dir/include/krb5.h | head -n 1 | sed 's/^.*heimdal.*$/HEIMDAL/'`
+	  ac_heimdal_version=`grep heimdal $krb5_dir/include/krb5.h | head -n 1 | tr "[:lower:]" "[:upper:]" sed 's/^.*heimdal.*$/HEIMDAL/'`
 	  ac_mit_version=`grep 'Massachusetts Institute of Technology' $krb5_dir/include/krb5.h | head -n 1 | sed 's/^.*Massachusetts Institute of Technology.*$/MIT/'`
 	  ac_krb5_version="$ac_heimdal_version$ac_mit_version"
 	  if test "x$ac_krb5_version" = "xHEIMDAL"
@@ -30199,7 +30201,7 @@ fi
 
 	  if test -x "$KRB5_CONFIG"
 	  then
-	    KRB5_FLAGS=`"$KRB5_CONFIG" --cflags`
+	    KRB5_FLAGS=`"$KRB5_CONFIG" --cflags | sed -e 's/@INCLUDE_des@//g'`
 	    KRB5_LIBS=`"$KRB5_CONFIG" --libs`
 	    CFLAGS="$CFLAGS $KRB5_FLAGS"
 	    CPPFLAGS="$CPPFLAGS $KRB5_FLAGS"
@@ -31974,7 +31976,7 @@ fi
 
 
 ac_save_LIBS="$LIBS"
-LIBS="$GLIB_LIBS $LIBS"
+LIBS="$GLIB_LIBS -liconv $LIBS"
 G_ASCII_STRTOULL_C=""
 G_ASCII_STRTOULL_O=""
 G_ASCII_STRTOULL_LO=""
@@ -33019,7 +33021,7 @@ fi
 #
 # The plugin dissectors reside in ./plugins/PROTO/
 #
-PLUGIN_LIBS="-L../../epan -lwireshark $GLIB_LIBS"
+PLUGIN_LIBS="-L../../epan -lwireshark -liconv $GLIB_LIBS"
 
 
 #
