
$FreeBSD$

--- res/Makefile.orig
+++ res/Makefile
@@ -21,7 +21,10 @@
 
 CFLAGS+=
 CFLAGS+=$(shell [ -f /usr/include/linux/zaptel.h ] && echo " -DZAPATA_MOH")
-CFLAGS+=$(shell [ -f /usr/local/include/zaptel.h ] && echo " -DZAPATA_MOH")
+CFLAGS+=-I$(LOCALBASE)/include
+ifndef WITHOUT_ZAPTEL
+CFLAGS+=-DZAPATA_MOH
+endif
 #
 # Work around buggy RedHat 9.0
 #
@@ -34,7 +37,7 @@
 	rm -f $(DESTDIR)$(ASTHEADERDIR)/parking.h
 	rm -f $(DESTDIR)$(MODULES_DIR)/app_agi.so 
 	rm -f $(DESTDIR)$(MODULES_DIR)/res_parking.so
-	for x in $(MODS); do $(INSTALL) -m 755 $$x $(DESTDIR)$(MODULES_DIR) ; done
+	for x in $(MODS); do $(BSD_INSTALL_PROGRAM) $$x $(DESTDIR)$(MODULES_DIR) ; done
 
 res_crypto.so: res_crypto.o
 	$(CC) $(SOLINK) -o $@ $< $(CRYPTO_LIBS)
