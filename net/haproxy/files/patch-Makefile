--- Makefile.orig	Tue May  6 00:11:59 2003
+++ Makefile	Tue Jun  3 16:22:55 2003
@@ -1,22 +1,21 @@
 # Select target OS. TARGET must match a system for which COPTS and LIBS are
 # correctly defined below.
 # You can set it on make's command line. eg: make TARGET=solaris
-TARGET = linux24
+#TARGET = linux24
 #TARGET = linux22
 #TARGET = solaris
 #TARGET = solarisv9
 #TARGET = openbsd
-
-CC = gcc
-LD = gcc
+TARGET = FreeBSD
 
 # By default, we use libc's regex.
-REGEX=libc
+#REGEX=libc
 #REGEX=pcre
 
 # This is the directory hosting include/pcre.h and lib/libpcre.* when REGEX=pcre
-PCREDIR	:= $(shell pcre-config --prefix 2>/dev/null || :)
+#PCREDIR	:= $(shell pcre-config --prefix 2>/dev/null || :)
 #PCREDIR=/usr/local
+PCREDIR=${LOCALBASE}
 
 # This is for Linux 2.4 with netfilter
 COPTS.linux24 = -O2 -DNETFILTER
@@ -38,14 +37,17 @@
 COPTS.openbsd = -O2
 LIBS.openbsd =
 
+COPTS.FreeBSD = -O2
+LIBS.FreeBSD =
+
 COPTS.libc=
 LIBS.libs=
 
 COPTS.pcre=-DUSE_PCRE -I$(PCREDIR)/include
 LIBS.pcre=-L$(PCREDIR)/lib -lpcreposix -lpcre
 
-#DEBUG =
-DEBUG = -g
+DEBUG =
+#DEBUG = -g
 
 COPTS=$(COPTS.$(TARGET)) $(COPTS.$(REGEX))
 LIBS=$(LIBS.$(TARGET)) $(LIBS.$(REGEX))
@@ -53,16 +55,13 @@
 # - use -DSTATTIME=0 to disable statistics, else specify an interval in
 #   milliseconds.
 # - use -DTPROXY to compile with transparent proxy support.
-CFLAGS = -Wall $(COPTS) $(DEBUG) -DSTATTIME=0 -DTPROXY
-LDFLAGS = -g
+CFLAGS+= -Wall $(COPTS) $(DEBUG) -DSTATTIME=$(INTERVAL)
+LDFLAGS+= 
 
 all: haproxy
 
-haproxy: haproxy.o
-	$(LD) $(LDFLAGS) -o $@ $^ $(LIBS)
-
-%.o:	%.c
-	$(CC) $(CFLAGS) -c -o $@ $<
+haproxy: 
+	$(CC) $(CFLAGS) haproxy.c $(LIBS) $(LDFLAGS) -o haproxy
 
 clean:
 	rm -f *.[oas] *~ core haproxy test nohup.out gmon.out
