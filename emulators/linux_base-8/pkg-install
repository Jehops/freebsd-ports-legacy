#!/bin/sh
# an installation script for linux_base

case "$2" in
PRE-INSTALL)
	if [ -z "`kldstat -v | grep -E 'linux(aout|elf)'`" ]; then
		echo 'Linux mode is not enabled.'
		echo 'Loading linux kernel module now...'
		if ! kldload linux; then
			echo 'The linux kernel module could not be loaded.'
			echo 'Please enable linux mode manually and retry.'
			exit 1
		fi
	fi
	if [ -n "`mount | grep -w ^linprocfs`" ]; then
		echo 'Un-mounting linprocfs...'
		umount linprocfs
	fi
	if [ -n "`mount | grep -w ^linproc`" ]; then
		echo 'Un-mounting linproc...'
		umount linproc
	fi
	;;
POST-INSTALL)
	if [ -n "`grep -w ^linprocfs /etc/fstab`" ]; then
		echo 'Re-mounting linprocfs...'
		mount linprocfs
	fi
	if [ -n "`grep -w ^linproc /etc/fstab`" ]; then
		echo 'Re-mounting linproc...'
		mount linproc
	fi
	;;
esac

exit 0
