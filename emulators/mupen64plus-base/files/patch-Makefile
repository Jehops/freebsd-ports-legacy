--- Makefile.orig	2008-12-13 14:53:49.000000000 -0500
+++ Makefile	2008-12-14 23:40:23.000000000 -0500
@@ -97,7 +97,7 @@
 # handle dynamic recompiler objects
 ifneq ($(NO_ASM), 1)
   ifeq ($(CPU), X86)
-    ifeq ($(ARCH), 64BITS)
+    ifeq ($(ARCH_DETECTED), 64BITS)
       DYNAREC = x86_64
     else
       DYNAREC = x86
@@ -274,7 +274,7 @@
 all: $(ALL)
 
 mupen64plus: $(OBJECTS)
-	$(MUPENCC) $^ $(LDFLAGS) $(LIBS) -Wl,-export-dynamic -lpthread -ldl -o $@
+	$(MUPENCC) $^ $(LDFLAGS) $(LIBS) -Wl,-export-dynamic ${PTHREAD_LIBS} -o $@
 	$(STRIP) $@
 
 install:
