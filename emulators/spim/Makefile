# ex:ts=8
# Ports collection makefile for:  spim
# Date created:			  Mon Oct 28, 1996
# Whom:				  David O'Brien (obrien@cs.ucdavis.edu)
#
# $FreeBSD$
#

PORTNAME=	spim
PORTVERSION=	7.2.1
PORTREVISION=	3
CATEGORIES=	emulators
MASTER_SITES=	http://www.cs.wisc.edu/~larus/SPIM/

MAINTAINER=	ports@FreeBSD.org
COMMENT=	MIPS32 Simulator

WRKSRC=		${WRKDIR}/${PORTNAME}-${PORTVERSION}

MAN1=		spim.1

PORTDOCS=	cycle.ps.gz spim.ps.gz SPIM.html
PLIST_FILES=	bin/spim %%DATADIR%%/exceptions.s
PLIST_DIRS=	%%DATADIR%%

OPTIONS=	GUI "Graphical user interface" on

.include <bsd.port.pre.mk>

.if defined(WITH_GUI)
USE_XORG=	x11 xaw
BUILD_DEPENDS+=			imake:${PORTSDIR}/devel/imake
PLIST_FILES+=	bin/xspim
MAN1+=		xspim.1
.endif

do-configure:

do-build:
	cd ${WRKSRC}/spim && \
		${SETENV} ${MAKE_ENV} ${MAKE} ${MAKE_FLAGS} ${MAKEFILE}
.if defined(WITH_GUI)
	cd ${WRKSRC}/xspim && ${XMKMF} && \
		${SETENV} ${MAKE_ENV} ${MAKE} ${MAKE_FLAGS} ${MAKEFILE}
.endif

do-install:
	cd ${WRKSRC}/spim && \
		${SETENV} ${MAKE_ENV} ${MAKE} ${MAKE_FLAGS} ${MAKEFILE} \
		${INSTALL_TARGET}
.if defined(WITH_GUI)
	cd ${WRKSRC}/xspim && \
		${SETENV} ${MAKE_ENV} ${MAKE} ${MAKE_FLAGS} ${MAKEFILE} \
		${INSTALL_TARGET}
	${INSTALL_MAN} ${WRKSRC}/Documentation/xspim.man ${PREFIX}/man/man1/xspim.1
.endif

post-install:
.if !defined(NOPORTDOCS)
	@${MKDIR} ${DOCSDIR}
	${INSTALL_DATA} ${WRKSRC}/Documentation/TeX/cycle.ps ${DOCSDIR}
	${INSTALL_DATA} ${WRKSRC}/Documentation/TeX/spim.ps ${DOCSDIR}
	${INSTALL_DATA} ${WRKSRC}/Documentation/SPIM.html ${DOCSDIR}
	${GZIP_CMD} ${DOCSDIR}/cycle.ps ${DOCSDIR}/spim.ps
.endif

.include <bsd.port.post.mk>
