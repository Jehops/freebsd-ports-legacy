--- CMakeLists.txt.orig	2015-07-03 09:22:49 UTC
+++ CMakeLists.txt
@@ -32,6 +32,7 @@ set(USE_SYSTEM_JSONCPP ON CACHE BOOL "Us
 set(USE_SYSTEM_BOOST ON CACHE BOOL "Use the system version of Boost")
 set(USE_SYSTEM_GOOGLE_TEST ON CACHE BOOL "Use the system version of Google Test")
 set(USE_SYSTEM_LIBPQ ON CACHE BOOL "Use the system version of the PostgreSQL client library")
+set(BUILD_UNIT_TESTS ON CACHE BOOL "Build UnitTests")
 
 # Distribution-specific settings
 set(USE_GTEST_DEBIAN_SOURCE_PACKAGE OFF CACHE BOOL "Use the sources of Google Test shipped with libgtest-dev (Debian only)")
@@ -47,7 +48,10 @@ include(${CMAKE_SOURCE_DIR}/Resources/CM
 include(${CMAKE_SOURCE_DIR}/Resources/CMake/BoostConfiguration.cmake)
 include(${CMAKE_SOURCE_DIR}/Resources/CMake/PostgreSQLConfiguration.cmake)
 include(${CMAKE_SOURCE_DIR}/Resources/CMake/JsonCppConfiguration.cmake)
-include(${CMAKE_SOURCE_DIR}/Resources/CMake/GoogleTestConfiguration.cmake)
+
+if (BUILD_UNIT_TESTS)
+  include(${CMAKE_SOURCE_DIR}/Resources/CMake/GoogleTestConfiguration.cmake)
+endif()
 
 
 # Check that the Orthanc SDK headers are available or download them
@@ -123,14 +127,21 @@ set_target_properties(OrthancPostgreSQLI
   SOVERSION ${ORTHANC_POSTGRESQL_VERSION}
   )
 
+install(
+  TARGETS OrthancPostgreSQLStorage OrthancPostgreSQLIndex
+  RUNTIME DESTINATION lib	# Destination for Windows
+  LIBRARY DESTINATION share/orthanc/plugins	# Destination for Linux
+)
 
-add_executable(UnitTests
-  ${CORE_SOURCES}
-  ${GTEST_SOURCES}
-  ${AUTOGENERATED_SOURCES}
-  ${CMAKE_SOURCE_DIR}/IndexPlugin/PostgreSQLWrapper.cpp
-  ${CMAKE_SOURCE_DIR}/StoragePlugin/PostgreSQLStorageArea.cpp
-  ${CMAKE_SOURCE_DIR}/UnitTestsSources/UnitTestsMain.cpp
-  ${CMAKE_SOURCE_DIR}/UnitTestsSources/PostgreSQLTests.cpp
-  ${CMAKE_SOURCE_DIR}/UnitTestsSources/PostgreSQLWrapperTests.cpp
-  )
+if (BUILD_UNIT_TESTS)
+  add_executable(UnitTests
+    ${CORE_SOURCES}
+    ${GTEST_SOURCES}
+    ${AUTOGENERATED_SOURCES}
+    ${CMAKE_SOURCE_DIR}/IndexPlugin/PostgreSQLWrapper.cpp
+    ${CMAKE_SOURCE_DIR}/StoragePlugin/PostgreSQLStorageArea.cpp
+    ${CMAKE_SOURCE_DIR}/UnitTestsSources/UnitTestsMain.cpp
+    ${CMAKE_SOURCE_DIR}/UnitTestsSources/PostgreSQLTests.cpp
+    ${CMAKE_SOURCE_DIR}/UnitTestsSources/PostgreSQLWrapperTests.cpp
+    )
+endif()
