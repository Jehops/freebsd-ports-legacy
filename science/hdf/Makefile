# New ports collection makefile for:	HDF_lib
# Date created:		17 November 1996
# Whom:			mi
#
# $FreeBSD$
#

PORTNAME=	hdf
PORTVERSION=	4.1r5
CATEGORIES=	science archivers graphics
MASTER_SITES=	ftp://ftp.ncsa.uiuc.edu/HDF/HDF/HDF${PORTVERSION}/tar/
DISTNAME=	HDF${PORTVERSION}

MAINTAINER=	mi@aldan.algebra.com
COMMENT=	Hierarchical Data Format library (from NCSA)

LIB_DEPENDS=	jpeg.9:${PORTSDIR}/graphics/jpeg

CONFLICTS=	netcdf-*

MAN1=		hdf.1 hdfunpac.1 ncdump.1 ncgen.1
MAN3=		gr_chunk.3
MANCOMPRESSED=	maybe

INSTALLS_SHLIB=	yes

MAKE_ARGS=	PREFIX="${PREFIX}" -j 2

.include <bsd.port.pre.mk>

.if ${ARCH} != "i386" && ${ARCH} != "alpha"
BROKEN=		"Does not compile on !i386 and !alpha"
.endif

post-patch:
	${RM} -rf ${WRKSRC}/hdf/jpeg
	${RM} -rf ${WRKSRC}/hdf/zlib

do-configure:
	${CP} -rp ${FILESDIR}/Makefile ${FILESDIR}/hdf \
		${FILESDIR}/mfhdf ${FILESDIR}/man ${WRKSRC}
	${LN} -s config/netcdf-fbsd.h ${WRKSRC}/mfhdf/libsrc/netcdf.h
	${LN} -s netcdf-fbsd.inc ${WRKSRC}/mfhdf/fortran/config/netcdf.inc

test: build
	cd ${WRKSRC}; ${MAKE} test

.include <bsd.port.post.mk>
