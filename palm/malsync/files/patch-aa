--- Makefile.orig	Sun May 14 23:17:35 2000
+++ Makefile	Tue Jul 25 14:25:02 2000
@@ -1,4 +1,3 @@
-CC = gcc
 TARGET = malsync
 
 PLAT := $(shell uname)
@@ -12,9 +11,15 @@
 endif
 
 TREETOP = ../../..
-PILOT_LINK_DIR = $(TREETOP)/vendor/pilot/pilot-link.0.9.3
+PILOT_LINK_DIR = $(PREFIX)/pilot
+  
+DEFINES = -DMALSYNC
 
-CFLAGS = -Wall -g -DMALSYNC -I$(TREETOP)/mal/common \
+ifeq ($(PLAT),FreeBSD)
+LINKFLAGS = -Wl,--rpath -Wl,$(PILOT_LINK_DIR)/lib
+endif
+
+CFLAGS += $(DEFINES) -I$(TREETOP)/mal/common \
   -I$(TREETOP)/mal/client/common -I$(PILOT_LINK_DIR)/include -I.
 
 
@@ -55,17 +60,12 @@
 
 OBJS = $(SRC:.c=.o)
 
+all: $(TARGET)
 
 $(TARGET): $(OBJS)
-	$(CC) -rdynamic  $(CFLAGS) -o $@ $(OBJS) \
-          -L${PILOT_LINK_DIR}/libsock -lpisock $(LINKLIBS)
+	$(CC) $(CFLAGS) -o $@ $(OBJS) \
+	-L${PILOT_LINK_DIR}/lib -lpisock $(LINKLIBS) $(LINKFLAGS)
+ 
 clean:
 	rm -f $(OBJS) $(TARGET)
-
-.c.o:
-	gcc $(CFLAGS) -c -o $@ $<
-
-
-
-
 
