# New ports collection makefile for:	BitchX ircII client
# Version required:	1.0c15
# Date created:		26 Jan 1998
# Whom:			griffin
#
# $FreeBSD$
#

DISTNAME=	BitchX-1.0c15
CATEGORIES=	irc
MASTER_SITES=	ftp://ftp.bitchx.com/pub/BitchX/source/ \
		ftp://bitchx.dimension6.com/pub/BitchX/source/

MAINTAINER=	calle.madestrand@norrgarden.se

.if defined(USE_GNOME)
LIB_DEPENDS=	gnome.3:${PORTSDIR}/x11/gnomelibs
.endif

GLIB_CONFIG?=	${LOCALBASE}/bin/glib12-config
GTK_CONFIG?=	${X11BASE}/bin/gtk12-config
WRKSRC=		${WRKDIR}/BitchX
GNU_CONFIGURE=	yes
USE_GMAKE=	yes
.if defined(USE_GNOME)
CONFIGURE_ARGS+=	--with-plugins --with-gtk --enable-sound
.else
CONFIGURE_ARGS+=	--with-plugins --without-gtk
.endif
CONFIGURE_ARGS+=	--exec-prefix="${PREFIX}/share"	\
			--bindir="${PREFIX}/bin" \
			--datadir="${PREFIX}/share" \
			--libdir="${PREFIX}/share"

CONFIGURE_ENV=	CPPFLAGS="-I${LOCALBASE}/include" \
		GLIB_CONFIG="${GLIB_CONFIG}" \
		GTK_CONFIG="${GTK_CONFIG}"

MAKE_ENV+=	INSTALL_PROGRAM="${INSTALL_PROGRAM}" \
		INSTALL_DATA="${INSTALL_DATA}"

.if !defined(USE_GNOME)
pre-extract:
	@${ECHO} "You can add hooks for GNOME by defining USE_GNOME"
.endif

# Horrible hack to remove bogus CR's at the end of this file
post-patch:
	@${PERL} -pi -e 's,\r$$,,' ${WRKSRC}/script/menu.bx

post-install:
.if !defined(NOPORTDOCS)
	${MKDIR} ${PREFIX}/share/bx/help
	${MKDIR} ${PREFIX}/share/doc/bitchx
	${TAR} --directory ${WRKSRC}/bitchx-docs -cf - . --exclude CVS | \
		${TAR} --directory ${PREFIX}/share/bx/help -xf -
	${INSTALL_DATA} ${WRKSRC}/doc/bxfaq.html ${PREFIX}/share/doc/bitchx
.endif
.if defined(USE_GNOME)
	@${ECHO} bin/gtkBitchX >> ${TMPPLIST}
	@${ECHO} bin/gtkBitchX-1.0c15 >> ${TMPPLIST}
	@${ECHO} share/bx/plugins/nicklist.so >> ${TMPPLIST}
.else
	@${ECHO} bin/BitchX >> ${TMPPLIST}
	@${ECHO} bin/BitchX-1.0c15 >> ${TMPPLIST}
	@${ECHO} bin/scr-bx >> ${TMPPLIST}
	@${ECHO} share/bx/wserv >> ${TMPPLIST}
.endif
	@${ECHO} @dirrm share/bx/help >> ${TMPPLIST}
	@${ECHO} @dirrm share/bx/plugins >> ${TMPPLIST}
	@${ECHO} @dirrm share/bx/script >> ${TMPPLIST}
	@${ECHO} @dirrm share/bx/translation >> ${TMPPLIST}
	@${ECHO} @dirrm share/bx >> ${TMPPLIST}

.include <bsd.port.mk>
