--- nntp.c.orig	Tue Apr 19 18:06:51 2005
+++ nntp.c	Sat Sep  3 14:34:49 2005
@@ -76,6 +76,7 @@
 static int      connect_server(void);
 static void     debug_msg(char *prefix, char *str);
 static void     find_server(void);
+static char    *find_domain(const char *domainFile);
 static int      get_server_line(char *string, int size);
 static int      get_server(char *string, int size);
 static int      get_socket(void);
@@ -233,6 +234,50 @@
     sys_error("Failed to find name of NNTP server!");
 }
 
+
+/*
+ * find_domain		Get the domain name for posting from a named file.
+ *			Handle blank lines and comments.
+ *
+ *	Parameters:	"file" is the name of the file to read.
+ *
+ *	Returns:	Pointer to static data area containing the
+ *			first non-blank/comment line in the file.
+ *			NULL on error (or lack of entry in file).
+ *
+ *	Side effects:	None.
+ */
+
+static char *
+find_domain(const char *domainFile)
+{
+    register FILE  *fp;
+    register char  *cp;
+    static char     buf[MAXHOSTNAMELEN];
+    char           *index();
+
+    if (domainFile == NULL)
+	return (NULL);
+
+    fp = fopen(domainFile, "r");
+    if (fp == NULL)
+	return (NULL);
+
+    while (fgets(buf, sizeof (buf), fp) != NULL) {
+	if (*buf == '\n' || *buf == '#')
+	    continue;
+	cp = index(buf, '\n');
+	if (cp)
+	    *cp = '\0';
+	(void) fclose(fp);
+	return (buf);
+    }
+
+    (void) fclose(fp);
+    return (NULL);
+}
+
+
 /*
  * get_server_line: get a line from the server.
  *
@@ -1492,15 +1537,24 @@
 gen_frompath(void)
 {
     struct passwd  *passwd;
+    char           *domain;
+    const char     *fromFormat = "From: <%s@%s>\r\n";
 
     passwd = getpwuid(getuid());
 
     fprintf(nntp_out, "From: ");
     fprintf(nntp_out, "%s ", full_name());
 
-    fprintf(nntp_out, "<%s@%s>\r\n",
-	    passwd->pw_name,
-	    domain);
+    domain = find_domain(DOMAIN_FILE);
+    if (domain == NULL) {
+	fprintf(nntp_out, fromFormat,
+		passwd->pw_name,
+		host_name);
+    } else {
+	fprintf(nntp_out, fromFormat,
+		passwd->pw_name,
+		domain);
+    }
 
 #ifdef HIDDENNET
     /* Only the login name - nntp server will add uucp name */
