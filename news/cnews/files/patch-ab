*** ./maint/makefile	Tue Sep 20 21:56:32 1994
--- ../cnews/maint/makefile	Thu Sep 29 09:40:58 1994
***************
*** 77,83 ****
  	echo 'Message-ID: <legal>' >>arts/bar/ugh/12
  	echo '<bar.ugh/13@trash>	0~0	bar.ugh/13' >>history.good
  	echo 'Message-ID: illegal' >arts/bar/ugh/13
! 	sed $(FIXMIDFIELD) history.good | sort -o history.good
  
  r:	$(PROGS) rclean rsetup
  	: "mkhistory"
--- 77,84 ----
  	echo 'Message-ID: <legal>' >>arts/bar/ugh/12
  	echo '<bar.ugh/13@trash>	0~0	bar.ugh/13' >>history.good
  	echo 'Message-ID: illegal' >arts/bar/ugh/13
! 	sed $(FIXMIDFIELD) history.good | sort -o history.good2
! 	mv history.good2 history.good
  
  r:	$(PROGS) rclean rsetup
  	: "mkhistory"
***************
*** 93,99 ****
  	: "addmissing"
  	echo '<missing>	9999~-	bar.ugh/14' >>history.good
  	echo 'Message-ID: <missing>' >arts/bar/ugh/14
! 	sed $(FIXMIDFIELD) history.good | sort -o history.good
  	sleep 2		# ensure article looks older than addmissing startup
  	$(HERE) ./addmissing -v >addm.out 2>addm.diag
  	sed $(FIXMIDFIELD) history | sort >history.fixed
--- 94,101 ----
  	: "addmissing"
  	echo '<missing>	9999~-	bar.ugh/14' >>history.good
  	echo 'Message-ID: <missing>' >arts/bar/ugh/14
! 	sed $(FIXMIDFIELD) history.good | sort -o history.good2
! 	mv history.good2 history.good
  	sleep 2		# ensure article looks older than addmissing startup
  	$(HERE) ./addmissing -v >addm.out 2>addm.diag
  	sed $(FIXMIDFIELD) history | sort >history.fixed
***************
*** 106,112 ****
  	: "cnewsdo, using addmissing as test command"
  	echo '<missing2>	9999~-	bar.ugh/15' >>history.good
  	echo 'Message-ID: <missing2>' >arts/bar/ugh/15
! 	sed $(FIXMIDFIELD) history.good | sort -o history.good
  	sleep 2		# ensure article looks older than addmissing startup
  	touch active
  	$(HERE) ./cnewsdo addmissing >addm.out 2>addm.diag
--- 108,115 ----
  	: "cnewsdo, using addmissing as test command"
  	echo '<missing2>	9999~-	bar.ugh/15' >>history.good
  	echo 'Message-ID: <missing2>' >arts/bar/ugh/15
! 	sed $(FIXMIDFIELD) history.good | sort -o history.good2
! 	mv history.good2 history.good
  	sleep 2		# ensure article looks older than addmissing startup
  	touch active
  	$(HERE) ./cnewsdo addmissing >addm.out 2>addm.diag
*** batch/usenntpxmit.old	Thu Sep 22 17:28:37 1994
--- batch/usenntpxmit	Fri Sep 30 12:30:17 1994
***************
*** 15,21 ****
  
  tmp=/tmp/nntp$$
  cat >$tmp
! nntpxmit $site:$tmp
  if test -s $tmp
  then
  	cat $tmp >>$NEWSSITEDIR/togo.leftover
--- 15,21 ----
  
  tmp=/tmp/nntp$$
  cat >$tmp
! nntpxmit -s $site:$tmp
  if test -s $tmp
  then
  	cat $tmp >>$NEWSSITEDIR/togo.leftover
*** nov/mkov.c.old	Sun Sep 18 17:55:05 1994
--- nov/mkov.c	Fri Sep 30 13:39:22 1994
***************
*** 305,317 ****
  	putfld(hdrp->h_bytes);
  	putfld(hdrp->h_lines);
  	/* put Xref in only if there is more than one locator in it */
! 	p = strchr(hdrp->h_xref, ' ');	/* p -> space after relayer */
! 	if (p != NULL)
  		p = strchr(p, ':');	/* p -> colon in first location */
! 	if (p != NULL)
  		p = strchr(p+1, ':');	/* p -> colon in second location */
! 	if (p != NULL)			/* at least two locations! */
  		putextfld("xref", hdrp->h_xref);
  	/* step 3 of 4: add new header output before this line */
  	(void) putchar('\n');
  }
--- 305,319 ----
  	putfld(hdrp->h_bytes);
  	putfld(hdrp->h_lines);
  	/* put Xref in only if there is more than one locator in it */
! 	if (hdrp->h_xref != NULL) {
! 	    p = strchr(hdrp->h_xref, ' ');	/* p -> space after relayer */
! 	    if (p != NULL)
  		p = strchr(p, ':');	/* p -> colon in first location */
! 	    if (p != NULL)
  		p = strchr(p+1, ':');	/* p -> colon in second location */
! 	    if (p != NULL)			/* at least two locations! */
  		putextfld("xref", hdrp->h_xref);
+ 	}
  	/* step 3 of 4: add new header output before this line */
  	(void) putchar('\n');
  }
