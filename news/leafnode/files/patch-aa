
$FreeBSD$

--- fetchnews_check_date.c.orig	Wed Feb 12 23:55:16 2003
+++ fetchnews_check_date.c	Wed Feb 12 23:58:46 2003
@@ -22,12 +22,20 @@
     if (reply != 111) {
 	/* upstream does not support the DATE command, so ignore */
 	if (debugmode) {
-	    syslog(LOG_DEBUG, "check_date: %s does not support DATE, "
+	    syslog(LOG_DEBUG, "check_date: %s: does not support DATE, "
 		    "reply %d, expected 111", servername, reply);
 	}
 	return;
     }
 
+    if (lastline == NULL) {
+	if (debugmode) {
+	    syslog(LOG_DEBUG, "check_date: %s: cannot parse lastline (NULL)",
+		    servername);
+	}
+	return;
+    }
+
     /* upstream supports the DATE command */
     if (sscanf(lastline, "%*d %4d%2d%2d%2d%2d%2d",
 		&tm.tm_year, &tm.tm_mon, &tm.tm_mday,
@@ -61,7 +69,7 @@
     } else {
 	if (debugmode) {
 	syslog(LOG_DEBUG, "check_date: %s: server time %ld, our time %ld",
-		servername, t, to);
+		servername, (long)t, (long)to);
 	}
     }
 }
