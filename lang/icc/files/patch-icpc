--- opt/intel/compiler60/ia32/bin/icpc.orig	Fri Sep  6 02:18:03 2002
+++ opt/intel/compiler60/ia32/bin/icpc	Tue Sep 10 18:32:59 2002
@@ -1,29 +1,45 @@
 #!/bin/sh
 
-INTEL_LICENSE_FILE=<INSTALLDIR>/licenses;
+PREFIX=@@PREFIX@@
+export PREFIX;
+INTEL_LICENSE_FILE=${PREFIX}/intel/licenses;
 export INTEL_LICENSE_FILE;
 
 if [ -z LD_LIBRARY_PATH ]
 then 
- LD_LIBRARY_PATH=<INSTALLDIR>/compiler60/ia32/lib;
+ LD_LIBRARY_PATH=${PREFIX}/intel/compiler60/ia32/lib;
 else
- LD_LIBRARY_PATH=<INSTALLDIR>/compiler60/ia32/lib:$LD_LIBRARY_PATH
+ LD_LIBRARY_PATH=${PREFIX}/intel/compiler60/ia32/lib:$LD_LIBRARY_PATH
 fi
 export LD_LIBRARY_PATH;
 
 if [ -z PATH ]
 then
- PATH=<INSTALLDIR>/compiler60/ia32/bin;
+ PATH=${PREFIX}/intel/compiler60/ia32/bin;
 else
- PATH=<INSTALLDIR>/compiler60/ia32/bin:$PATH;
+ PATH=${PREFIX}/intel/compiler60/ia32/bin:$PATH;
 fi
 export PATH;
 
-export -n IA32ROOT; unset IA32ROOT;
-
 if [ $# != 0 ]
 then
- exec -a "<INSTALLDIR>/compiler60/ia32/bin/icpc" <INSTALLDIR>/compiler60/ia32/bin/icpcbin "$@";
+ i=0
+ argc=$#
+ while [ $i -lt $argc ] ; do
+  val1=$1
+  shift
+  val2=${val1#"-openmp"}
+  if [ ${#val1} -gt ${#val2} ] || [ ${val1} = "-parallel" ] ; then
+   echo "Sorry, option '$val1' is not supported on FreeBSD."
+   exit 1
+  fi
+  if [ ${val1} = "-Kpic" ] || [ ${val1} = "-KPIC" ] ; then
+   set -- "$@" "-Qoption,ld,-PIC"
+  fi
+  set -- "$@" "$val1"
+  i=$(($i+1))
+ done
+ exec ${PREFIX}/intel/compiler60/ia32/bin/icpcbin "$@";
 else
- exec -a "<INSTALLDIR>/compiler60/ia32/bin/icpc" <INSTALLDIR>/compiler60/ia32/bin/icpcbin;
+ exec ${PREFIX}/intel/compiler60/ia32/bin/icpcbin;
 fi
