--- configure.orig	2012-06-06 18:11:19.000000000 +0100
+++ configure	2012-08-25 06:03:00.000000000 +0100
@@ -3372,8 +3372,8 @@
   vax)
     BuildArch="vax"
     ;;
-  x86_64)
-    BuildArch="x86_64"
+  x86_64|amd64)
+    BuildArch="amd64"
     ;;
   *)
     echo "Unknown CPU $build_cpu"
@@ -3404,7 +3404,7 @@
   freebsd|netbsd|openbsd|dragonfly|osf1|osf3|hpux|linuxaout|kfreebsdgnu|freebsd2|solaris2|cygwin32|mingw32|darwin|gnu|nextstep2|nextstep3|sunos4|ultrix|irix|aix|haiku)
     BuildOS="$build_os"
     ;;
-  freebsd8) # like i686-gentoo-freebsd8
+  freebsd*) # like i686-gentoo-freebsd8
     BuildOS="freebsd"
     ;;
   *)
@@ -3486,8 +3486,8 @@
   vax)
     HostArch="vax"
     ;;
-  x86_64)
-    HostArch="x86_64"
+  x86_64|amd64)
+    HostArch="amd64"
     ;;
   *)
     echo "Unknown CPU $host_cpu"
@@ -3600,8 +3600,8 @@
   vax)
     TargetArch="vax"
     ;;
-  x86_64)
-    TargetArch="x86_64"
+  x86_64|amd64)
+    TargetArch="amd64"
     ;;
   *)
     echo "Unknown CPU $target_cpu"
@@ -3711,6 +3711,8 @@
 
 
 
+bootstrap_target=`echo "$bootstrap_target" |sed -e 's/-unknown-/-portbld-/g' -e 's/x86_64/amd64/g'`
+build=`echo "$build" |sed -e 's/\(freebsd\)[[:digit:].]*$/\1/g'`
 
 # Verify that the installed (bootstrap) GHC is capable of generating
 # code for the requested build platform.
@@ -5772,7 +5774,7 @@
         i386)
             test -z "$2" || eval "$2=ArchX86"
             ;;
-        x86_64)
+        x86_64|amd64)
 
     cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
@@ -5953,7 +5955,7 @@
 
     checkVendor() {
         case $1 in
-        dec|unknown|hp|apple|next|sun|sgi|ibm)
+        dec|unknown|hp|apple|next|sun|sgi|ibm|portbld)
             ;;
         *)
             echo "Unknown vendor $1"
@@ -5976,7 +5978,7 @@
         mingw32)
             test -z "$2" || eval "$2=OSMinGW32"
             ;;
-        freebsd)
+        freebsd*)
             test -z "$2" || eval "$2=OSFreeBSD"
             ;;
         kfreebsdgnu)
@@ -9990,7 +9992,7 @@
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-lrt  $LIBS"
+LIBS="$LIBS"
 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
@@ -10021,12 +10023,7 @@
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_rt_clock_gettime" >&5
 $as_echo "$ac_cv_lib_rt_clock_gettime" >&6; }
 if test "x$ac_cv_lib_rt_clock_gettime" = x""yes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LIBRT 1
-_ACEOF
-
-  LIBS="-lrt $LIBS"
-
+  LIBS="$LIBS"
 fi
 
 for ac_func in clock_gettime timer_create timer_settime
