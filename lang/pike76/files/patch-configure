--- configure.orig	Fri Feb 20 20:41:26 2004
+++ configure	Sat Feb 21 02:29:33 2004
@@ -27161,14 +27161,14 @@
 
         if test "x$PTHREAD_CONFIG" = xno ; then
 
-  echo "$as_me:27164: checking -pthread" >&5
-echo $ECHO_N "checking -pthread... $ECHO_C" >&6
+  echo "$as_me:27164: checking %%PTHREAD_CFLAGS%%" >&5
+echo $ECHO_N "checking %%PTHREAD_CFLAGS%%.. $ECHO_C" >&6
   if test "${pike_cv_option_pthread+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
 
     OLD_CPPFLAGS="$CPPFLAGS"
-    CPPFLAGS="$OLD_CPPFLAGS -pthread"
+    CPPFLAGS="$OLD_CPPFLAGS %%PTHREAD_FLAGS%%"
     old_ac_link="$ac_link"
     ac_link="$old_ac_link 2>conftezt.out.2"
     if test "$cross_compiling" = yes; then
@@ -27275,10 +27275,10 @@
 fi
 
   if test x"$pike_cv_option_pthread" = "xyes" ; then
-    CFLAGS="$CFLAGS -pthread"
+    CFLAGS="$CFLAGS %%PTHREAD_CFLAGS%%"
     case "CFLAGS" in
       OPTIMIZE)
-        CFLAGS="$CFLAGS -pthread"
+        CFLAGS="$CFLAGS %%PTHREAD_CFLAGS%%"
       ;;
     esac
     echo "$as_me:27284: result: yes" >&5
@@ -27287,10 +27287,10 @@
   else
     echo "$as_me:27288: result: no" >&5
 echo "${ECHO_T}no" >&6
-    LIBS="$LIBS -lc_r"
+    LIBS="$LIBS %%PTHREAD_LIBS%%"
   fi
 
-          LD_FALLBACK_FLAGS="${LD_FALLBACK_FLAGS-} -lc_r"
+          LD_FALLBACK_FLAGS="${LD_FALLBACK_FLAGS-} %%PTHREAD_LIBS%%"
 
           echo "$as_me:27295: checking Initial stack limit" >&5
 echo $ECHO_N "checking Initial stack limit... $ECHO_C" >&6
