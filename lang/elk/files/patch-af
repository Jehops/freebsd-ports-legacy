--- src/print.c.orig	Thu Apr  4 15:25:04 1996
+++ src/print.c	Thu Aug  7 18:42:43 2003
@@ -5,7 +5,8 @@
 
 #include <errno.h>
 #include <ctype.h>
-#include <varargs.h>
+#include <string.h>
+#include <stdarg.h>
 
 #ifdef FLUSH_TIOCFLUSH
 #  include <sys/ioctl.h>
@@ -95,15 +96,11 @@
 #endif
 
 /*VARARGS0*/
-Printf (va_alist) va_dcl {
+Printf (Object port, char *fmt, ...) {
     va_list args;
-    Object port;
-    char *fmt;
     char buf[1024];
 
-    va_start (args);
-    port = va_arg (args, Object);
-    fmt = va_arg (args, char *);
+    va_start (args, fmt);
     if (PORT(port)->flags & P_STRING) {
 	vsprintf (buf, fmt, args);
 	Print_String (port, buf, strlen (buf));
@@ -555,10 +552,6 @@
     char *p;
     register c;
     char buf[256];
-    extern sys_nerr;
-#ifndef __bsdi__
-    extern char *sys_errlist[];
-#endif
     GC_Node;
     Alloca_Begin;
 
@@ -573,13 +566,13 @@
 	    } else if (c == '%') {
 		Print_Char (port, '\n');
 	    } else if (c == 'e' || c == 'E') {
-		if (Saved_Errno > 0 && Saved_Errno < sys_nerr) {
-		    s = sys_errlist[Saved_Errno];
-		    sprintf (buf, "%c%s", isupper (*s) ? tolower (*s) :
-			*s, s+1);
-		} else {
-		    sprintf (buf, "error %d", Saved_Errno);
+		if (strerror_r(Saved_Errno, buf, sizeof(buf)) != 0) {
+			snprintf(buf, sizeof(buf) - 1, "unknown error: %d",
+				Saved_Errno);
+			buf[sizeof(buf) - 1] = '\0';
 		}
+		if (isupper(buf[0]))
+			buf[0] = tolower(buf[0]);
 		Print_Object (Make_String (buf, strlen (buf)), port,
 		    c == 'E', 0, 0);
 	    } else {
