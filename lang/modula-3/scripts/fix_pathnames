#! /bin/sh
#
# $Id: fix_pathnames,v 1.3 1996/10/29 23:17:19 jdp Exp $

umask 022

if [ $# -ne 2 ]; then
    echo "Usage: $0 oldpath newpath" >&2
    exit 1
fi

oldpath=$1
newpath=$2
pkgdir=lib/m3/pkg

# Fix absolute pathnames in files so that they reference the actual
# installation directory, instead of the temporary directory we have
# been using.

cd ${newpath}/${pkgdir}
for i in `cd ${oldpath}/${pkgdir}; \
  find . -type f \( -name .M3IMPTAB -o -name FreeBSD2 \)`; do
    if [ -f ${i} ]; then
	test -f ${i}.bak || cp -p ${i} ${i}.bak
	rm -f ${i}
	sed -e "s|/[^ 	]*/work/installed/|${newpath}/|g" ${i}.bak >${i} && \
	  rm -f ${i}.bak
    fi
done
