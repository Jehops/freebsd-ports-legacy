PLIST=	${.CURDIR}/pkg-plist
PATCHDIR=	${.CURDIR}/files
WRKSRC=	${WRKDIR}/${PORTNAME:S/$/build_/}${PORTVERSION:S/$/_exp/}

UNITPREFIX=    		unit-
UNITEXTRACT_SUFX=	.tar.gz
UNITNAME=		${UNITPREFIX}${PKGNAMESUFFIX:S/-//}${BUILDNAME:S/^/./}${UNITEXTRACT_SUFX}
UNITDIR=		lib/fpc/${PORTVERSION}/units/${BUILDNAME}

EXTRACT_AFTER_ARGS=	| ${TAR} -xf - ${EXTRACTUNITDIR}
OPT=-CX


.if !exists(${LOCALBASE}/bin/fpcmake)
EXTRACTUNITDIR+=	fpc-bin
DISTFILES+=	${DISTNAME:S/$/.bin/}${EXTRACT_SUFX}:bin
MAKE_ENV+=	FPCMAKE=${WRKDIR}/${PORTNAME:S/$/-bin/}/bin/fpcmake
.endif

.if ${PKGNAMESUFFIX} == "-gdbint"
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-ibase"
.	if defined(WITH_IBASE)
LIB_DEPENDS=	fbembed.1:${PORTSDIR}/databases/firebird-client
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-mysql"
.	if defined(WITH_MYSQL)
USE_MYSQL=	yes
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-odbc"
.	if defined(WITH_ODBC)
LIB_DEPENDS=	odbc.1:${PORTSDIR}/databases/unixODBC
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-oracle"
.	if defined(WITH_ORACLE)
ORACLE8_LIB=	${LOCALBASE}/oracle8-client/rdbms/lib
RUN_DEPENDS=	${ORACLE8_LIB}/env_rdbms.mk:${PORTSDIR}/databases/oracle8-client
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-postgres"
.	if defined(WITH_PGSQL)
USE_PGSQL=	yes
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-pasjpeg"
HAVE_EXAMPLES=  true
.endif

.if ${PKGNAMESUFFIX} == "-paszlib"
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-regexpr"
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-sqlite"
.	if defined(WITH_SQLITE)
USE_SQLITE=	yes
.	endif
.endif

.if ${PKGNAMESUFFIX} == "-bfd"
.	if defined(WITH_LIBBFD)
RUN_DEPENDS=	${LOCALBASE}/lib/libbfd.a:${PORTSDIR}/devel/libbfd
.	endif
.endif

.if ${PKGNAMESUFFIX} == "-fftw"
.	if defined(WITH_FFTW)
LIB_DEPENDS=	fftw3.4:${PORTSDIR}/math/fftw3
.	endif
.endif

.if ${PKGNAMESUFFIX} == "-forms"
.	if defined(WITH_XFORMS)
LIB_DEPENDS=	forms.1:${PORTSDIR}/x11-toolkits/xforms
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-fcl"
OPT+=	-Fuunits/${ARCH}-freebsd -Fu../units/${ARCH}-freebsd \
	-Fuxml/units/${ARCH}-freebsd -Fu../xml/units/${ARCH}-freebsd \
	-Fudb/units/${ARCH}-freebsd -Fu../db/units/${ARCH}-freebsd \
	-Fu../../units/${ARCH}-freebsd -Fu../passrc/units/${ARCH}-freebsd
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-fpgtk"
.	if defined(WITH_GTK1)
.include <${PORTSDIR}/Mk/bsd.gnome.mk>
USE_GNOME=	gtk12
.	endif
.endif

.if ${PKGNAMESUFFIX} == "-fv"
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-gconf"
.	if defined(WITH_GCONF)
.include <${PORTSDIR}/Mk/bsd.gnome.mk>
USE_GNOME=      gconf
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-gdbm"
.	if defined(WITH_GDBM)
LIB_DEPENDS=	gdbm.3:${PORTSDIR}/databases/gdbm
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-ggi"
.	if defined(WITH_LIBGGI)
LIB_DEPENDS=	ggi:${PORTSDIR}/graphics/libggi
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-gtk"
.	if defined(WITH_GTK1)
.include <${PORTSDIR}/Mk/bsd.gnome.mk>
USE_GNOME=	gtk12
.	endif
HAVE_EXAMPLES=	true
OPT+=-Fu${WRKDIR}/${WRKUNITDIR}/*
.endif

.if ${PKGNAMESUFFIX} == "-gtk2"
.	if defined(WITH_GTK2)
.include <${PORTSDIR}/Mk/bsd.gnome.mk>
USE_GNOME=	gtk20
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-hash"
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-imlib"
.	if defined(WITH_IMLIB)
.include <${PORTSDIR}/Mk/bsd.gnome.mk>
USE_GNOME=	imlib
.	endif
.endif

.if ${PKGNAMESUFFIX} == "-libgd"
.	if defined(WITH_LIBGD)
LIB_DEPENDS=	gd.4:${PORTSDIR}/graphics/gd
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-libpng"
.	if defined(WITH_LIBPNG)
LIB_DEPENDS=	png.5:${PORTSDIR}/graphics/png
.	endif
.endif

.if ${PKGNAMESUFFIX} == "-ncurses"
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-netdb"
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-opengl"
.	if defined(WITH_OPENGL)
USE_GL=		yes
LIB_DEPENDS=	glut.4:${PORTSDIR}/graphics/libglut
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-svgalib"
.	if defined(WITH_SVGA)
LIB_DEPENDS=	vga.1:${PORTSDIR}/graphics/svgalib
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-syslog"
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-tcl"
.	if defined(WITH_TCL)
RUN_DEPENDS=	wish8.4:${PORTSDIR}/x11-toolkits/tk84
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-unzip"
.	if defined(WITH_UNZIP)
RUN_DEPENDS=	unzip:${PORTSDIR}/archivers/unzip
.	endif
.endif

.if ${PKGNAMESUFFIX} == "-utils"
OPT+=-Fu../fcl/*
.endif

.if ${PKGNAMESUFFIX} == "-utmp"
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-x11"
.	if defined(WITH_X11)
USE_XLIB=	yes
.	endif
.endif

.if ${PKGNAMESUFFIX} == "-zvt"
.	if defined(WITH_ZVT)
.include <${PORTSDIR}/Mk/bsd.gnome.mk>
USE_GNOME=	libzvt
.	endif
HAVE_EXAMPLES=	true
.endif

post-extract:
	@cd ${WRKDIR}/${WRKUNITDIR} && \
		${FIND} ${WRKSRC} -type d -name .svn | ${XARGS} ${RM} -rf

do-build:
	@${ECHO_CMD} ${MAKE_ENV}
	@${ECHO_CMD} ""
	@cd ${WRKDIR}/${WRKUNITDIR} && ${GMAKE} all ${MAKE_ENV}

do-install:
	@cd ${WRKDIR}/${WRKUNITDIR} && ${GMAKE} install ${MAKE_ENV}
.	if !defined(NOPORTSDOCS)
.		if defined(HAVE_EXAMPLES)
			@cd ${WRKDIR}/${WRKUNITDIR} && ${GMAKE} fpc_exampleinstall
.		endif
.	endif
	
security-check: fpc-check-install

fpc-check-install:
check-makevars::
	@${ECHO_CMD} "*****************************************************************"
	@${ECHO_CMD} ""
	@${ECHO_CMD} " The following freepascal unit will be installed in your system: "
	@${ECHO_CMD} ""
	@${ECHO_CMD} " * ${UNITPREFIX}${PKGNAMESUFFIX:S/-//}"
	@${ECHO_CMD} ""
	@${ECHO_CMD} "*****************************************************************"
