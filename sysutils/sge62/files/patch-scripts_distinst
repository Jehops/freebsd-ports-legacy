
$FreeBSD$

--- scripts/distinst.orig
+++ scripts/distinst
@@ -35,7 +35,7 @@
 
 umask 022
 
-TOPFILES="3rd_party bin catman ckpt doc examples include inst_sge \
+TOPFILES="3rd_party bin ckpt doc examples include inst_sge \
           install_execd install_qmaster lib man mpi pvm qmon util utilbin"
 
 HASARCHDIR="bin lib examples/jobsbin utilbin"
@@ -730,17 +730,6 @@
 echo   "    Installing:" $PROG
 echo   " Architectures:" $ARCH
 echo   "Base directory:" $DEST_SGE_ROOT
-printf "   OK [Y/N][Y]: "
-
-read ans
-if [ "$ans" = y -o "$ans" = Y -o "$ans" = "" ]; then
-   :
-else
-   echo
-   echo Ciao
-   echo
-   exit 1
-fi
 
 echo
 
@@ -799,6 +788,9 @@
          instmpi=true
          instcommon=true
          ;;
+      noqmon)
+         instqmon=false
+         ;;
       qmontree)
          instqmon=true
          instcommon=true
@@ -1006,19 +998,6 @@
          Execute chmod 755 $DEST_SGE_ROOT/$MYRINETBASE/$f
       done
 
-      HPCBASE=mpi/SunHPCT5
-      Execute mkdir -p $DEST_SGE_ROOT/$HPCBASE
-      
-      for f in $SUNHPCTIGHT_FILES; do
-         Execute cp dist/$HPCBASE/$f $DEST_SGE_ROOT/$HPCBASE
-         Execute chmod 644 $DEST_SGE_ROOT/$HPCBASE/$f
-      done
-   
-      for f in $SUNHPCTIGHT_SCRIPTS; do
-         Execute cp dist/$HPCBASE/$f $DEST_SGE_ROOT/$HPCBASE
-         Execute chmod 755 $DEST_SGE_ROOT/$HPCBASE/$f
-      done
-
       Cleanup mpi
    fi
 
@@ -1148,7 +1127,7 @@
 
       for prog in $PROG; do
          case $prog in
-            jobs|ckpt|doc|inst_sge|utiltree|examples|man|mpi|pvm|qmontree|common|distcommon|utilbin)
+            jobs|ckpt|doc|inst_sge|utiltree|examples|man|mpi|pvm|noqmon|qmontree|common|distcommon|utilbin)
                : 
                ;;
             qmake)
@@ -1246,6 +1225,8 @@
                      InstallProg $BERKELEYDBBASE/$DSTARCH/bin/$prog
                   elif [ -f $BERKELEYDBBASE/bin/$prog ]; then
                      InstallProg $BERKELEYDBBASE/bin/$prog
+		  elif [ -f $BERKELEYDBBASE/bin/$prog${BDB_LIB_SUFFIX} ]; then
+		     InstallProgAs $BERKELEYDBBASE/bin/$prog${BDB_LIB_SUFFIX} $prog
                   fi
                fi
             elif [ $prog = spoolinit -o $prog = spooldefaults ]; then
@@ -1356,13 +1337,15 @@
                   libname="$OPENSSLBASE/$DSTARCH/lib/$lib.$shlibext"
                elif [ $DSTARCH = darwin ];  then
                   libname="$OPENSSLBASE/$DSTARCH/lib/$lib.0.9.7.$shlibext"
+	       elif [ ${DSTARCH%%-*} = fbsd ]; then
+                  libname="$OPENSSLBASE/lib/$lib.$shlibext"
                else
                   libname="$OPENSSLBASE/$DSTARCH/lib/$lib.$shlibext.0.9.7"
                fi
 
                if [ -f $libname ]; then
                   InstallProg $libname
-                  if [ $DSTARCH = tru64 ]; then
+                  if [ $DSTARCH = tru64 -o ${DSTARCH%%-*} = fbsd ]; then
                      :
                   elif [ $DSTARCH = darwin ]; then
                      (cd $DEST_SGE_ROOT/${UTILPREFIX}/$DSTARCH; \
@@ -1383,7 +1366,11 @@
          if [ $DSTARCH != win32-x86 ]; then
             if [ $instbdb = true ]; then
                for lib in $BERKELEYDB_SHARED_LIBRARIES; do
-                  libname="$BERKELEYDBBASE/$DSTARCH/lib/$lib.$shlibext"
+                  if [ ${DSTARCH%%-*} = fbsd ]; then
+                     libname="$BERKELEYDBBASE/lib/$lib.$shlibext"
+                  else
+                     libname="$BERKELEYDBBASE/$DSTARCH/lib/$lib.$shlibext"
+                  fi
                   if [ -f $libname ]; then
                      InstallProg $libname
                   elif [ $exit_on_error = true ]; then
