$FreeBSD$

--- Makefile.orig	Fri Dec 19 09:39:10 2003
+++ Makefile	Thu Aug  5 14:57:44 2004
@@ -1,20 +1,19 @@
 PROJECT = powerman
 VERSION = $(shell perl -ne 'print,exit if s/^\s*VERSION:\s*(\S*).*/\1/i' META)
 RELEASE = $(shell perl -ne 'print,exit if s/^\s*RELEASE:\s*(\S*).*/\1/i' META)
-SHELL=   /bin/sh
-MAKE=    /usr/bin/make
-CC=      gcc
-INSTALL= /usr/bin/install -c
+SHELL?=  /bin/sh
+CC?=      gcc
+INSTALL?=/usr/bin/install -c
 mkinstalldirs=	 $(SHELL) $(top_srcdir)/aux/mkinstalldirs
-CFLAGS=   -g -O2 -Wall
+CFLAGS?=   -g -O2 -Wall
 
 top_srcdir	=	.
-prefix		=	/usr
+prefix		=	${PREFIX}
 exec_prefix	=	${prefix}
 bindir		=	${exec_prefix}/bin
-sbindir		= 	${exec_prefix}/sbin
-mandir		=	$(prefix)/man
-etcdir		=	/etc
+sbindir		=	${exec_prefix}/sbin
+mandir		=	${prefix}/man
+etcdir		=	${prefix}/etc
 packagedir	=	${etcdir}/${PROJECT}
 
 all: progs tests
@@ -26,38 +25,38 @@
 	$(MAKE) -C test
 
 install: all
-	$(mkinstalldirs) 			$(DESTDIR)$(bindir)
-	$(INSTALL) src/powerman			$(DESTDIR)$(bindir)/
-	ln -s $(bindir)/powerman		$(DESTDIR)$(bindir)/pm
-	$(mkinstalldirs) 			$(DESTDIR)$(sbindir)
-	$(INSTALL) src/powermand		$(DESTDIR)$(sbindir)/
-	$(mkinstalldirs)			$(DESTDIR)$(packagedir)
-	$(INSTALL) etc/baytech.dev		$(DESTDIR)$(packagedir)
-	$(INSTALL) etc/baytech-rpc28-nc.dev	$(DESTDIR)$(packagedir)
-	$(INSTALL) etc/baytech-rpc3-nc.dev	$(DESTDIR)$(packagedir)
-	$(INSTALL) etc/icebox.dev		$(DESTDIR)$(packagedir)
-	$(INSTALL) etc/icebox3.dev		$(DESTDIR)$(packagedir)
-	$(INSTALL) etc/wti.dev			$(DESTDIR)$(packagedir)
-	$(INSTALL) etc/wti-rps10.dev		$(DESTDIR)$(packagedir)
-	$(INSTALL) etc/apc.dev			$(DESTDIR)$(packagedir)
-	$(INSTALL) etc/apcnew.dev		$(DESTDIR)$(packagedir)
-#	$(INSTALL) etc/vicebox.dev		$(DESTDIR)$(packagedir)
-	$(INSTALL) etc/vpc.dev			$(DESTDIR)$(packagedir)
-	$(INSTALL) etc/ibmh8.dev		$(DESTDIR)$(packagedir)
-	$(INSTALL) etc/phantom.dev		$(DESTDIR)$(packagedir)
-	$(INSTALL) etc/phantom4.dev		$(DESTDIR)$(packagedir)
-	$(INSTALL) etc/ipmi.dev			$(DESTDIR)$(packagedir)
-	$(INSTALL) etc/cyclades-pm8.dev		$(DESTDIR)$(packagedir)
-	$(INSTALL) etc/ipmipower.dev            $(DESTDIR)$(packagedir)
-	$(mkinstalldirs)			$(DESTDIR)$(mandir)/man1
-	$(INSTALL) -m 644 man/powerman.1	$(DESTDIR)$(mandir)/man1
-	$(INSTALL) -m 644 man/powermand.1	$(DESTDIR)$(mandir)/man1
-	$(mkinstalldirs) 			$(DESTDIR)$(mandir)/man5
-	$(INSTALL) -m 644 man/powerman.conf.5  	$(DESTDIR)$(mandir)/man5
-	$(mkinstalldirs) 			$(DESTDIR)$(mandir)/man7
-	$(INSTALL) -m 644 man/powerman-devices.7 $(DESTDIR)$(mandir)/man7
-	$(mkinstalldirs) 			$(DESTDIR)/etc/rc.d/init.d
-	$(INSTALL) -m 755 scripts/powerman.init $(DESTDIR)/etc/rc.d/init.d/powerman
+	$(mkinstalldirs)				$(bindir)
+	${BSD_INSTALL_PROGRAM} src/powerman		$(bindir)/
+	ln -s $(bindir)/powerman			$(bindir)/pm
+	$(mkinstalldirs)				$(sbindir)
+	${BSD_INSTALL_PROGRAM} src/powermand		$(sbindir)/
+	$(mkinstalldirs)				$(packagedir)
+	${BSD_INSTALL_DATA} etc/baytech.dev		$(packagedir)
+	${BSD_INSTALL_DATA} etc/baytech-rpc28-nc.dev	$(packagedir)
+	${BSD_INSTALL_DATA} etc/baytech-rpc3-nc.dev	$(packagedir)
+	${BSD_INSTALL_DATA} etc/icebox.dev		$(packagedir)
+	${BSD_INSTALL_DATA} etc/icebox3.dev		$(packagedir)
+	${BSD_INSTALL_DATA} etc/wti.dev			$(packagedir)
+	${BSD_INSTALL_DATA} etc/wti-rps10.dev		$(packagedir)
+	${BSD_INSTALL_DATA} etc/apc.dev			$(packagedir)
+	${BSD_INSTALL_DATA} etc/apcnew.dev		$(packagedir)
+#	${BSD_INSTALL_DATA} etc/vicebox.dev		$(packagedir)
+	${BSD_INSTALL_DATA} etc/vpc.dev			$(packagedir)
+	${BSD_INSTALL_DATA} etc/ibmh8.dev		$(packagedir)
+	${BSD_INSTALL_DATA} etc/phantom.dev		$(packagedir)
+	${BSD_INSTALL_DATA} etc/phantom4.dev		$(packagedir)
+	${BSD_INSTALL_DATA} etc/ipmi.dev		$(packagedir)
+	${BSD_INSTALL_DATA} etc/cyclades-pm8.dev	$(packagedir)
+	${BSD_INSTALL_DATA} etc/ipmipower.dev		$(packagedir)
+	$(mkinstalldirs)				$(mandir)/man1
+	${BSD_INSTALL_DATA} man/powerman.1		$(mandir)/man1
+	$(mkinstalldirs)				$(mandir)/man8
+	${BSD_INSTALL_DATA} man/powermand.1		$(mandir)/man8/powermand.8
+	$(mkinstalldirs)				$(mandir)/man5
+	${BSD_INSTALL_DATA} man/powerman.conf.5		$(mandir)/man5
+	$(mkinstalldirs)				$(mandir)/man7
+	${BSD_INSTALL_DATA} man/powerman-devices.7	$(mandir)/man7
+	${BSD_INSTALL_SCRIPT} scripts/powerman.init	$(etcdir)/rc.d/powermand.sh
 
 clean:
 	make -C src clean
