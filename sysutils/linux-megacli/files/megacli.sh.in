#!/bin/sh

# check for root user
#
if [ `id -u` -ne 0 ]
then
	echo You must be root to run `basename $0`.
	exit 1
fi

if ! [ `sysctl -n compat.linux.osrelease` = "2.6.12" ]; then
	echo You need to set compat.linux.osrelease to 2.6.12 to run `basename $0`.
	exit 1
fi

if ! [ -d /usr/compat/linux/sys ]; then
	echo You need to mount linsysfs to run `basename $0`.
	exit 1
fi

# check for active mfi_linux.ko
#
if ! kldstat -q -m mfi_linux
then
	if kldload mfi_linux
	then
		echo 'mfi_linux module loaded.'
	else
		echo 'mfi_linux module failed to load.'
		exit 1
	fi
fi

exec %%PREFIX%%/libexec/MegaCli ${*}
