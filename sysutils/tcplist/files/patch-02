--- tcplist.c.orig	Tue Apr 15 00:28:29 1997
+++ tcplist.c	Tue Apr 15 00:31:40 1997
@@ -37,6 +37,10 @@
 #include <arpa/inet.h>
 #include <netdb.h>
 
+#if ((defined(__unix__) || defined(unix)) && !defined(USG))
+#include <sys/param.h>
+#endif
+
 #include "utils.h"		
 #include "tcplist.h"
 
@@ -346,10 +350,14 @@
 
 	if(verbose) printf("Connecting to remote hosts.\n");
 
+#if (defined(BSD) && (BSD >= 199103))
+	maxfd=getdtablesize();	/* could also use getrlimit(2) here... */
+#else
 	if(0>(maxfd=ulimit(4,0l))){
 		perror("ulimit");
 		exit(2);
 	}
+#endif
 	
 	/* waltz through the connections in the hostlist, setting idents  */
 	/* to NULL */
