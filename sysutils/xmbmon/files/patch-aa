--- Makefile.in.orig	Fri Aug 13 16:04:21 2004
+++ Makefile.in	Fri Sep 17 05:34:33 2004
@@ -26,8 +26,8 @@
 LIBSX=$(LIBS) @X_LIBS@ -lXt @X_PRE_LIBS@ -lX11 @X_EXTRA_LIBS@
 
 #CC=/compat/linux/usr/bin/gcc
-CC=@CC@
-CFLAGS=-O3 $(INCLUDES) $(DEFS)
+CC?=@CC@
+CFLAGS+=$(INCLUDES) $(DEFS)
 CFLAGSX=$(CFLAGS) @X_CFLAGS@
 LDFLAGS=-s
 
@@ -37,19 +37,25 @@
 RM=rm -f
 INSTALL=install
 
-INST_DIR=/usr/local/bin
-INST_MANDIR=/usr/local/man/man1
-INST_XDIR=/usr/X11R6/bin
-INST_MANXDIR=/usr/X11R6/man/man1
-INST_XRDIR=/usr/X11R6/lib/X11/app-defaults
+INST_DIR=$(PREFIX)/bin
+INST_MANDIR=$(PREFIX)/man/man1
+INST_XDIR=$(X11BASE)/bin
+INST_MANXDIR=$(X11BASE)/man/man1
+INST_XRDIR=$(X11BASE)/lib/X11/app-defaults
  
 .c.o:
 	$(CC) -c $(CFLAGS) $*.c
 
 MANPAGE = mbmon.1 xmbmon.1x
-PROGRAM = mbmon xmbmon
-
+PROGRAM = mbmon
 TESTPROG = testpci testsmb testhwm testfan
+DOCS= ReadMe ReadMe.jp ReadMe.tech
+.if !defined(WITHOUT_X11)
+DOCS+=	xmbmon.resources
+PROGRAM+= xmbmon
+.endif
+
+all: $(PROGRAM) $(TESTPROG)
 
 MB_OBJ  = getMB-via.o getMB-smb.o getMB-isa.o
 SMB_OBJ = smbuses.o smbus_piix4.o smbus_amd.o smbus_ali.o smbus_amd8.o
@@ -133,12 +139,18 @@
 	$(RM) Makefile config.cache config.log config.h config.status
 
 install: $(PROGRAM)
-	$(INSTALL) -o root -g wheel -m 4555 -c -p mbmon $(INST_DIR)
-	$(INSTALL) -o root -g wheel -m 4555 -c -p xmbmon $(INST_XDIR)
+	@for i in $(PROGRAM); do \
+		$(INSTALL) -o root -g wheel -m 4555 -c -p $$i $(INST_DIR); \
+	done
 
 install-man: $(MANPAGE)
 	$(INSTALL) -o root -g wheel -m 444 -c -p mbmon.1 $(INST_MANDIR)
-	$(INSTALL) -o root -g wheel -m 444 -c -p xmbmon.1x $(INST_MANXDIR)
+
+install-doc:
+	@for f in $(DOCS); do \
+		$(INSTALL_DATA) $$f $(DOCSDIR)/; \
+	done
+	$(INSTALL) -o root -g wheel -m 444 -c -p xmbmon.1x $(INST_MANDIR)
 
 lint:
 	$(LINT) $(INCLUDES) $(DEFS) $(FONTDEFINES) $(SRCS) -lm
