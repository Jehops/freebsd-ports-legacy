--- Makefile.in.orig	Thu Aug 22 14:03:21 2002
+++ Makefile.in	Fri Nov 22 22:14:39 2002
@@ -13,9 +13,9 @@
 
 DEFS=-DHAVE_CONFIG_H -Wall
 
-LIBDIR=/usr/X11R6/lib
+LIBDIR=$(X11BASE)/lib
 INCDIR=.
-XINCDIR=/usr/X11R6/include
+XINCDIR=$(X11BASE)/include
 XLIB=-lXaw -lXmu
 EXTENSIONLIB=-lXext
 INCLUDES=-I$(INCDIR)
@@ -23,9 +23,9 @@
 LIBS=-L$(LIBDIR) -lXaw $(XLIB) -lXt $(EXTENSIONLIB) -lX11 -lm
 
 #CC=/compat/linux/usr/bin/gcc
-CC=gcc
-CFLAGS=-O3 $(INCLUDES) $(DEFS)
-CFLAGSX=-O3 $(XINCLUDES) $(DEFS)
+CC?=gcc
+CFLAGS+= $(INCLUDES) $(DEFS)
+CFLAGSX= $(XINCLUDES) $(CFLAGS)
 LDFLAGS=-s
 
 LINT=lint
@@ -34,16 +34,22 @@
 RM=rm -f
 INSTALL=install
 
-INST_DIR=/usr/local/bin
-INST_XDIR=/usr/X11R6/bin
-INST_XRDIR=/usr/X11R6/lib/X11/app-defaults
+INST_DIR=$(PREFIX)/bin
+INST_XDIR=$(PREFIX)/bin
+INST_XRDIR=$(X11BASE)/lib/X11/app-defaults
  
 .c.o:
 	$(CC) -c $(CFLAGS) $*.c
 
-PROGRAM = mbmon xmbmon
-
+PROGRAM = mbmon
 TESTPROG = testpci testsmb testhwm testfan
+DOCS=	00README.txt 00READMEj.txt 00READMEtech.txt
+.if !defined(WITHOUT_X11)
+DOCS+=	xmbmon.resources
+PROGRAM+= xmbmon
+.endif
+  
+all: $(PROGRAM) $(TESTPROG)
 
 MB_OBJ  = getMB-via.o getMB-smb.o getMB-isa.o
 SMB_OBJ = smbus_piix4.o smbus_amd.o smbus_ali.o
@@ -115,8 +121,14 @@
 	$(RM) Makefile config.cache config.log config.h config.status
 
 install: $(PROGRAM)
-	$(INSTALL) -o root -g wheel -m 4555 -c -p mbmon $(INST_DIR)
-	$(INSTALL) -o root -g wheel -m 4555 -c -p xmbmon $(INST_XDIR)
+	@for i in $(PROGRAM); do \
+		$(INSTALL) -o root -g wheel -m 4555 -c -p $$i $(INST_DIR); \
+	done
 
 lint:
 	$(LINT) $(INCLUDES) $(DEFS) $(FONTDEFINES) $(SRCS) -lm
+
+install-doc:
+	@for f in $(DOCS); do \
+		$(INSTALL_DATA) $$f $(DOCSDIR)/; \
+	done
