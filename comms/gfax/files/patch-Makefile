--- Makefile.orig	Wed Jun 30 18:27:25 2004
+++ Makefile	Sat Jan  8 18:54:20 2005
@@ -1,4 +1,3 @@
-export MONO_PATH=/usr/lib/mono:/usr/lib/mono/gtk-sharp
 
 MCS = mcs /define:DEBUG
 #MCS = mcs /define:DEBUGHYLAFAX
@@ -11,9 +10,7 @@
 		/resource:./pixmaps/gfax.png,gfax.png \
 		/resource:./pixmaps/send.png,send.png 
 
-			
-REFERENCES = -r gnome-sharp -r gtk-sharp -r glib-sharp -r glade-sharp -r gdk-sharp \
-			 -r gconf-sharp -r gconf-sharp-peditors.dll
+REFERENCES = $(shell pkg-config --libs gnome-sharp glade-sharp gconf-sharp)
 SOURCES = 	src/phonebook.cs \
 			src/gui.cs \
 			src/main.cs \
@@ -22,7 +19,7 @@
 			src/fax.cs \
 			src/hylafax.cs \
 			src/Settings.cs
-			
+
 DATE=`date +%y-%m-%d`
 
 all: mono-gfax.exe
@@ -31,37 +28,43 @@
 	$(MCS) $(RESOURCES) -o $@ $(SOURCES) $(REFERENCES)
 
 schema:
-	env GCONF_CONFIG_SOURCE="" gconftool-2 --makefile-install-rule $(SCHEMA)
+	${SETENV} GCONF_CONFIG_SOURCE="xml::${PREFIX}/etc/gconf/gconf.xml.defaults" gconftool-2 --makefile-install-rule $(SCHEMA)
 	gconfsharp-schemagen gfax $(SCHEMA) > ./src/Settings.cs
 
 tar:
 	cd ..; tar cvzf mg.$(DATE).tar.gz mono-gfax
-	
+
 install: mono-gfax.exe
-	mkdir -p $(prefix)/bin
-	mkdir -p /usr/share/gfax
-	mkdir -p /var/spool/gfax
-	chmod 777 /var/spool/gfax
-	$(INSTALL) -m 755 mono-gfax.exe /usr/bin/mono-gfax.exe
-	$(INSTALL) -m 755 gfax /usr/bin/gfax
-	$(INSTALL) -m 755 gfaxlpr /usr/bin/gfaxlpr
-	$(INSTALL) -m 755 pixmaps/gfax.png /usr/share/pixmaps/
-	$(INSTALL) -m 755 data/gfax.desktop /usr/share/applications/
-	$(INSTALL) -m 755 data/fax-g3.profile /usr/share/gfax/
-	$(INSTALL) -m 755 data/GFAX.xml /usr/share/gfax/
-	$(INSTALL) -m 755 data/GNOME-GFAX-PS.xml /usr/share/gfax/
-	$(INSTALL) -m 755 scripts/printer-setup.sh /usr/share/gfax/
-	env GCONF_CONFIG_SOURCE="" gconftool-2 --makefile-install-rule $(SCHEMA)
-	./scripts/printer-setup.sh --install
+	${MKDIR} ${PREFIX}/bin
+	${MKDIR} ${PREFIX}/share/gnome/pixmaps
+	${MKDIR} ${PREFIX}/share/gnome/applications
+	${MKDIR} ${PREFIX}/share/gnome/gfax
+	${MKDIR} ${PREFIX}/etc/gconf/schemas
+	${MKDIR} ${PREFIX}/etc/gconf/gconf.xml.defaults
+	${MKDIR} /var/spool/gfax
+	${CHMOD} 777 /var/spool/gfax
+	${BSD_INSTALL_SCRIPT} mono-gfax.exe ${PREFIX}/bin/mono-gfax.exe
+	${BSD_INSTALL_SCRIPT} gfax ${PREFIX}/bin/gfax
+	${BSD_INSTALL_SCRIPT} gfaxlpr ${PREFIX}/bin/gfaxlpr
+	${BSD_INSTALL_DATA} pixmaps/gfax.png ${PREFIX}/share/gnome/pixmaps/
+	${BSD_INSTALL_DATA} data/gfax.desktop ${PREFIX}/share/gnome/applications/
+	${BSD_INSTALL_DATA} data/fax-g3.profile ${PREFIX}/share/gnome/gfax/
+	${BSD_INSTALL_DATA} data/GFAX.xml ${PREFIX}/share/gnome/gfax/
+	${BSD_INSTALL_DATA} data/GNOME-GFAX-PS.xml ${PREFIX}/share/gnome/gfax/
+	${BSD_INSTALL_SCRIPT} scripts/printer-setup.sh ${PREFIX}/share/gnome/gfax/
+	${BSD_INSTALL_DATA} $(SCHEMA) ${PREFIX}/etc/gconf/schemas/gfax.schema
+	${SETENV} GCONF_CONFIG_SOURCE="xml::${PREFIX}/etc/gconf/gconf.xml.defaults" gconftool-2 --makefile-install-rule ${PREFIX}/etc/gconf/schemas/gfax.schema
+	${SH} ${PREFIX}/share/gnome/gfax/printer-setup.sh --install
 
 uninstall:
-	rm -f /usr/bin/mono-gfax.exe
-	rm -f /usr/bin/gfax
-	rm -f /usr/bin/gfaxlpr
-	rm -f /usr/share/pixmaps/gfax.png
-	rm -f /usr/share/applications/gfax.desktop
-	/usr/share/gfax/printer-setup.sh --remove
-	rm -rf /usr/share/gfax
-	
+	${RM} -f ${PREFIX}/bin/mono-gfax.exe
+	${RM} -f ${PREFIX}/bin/gfax
+	${RM} -f ${PREFIX}/bin/gfaxlpr
+	${RM} -f ${PREFIX}/share/gnome/pixmaps/gfax.png
+	${RM} -f ${PREFIX}/share/gnome/applications/gfax.desktop
+	${SETENV} GCONF_CONFIG_SOURCE="xml::${PREFIX}/etc/gconf/gconf.xml.defaults" gconftool-2 --makefile-uninstall-rule ${PREFIX}/etc/gconf/schemas/gfax.schema
+	${SH} ${PREFIX}/share/gnome/gfax/printer-setup.sh --remove
+	${RM} -rf ${PREFIX}/share/gnome/gfax
+
 clean:
-	-rm *.exe
+	-${RM} -f *.exe
