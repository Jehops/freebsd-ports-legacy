From 4ab7023f615686f61d804bd5a90f5bb68b1b4fdc Mon Sep 17 00:00:00 2001
From: =?utf-8?q?Michal=20=C4=8Ciha=C5=99?= <mcihar@novell.com>
Date: Fri, 28 Jan 2011 14:52:09 +0100
Subject: [PATCH] Improve searching for glib/gobject.

---
 cmake/FindGlib.cmake    |   36 +++++++++++++++++++++++++++++++-----
 cmake/FindGobject.cmake |   34 +++++++++++++++++++++++++++-------
 2 files changed, 58 insertions(+), 12 deletions(-)

diff --git a/cmake/FindGlib.cmake b/cmake/FindGlib.cmake
index 1a75a93..9bdee14 100644
--- cmake/FindGlib.cmake
+++ cmake/FindGlib.cmake
@@ -1,7 +1,24 @@
-pkg_check_modules(GLIB glib-2.0)
+pkg_check_modules(GLIB_PKG glib-2.0)
 
-# Find Glib even if pkg-config is not working (eg. cross compiling to Windows)
-if (NOT GLIB_FOUND)
+if (GLIB_PKG_FOUND)
+    find_path(GLIB_INCLUDE_DIR  NAMES glib.h PATH_SUFFIXES glib-2.0
+       PATHS
+       ${GLIB_PKG_INCLUDE_DIRS}
+       /usr/include/glib-2.0
+       /usr/include
+       /usr/local/include
+    )
+    find_path(GLIB_CONFIG_INCLUDE_DIR NAMES glibconfig.h PATHS ${GLIB_PKG_LIBDIR} PATH_SUFFIXES glib-2.0/include)
+
+    find_library(GLIB_LIBRARIES NAMES glib-2.0
+       PATHS
+       ${GLIB_PKG_LIBRARY_DIRS}
+       /usr/lib
+       /usr/local/lib
+    )
+
+else (GLIB_PKG_FOUND)
+    # Find Glib even if pkg-config is not working (eg. cross compiling to Windows)
     find_library(GLIB_LIBRARIES NAMES glib-2.0)
     string (REGEX REPLACE "/[^/]*$" "" GLIB_LIBRARIES_DIR ${GLIB_LIBRARIES})
 
@@ -9,7 +26,16 @@ if (NOT GLIB_FOUND)
     find_path(GLIB_CONFIG_INCLUDE_DIR NAMES glibconfig.h PATHS ${GLIB_LIBRARIES_DIR} PATH_SUFFIXES glib-2.0/include)
 
     if (GLIB_INCLUDE_DIR AND GLIB_CONFIG_INCLUDE_DIR AND GLIB_LIBRARIES)
-        set(GLIB_FOUND TRUE)
         set(GLIB_INCLUDE_DIRS ${GLIB_INCLUDE_DIR} ${GLIB_CONFIG_INCLUDE_DIR})
     endif (GLIB_INCLUDE_DIR AND GLIB_CONFIG_INCLUDE_DIR AND GLIB_LIBRARIES)
-endif (NOT GLIB_FOUND)
+endif (GLIB_PKG_FOUND)
+
+if(GLIB_INCLUDE_DIR AND GLIB_LIBRARIES)
+   set(GLIB_FOUND TRUE CACHE INTERNAL "glib-2.0 found")
+   message(STATUS "Found glib-2.0: ${GLIB_INCLUDE_DIR}, ${GLIB_LIBRARIES}")
+else(GLIB_INCLUDE_DIR AND GLIB_LIBRARIES)
+   set(GLIB_FOUND FALSE CACHE INTERNAL "glib-2.0 found")
+   message(STATUS "glib-2.0 not found.")
+endif(GLIB_INCLUDE_DIR AND GLIB_LIBRARIES)
+
+mark_as_advanced(GLIB_INCLUDE_DIR GLIB_LIBRARIES)
diff --git a/cmake/FindGobject.cmake b/cmake/FindGobject.cmake
index 5312be7..586c8a2 100644
--- cmake/FindGobject.cmake
+++ cmake/FindGobject.cmake
@@ -1,12 +1,32 @@
-pkg_check_modules(GOBJECT gobject-2.0)
+pkg_check_modules(GOBJECT_PKG gobject-2.0)
 
-# Find Gobject even if pkg-config is not working (eg. cross compiling to Windows)
-if (NOT GOBJECT_FOUND)
+if (GOBJECT_PKG_FOUND)
+    find_path(GOBJECT_INCLUDE_DIR  NAMES glib-object.h PATH_SUFFIXES glib-2.0
+       PATHS
+       ${GOBJECT_PKG_INCLUDE_DIRS}
+       /usr/include/glib-2.0
+       /usr/include
+       /usr/local/include
+    )
+    find_library(GOBJECT_LIBRARIES NAMES gobject-2.0
+       PATHS
+       ${GOBJECT_PKG_LIBRARY_DIRS}
+       /usr/lib
+       /usr/local/lib
+    )
+else (GOBJECT_PKG_FOUND)
+    # Find Gobject even if pkg-config is not working (eg. cross compiling to Windows)
     find_path(GOBJECT_INCLUDE_DIRS NAMES glib-object.h PATH_SUFFIXES glib-2.0)
 
     find_library(GOBJECT_LIBRARIES NAMES gobject-2.0)
-    if (GOBJECT_INCLUDE_DIRS AND GOBJECT_LIBRARIES)
-        set(GOBJECT_FOUND TRUE)
-    endif (GOBJECT_INCLUDE_DIRS AND GOBJECT_LIBRARIES)
-endif (NOT GOBJECT_FOUND)
+endif (GOBJECT_PKG_FOUND)
 
+if(GOBJECT_INCLUDE_DIR AND GOBJECT_LIBRARIES)
+   set(GOBJECT_FOUND TRUE CACHE INTERNAL "gobject-2.0 found")
+   message(STATUS "Found gobject-2.0: ${GOBJECT_INCLUDE_DIR}, ${GOBJECT_LIBRARIES}")
+else(GOBJECT_INCLUDE_DIR AND GOBJECT_LIBRARIES)
+   set(GOBJECT_FOUND FALSE CACHE INTERNAL "gobject-2.0 found")
+   message(STATUS "gobject-2.0 not found.")
+endif(GOBJECT_INCLUDE_DIR AND GOBJECT_LIBRARIES)
+
+mark_as_advanced(GOBJECT_INCLUDE_DIR GOBJECT_LIBRARIES)
-- 
1.6.1

