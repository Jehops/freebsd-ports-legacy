--- ../berkeleydb/db-3.2.9.patch.orig	Sun Jan 19 14:58:19 2003
+++ ../berkeleydb/db-3.2.9.patch	Sun Jan 19 15:00:02 2003
@@ -51,7 +51,7 @@
   	   CPPFLAGS="-D_REENTRANT $CPPFLAGS";;
   mpeix*)	   CPPFLAGS="-D_POSIX_SOURCE -D_SOCKET_SOURCE $CPPFLAGS"
   	   LIBS="-lsocket -lsvipc $LIBS";;
-+ netbsd*)   optimize_def="-O2";;
++ netbsd*)   optimize_def="-O";;
   osf*)	   CPPFLAGS="-D_REENTRANT $CPPFLAGS";;
   *qnx)	   cat >> confdefs.h <<\EOF
   #define HAVE_QNX 1
@@ -62,54 +62,57 @@
   	solaris*)	JINCSUBDIRS="solaris";;
   	linux*)		JINCSUBDIRS="linux genunix";;
 + 	irix*)		JINCSUBDIRS="irix";;
-+ netbsd*)	JINCSUBDIRS="netbsd linux solaris genunix";;
++	freebsd*)	JINCSUBDIRS="freebsd linux solaris genunix";;
   	*)		JINCSUBDIRS="genunix";;
   	esac
   
 *** misc/db-3.2.9/dist/ltconfig	Fri Oct 13 16:23:00 2000
 --- misc/build/db-3.2.9/dist/ltconfig	Tue Jan  7 11:37:05 2003
-***************
-*** 1194,1204 ****
-  
-    netbsd*)
-      if echo __ELF__ | $CC -E - | grep __ELF__ >/dev/null; then
--       archive_cmds='$CC -shared $libobjs $deplibs $linkopts ${wl}-soname $wl$soname -o $lib'
--       archive_expsym_cmds='$CC -shared $libobjs $deplibs $linkopts ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
--     else
-        archive_cmds='$LD -Bshareable $libobjs $deplibs $linkopts -o $lib'
-        # can we support soname and/or expsyms with a.out? -oliva
-      fi
-      ;;
-  
---- 1194,1205 ----
-  
-    netbsd*)
-      if echo __ELF__ | $CC -E - | grep __ELF__ >/dev/null; then
-        archive_cmds='$LD -Bshareable $libobjs $deplibs $linkopts -o $lib'
-        # can we support soname and/or expsyms with a.out? -oliva
-+     else
-+       archive_cmds='$CC -shared $libobjs $deplibs $linkopts ${wl}-soname $wl$soname -o $lib'
-+       archive_expsym_cmds='$CC -shared $libobjs $deplibs $linkopts ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
-+       need_version=no
-      fi
-      ;;
-  
-*** misc/db-3.2.9/dist/ltconfig	Fri Oct 13 16:23:00 2000
---- misc/build/db-3.2.9/dist/ltconfig	Tue Jan  7 11:37:05 2003
-***************
-*** 1955,1961 ****
-    version_type=irix
-    need_lib_prefix=no
-    need_version=no
-!   soname_spec='${libname}${release}.so.$major'
-    library_names_spec='${libname}${release}.so.$versuffix ${libname}${release}.so.$major ${libname}${release}.so $libname.so'
-    case "$host_os" in
-    irix5*)
---- 1955,1961 ----
-    version_type=irix
-    need_lib_prefix=no
-    need_version=no
-!   soname_spec='${libname}${release}.so'
-    library_names_spec='${libname}${release}.so.$versuffix ${libname}${release}.so.$major ${libname}${release}.so $libname.so'
-    case "$host_os" in
-    irix5*)
+@@ -1202,6 +1202,17 @@
+     fi
+     ;;
+ 
++  freebsd*)
++    if echo __ELF__ | $CC -E - | grep __ELF__ >/dev/null; then
++      archive_cmds='$LD -Bshareable $libobjs $deplibs $linkopts -o $lib'
++      # can we support soname and/or expsyms with a.out? -oliva
++    else
++      archive_cmds='$CC -shared $libobjs $deplibs $linkopts ${wl}-soname $wl$soname -o $lib'
++      archive_expsym_cmds='$CC -shared $libobjs $deplibs $linkopts ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
++      need_version=no
++    fi
++    ;;
++
+   solaris* | sysv5*)
+     if $LD -v 2>&1 | egrep 'BFD 2\.8' > /dev/null; then
+       ld_shlibs=no
+@@ -1955,7 +1966,7 @@
+   version_type=irix
+   need_lib_prefix=no
+   need_version=no
+-  soname_spec='${libname}${release}.so.$major'
++  soname_spec='${libname}${release}.so'
+   library_names_spec='${libname}${release}.so.$versuffix ${libname}${release}.so.$major ${libname}${release}.so $libname.so'
+   case "$host_os" in
+   irix5*)
+@@ -2019,6 +2030,20 @@
+     library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so$major ${libname}${release}.so ${libname}.so'
+     soname_spec='${libname}${release}.so$major'
+     dynamic_linker='NetBSD ld.elf_so'
++  fi
++  shlibpath_var=LD_LIBRARY_PATH
++  ;;
++
++freebsd*)
++  version_type=sunos
++  if echo __ELF__ | $CC -E - | grep __ELF__ >/dev/null; then
++    library_names_spec='${libname}${release}.so$versuffix ${libname}.so$versuffix'
++    finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
++    dynamic_linker='FreeBSD (a.out) ld.so'
++  else
++    library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so$major ${libname}${release}.so ${libname}.so'
++    soname_spec='${libname}${release}.so$major'
++    dynamic_linker='FreeBSD ld.elf_so'
+   fi
+   shlibpath_var=LD_LIBRARY_PATH
+   ;;
