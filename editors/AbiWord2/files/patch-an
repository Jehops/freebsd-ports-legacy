
$FreeBSD$

--- src/Makefile.orig	Mon Jun  7 00:15:08 2004
+++ src/Makefile	Mon Jun  7 00:51:56 2004
@@ -52,6 +52,7 @@
 
 ## Set the following to a list of pathnames to be copied to $(CANONDIR)
 CANON_TOPLEVELFILES=	$(ABI_ROOT)/COPYING $(ABI_ROOT)/user/wp/readme.txt
+CANON_TLF_NOTDIR=	$(notdir $(CANON_TOPLEVELFILES))
 
 ## Set the following to a list of directories (probably a subset of DIRS)
 ## that have work to do.
@@ -62,6 +63,9 @@
 	@for k in $(CANON_TOPLEVELFILES); do			\
 		$(ABICOPY) $$k $(CANONDIR);			\
 	done
+	@for k in $(CANON_TLF_NOTDIR); do			\
+		$(ABICHMOD) ugo=r $(CANONDIR)/$$k;		\
+	done
 	@for k in $(CANON_SubDirs); do				\
 		$(MAKE) ABI_ROOT=$(ABI_ROOT) -C $$k canonical;	\
 	done
@@ -73,9 +77,10 @@
 	@$(ABICOPY) $(ABI_ROOT)/../abidistfiles/dictionary/$(OS_ENDIAN).*.hash $(CANONDIR)/dictionary
 	@(cd $(CANONDIR)/dictionary; 				\
 		for k in *.hash; do				\
-			cp $$k american.hash;		\
-			rm $$k ;			\
+			$(ABICOPY) $$k american.hash;		\
+			$(ABIRM) $$k ;				\
 		done)
+	@(cd $(CANONDIR)/dictionary; $(ABICHMOD) ugo=r *)
 # We currently only ship american.hash, so the above and below aren't logical.
 	@$(ABICOPY) $(ABI_ROOT)/../abidistfiles/dictionary/*.xml $(CANONDIR)/dictionary	
 endif
@@ -115,10 +120,12 @@
 	fi
 # icons for X window manager use
 	@$(subst xxxx,$(CANONDIR)/icons,$(VERIFY_DIRECTORY))
-	(cd $(ABI_ROOT)/../abidistfiles/icons; cp abi* $(CANONDIR)/icons)
+	(cd $(ABI_ROOT)/../abidistfiles/icons; $(ABICOPY) abi* $(CANONDIR)/icons)
+	@(cd $(CANONDIR)/icons; $(ABICHMOD) ugo=r abi*)
 # font stuff for installation
 	@$(subst xxxx,$(CANONDIR)/fonts,$(VERIFY_DIRECTORY))
-	(cd $(ABI_ROOT)/../unixfonts/fonts ; cp *.* $(CANONDIR)/fonts)
+	(cd $(ABI_ROOT)/../unixfonts/fonts ; $(ABICOPY) *.* $(CANONDIR)/fonts)
+	@(cd $(CANONDIR)/fonts; $(ABICHMOD) ugo=r *.*)
 endif
 
 ##################################################################
