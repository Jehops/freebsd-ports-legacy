--- ../nas/nas-1.6.patch.orig	Tue Mar 11 15:04:35 2003
+++ ../nas/nas-1.6.patch	Tue Mar 11 15:29:52 2003
@@ -69,3 +69,298 @@
   number		: NUMBER		{ $$ = $1; }
   		;
 
+--- misc/nas-1.6/clients/audio/auctl/auctl.c	Tue Mar 11 14:56:14 2003
++++ misc/build/nas-1.6/clients/audio/auctl/auctl.c	Tue Mar 11 15:01:04 2003
+@@ -23,7 +23,7 @@
+  */
+ 
+ #include <stdio.h>
+-#include <malloc.h>
++#include <stdlib.h>
+ #include "auctl.h"
+ 
+ char *ProgramName;
+--- misc/nas-1.6/clients/audio/audemo/audemo.c	Tue Mar 11 14:56:14 2003
++++ misc/build/nas-1.6/clients/audio/audemo/audemo.c	Tue Mar 11 15:01:04 2003
+@@ -32,7 +32,7 @@
+ #include <stdlib.h>
+ #endif
+ #include <signal.h>
+-#include <malloc.h>
++#include <stdlib.h>
+ 
+ #if !defined(SYSV) || defined(WIN32)
+ #include <audio/Aos.h>		/* for string and other os stuff */
+--- misc/nas-1.6/clients/audio/audial/audial.c	Tue Mar 11 14:56:14 2003
++++ misc/build/nas-1.6/clients/audio/audial/audial.c	Tue Mar 11 15:01:04 2003
+@@ -32,7 +32,7 @@
+ #if !defined(ISC40) && !defined(WIN32)
+ #include <sys/file.h>
+ #endif /* !ISC40 */
+-#include <malloc.h>
++#include <stdlib.h>
+ 
+ #include <audio/Aos.h>			/* for string and other os stuff */
+ #include <audio/Afuncs.h> 		/* for bcopy et. al. */
+--- misc/nas-1.6/clients/audio/auedit/auedit.c	Tue Mar 11 14:56:14 2003
++++ misc/build/nas-1.6/clients/audio/auedit/auedit.c	Tue Mar 11 15:01:04 2003
+@@ -37,7 +37,7 @@
+ #define access _access
+ #define R_OK 4
+ #endif /* WIN32 */
+-#include <malloc.h>
++#include <stdlib.h>
+ #include <limits.h>				/* for SHRT_MIN and SHRT_MAX */
+ #ifndef SYSV
+ #include <audio/Aos.h>				/* for string and other os
+--- misc/nas-1.6/clients/audio/autool/audiotool.c	Tue Mar 11 14:56:16 2003
++++ misc/build/nas-1.6/clients/audio/autool/audiotool.c	Tue Mar 11 15:01:04 2003
+@@ -28,7 +28,7 @@
+  */
+ 
+ #include	<stdio.h>
+-#include	<malloc.h>
++#include	<stdlib.h>
+ #include	<audio/audiolib.h>
+ #include	<audio/soundlib.h>
+ 
+--- misc/nas-1.6/clients/audio/util/soundtoh.c	Tue Mar 11 14:56:15 2003
++++ misc/build/nas-1.6/clients/audio/util/soundtoh.c	Tue Mar 11 15:01:04 2003
+@@ -27,7 +27,7 @@
+  */
+ 
+ #include <stdio.h>
+-#include <malloc.h>
++#include <stdlib.h>
+ #include <audio/Aos.h>			/* for string and other os stuff */
+ #include <audio/Afuncs.h> 		/* for bcopy et. al. */
+ #include <audio/audiolib.h>
+--- misc/nas-1.6/lib/audio/8svx.c	Tue Mar 11 14:56:13 2003
++++ misc/build/nas-1.6/lib/audio/8svx.c	Tue Mar 11 15:01:04 2003
+@@ -23,7 +23,7 @@
+  */
+ 
+ #include <stdio.h>
+-#include <malloc.h>
++#include <stdlib.h>
+ #include <audio/Aos.h>
+ #include <math.h>
+ #include <audio/8svx.h>
+--- misc/nas-1.6/lib/audio/aiff.c	Tue Mar 11 14:56:13 2003
++++ misc/build/nas-1.6/lib/audio/aiff.c	Tue Mar 11 15:01:04 2003
+@@ -23,7 +23,7 @@
+  */
+ 
+ #include <stdio.h>
+-#include <malloc.h>
++#include <stdlib.h>
+ #include <audio/Aos.h>
+ #include <math.h>
+ #include <audio/aiff.h>
+--- misc/nas-1.6/lib/audio/fileutil.c	Tue Mar 11 14:56:13 2003
++++ misc/build/nas-1.6/lib/audio/fileutil.c	Tue Mar 11 15:01:04 2003
+@@ -29,7 +29,7 @@
+ #include	<stdio.h>
+ #include	<audio/Aos.h>
+ #include	<audio/fileutil.h>
+-#include	<malloc.h>
++#include	<stdlib.h>
+ 
+ #if NeedFunctionPrototypes
+ unsigned short FileSwapS (unsigned short us)
+--- misc/nas-1.6/lib/audio/snd.c	Tue Mar 11 14:56:13 2003
++++ misc/build/nas-1.6/lib/audio/snd.c	Tue Mar 11 15:01:04 2003
+@@ -23,7 +23,7 @@
+  */
+ 
+ #include <stdio.h>
+-#include <malloc.h>
++#include <stdlib.h>
+ #include <audio/Aos.h>
+ #include <audio/snd.h>
+ #include <audio/fileutil.h>
+--- misc/nas-1.6/lib/audio/sound.c	Tue Mar 11 14:56:13 2003
++++ misc/build/nas-1.6/lib/audio/sound.c	Tue Mar 11 15:01:04 2003
+@@ -29,7 +29,7 @@
+ #define _SOUND_C_
+ 
+ #include	<stdio.h>
+-#include 	<malloc.h>
++#include 	<stdlib.h>
+ #include	<audio/Aos.h>
+ #include	<audio/audio.h>
+ #include	<audio/sound.h>
+--- misc/nas-1.6/lib/audio/voc.c	Tue Mar 11 14:56:13 2003
++++ misc/build/nas-1.6/lib/audio/voc.c	Tue Mar 11 15:01:04 2003
+@@ -23,7 +23,7 @@
+  */
+ 
+ #include	<stdio.h>
+-#include 	<malloc.h>
++#include 	<stdlib.h>
+ #include	<audio/Aos.h>
+ #include	<audio/voc.h>
+ #include	<audio/fileutil.h>
+--- misc/nas-1.6/lib/audio/wave.c	Tue Mar 11 14:56:13 2003
++++ misc/build/nas-1.6/lib/audio/wave.c	Tue Mar 11 15:01:04 2003
+@@ -27,7 +27,7 @@
+  */
+ 
+ #include	<stdio.h>
+-#include 	<malloc.h>
++#include 	<stdlib.h>
+ #include	<audio/Aos.h>
+ #include	<audio/wave.h>
+ #include	<audio/fileutil.h>
+--- misc/nas-1.6/server/os/utils.c	Tue Mar 11 14:56:13 2003
++++ misc/build/nas-1.6/server/os/utils.c	Tue Mar 11 15:01:04 2003
+@@ -454,7 +454,7 @@
+ }
+ 
+ #ifdef CAHILL_MALLOC
+-#include <malloc.h>
++#include <stdlib.h>
+ 
+ void * 
+ debug_Xalloc (char *file, int line, unsigned long amount)
+--- misc/nas-1.6/clients/audio/audial/audial.c	Tue Mar 11 15:19:40 2003
++++ misc/build/nas-1.6/clients/audio/audial/audial.c	Tue Mar 11 15:20:51 2003
+@@ -84,6 +84,7 @@
+  */
+ static void
+ usleep(usecs)
++#if !defined(__FreeBSD__) || (__FreeBSD__ < 3)
+ unsigned int    usecs;
+ {
+     double          s1;
+@@ -150,6 +151,7 @@
+     pause();
+ }
+ 
++#endif
+ #endif						/* SYSV else not */
+ #endif						/* VMS else not */
+ #endif						/* NEEDUSLEEP */
+--- misc/nas-1.6/clients/audio/auedit/Graph.c	Tue Mar 11 15:19:40 2003
++++ misc/build/nas-1.6/clients/audio/auedit/Graph.c	Tue Mar 11 15:25:21 2003
+@@ -28,7 +28,7 @@
+  */
+ 
+ #ifndef WIN32
+-# ifdef __NetBSD__
++# if defined(__NetBSD__) || defined(__FreeBSD__)
+ #  include <limits.h>
+ #  define MAXSHORT SHRT_MAX
+ #  define MINSHORT SHRT_MIN
+--- misc/nas-1.6/config/NetAudio.def	Tue Mar 11 15:19:40 2003
++++ misc/build/nas-1.6/config/NetAudio.def	Tue Mar 11 15:26:55 2003
+@@ -8,6 +8,6 @@
+ 
+ XCOMM Directory where NAS will look for it's config file(s)
+ #ifndef NasConfigSearchPath
+-#define NasConfigSearchPath /etc/nas/
++#define NasConfigSearchPath $(PROJECTROOT)/etc/
+ #endif
+ 
+--- misc/nas-1.6/lib/audio/Imakefile	Tue Mar 11 15:19:38 2003
++++ misc/build/nas-1.6/lib/audio/Imakefile	Tue Mar 11 15:26:26 2003
+@@ -36,6 +36,10 @@
+ #endif
+ #endif /* ProjectX < 5 */
+ 
++#if HasBSD44Sockets
++    SOCK_DEFINES = -DBSD44SOCKETS
++#endif
++
+ #ifndef NormalLibAudio
+ #define NormalLibAudio NormalLibX
+ #endif
+@@ -79,7 +83,7 @@
+      EDB_DEFINES = -DERRORDB=\"$(LIBDIR)/AuErrorDB\"
+ 
+         DEFINES = $(MALLOC_DEFINES) $(SYSV_DEFINES)
+-   CONN_DEFINES = ConnectionFlags
++   CONN_DEFINES = ConnectionFlags $(SOCK_DEFINES)
+ 
+ HEADERS = Alibint.h Alibnet.h Xtutil.h audiolib.h audioutil.h snd.h wave.h    \
+           voc.h aiff.h sound.h soundlib.h fileutil.h 8svx.h Astreams.h \
+--- misc/nas-1.6/server/Imakefile	Tue Mar 11 15:19:40 2003
++++ misc/build/nas-1.6/server/Imakefile	Tue Mar 11 15:27:38 2003
+@@ -105,6 +105,9 @@
+ # if defined(LinuxArchitecture)
+     RCMANDIR = $(FILEMANDIR)
+     RCMANSUFFIX = 5nas
++# elif defined(FreeBSDArchitecture)
++    RCMANDIR = $(FILEMANDIR)
++    RCMANSUFFIX = $(FILEMANSUFFIX)
+ # else
+     RCMANDIR = $(MANDIR)
+     RCMANSUFFIX = 5x
+--- misc/nas-1.6/server/dda/voxware/auvoxware.c	Tue Mar 11 15:19:39 2003
++++ misc/build/nas-1.6/server/dda/voxware/auvoxware.c	Tue Mar 11 15:24:32 2003
+@@ -133,7 +133,7 @@
+ 
+ #include <stdio.h>
+ #include <stdlib.h>
+-#ifndef SVR4
++#if !defined(SVR4) && !defined(__FreeBSD__)
+ #include <getopt.h>
+ #endif
+ #include <sys/types.h>
+@@ -171,16 +171,11 @@
+ #include <sys/param.h>
+ #include <assert.h>
+ 
+-#ifdef __FreeBSD__
+-# include <machine/soundcard.h>
+-# include <machine/pcaudioio.h>
++#ifdef __NetBSD__
++# include <sys/ioctl.h>
++# include <soundcard.h>
+ #else
+-# ifdef __NetBSD__
+-#  include <sys/ioctl.h>
+-#  include <soundcard.h>
+-# else
+-#  include <sys/soundcard.h>
+-# endif
++# include <sys/soundcard.h>
+ #endif
+ 
+ #include <audio/audio.h>
+@@ -659,7 +654,11 @@
+     if(sndStatOut.fd == -1)
+     {
+        while ((sndStatOut.fd = open(sndStatOut.device, 
++#if defined(__FreeBSD__)
++				    sndStatOut.howToOpen|extramode,
++#else
+ 				    sndStatOut.howToOpen|O_SYNC|extramode, 
++#endif
+ 				    0666)) == -1 && wait)
+        {
+            osLogMsg("openDevice: waiting on output device\n");
+@@ -1310,6 +1309,11 @@
+ /*
+  * Setup soundcard at maximum audio quality.
+  */
++
++#if defined(__FreeBSD__)
++#define NO_16_BIT_SAMPLING
++#endif
++
+ static void setupSoundcard(sndStatPtr)
+ SndStat* sndStatPtr;
+ {
+@@ -1472,7 +1476,11 @@
+ 		   sndStatOut.device, sndStatOut.howToOpen);
+ 	
+ 	if ((fd = open(sndStatOut.device, 
++#if defined(__FreeBSD__)
++		       sndStatOut.howToOpen|extramode, 0)) == -1)
++#else
+ 		       sndStatOut.howToOpen|O_SYNC|extramode, 0)) == -1)
++#endif
+ 	  {
+ 	    UNIDENTMSG;
+ 	    return AuFalse;
