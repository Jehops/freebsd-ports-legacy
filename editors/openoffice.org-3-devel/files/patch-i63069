cws freebsd06
Index: stlport/STLport-4.5.patch
===================================================================
RCS file: /cvs/external/stlport/STLport-4.5.patch,v
retrieving revision 1.26
diff -u -r1.26 STLport-4.5.patch
--- stlport/STLport-4.5.patch	7 Mar 2006 17:11:51 -0000	1.26
+++ stlport/STLport-4.5.patch	11 Mar 2006 05:16:19 -0000
@@ -120,16 +120,16 @@
 ***************
 *** 1 ****
 ! dummy
---- 1,59 ----
+--- 1,69 ----
 ! #
 ! # Note : this makefile is for gcc-3 !
 ! #
 ! 
 ! #
 ! # compiler
-! #
-! CC+= ${PTHREAD_CFLAGS} -D_REENTRANT
-! CXX+= ${PTHREAD_CFLAGS} -D_REENTRANT -fexceptions
+! # take these from the OOo build environment
+! CC*= gcc 
+! CXX*= g++
 ! 
 ! #
 ! # Basename for libraries
@@ -141,7 +141,7 @@
 ! #
 ! #
 ! LINK=ar cr
-! DYN_LINK=${CXX} ${PTHREAD_LIBS} --fexceptions -shared -o
+! DYN_LINK=${CXX} -Wl,-rpath,'$$ORIGIN' ${PTHREAD_LIBS} --fexceptions -shared -o
 ! 
 ! OBJEXT=o
 ! DYNEXT=so
@@ -149,26 +149,36 @@
 ! RM=rm -rf
 ! PATH_SEP=/
 ! MKDIR=mkdir -p
-! COMP=GCC-FREEBSD
+! COMP=GCC$(ARCH)
 ! INSTALL_STEP = install_unix 
 ! 
 ! all:  all_dynamic all_static symbolic_links 
 ! 
 ! include common_macros.mak
 ! 
-! WARNING_FLAGS= -Wall -W -Wno-sign-compare -Wno-unused -Wno-uninitialized -ftemplate-depth-32
+! WARNING_FLAGS= -Wall -W -Wno-sign-compare -Wno-unused -Wno-uninitialized
 ! 
-! CXXFLAGS_COMMON = -I${STLPORT_DIR} -DGXX_INCLUDE_PATH=${GXX_INCLUDE_PATH} ${WARNING_FLAGS} ${ARCH_FLAGS}
+! CXXFLAGS_COMMON =  -D_REENTRANT -DGXX_INCLUDE_PATH=${GXX_INCLUDE_PATH} -fexceptions -ftemplate-depth-32 -I${STLPORT_DIR} ${WARNING_FLAGS} ${ARCH_FLAGS}
+! CFLAGS_COMMON =  -D_REENTRANT -DGXX_INCLUDE_PATH=${GXX_INCLUDE_PATH} -fexceptions -I${STLPORT_DIR} ${WARNING_FLAGS} ${ARCH_FLAGS}
 ! 
-! CXXFLAGS_RELEASE_static = $(CXXFLAGS_COMMON) ${CXXFLAGS}
-! CXXFLAGS_RELEASE_dynamic = $(CXXFLAGS_COMMON) ${CXXFLAGS} -fPIC
+! CXXFLAGS_RELEASE_static = $(CXXFLAGS_COMMON) -O2 -fPIC
+! CXXFLAGS_RELEASE_dynamic = $(CXXFLAGS_COMMON) -O2 -fPIC
 ! 
-! CXXFLAGS_DEBUG_static = $(CXXFLAGS_COMMON) -g
+! CXXFLAGS_DEBUG_static = $(CXXFLAGS_COMMON) -g -fPIC
 ! CXXFLAGS_DEBUG_dynamic = $(CXXFLAGS_COMMON) -g -fPIC
 ! 
 ! CXXFLAGS_STLDEBUG_static = $(CXXFLAGS_DEBUG_static) -D_STLP_DEBUG
 ! CXXFLAGS_STLDEBUG_dynamic = $(CXXFLAGS_DEBUG_dynamic) -D_STLP_DEBUG
 ! 
+! CFLAGS_RELEASE_static = $(CFLAGS_COMMON) -O2 -fPIC
+! CFLAGS_RELEASE_dynamic = $(CFLAGS_COMMON) -O2 -fPIC
+! 
+! CFLAGS_DEBUG_static = $(CFLAGS_COMMON) -g -fPIC
+! CFLAGS_DEBUG_dynamic = $(CFLAGS_COMMON) -g -fPIC
+! 
+! CFLAGS_STLDEBUG_static = $(CFLAGS_DEBUG_static) -D_STLP_DEBUG
+! CFLAGS_STLDEBUG_dynamic = $(CFLAGS_DEBUG_dynamic) -D_STLP_DEBUG
+! 
 ! include common_percent_rules.mak
 ! include common_rules.mak
 ! 
