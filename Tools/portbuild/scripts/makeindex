#!/bin/sh
# usage: $0 branch

# -j# to make index
INDEXJOBS=1

usage () {
  echo "usage: makeindex branch"
  exit 1
}
if [ $# != 1 ]; then
  usage
fi
case "x$1" in
  x2.2)
    branch=2.2
    export PORTOBJFORMAT=aout
    export OSREL=2.2.8
    export OSVERSION=228001
    ;;
  x3)
    branch=3
    export PORTOBJFORMAT=elf
    export OSREL=3.5
    export OSVERSION=350001
    ;;
  x4)
    branch=4
    export PORTOBJFORMAT=elf
    # export OSREL=4.0
    # export OSVERSION=400018
    ;;
  x5)
    branch=5
    export PORTOBJFORMAT=elf
    export OSREL=5.0
    export OSVERSION=500011
    ;;
  *)
    usage
    ;;
esac

export PORTSDIR=$(pwd)

unset DISPLAY
export BATCH=t
export HAVE_MOTIF=t
export PACKAGE_BUILDING=t
export PARALLEL_PACKAGE_BUILD=t
#export NO_RESTRICTED=t
#export FOR_CDROM=t
#export INDEX_NOSORT=t
make -j${INDEXJOBS} index
# remove extra spaces in dependency list -- this could cause problems
sed -e 's/  */ /g' -e 's/|  */|/g' -e 's/  *|/|/g' INDEX > INDEX.tmp
mv -f INDEX.tmp INDEX
