--- configure.orig	Fri Sep 24 16:53:37 2004
+++ configure	Fri Sep 24 16:53:53 2004
@@ -8071,8 +8071,6 @@
 # This can be used to rebuild libtool when needed
 LIBTOOL_DEPS="$ac_aux_dir/ltmain.sh"; $ac_aux_dir/ltconfig $LIBTOOL_DEPS;
 
-# Always use our own libtool.
-LIBTOOL='$(SHELL) $(top_builddir)/libtool'
 
 # Prevent multiple expansion
 
@@ -12509,8 +12507,16 @@
     ;;
   *freebsd*)
     echo "Adding fix for interrupted reads"
-    CFLAGS="$CFLAGS -DHAVE_BROKEN_REALPATH"
-    CXXFLAGS="$CXXFLAGS -DMYSQLD_NET_RETRY_COUNT=1000000 -DHAVE_BROKEN_REALPATH"
+    OSVERSION=`/sbin/sysctl -a | /usr/bin/grep osreldate | /usr/bin/awk '{ print $2 }'`
+    if test "$OSVERSION" -gt "480100" && \
+       test "$OSVERSION" -lt "500000" || \
+       test "$OSVERSION" -gt "500109"
+    then
+      CXXFLAGS="$CXXFLAGS -DMYSQLD_NET_RETRY_COUNT=1000000"
+    else
+      CFLAGS="$CFLAGS -DHAVE_BROKEN_REALPATH"
+      CXXFLAGS="$CXXFLAGS -DMYSQLD_NET_RETRY_COUNT=1000000 -DHAVE_BROKEN_REALPATH"
+    fi
     ;;
   *netbsd*)
     echo "Adding flag -Dunix"
@@ -13710,30 +13716,6 @@
 #define HAVE_RESTARTABLE_SYSCALLS 1
 _ACEOF
 
-fi
-
-
-# Build optimized or debug version ?
-# First check for gcc and g++
-if test "$ac_cv_c_compiler_gnu" = "yes"
-then
-  DEBUG_CFLAGS="-g"
-  DEBUG_OPTIMIZE_CC="-O"
-  OPTIMIZE_CFLAGS="$MAX_C_OPTIMIZE"
-else
-  DEBUG_CFLAGS="-g"
-  DEBUG_OPTIMIZE_CC=""
-  OPTIMIZE_CFLAGS="-O"
-fi
-if test "$ac_cv_prog_cxx_g" = "yes"
-then
-  DEBUG_CXXFLAGS="-g"
-  DEBUG_OPTIMIZE_CXX="-O"
-  OPTIMIZE_CXXFLAGS="-O3"
-else
-  DEBUG_CXXFLAGS="-g"
-  DEBUG_OPTIMIZE_CXX=""
-  OPTIMIZE_CXXFLAGS="-O"
 fi
 
 
