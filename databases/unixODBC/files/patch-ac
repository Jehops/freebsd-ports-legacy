--- configure.in.orig	Mon Jan 15 05:44:57 2001
+++ configure.in	Wed Jan 24 00:40:51 2001
@@ -110,8 +110,8 @@
 ])
 AC_SUBST(READLINE)
 
-AC_CHECK_LIB(c, strcasecmp, [AC_DEFINE(HAVE_STRCASECMP, 1)])
-AC_CHECK_LIB(c, strncasecmp, [AC_DEFINE(HAVE_STRNCASECMP, 1)])
+AC_CHECK_FUNC(strcasecmp, [AC_DEFINE(HAVE_STRCASECMP, 1)])
+AC_CHECK_FUNC(strncasecmp, [AC_DEFINE(HAVE_STRNCASECMP, 1)])
 
 LIBADD_DL=
 AC_CHECK_LIB(dl, dlopen, [AC_DEFINE(HAVE_LIBDL, 1) LIBADD_DL="-ldl"],
@@ -134,25 +134,27 @@
     AC_DEFINE(HAVE_LIBPTH,1)
   else
     AC_CHECK_LIBPT(pthread, pthread_mutex_lock )
-    AC_CHECK_LIBPT(pthread, pthread_mutex_lock, 
+    AC_CHECK_LIBPT(c_r, pthread_mutex_lock,
     [
       AC_DEFINE(HAVE_LIBPTHREAD,1)
       if test "x$ac_cv_prog_gcc"="xyes"; then
         CFLAGS="$CFLAGS -pthread"
+        CXXFLAGS="$CXXFLAGS -pthread"
+        AC_DEFINE(_THREAD_SAFE,1)
       fi
     ] )
 
     AC_CHECK_LIB(thread, mutex_lock )
-    AC_CHECK_LIB(c, localtime_r, [AC_DEFINE(HAVE_LOCALTIME_R, 1)] )
+    AC_CHECK_FUNC(localtime_r, [AC_DEFINE(HAVE_LOCALTIME_R, 1)] )
   fi
 fi
 
 if test "x$stats" = "xtrue"; then
-  AC_CHECK_LIB( c, ftok,[],[stats=false] )
-  AC_CHECK_LIB( c, semget,[],[stats=false] )
-  AC_CHECK_LIB( c, shmget,[],[stats=false] )
-  AC_CHECK_LIB( c, semop,[],[stats=false] )
-  AC_CHECK_LIB( c, snprintf, [AC_DEFINE(HAVE_SNPRINTF)],[stats=false] )
+  AC_CHECK_FUNC(ftok,[],[stats=false] )
+  AC_CHECK_FUNC(semget,[],[stats=false] )
+  AC_CHECK_FUNC(shmget,[],[stats=false] )
+  AC_CHECK_FUNC(semop,[],[stats=false] )
+  AC_CHECK_FUNC(snprintf, [AC_DEFINE(HAVE_SNPRINTF)],[stats=false] )
 fi
 
 if test "x$stats" = "xtrue"; then
