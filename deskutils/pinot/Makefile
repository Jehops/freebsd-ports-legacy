# New ports collection makefile for:	pinot
# Date created:		2006-11-19
# Whom:			Thierry Thomas <thierry@pompo.net>
#
# $FreeBSD$

PORTNAME=	pinot
PORTVERSION=	0.64
PORTREVISION=	1
CATEGORIES=	deskutils
MASTER_SITES=	${MASTER_SITE_BERLIOS}
#		http://www.chez.com/colinf/pinot/	\
#		http://amra.dyndns.org/
MASTER_SITE_SUBDIR=	${PORTNAME}

MAINTAINER=	thierry@FreeBSD.org
COMMENT=	Personal search and metasearch for the Free Desktop

BUILD_DEPENDS=	update-desktop-database:${PORTSDIR}/devel/desktop-file-utils
LIB_DEPENDS=	xapian.13:${PORTSDIR}/databases/xapian-core	\
		gtkmm-2.4:${PORTSDIR}/x11-toolkits/gtkmm24	\
		textcat.0:${PORTSDIR}/textproc/libtextcat	\
		dbus-glib-1.2:${PORTSDIR}/devel/dbus-glib	\
		xml\\+\\+-2.6:${PORTSDIR}/textproc/libxml++26	\
		boost_thread.3:${PORTSDIR}/devel/boost		\
		gmime-2.0:${PORTSDIR}/mail/gmime2		\
		tag.5:${PORTSDIR}/audio/taglib			\
		curl.3:${PORTSDIR}/ftp/curl
RUN_DEPENDS=	update-mime-database:${PORTSDIR}/misc/shared-mime-info	\
		antiword:${PORTSDIR}/textproc/antiword			\
		pdftotext:${PORTSDIR}/graphics/xpdf			\
		unzip:${PORTSDIR}/archivers/unzip			\
		unrtf:${PORTSDIR}/textproc/unrtf

# pinot-0.64 is not ready for gsoap_2.7.8c
.if !defined(WITHOUT_SOAP)
BUILD_DEPENDS+=	${LOCALBASE}/lib/libgsoap.a:${PORTSDIR}/devel/gsoap
CONFIGURE_ARGS+=	--with-soap=yes
.endif

GNU_CONFIGURE=	yes
#USE_AUTOTOOLS=	libtool:15
CONFIGURE_TARGET=	--build=${ARCH}-portbld-freebsd${OSREL}
CONFIGURE_ARGS=	--with-http=curl
CONFIGURE_ENV=	CPPFLAGS="-I${LOCALBASE}/include" LDFLAGS="-L${LOCALBASE}/lib"

USE_GETTEXT=	yes
USE_XLIB=	yes
USE_SQLITE=	3
USE_PYTHON=	yes

INSTALLS_ICONS=	yes

MAN1=		pinot-collect.1 pinot-dbus-daemon.1 pinot-index.1	\
		pinot-search.1 pinot.1

LM2FIX=		textcat_conf.txt textcat3_conf.txt
SHR2FIX=	Search/pinot-search.1 README
UL2FIX=		Utils/xdgmime/xdgmime.c

pre-configure:
	${REINPLACE_CMD} -e 's|-lpthread|${PTHREAD_LIBS}|' ${WRKSRC}/configure
	${REINPLACE_CMD} -e 's|/usr/share|${LOCALBASE}/share|'	\
		${LM2FIX:S|^|${WRKSRC}/|}
	${REINPLACE_CMD} -e 's|/usr/local|${LOCALBASE}|'	\
		${UL2FIX:S|^|${WRKSRC}/|}
	${REINPLACE_CMD} -e 's|/usr/share|${PREFIX}/share|'	\
		${SHR2FIX:S|^|${WRKSRC}/|}

post-install:
	@${PYTHON_CMD} ${PYTHON_LIBDIR}/compileall.py		\
		${PREFIX}/lib/deskbar-applet/handlers
	@${PYTHON_CMD} -O ${PYTHON_LIBDIR}/compileall.py	\
		${PREFIX}/lib/deskbar-applet/handlers

.include <bsd.port.mk>
