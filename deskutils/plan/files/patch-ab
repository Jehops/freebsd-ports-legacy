*** src/Makefile.orig	Sun Apr 14 15:55:22 1996
--- src/Makefile	Tue Apr 16 18:41:20 1996
***************
*** 6,21 ****
  # DO NOT put a blank between the path and the #, or you'll get compile errors.
  #
  
! DIR  = /usr/local/bin#		# user-callable executable (plan)
! LIB  = /usr/local/lib#		# auxiliary programs (pland, notifier, netplan)
! HELP = $(LIB)#			# help file (plan.help)
! MAN  = /usr/man/local/man#	# unformatted nroff manpage (plan.[14])
! # MAN = /usr/local/man/man#	# for linux
  CATMAN = /usr/catman/local/cat#	# formatted manpage (plan.[14])
  INCDIR =#			# extra cc options, e.g. "-I/var/include"
! NOB_UID = 60001#		# numerical user ID of <nobody> account
! NOB_GID = 60001#		# default numerical group ID of <nobody> account
! CPP_PATH="/lib/cpp -P -I$(HELP)"# used by plan to pre-process holiday files,
  #				# plan will check if this file really exists
  ESCTOISOLATIN=\"\\033\(B\"#	# switching to ISO8859-1
  ESCTOJISLATIN=\"\\033\(J\"#	# switching to JIS X0201-1976 roman
--- 6,26 ----
  # DO NOT put a blank between the path and the #, or you'll get compile errors.
  #
  
! PLANBASE = /usr/local#
! DOCBASE = $(PLANBASE)/share/doc/plan#
! NETPLAN  = $(PLANBASE)/share#	# netplan directory
! 
! DIR  = $(PLANBASE)/bin#		# user-callable executable (plan)
! LIB = $(DIR)#         		# auxiliary programs (pland, notifier, netplan)
! EXAMPLES = $(DOCBASE)/examples#	# Example holiday files
! DOCS = $(DOCBASE)#		# doc files
! #MAN  = /usr/man/local/man#	# unformatted nroff manpage (plan.[14])
! MAN = $(PLANBASE)/man/man#	# for linux and freebsd
  CATMAN = /usr/catman/local/cat#	# formatted manpage (plan.[14])
  INCDIR =#			# extra cc options, e.g. "-I/var/include"
! NOB_UID = 65534#		# numerical user ID of <nobody> account
! NOB_GID = 65534#		# default numerical group ID of <nobody> account
! CPP_PATH="/usr/bin/cpp -P -I$(DOCS)"# used by plan to pre-process holiday files,
  #				# plan will check if this file really exists
  ESCTOISOLATIN=\"\\033\(B\"#	# switching to ISO8859-1
  ESCTOJISLATIN=\"\\033\(J\"#	# switching to JIS X0201-1976 roman
***************
*** 26,32 ****
  #        -DLOCALE_SJIS=\"ja_JP.SJIS\" -DLOCALE_EUC=\"ja_JP.EUC\"
  #				# JAPAN requires X11R5 and a Japanese env.
  
! DEBUG = -g
  #DEBUG = -O2 -s			# do NOT define -O2 on DEC OSF/1 machines!
  
  #DEFTARGET = sgi
--- 31,37 ----
  #        -DLOCALE_SJIS=\"ja_JP.SJIS\" -DLOCALE_EUC=\"ja_JP.EUC\"
  #				# JAPAN requires X11R5 and a Japanese env.
  
! #DEBUG = -g
  #DEBUG = -O2 -s			# do NOT define -O2 on DEC OSF/1 machines!
  
  #DEFTARGET = sgi
***************
*** 54,59 ****
--- 59,66 ----
  #	-DVARARGS	use pre-ANSI varargs instead of stdargs
  #	-DDESTROYBUG	fixes Linux XtDestroyWidget bug that kills plan when a
  #			Done button is used. WARNING: introduces a memory leak
+ #	-DSTDLIBMALLOC	do not include <malloc.h>, use <stdlib.h> instead,
+ #			(FreeBSD)
  #
  # Note for HP systems: if you have the PROG-AUX option, remove -DNOREGEX
  # from HP_C, and add -lPW to HP_L1. On Suns, try removing -DNOREGEX (and
***************
*** 104,109 ****
--- 111,119 ----
  BSDIG_C	= -ansi -I/usr/X11/include -DBSD -DRABBITS -DNOLOCK -DNOREGEX -Dbsdi
  NBSD_C	= -ansi -I/usr/X11R6/include -DBSD -DRABBITS -DNOLOCK -DNOREGEX\
  	  -DNO_MOTIF
+ FBSD_C	= $(CFLAGS) -ansi -I/usr/X11R6/include -DBSD -DFLOCK -DRABBITS -Dfreebsd -DSTDLIBMALLOC
+ IBM_C	= -O -I/usr/include/X11 -D_ALL_SOURCE -DIBM -DAIXV3 -DNOMSEP -DRABBITS
+ PS2_C	= -O -I/usr/include/X11 -D_POSIX_SOURCE\
  LINUX_C	= -D_POSIX_SOURCE -DNOLOCK -DLINUX
  SVR4_C	= -DSVR4 -DSYSV -DOLDTZ -DUSERAND -DPID_T=long -DNOMSEP
  NEWS_C	= -DNEWSOS4 -DSUN -DBSD -DRABBITS -DPID_T="int" -Dconst=""
***************
*** 179,184 ****
--- 189,196 ----
  BSDIG_L2= -L/usr/X11/lib -lc
  NBSD_L1	= -L/usr/X11R6/lib -lXm -lXt -lX11
  NBSD_L2	= -L/usr/X11R6/lib -lc
+ FBSD_L1	= -L/usr/X11R6/lib ${MOTIFLIB} -lXt -lX11 -lXext -lc
+ FBSD_L2	= -lc
  LINUX_L1= -lXm -lXt -lX11 -lXpm -lc
  LINUX_L2= -lc
  SVR4_L1	= -lXm -lXt -lX11 -lgen -lsocket -lnsl
***************
*** 236,241 ****
--- 248,254 ----
  	@echo "  make bsdi      BSDI/386"
  	@echo "  make bsdig     BSDI/386 with gcc"
  #	@echo "  make netbsd	NetBSD/i386 1.0A (maybe others too)"
+ 	@echo "  make freebsd   FreeBSD 2.x"
  	@echo "  make svr4      SVR4 Using gcc"
  	@echo "  make news4     Sony NEWS-OS4.x"
  	@echo "  make news4g    Sony NEWS-OS4.x with gcc"
***************
*** 344,349 ****
--- 357,365 ----
  netbsd:
  	env CF="$(NBSD_C)" L1F="$(NBSD_L1)" L2F="$(NBSD_L2)" MYCC=gcc $(MAK all
  
+ freebsd:
+ 	env CF="$(FBSD_C)" L1F="$(FBSD_L1)" L2F="$(FBSD_L2)" MYCC=${CC} make all
+ 
  svr4:
  	env CF="$(SVR4_C)" L1F="$(SVR4_L1)" L2F="$(SVR4_L2)" MYCC=gcc make all
  
***************
*** 437,449 ****
  	$(MYCC) $(DEBUG) $(CF) $(JAPAN) $(INCDIR) -c -DLIB=\"$(LIB)\" $<
  
  holiday.o: holiday.c Makefile
! 	$(MYCC) $(DEBUG) $(CF) $(JAPAN) $(INCDIR) -DCPP_PATH=\"$(CPP_PATH)\" -c -DLIB=\"$(LIB)\" $<
  
  lock.o: lock.c
! 	$(MYCC) $(DEBUG) $(CF) $(JAPAN) $(INCDIR) -c -DPATH=\"$(LIB):$(DIR):$(HELP)\" $<
  
  netplan.o: netplan.c netplan_if.h
! 	$(MYCC) $(DEBUG) $(CF) -DNOBODY_UID=$(NOB_UID) -DNOBODY_GID=$(NOB_GID) $(INCDIR) -c -DLIB=\"$(LIB)\" $<
  #	$(MYCC) $(DEBUG) $(CF) -DNOBODY_UID=`grep nobody /etc/passwd | head -1 | awk -F: '{print $$3}'` -DNOBODY_GID=`grep nobody /etc/passwd | head -1 | awk -F: '{print $$4}'` $(INCDIR) -c -DLIB=\"$(LIB)\" $<
  
  parser.c: parser.y
--- 453,465 ----
  	$(MYCC) $(DEBUG) $(CF) $(JAPAN) $(INCDIR) -c -DLIB=\"$(LIB)\" $<
  
  holiday.o: holiday.c Makefile
! 	$(MYCC) $(DEBUG) $(CF) $(JAPAN) $(INCDIR) -DCPP_PATH=\"$(CPP_PATH)\" -c -DLIB=\"$(DOCS)\" $<
  
  lock.o: lock.c
! 	$(MYCC) $(DEBUG) $(CF) $(JAPAN) $(INCDIR) -c -DPATH=\"$(LIB):$(DIR):$(DOCS)\" $<
  
  netplan.o: netplan.c netplan_if.h
! 	$(MYCC) $(DEBUG) $(CF) -DNOBODY_UID=$(NOB_UID) -DNOBODY_GID=$(NOB_GID) $(INCDIR) -c -DLIB=\"$(NETPLAN)\" $<
  #	$(MYCC) $(DEBUG) $(CF) -DNOBODY_UID=`grep nobody /etc/passwd | head -1 | awk -F: '{print $$3}'` -DNOBODY_GID=`grep nobody /etc/passwd | head -1 | awk -F: '{print $$4}'` $(INCDIR) -c -DLIB=\"$(LIB)\" $<
  
  parser.c: parser.y
***************
*** 465,492 ****
  
  #---------------------------------------------------------------
  install:
! 	cp plan $(DIR)
! 	-rm -f $(DIR)/pland $(DIR)/notifier
! 	cp pland notifier netplan ../misc/plan_cal.ps $(LIB)
! 	@if [ '$(JAPAN)' ]; then cp ../misc/plan_calSJ.ps $(LIB); fi
! 	cp ../misc/plan.help $(HELP)
! 	-strip $(DIR)/plan $(LIB)/pland $(LIB)/notifier $(LIB)/netplan
! 	-chmod 755 $(DIR)/plan $(LIB)/pland $(LIB)/notifier $(LIB)/netplan
! 	-chmod 644 $(HELP)/plan.help $(LIB)/plan_cal.ps
! 	@if [ '$(JAPAN)' ]; then chmod 644 $(LIB)/plan_calSJ.ps; fi
! 	-mkdir $(LIB)/netplan.dir
! 	-chmod 777 $(LIB)/netplan.dir
  	-test -x `which nroff` && nroff -man ../misc/plan.1 >../misc/plan.1cat
  	-test -x `which nroff` && nroff -man ../misc/plan.4 >../misc/plan.4cat
  	-test -d $(MAN)1 && cp ../misc/plan.1 $(MAN)1/plan.1
  	-test -d $(MAN)4 && cp ../misc/plan.4 $(MAN)4/plan.4
! 	-test -d $(CATMAN)1 && cp ../misc/plan.1cat $(CATMAN)1/plan.1
! 	-test -d $(CATMAN)4 && cp ../misc/plan.4cat $(CATMAN)4/plan.4
! 	-test -f ${HOME}/.holiday || cp ../holiday/holiday_german ${HOME}/.holiday
! 	-test `uname` = IRIX && mkdir $$HOME/.icons
! 	-test `uname` = IRIX && cp ../misc/Plan.icon $$HOME/.icons/Plan.icon
  	@echo ""
! 	@echo "use ../holiday/* as templates for your ~/.holiday file"
  
  clean:
  	-rm -f *.o
--- 481,514 ----
  
  #---------------------------------------------------------------
  install:
! 	-mkdir -p $(DOCBASE)
! 	-mkdir -p $(EXAMPLES)
! 	cp pland $(DIR)
! 	cp notifier netplan plan ../misc/Killpland $(LIB)
! 	cp ../misc/plan.help ../misc/plan_cal.ps ../misc/Mkdoc \
! 	   ../misc/Mkdoc.nawk ../misc/Monochrome ../misc/BlackWhite $(DOCS)
! 	-strip $(DIR)/plan $(DIR)/pland $(DIR)/notifier $(DIR)/netplan
! 	-chmod 755 $(DIR)/plan
! 	-chmod 755 $(LIB)/pland $(LIB)/notifier $(LIB)/netplan
! 	-chmod 644 $(DOCS)/plan.help $(DOCS)/plan_cal.ps
! 	-chmod 755 $(DOCS)/Mkdoc $(DOCS)/Mkdoc.nawk
! 	-chmod 644 $(DOCS)/Monochrome $(DOCS)/BlackWhite
! 	-chmod 755 $(LIB)/Killpland
! 	-mkdir $(NETPLAN)/netplan.dir
! 	-chmod 777 $(NETPLAN)/netplan.dir
  	-test -x `which nroff` && nroff -man ../misc/plan.1 >../misc/plan.1cat
  	-test -x `which nroff` && nroff -man ../misc/plan.4 >../misc/plan.4cat
  	-test -d $(MAN)1 && cp ../misc/plan.1 $(MAN)1/plan.1
  	-test -d $(MAN)4 && cp ../misc/plan.4 $(MAN)4/plan.4
! #	-test -d $(CATMAN)1 && cp ../misc/plan.1cat $(CATMAN)1/plan.1
! #	-test -d $(CATMAN)4 && cp ../misc/plan.4cat $(CATMAN)4/plan.4
! #	-test -f ${HOME}/.holiday || cp ../holiday/holiday_german ${HOME}/.holiday
! 	-test -d $(EXAMPLES) && cp ../holiday/holiday_* $(EXAMPLES)
! 	-test -f ../README && cp ../README $(DOCS)
! #	-test `uname` = IRIX && mkdir $$HOME/.icons
! #	-test `uname` = IRIX && cp ../misc/Plan.icon $$HOME/.icons/Plan.icon
  	@echo ""
! 	@echo "Use $(EXAMPLES)/* as templates for your ~/.holiday file"
  
  clean:
  	-rm -f *.o
