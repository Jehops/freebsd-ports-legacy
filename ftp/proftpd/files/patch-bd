--- contrib/mod_sqlpw.c.old	Sun Feb 11 20:14:40 2001
+++ contrib/mod_sqlpw.c	Sun Feb 11 20:16:00 2001
@@ -400,9 +400,6 @@
   int return_type;
   int retval = AUTH_NOPWD;
 
-  if (!g.sql_passwd || !g.homedir)
-    return DECLINED (cmd);
-
   /* Figure out our default return style: Whether or not SQL should
    * allow other auth modules a shot at this user or not is controlled
    * by the parameter "SQLAuthoritative".  Like mod_pam this
@@ -418,6 +415,8 @@
   if ((user = cmd->argv[0]) == NULL)
     return return_type ? ERROR (cmd) : DECLINED (cmd);
   if ((pass = cmd->argv[1]) == NULL)
+    return return_type ? ERROR (cmd) : DECLINED (cmd);
+  if (!g.sql_passwd || !g.homedir)
     return return_type ? ERROR (cmd) : DECLINED (cmd);
 
   if (!g.pass
