--- configure.in	Thu Mar  9 09:12:35 2006
+++ configure.in	Mon May 22 15:01:23 2006
@@ -161,12 +161,14 @@
   [
     if test "$withval" != "no" ; then
       LIB_OBJS="$LIB_OBJS getopt.o getopt1.o"
-      AC_CHECK_FUNCS(getopt)
+      AC_CHECK_FUNCS(getopt getopt_long)
+      AC_CHECK_HEADERS(getopt.h)
     fi
   ],
   [
     LIB_OBJS="$LIB_OBJS getopt.o getopt1.o"
-    AC_CHECK_FUNCS(getopt)
+    AC_CHECK_FUNCS(getopt getopt_long)
+    AC_CHECK_HEADERS(getopt.h)
   ])
 
 dnl Modules...'nuff said.
@@ -850,7 +852,7 @@
   ac_build_static_modules="modules/mod_cap.o $ac_build_static_modules"
 fi
 
-AC_CHECK_HEADERS(ctype.h getopt.h crypt.h bstring.h iconv.h inttypes.h langinfo.h limits.h)
+AC_CHECK_HEADERS(ctype.h crypt.h bstring.h iconv.h inttypes.h langinfo.h limits.h)
 AC_CHECK_HEADERS(string.h strings.h stropts.h)
 AC_CHECK_HEADERS(sys/file.h sys/mman.h sys/types.h sys/uio.h)
 
@@ -1110,7 +1112,7 @@
 )
 
 AC_CHECK_FUNCS(getcwd getenv gethostbyname2 gethostname getnameinfo)
-AC_CHECK_FUNCS(getopt_long gettimeofday hstrerror inet_aton inet_ntop inet_pton)
+AC_CHECK_FUNCS(gettimeofday hstrerror inet_aton inet_ntop inet_pton)
 AC_CHECK_FUNCS(memcpy mempcpy mkdir mkstemp mlock mlockall munlock munlockall)
 AC_CHECK_FUNCS(rmdir select setgroups socket statfs strchr strcoll strerror)
 AC_CHECK_FUNCS(strsep strtol strtoull setprotoent setspent endprotoent)
