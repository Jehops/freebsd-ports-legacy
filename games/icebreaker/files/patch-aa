
$FreeBSD$

--- Makefile.orig	Fri Jul 27 05:45:10 2001
+++ Makefile	Mon Jul 30 14:25:37 2001
@@ -1,6 +1,7 @@
 CC=gcc
 
-SDLCONFIG=sdl-config
+SDLCONFIG=$(SDL_CONFIG)
+CC?=gcc
 
 ifndef prefix
   #prefix=/usr/local
@@ -17,7 +18,7 @@
 endif
 
 ifndef OPTIMIZE
-  OPTIMIZE=-O3
+  OPTIMIZE=
 endif
 
 CFLAGS=-Wall $(OPTIMIZE) $(SDL_CFLAGS) -DDATAPREFIX=\"$(prefix)/share/icebreaker\" -DHISCOREPREFIX=\"$(highscoredir)\"
@@ -26,7 +27,7 @@
     level.c intro.c text.c status.c transition.c hiscore.c dialog.c \
     options.c fullscreen.c
 
-SDL_MIXER=-lSDL_mixer
+SDL_MIXER=-lSDL_mixer -lsmpeg
 SDL_LIB=$(SDL_LDFLAGS) $(SDL_MIXER) 
 SDL_CFLAGS := $(shell $(SDLCONFIG) --cflags)
 SDL_LDFLAGS := $(shell $(SDLCONFIG) --libs)
@@ -100,17 +101,17 @@
 	   sed 's/\$$VERDATE/$(VERDATE)/' > $@
 
 install: all
-	mkdir -p $(prefix)/bin
-	mkdir -p $(prefix)/share/icebreaker
-	mkdir -p $(highscoredir)
-	mkdir -p $(mandir)/man6
+	$(MKDIR) $(prefix)/share/icebreaker
+	$(MKDIR) $(highscoredir)
 
-	install -m 644 *.wav *.bmp $(prefix)/share/icebreaker
-	install -g games -s -m 2755 icebreaker $(prefix)/bin
-	install -m 644 icebreaker.6 $(mandir)/man6
+	$(BSD_INSTALL_DATA) *.wav *.bmp $(prefix)/share/icebreaker
+	$(BSD_INSTALL_PROGRAM) icebreaker $(prefix)/bin
+	$(BSD_INSTALL_MAN) icebreaker.6 $(mandir)/man6
 	touch $(highscoredir)/icebreaker.scores
-	chown games:games $(highscoredir)/icebreaker.scores
-	chmod 664 $(highscoredir)/icebreaker.scores
+	$(CHOWN) root:games $(prefix)/bin/icebreaker
+	$(CHMOD) 2755 $(prefix)/bin/icebreaker
+	$(CHOWN) root:games $(highscoredir)/icebreaker.scores
+	$(CHMOD) 664 $(highscoredir)/icebreaker.scores
 
 
 include $(SRC:.c=.d)
