# New ports collection makefile for:	spring
# Date created:		10 Jan 2008
# Whom:			Dmitry Marakasov <amdmi3@amdmi3.ru>
#
# $FreeBSD$
#

PORTNAME=	spring
PORTVERSION=	0.77b5
PORTREVISION=	2
CATEGORIES=	games
MASTER_SITES=	http://spring.clan-sy.com/dl/ \
		http://mirror.amdmi3.ru/
DISTNAME=	${PORTNAME}_${PORTVERSION}_src

MAINTAINER=	amdmi3@FreeBSD.org
COMMENT=	A project aiming to create a new and versatile RTS Engine

LIB_DEPENDS=	freetype.9:${PORTSDIR}/print/freetype2 \
		openal.0:${PORTSDIR}/audio/openal \
		GLEW.1:${PORTSDIR}/graphics/glew \
		boost_thread.4:${PORTSDIR}/devel/boost \
		IL.2:${PORTSDIR}/graphics/devil \
		ogg.5:${PORTSDIR}/audio/libogg \
		vorbis.4:${PORTSDIR}/audio/libvorbis
BUILD_DEPENDS=	zip:${PORTSDIR}/archivers/zip

USE_BZIP2=	yes
USE_SDL=	sdl
USE_GL=		gl glu
USE_XORG=	x11 xcursor
USE_LDCONFIG=	yes
# built with < 4.0 will not sync in multiplayer...
# ...but it won't build with gcc42 from ports
#USE_GCC=	4.2+

USE_CMAKE=	yes
CMAKE_ARGS=	-DDATADIR:STRING="share/${PORTNAME}" \
		-DMARCH_FLAG:STRING=

WRKSRC=		${WRKDIR}/${PORTNAME}_${PORTVERSION}

PORTDOCS=	*

.include <bsd.port.pre.mk>

.if ${ARCH} == "sparc64"
BROKEN=		Does not compile on sparc64
.endif

post-patch:
	@${REINPLACE_CMD} -E -e '/FIND_PACKAGE.*(Python|JNI)/ d' \
		${WRKSRC}/tools/unitsync/CMakeLists.txt
	@${REINPLACE_CMD} -e 's|x1F3F|x0F3F|g' \
		${WRKSRC}/rts/System/FPUCheck.h

post-install:
.if !defined(NOPORTDOCS)
	${MKDIR} ${DOCSDIR}
	cd ${WRKSRC}/Documentation && ${COPYTREE_SHARE} . ${DOCSDIR}
.endif
	@${ECHO_CMD}; ${CAT} ${PKGMESSAGE}; ${ECHO_CMD}

.include <bsd.port.post.mk>
