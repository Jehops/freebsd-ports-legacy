# New ports collection makefile for:   el
# Date created:        25 January 2005
# Whom:                Janni
#
# $FreeBSD$
#

PORTNAME=	el
PORTVERSION=	130
PORTREVISION=	1
CATEGORIES=	games
MASTER_SITES=	${MASTER_SITE_LOCAL}
MASTER_SITE_SUBDIR=	acm/${PORTNAME}
DIST_SUBDIR=	${PORTNAME}

MAINTAINER=	acm@FreeBSD.org
COMMENT=	Eternal Lands is a free 3D MMORPG

LIB_DEPENDS=	png.5:${PORTSDIR}/graphics/png \
		openal.0:${PORTSDIR}/audio/openal \
		vorbis.3:${PORTSDIR}/audio/libvorbis \
		cal3d.12:${PORTSDIR}/graphics/cal3d \
		alut.1:${PORTSDIR}/audio/freealut
RUN_DEPENDS=	${LOCALBASE}/share/${PORTNAME}/el.ini:${PORTSDIR}/games/el-data

USE_BZIP2=	yes
USE_GMAKE=	yes
USE_GNOME=	libxml2
USE_SDL=	sdl net

ALL_TARGET=	el.x86
MAKEFILE=	Makefile.bsdg

.include <bsd.port.pre.mk>

.if ${ARCH} == amd64
CFLAGS+=	-DX86_64
.endif

.if ${OSVERSION} < 500000
BROKEN=		does not compile
.endif

.if ${ARCH} == "sparc64"
BROKEN=		Does not compile on sparc64
.endif

post-extract:
	@cd ${WRKSRC} && \
		${FIND} * -type f -exec ${REINPLACE_CMD} -i "" -e 's|malloc.h|stdlib.h|g' "{}" \;

post-patch:
	@${ECHO} "bin/el" > ${PLIST}
	@${ECHO} "%%DATADIR%%/el.x86" >> ${PLIST}
	@${ECHO} "@dirrmtry %%DATADIR%%" >> ${PLIST}

pre-install:
	${ECHO} "#!/bin/sh" > ${WRKDIR}/el
	${ECHO} "cd ${DATADIR} || exit 1 " >> ${WRKDIR}/el
	${ECHO} "exec ${DATADIR}/el.x86" >> ${WRKDIR}/el

do-install:
	@${MKDIR} ${DATADIR}
	${INSTALL_SCRIPT} ${WRKDIR}/el ${PREFIX}/bin
	${INSTALL_PROGRAM} ${WRKSRC}/el.x86 ${DATADIR}

.include <bsd.port.post.mk>
