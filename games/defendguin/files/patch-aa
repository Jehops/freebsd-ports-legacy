
$FreeBSD$

--- Makefile.orig	Sun Jan  6 03:09:37 2002
+++ Makefile	Tue Mar  5 15:11:49 2002
@@ -9,9 +9,9 @@
 
 # User-definable stuff:
 
-CFLAGS=-Wall -O2
+CFLAGS?=-Wall -O2
 #DATA_PREFIX=$(PWD)/data/
-PREFIX=/usr/local
+PREFIX?=/usr/local
 MAN_PREFIX=$(PREFIX)
 BIN_PREFIX=$(PREFIX)/bin
 DATA_PREFIX=$(PREFIX)/share/defendguin/
@@ -20,11 +20,11 @@
 
 # Other definitions:
 
-SDL_CFLAGS := $(shell sdl-config --cflags)
-SDL_LDFLAGS := $(shell sdl-config --libs) -L/usr/X11R6/lib
-MIXER=-lSDL_mixer
+SDL_CFLAGS := $(shell $(SDL_CONFIG) --cflags)
+SDL_LDFLAGS := $(shell $(SDL_CONFIG) --libs)
+MIXER=-lSDL_mixer -lsmpeg
 NOSOUNDFLAG=__SOUND
-CFLAGS=-Wall $(SDL_CFLAGS) -DDATA_PREFIX=\"$(DATA_PREFIX)\" -D$(NOSOUNDFLAG) \
+CFLAGS+=-Wall $(SDL_CFLAGS) -DDATA_PREFIX=\"$(DATA_PREFIX)\" -D$(NOSOUNDFLAG) \
 	-DJOY_$(JOY)
 SDL_LIB=$(SDL_LDFLAGS) $(MIXER)
 
@@ -37,13 +37,11 @@
 	make defendguin MIXER= NOSOUNDFLAG=NOSOUND
 
 install:	defendguin
-	install -d $(DATA_PREFIX)
-	cp -R data/* $(DATA_PREFIX)
-	chmod -R a+rX,g-w,o-w $(DATA_PREFIX)
-	cp defendguin $(BIN_PREFIX)/
-	chmod a+rx,g-w,o-w $(BIN_PREFIX)/defendguin
-	cp defendguin.6 $(MAN_PREFIX)/man/man6/
-	chmod a+rx,g-w,o-w $(MAN_PREFIX)/man/man6/defendguin.6
+	$(MKDIR) $(DATA_PREFIX)
+	cd data; tar --exclude .xvpics -cf - . | \
+		(cd $(DATA_PREFIX); ${TAR} --unlink -xf - )
+	$(BSD_INSTALL_PROGRAM) defendguin $(BIN_PREFIX)/
+	$(BSD_INSTALL_MAN) defendguin.6 $(MAN_PREFIX)/man/man6/
 
 uninstall:
 	-rm -r $(DATA_PREFIX)
