# New ports collection makefile for:	gtar
# Date created:		Sa   6 Jun 1998 10:24:51 CEST
# Whom:			Andreas Klemm <andreas@klemm.gtn.com>
#
# $FreeBSD$
#

PORTNAME=	tar
PORTVERSION=	1.20
PORTREVISION=	1
CATEGORIES=	archivers sysutils
MASTER_SITES=	${MASTER_SITE_GNU}
MASTER_SITE_SUBDIR=	${PORTNAME}
PKGNAMEPREFIX=	g

MAINTAINER=	naddy@FreeBSD.org
COMMENT=	GNU version of the traditional tape archiver

# Actually we need lzma(1), but not the one in archivers/lzma.
RUN_DEPENDS=	${LOCALBASE}/bin/lzcat:${PORTSDIR}/archivers/lzmautils

INFO=		tar

USE_BZIP2=	yes
USE_ICONV=	yes
GNU_CONFIGURE=	yes
CONFIGURE_ARGS=	--program-prefix=g
CONFIGURE_ENV=	CPPFLAGS='-I${LOCALBASE}/include' \
		LDFLAGS='-L${LOCALBASE}/lib ${LDSTATIC}' \
		DEFAULT_ARCHIVE=/dev/sa0 \
		DEFAULT_RMT_COMMAND=/etc/rmt

.if defined(WANT_STATIC)
LDSTATIC=	-static
.else
LDSTATIC=
.endif

.if !defined(WITHOUT_NLS)
USE_GETTEXT=	yes
PLIST_SUB+=	NLS=""
.else
CONFIGURE_ARGS+=--disable-nls
PLIST_SUB+=	NLS="@comment "
.endif

.include <bsd.port.pre.mk>

# after the GNU gzip implementation was replaced with a BSD licensed version
.if (${OSVERSION} >= 602105) && \
    (${OSVERSION} < 700000 || ${OSVERSION} >= 700029)
USE_AUTOTOOLS=	autoconf:261:env	# autom4te
EXTRA_PATCHES=	${PATCHDIR}/extra-patch-tests_gzip.at
.endif

# avoid triggering auto framework rebuilds
# FreeBSD 5.5 makeinfo can't rebuild tar.info
post-patch:
	@${TOUCH} -r ${WRKSRC}/configure.orig ${WRKSRC}/configure
	@${TOUCH} ${WRKSRC}/doc/tar.info* ${WRKSRC}/stamp-vti

regression-test: build
	@cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} ${MAKE} check

.include <bsd.port.post.mk>
