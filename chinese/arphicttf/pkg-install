#!/bin/sh

if [ "$2" = "PRE-INSTALL" ]; then
  exit 0
fi

PKGNAME=$1
PREFIX=${PKG_PREFIX}
TTFM=${PREFIX}/bin/ttfm.sh

FONTDIR=${PREFIX}/share/fonts/TrueType
FONTS="bkai00mp.ttf bsmi00lp.ttf gbsn00lp.ttf gkai00mp.ttf"
DEFAULTMING="bsmi00lp.ttf gbsn00lp.ttf"
DEFAULTKAI="bkai00mp.ttf gkai00mp.ttf"

[ "X$WANT_X" = "X" ] && WANT_X=YES

if [ ! -x $TTFM ]; then
    echo "$TTFM not found!"
    exit 1
fi

rm -f $FONTDIR/$PKGNAME

if [ "$WANT_CJK" = "YES" -o "$WANT_CJK" = "yes" ]; then
    # There's no CJK module now.
fi

if [ "$WANT_GS6" = "YES" -o "$WANT_GS6" = "yes" ]; then
    for f in $FONTS; do
        $TTFM --add ghostscript6 $FONTDIR/$f
    done
    for f in $DEFAULTMING; do
        $TTFM --setdefault ghostscript6 $FONTDIR/$f
    done
    for f in $DEFAULTKAI; do
        $TTFM --setdefault_kai ghostscript6 $FONTDIR/$f
    done
    echo "ghostscript6" >> $FONTDIR/$PKGNAME
fi

if [ "$WANT_X" = "YES" -o "$WANT_X" = "yes" ]; then
    for f in $FONTS; do
        $TTFM --add xttfm $FONTDIR/$f
    done
    for f in $DEFAULTMING; do
        $TTFM --setdefault xttfm $FONTDIR/$f
    done
    for f in $DEFAULTKAI; do
        $TTFM --setdefault_kai xttfm $FONTDIR/$f
    done
    echo "xttfm" >> $FONTDIR/$PKGNAME
fi

exit 0
