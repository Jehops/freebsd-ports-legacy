#!/bin/sh

# Set printer drivers automatically if BATCH is set

if [ ! "X"${BATCH} = "X" ] ; then

PRINTER_JAPAN=' mjc180.dev mjc360.dev mjc720.dev mj500c.dev lips2p.dev lips3.dev lips4.dev lips4v.dev  bjc880j.dev lp2000.dev escpage.dev npdl.dev nx100f.dev nx100v.dev bj10v.dev bj10vh.dev dmprt.dev md2k.dev md5k.dev'

sed -e "s;XINCLUDE=-I/usr/local/X/include;XINCLUDE=-I/usr/X11R6/include;" \
    -e "s;XLIBDIRS=-L/usr/X11/lib;XLIBDIRS=-L/usr/X11R6/lib;" \
    -e "s;XLDFLAGS=;XLDFLAGS= -L/usr/local/lib;" \
    -e "s;XLIBS=Xt;XLIBS=Xt ICE SM;" \
    -e "s;^VFINCLUDE=;VFINCLUDE=-I/usr/local/include;" \
    -e "s;^VFLIBDIRS=;VFLIBDIRS=-L/usr/local/lib;" \
    -e "s;PVERSION=96;PVERSION=102;" \
    -e "s;SHARE_ZLIB=0;SHARE_ZLIB=1;" \
    -e "s;CC=gcc;CC=cc;" \
    -e "s;DEVICE_DEVS15=pdfwrite.dev;DEVICE_DEVS15=pdfwrite.dev stcolor.dev st800.dev uniprint.dev ${PRINTER_JAPAN};" \
    < ${WRKSRC}/unix-gcc.mak > ${WRKSRC}/unix-gcc.mak.bak && \
    mv ${WRKSRC}/unix-gcc.mak.bak ${WRKSRC}/unix-gcc.mak
touch ${WRKSRC}/makefile

else

# Define the directories for the X11 library files.
# This can be null if these files are in the default linker search path.
sed -e "s;XINCLUDE=-I/usr/local/X/include;XINCLUDE=-I/usr/X11R6/include;" \
    -e "s;XLIBDIRS=-L/usr/X11/lib;XLIBDIRS=-L/usr/X11R6/lib;" \
    -e "s;XLDFLAGS=;XLDFLAGS= -L/usr/local/lib;" \
    -e "s;XLIBS=Xt;XLIBS=Xt ICE SM;" \
    -e "s;^VFINCLUDE=;VFINCLUDE=-I/usr/local/include;" \
    -e "s;^VFLIBDIRS=;VFLIBDIRS=-L/usr/local/lib;" \
    -e "s;PVERSION=96;PVERSION=102;" \
    -e "s;SHARE_ZLIB=0;SHARE_ZLIB=1;" \
    -e "s;CC=gcc;CC=cc;" \
    -e "s;^DEVICE_DEVS=.*;;" \
    -e "s;^DEVICE_DEVS1=.*;DEVICE_DEVS1=;" \
    -e "s;^DEVICE_DEVS2=.*;DEVICE_DEVS2=;" \
    -e "s;^DEVICE_DEVS3=.*;DEVICE_DEVS3=;" \
    -e "s;^DEVICE_DEVS4=.*;DEVICE_DEVS4=;" \
    -e "s;^DEVICE_DEVS5=.*;DEVICE_DEVS5=;" \
    -e "s;^DEVICE_DEVS6=.*;DEVICE_DEVS6=;" \
    -e "s;^DEVICE_DEVS7=.*;DEVICE_DEVS7=;" \
    -e "s;^DEVICE_DEVS8=.*;DEVICE_DEVS8=;" \
    -e "s;^DEVICE_DEVS9=.*;DEVICE_DEVS9=;" \
    -e "s;^DEVICE_DEVS10=.*;DEVICE_DEVS10=;" \
    -e "s;^DEVICE_DEVS11=.*;DEVICE_DEVS11=;" \
    -e "s;^DEVICE_DEVS12=.*;DEVICE_DEVS12=;" \
    -e "s;^DEVICE_DEVS13=.*;DEVICE_DEVS13=;" \
    -e "s;^DEVICE_DEVS14=.*;DEVICE_DEVS14=;" \
    -e "s;^DEVICE_DEVS15=.*;DEVICE_DEVS15=;" \
    < ${WRKSRC}/unix-gcc.mak > ${WRKSRC}/unix-gcc.mak.bak && \
    mv ${WRKSRC}/unix-gcc.mak.bak ${WRKSRC}/unix-gcc.mak

# without that no way :)
touch ${WRKSRC}/makefile

# driverselection
/usr/bin/dialog --title "ja-VFGhostscript driver configuration" --clear \
	--checklist "\n\
This new ghostscript driver configuration dialog allows you to choose \n\
only those gs drivers, you really need. Don't think too economical, since \n\
other programs in the ports collection might need some of the default gs \n\
file format drivers. The gs4 default drivers and some drivers for Japanese \n\
printers are preselected. \n\
Have fun with this new configuration style !     -andreas \n\n\
  Please choose options by pressing SPACE to TOGGLE an option ON/OFF ?" -1 -1 9\
   "x11"      "X version 11, release >=4" ON \
   "x11alpha" "X masquer. as device with alpha capability" ON \
   "x11cmyk"  "X masquer. as 1-bit-per-plane CMYK device" ON \
   "x11cmyk2"  "X masquer. as 2-bit-per-plane CMYK device" ON \
   "x11cmyk4"  "X masquer. as 4-bit-per-plane CMYK device" OFF \
   "x11cmyk8"  "X masquer. as 8-bit-per-plane CMYK device" OFF \
   "x11gray2" "X masquer. as device with 2-bit gray-scale device" ON \
   "x11gray4" "X masquer. as device with 4-bit gray-scale device" OFF \
   "x11mono"  "X masquer. as black-and-white device" ON \
   "appledmp" "Apple Dot Matrix Printer / Imagewriter" OFF \
   "iwhi"     "Apple Imagewriter, high-resolution mode" OFF \
   "iwlo"     "Apple Imagewriter, low-resolution mode" OFF \
   "iwlq"     "Apple Imagewriter LQ in 320 x 216 dpi mode" OFF \
   "bj10e"    "Canon BubbleJet BJ10e" ON \
   "bj10v"    "Canon BubbleJet BJ10v" ON \
   "bj10vh"   "Canon BubbleJet BJ10v" ON \
   "bj200"    "Canon BubbleJet BJ200" ON \
   "bjc600"   "Canon Color BubbleJet BJC-600/4000/70" ON \
   "bjc800"   "Canon Color BubbleJet BJC-800" ON \
   "lbp8"     "Canon LBP-8II laser printer" OFF \
   "lips2p"   "Canon LIPS II+ laser printer " OFF \
   "lips3"    "Canon LIPS III laser printer " ON \
   "lips4"    "Canon LIPSIV laser printer, mono" ON \
   "bjc880j"  "Canon Color BubbleJet BJC-680J/880J (LIPS IV)" ON \
   "lips4v"   "Canon LIPSIV laser printer(Vector)" ON \
   "ccr"      "CalComp Raster format" OFF \
   "lj250"    "DEC LJ250 Companion color printer" OFF \
   "declj250" "alternate DEC LJ250 driver" OFF \
   "dmprt"    "Generic Printer" ON \
   "ap3250"   "Epson AP3250" OFF \
   "escpage"  "Epson ESC/Page laser printer 60-600dpi, mono" ON \
   "lp2000"   "Epson LP-2000/3000/7000/7000G, mono" ON \
   "md2k"     "ALPS MD2000/2010/4000/1300/1500/5000 driver" ON \
   "md5k"     "ALPS MD5000 driver" ON \
   "md50Mono" "ALPS MD5000 monochrome driver" OFF \
   "md50Eco"  "ALPS MD5000 monochrome driver, economy mode" OFF \
   "md1xMono" "ALPS MD1300 MD5000 monochrome driver" OFF \
   "mjc180"   "Epson MachJet series  180dpi, CMYK" ON \
   "mjc360"   "Epson MachJet series  360dpi, CMYK" ON \
   "mjc720"   "Epson MachJet series  720dpi, CMYK" ON \
   "mj500c"   "Epson MachJet MJ-500C 360dpi, CMY or mono" ON \
   "epson"    "Epson-compatible dot matrix, 9/24-pin" OFF \
   "eps9mid"  "Epson-compatible 9-pin, medium resol" OFF \
   "eps9high" "Epson-compatible 9-pin, high resol" OFF \
   "epsonc"   "Epson LQ-2550 and Fujitsu 3400/2400/1200 color" OFF \
   "lp8000"   "Epson LP8000 laser printer" OFF \
   "st800"    "Epson Stylus 800 printer" ON \
   "stcolor"  "Epson Stylus Color" ON \
   "ibmpro"   "IBM 9-pin Proprinter" OFF \
   "jetp3852" "IBM Jetprinter ink-jet color (Model #3852)" OFF \
   "imagen"   "Imagen ImPress printers" OFF \
   "cljet5"   "HP Color LaserJet 5/5M" ON \
   "cdeskjet" "HP DeskJet 500C, 1 bit/pixel color" ON \
   "cdjcolor" "HP DeskJet 500C/540C, 24 bit/pixel color + FS dithering" ON \
   "cdjmono"  "HP DeskJet 500/510/520/540C b/w printing" ON \
   "cdj550"   "HP DeskJet 550C/560C" ON \
   "deskjet"  "HP DeskJet and DeskJet Plus" ON \
   "djet500"  "HP DeskJet 500" ON \
   "djet500c" "HP DeskJet 500C alternate driver, not for 550/560C" OFF \
   "dnj650c"  "HP DesignJet 650C" OFF \
   "laserjet" "HP LaserJet" ON \
   "ljet2p"   "HP LaserJet IId/IIp/III* with TIFF compression" ON \
   "ljet3"    "HP LaserJet III* with Delta Row compression" ON \
   "ljet3d"   "HP LaserJet IIID with duplex capability" OFF \
   "ljet4"    "HP LaserJet 4 (defaults to 600 dpi)" ON \
   "lj4dith"  "HP LaserJet 4 with Floyd-Steinberg dithering" ON \
   "lj5mono"  "HP LaserJet 5  & 6 family (PCL XL), bitmap" OFF \
   "lj5gray"  "HP LaserJet 5  & 6 family (PCL XL), gray-scale bitmap" OFF \
   "ljetplus" "HP LaserJet Plus" ON \
   "lp2563"   "HP 2563B line printer" OFF \
   "pj"       "HP PaintJet XL driver " ON \
   "paintjet" "alternate HP PaintJet color printer" OFF \
   "pjetxl"   "alternate HP PaintJet XL driver" OFF \
   "pjxl"     "HP PaintJet XL color printer" ON \
   "pjxl300"  "HP PaintJet XL300 color printer (also for 1200C)" ON \
   "paintjet" "alternate HP PaintJet color printer" OFF \
   "pjetxl"   "alternate HP PaintJet XL driver" OFF \
   "pjxl"     "HP PaintJet XL color printer" ON \
   "pjxl300"  "HP PaintJet XL300 color printer (also for 1200C)" ON \
   "m8510"    "C.Itoh M8510 printer" OFF \
   "cp50"     "Mitsubishi CP50 color" OFF \
   "necp6"    "NEC P6/P6+/P60, 360x360 DPI resol" OFF \
   "npdl"     "NEC Printer Description Language (NPDL)" ON \
   "oce9050"  "OCE 9050 printer" OFF \
   "oki182"   "Okidata MicroLine 182" OFF \
   "okiibm"   "Okidata MicroLine IBM-compatible printers" OFF \
   "r4081"    "Ricoh 4081 laser printer" OFF \
   "nx100f"  "Ricoh Printer Description Language (RPDL) (fixed)" ON \
   "nx100v"  "Ricoh Printer Description Language (RPDL) (variable)" ON \
   "nwp533"   "Sony Microsystems NWP533 laser printer" OFF \
   "sj48"     "StarJet 48 inkjet printer" OFF \
   "t4693d2"  "Tektronix 4693d color, 2 bits per R/G/B component" OFF \
   "t4693d4"  "Tektronix 4693d color, 4 bits per R/G/B component" OFF \
   "t4693d8"  "Tektronix 4693d color, 8 bits per R/G/B component" OFF \
   "tek4696"  "Tektronix 4695/4696 inkjet plotter" OFF \
   "uniprint" "Unified printer driver ESC/P ESC/P2 HP-RTL/PCL..." ON \
   "xes"      "Xerox XES printers (2700, 3700, 4045, etc.)" OFF \
   "dfaxhigh" "DigiBoard, DigiFAX software format (high resol)" OFF \
   "dfaxlow"  "DigiFAX low (normal) resol" OFF \
   "faxg3"    "Group 3 fax, with EOLs but no header or EOD" ON \
   "faxg32d"  "Group 3 2-D fax, with EOLs but no header or EOD" ON \
   "faxg4"    "Group 4 fax, with EOLs but no header or EOD" ON \
   "tiffcrle" "TIFF CCITT RLE 1 dim = Group 3 fax with no EOLs" ON \
   "tiffg3"   "TIFF Group 3 fax with EOLs" ON \
   "tiffg32d" "TIFF Group 3 2-D fax" ON \
   "tiffg4"   "TIFF Group 4 fax" ON \
   "bit"      "Plain bits, monochrome" ON \
   "bitrgb"   "Plain bits, RGB" ON \
   "bitcmyk"  "Plain bits, CMYK" ON \
   "bmpmono"  "Monochrome MS Windows .BMP file format" OFF \
   "bmp16"    "4-bit EGA/VGA .BMP file format" OFF \
   "bmp256"   "8-bit 256-color .BMP file format" OFF \
   "bmp16m"   "24-bit .BMP file format" OFF \
   "cgmmono"  "Monochrome CGM -- LOW LEVEL OUTPUT ONLY" OFF \
   "cgm8"     "8-bit 256-color CGM -- DITTO" OFF \
   "cgm24"    "24-bit color CGM -- DITTO" OFF \
   "cif"      "CIF file format for VLSI" OFF \
   "jpeg"     "JPEG format, RGB output" ON \
   "jpeggray" "JPEG format, gray output" ON \
   "miff24"   "ImageMagick MIFF, 24-bit direct color, RLE compressed" OFF \
   "mgrmono"  "1-bit monochrome MGR devices" OFF \
   "mgrgray2" "2-bit gray scale MGR devices" OFF \
   "mgrgray4" "4-bit gray scale MGR devices" OFF \
   "mgrgray8" "8-bit gray scale MGR devices" OFF \
   "mgr4"     "4-bit (VGA) color MGR devices" OFF \
   "mgr8"     "8-bit color MGR devices" OFF \
   "pcxmono"  "PCX file format, monochrome 1-bit b/w" ON \
   "pcxgray"  "PCX file format, 8-bit gray scale" ON \
   "pcx16"    "PCX file format, 4-bit planar EGA/VGA color" ON \
   "pcx256"   "PCX file format, 8-bit chunky color" ON \
   "pcx24b"   "PCX file format, 24-bit color 3x8-bit planes" ON \
   "pcxcmyk"  "PCX file format,  4-bit chunky CMYK color" ON \
   "pbm"      "Portable Bitmap,  plain format" ON \
   "pbmraw"   "Portable Bitmap,  raw format" ON \
   "pgm"      "Portable Graymap, plain format" ON \
   "pgmraw"   "Portable Graymap, raw format" ON \
   "pgnm"     "Portable Graymap, plain format, optim. to PBM" ON \
   "pgnmraw"  "Portable Graymap, raw format, optim. to PBM" ON \
   "pnm"      "Portable Pixmap,  plain format RGB, optim. to PGM/PBM" ON \
   "pnmraw"   "Portable Pixmap,  raw format RGB, optim. to PGM/PBM" ON \
   "ppm"      "Portable Pixmap,  plain format RGB" ON \
   "ppmraw"   "Portable Pixmap,  raw format RGB" ON \
   "pkm"      "Portable inKmap   plain format 4bit CMYK to RGB" OFF \
   "pkmraw"   "Portable inKmap   raw format 4bit CMYK to RGB" OFF \
   "pngmono"  "Monochrome Portable Network Graphics, PNG" ON \
   "pnggray"  "8-bit gray Portable Network Graphics, PNG" ON \
   "png16"    "4-bit color Portable Network Graphics, PNG" ON \
   "png256"   "8-bit color Portable Network Graphics, PNG" ON \
   "png16m"   "24-bit color Portable Network Graphics, PNG" ON \
   "psmono"   "PostScript, Level 1, monochrome image" ON \
   "psgray"   "PostScript, Level 1, grayscale  image" ON \
   "epswrite" "EPS output" ON \
   "pdfwrite" "PDF output" ON \
   "pswrite"  "PostScript output" ON \
   "pxlmono"  "Black-and-white PCL XL" ON \
   "pxlcolor" "Color PCL XL" ON \
   "sgirgb"   "SGI RGB pixmap format" OFF \
   "tiff12nc" "TIFF 12-bit RGB, no compression" ON \
   "tiff24nc" "TIFF 24-bit RGB, no compression, NeXT std. format)" ON \
   "tifflzw"  "TIFF LZW,      tag = 5,     mono" ON \
   "tiffpack" "TIFF PackBits, tag = 32773, mono" ON 2> /tmp/checklist.tmp.$$

retval=$?

choice=`cat /tmp/checklist.tmp.$$`
rm -f /tmp/checklist.tmp.$$

case $retval in
	0)	if [ -z choice ]; then
			echo "Nothing selected"
			exit 1;
		fi
		;;
	1)	echo "Cancel pressed."
		exit 1
		;;
esac

# bring it into the right format with '.dev' appended to each driver name
echo "DEVICE_DEVS=$choice" \
	| sed -e "s/\"//g" \
	| sed -e "s/ /.dev /g" \
	| sed -e "s/$/.dev/g" \
	> ${WRKSRC}/unix-gcc.mak.new

# create one new Makefile, where DEVICE_DEVS contains all wanted devices
cat ${WRKSRC}/unix-gcc.mak >> ${WRKSRC}/unix-gcc.mak.new
mv ${WRKSRC}/unix-gcc.mak.new ${WRKSRC}/unix-gcc.mak
fi
