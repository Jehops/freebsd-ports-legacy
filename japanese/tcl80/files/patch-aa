--- configure.in.ORIG	Wed Dec  8 10:58:41 1999
+++ configure.in	Wed Dec  8 10:58:50 1999
@@ -851,15 +851,21 @@
     NetBSD-*|FreeBSD-*|OpenBSD-*)
 	# Not available on all versions:  check for include file.
 	AC_CHECK_HEADER(dlfcn.h, [
+	# FreeBSD-current supports elf format, now.
+	    if test "X$PORTOBJFORMAT" = "Xelf"; then
+	       SHLIB_LD='${CC} -shared -Wl,-x'
+	       TCL_SHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}\$\{DBGX\}.so.1'
+	    else
+	       SHLIB_LD="ld -Bshareable -x"
+	       TCL_SHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}\$\{DBGX\}.so.1.5'
+	    fi
 	    SHLIB_CFLAGS="-fpic"
-	    SHLIB_LD="ld -Bshareable -x"
 	    SHLIB_LD_LIBS=""
 	    SHLIB_SUFFIX=".so"
 	    DL_OBJS="tclLoadDl.o"
 	    DL_LIBS=""
 	    LD_FLAGS=""
 	    LD_SEARCH_FLAGS=""
-	    TCL_SHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}\$\{DBGX\}.so.1.0'
 	], [
 	    SHLIB_CFLAGS=""
 	    SHLIB_LD="echo tclLdAout $CC \{$SHLIB_CFLAGS\} | `pwd`/tclsh -r"
@@ -1222,6 +1228,7 @@
 if test "$TCL_UNSHARED_LIB_SUFFIX" = "" ; then
     TCL_UNSHARED_LIB_SUFFIX='${VERSION}\$\{DBGX\}.a'
 fi
+TCL_STATIC_LIB_FILE=""
 AC_ARG_ENABLE(shared,
     [  --enable-shared         build libtcl as a shared library],
     [tcl_ok=$enableval], [tcl_ok=no])
@@ -1230,10 +1237,15 @@
     TCL_SHLIB_CFLAGS="${SHLIB_CFLAGS}"
     TCL_LD_SEARCH_FLAGS="${LD_SEARCH_FLAGS}"
     eval "TCL_LIB_FILE=libtcl${TCL_SHARED_LIB_SUFFIX}"
+    eval "TCL_STATIC_LIB_FILE=libtcl${TCL_UNSHARED_LIB_SUFFIX}"
     if test "x$DL_OBJS" = "xtclLoadAout.o"; then
 	MAKE_LIB="ar cr \${TCL_LIB_FILE} \${OBJS}"
     else
-	MAKE_LIB="\${SHLIB_LD} -o \${TCL_LIB_FILE} \${OBJS} ${SHLIB_LD_LIBS}"
+        if test "X$PORTOBJFORMAT" = "Xelf"; then
+	   MAKE_LIB="\${SHLIB_LD} -o \${TCL_LIB_FILE} \${OBJS} -Wl,-S,-soname=${TCL_LIB_FILE} ${SHLIB_LD_LIBS}"
+	else
+	   MAKE_LIB="\${SHLIB_LD} -o \${TCL_LIB_FILE} \${OBJS} ${SHLIB_LD_LIBS}"
+	fi
 	RANLIB=":"
     fi
 else
@@ -1274,6 +1286,7 @@
 # Trick to replace DBGX with TCL_DBGX
 DBGX='${TCL_DBGX}'
 eval "TCL_LIB_FILE=${TCL_LIB_FILE}"
+eval "TCL_STATIC_LIB_FILE=${TCL_STATIC_LIB_FILE}"
 
 VERSION='${VERSION}'
 eval "CFG_TCL_SHARED_LIB_SUFFIX=${TCL_SHARED_LIB_SUFFIX}"
@@ -1313,6 +1326,7 @@
 AC_SUBST(TCL_BUILD_LIB_SPEC)
 AC_SUBST(TCL_LD_SEARCH_FLAGS)
 AC_SUBST(TCL_LIB_FILE)
+AC_SUBST(TCL_STATIC_LIB_FILE)
 AC_SUBST(TCL_LIB_FLAG)
 AC_SUBST(TCL_LIB_SPEC)
 AC_SUBST(TCL_LIB_VERSIONS_OK)
