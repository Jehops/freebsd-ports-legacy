--- Makefile.orig	Wed Aug  6 08:06:01 1997
+++ Makefile	Tue Sep 30 22:53:23 1997
@@ -1,6 +1,9 @@
-TARGETDIR = /usr/X11R6/lib/X11/fonts/misc
+TARGETDIR = ${PREFIX}/lib/X11/fonts/misc
 
-all:	k20b.pcf.Z k20m.pcf.Z 10x20b.pcf.Z 10x20m.pcf.Z 10x20rkb.pcf.Z 10x20rkm.pcf.Z
+TARGETS = k20b.pcf.Z k20m.pcf.Z 10x20b.pcf.Z 10x20m.pcf.Z \
+	10x20rkb.pcf.Z 10x20rkm.pcf.Z
+
+all: $(TARGETS)
 
 k20b.pcf.Z:	k20b.bdf
 	bdftopcf k20b.bdf | compress > k20b.pcf.Z
@@ -20,13 +23,14 @@
 10x20rkm.pcf.Z:	10x20rkm.bdf
 	bdftopcf 10x20rkm.bdf | compress > 10x20rkm.pcf.Z
 
-install:	k20b.pcf.Z k20m.pcf.Z 10x20b.pcf.Z 10x20m.pcf.Z 10x20rkb.pcf.Z 10x20rkm.pcf.Z
-	install -c -m 0644 k20b.pcf.Z k20m.pcf.Z 10x20b.pcf.Z 10x20m.pcf.Z 10x20rkb.pcf.Z 10x20rkm.pcf.Z ${TARGETDIR}
-	grep -h '[^0-9]' fonts.dir ${TARGETDIR}/fonts.dir | sort -u > fonts.dir.tmp
-	wc -l fonts.dir.tmp | awk '{print $$1}' | cat - fonts.dir.tmp > ${TARGETDIR}/fonts.dir
-	sort -u fonts.alias ${TARGETDIR}/fonts.alias > fonts.alias.tmp
-	install -m 0644 fonts.alias.tmp ${TARGETDIR}/fonts.alias
+install: $(TARGETS)
+	${INSTALL_DATA} $(TARGETS) $(TARGETDIR)
+	@echo "updating fonts.dir and fonts.alias"
+	@(cd $(TARGETDIR) ; mkfontdir . ; touch fonts.alias ; \
+	cp fonts.alias fonts.alias.orig)
+	@(cd $(TARGETDIR) ; cat fonts.alias.orig ; grep -i -- '-kappa-' fonts.dir | \
+	sed 's/\.pcf\.Z//;s/x20rkm/x20rk/') >$(TARGETDIR)/fonts.alias
+	@rm $(TARGETDIR)/fonts.alias.orig
 
 clean:
-	rm -f fonts.dir.tmp
-	rm -f k20b.pcf.Z k20m.pcf.Z 10x20b.pcf.Z 10x20m.pcf.Z 10x20rkb.pcf.Z 10x20rkm.pcf.Z
+	rm -f $(TARGETS)
