--- unix-gcc.mak.orig	Sat Sep 30 17:32:21 2000
+++ unix-gcc.mak	Sat Sep 30 17:35:22 2000
@@ -82,11 +82,10 @@
 # initialization files (gs_*.ps) and the fonts.
 
 # If your system has installbsd, change install to installbsd in the next line.
-INSTALL = install -c
-INSTALL_PROGRAM = $(INSTALL) -m 755
-INSTALL_DATA = $(INSTALL) -m 644
+INSTALL_PROGRAM = $(BSD_INSTALL_SCRIPT)
+INSTALL_DATA = $(BSD_INSTALL_DATA)
 
-prefix = /usr/local
+prefix = $(PREFIX)
 exec_prefix = $(prefix)
 bindir = $(exec_prefix)/bin
 scriptdir = $(bindir)
@@ -143,7 +142,7 @@
 # You may need to change this if the IJG library version changes.
 # See jpeg.mak for more information.
 
-JSRCDIR=jpeg-6a
+JSRCDIR=jpeg
 JVERSION=6
 
 # Define the directory where the PNG library sources are stored,
@@ -151,14 +150,14 @@
 # You may need to change this if the libpng version changes.
 # See libpng.mak for more information.
 
-PSRCDIR=libpng
+PSRCDIR=${LOCALBASE}/include
 PVERSION=96
 
 # Choose whether to use a shared version of the PNG library, and if so,
 # what its name is.
 # See gs.mak and make.txt for more information.
 
-SHARE_LIBPNG=0
+SHARE_LIBPNG=1
 LIBPNG_NAME=png
 
 # Define the directory where the zlib sources are stored.
@@ -170,7 +169,7 @@
 # what its name is (usually libz, but sometimes libgz).
 # See gs.mak and make.txt for more information.
 
-SHARE_ZLIB=0
+SHARE_ZLIB=1
 #ZLIB_NAME=gz
 ZLIB_NAME=z
 
@@ -189,7 +188,7 @@
 
 # Define the name of the C compiler.
 
-CC=gcc
+#CC=gcc
 
 # Define the name of the linker for the final link step.
 # Normally this is the same as the C compiler.
@@ -216,12 +215,12 @@
 #   gcc to accept ANSI-style function prototypes and function definitions.
 XCFLAGS=
 
-CFLAGS=-O $(GCFLAGS) $(XCFLAGS)
+#CFLAGS=-O $(GCFLAGS) $(XCFLAGS)
 
 # Define platform flags for ld.
 # SunOS 4.n may need -Bstatic.
 # XLDFLAGS can be set from the command line.
-XLDFLAGS=
+XLDFLAGS=-L${LOCALBASE}/lib
 
 LDFLAGS=$(XLDFLAGS)
 
@@ -241,7 +240,7 @@
 # Note that x_.h expects to find the header files in $(XINCLUDE)/X11,
 # not in $(XINCLUDE).
 
-XINCLUDE=-I/usr/local/X/include
+XINCLUDE=-I${X11BASE}/include
 
 # Define the directory/ies and library names for the X11 library files.
 # XLIBDIRS is for ld and should include -L; XLIBDIR is for LD_RUN_PATH
@@ -256,7 +255,7 @@
 #XLIBS=Xt SM ICE Xext X11
 
 #XLIBDIRS=-L/usr/local/X/lib
-XLIBDIRS=-L/usr/X11/lib
+XLIBDIRS=-L${X11BASE}/lib
 XLIBDIR=
 XLIBS=Xt Xext X11
 
@@ -3719,8 +3718,8 @@
 libpng95.dev: $(LIBPNG_MAK) $(ECHOGS_XE) pngwio.$(OBJ) crc32.dev
 	$(SETMOD) libpng95 pngwio.$(OBJ) -include crc32
 
-libpng96.dev: $(LIBPNG_MAK) $(ECHOGS_XE) pngwio.$(OBJ) crc32.dev
-	$(SETMOD) libpng96 pngwio.$(OBJ) -include crc32
+libpng96.dev: $(LIBPNG_MAK) $(ECHOGS_XE) pngwio.$(OBJ) # crc32.dev
+	$(SETMOD) libpng96 pngwio.$(OBJ) # -include crc32
 #    Copyright (C) 1995, 1996, 1997 Aladdin Enterprises.  All rights reserved.
 # 
 # This file is part of GNU Ghostscript.
@@ -4849,9 +4848,6 @@
 lbp8.dev: $(lbp8_) page.dev
 	$(SETPDEV) lbp8 $(lbp8_)
 
-lips3.dev: $(lbp8_) page.dev
-	$(SETPDEV) lips3 $(lbp8_)
-
 gdevlbp8.$(OBJ): gdevlbp8.c $(PDEVH)
 
 ### ----------- The DEC LN03/LA50/LA70/LA75 printer devices ------------ ###
@@ -5508,11 +5504,14 @@
 
 # ---------------- Kanji Font Utility ---------------- #
 
-kanji_=kfutil.$(OBJ)
+kanji_=kfutil.$(OBJ) zkfimpath.$(OBJ)
 kanji.dev: $(kanji_)
 	$(SETMOD) kanji $(kanji_)
+	$(ADDMOD) kanji -oper zkfimagepath
 
 kfutil.$(OBJ): kfutil.c $(OP) $(gsmatrix_h)
+zkfimpath.$(OBJ): zkfimpath.c $(OP) $(gsmatrix_h) $(gspath_h) \
+					$(igstate_h) $(store_h)
 
 # ---------------- Kanji Font(VFlib) ---------------- #
 
@@ -5520,10 +5519,13 @@
 kfvflib.dev: $(kfvflib_) kanji.dev
 	$(SETMOD) kfvflib $(kfvflib_)
 	$(ADDMOD) kfvflib -oper zkfVFlib
-	$(ADDMOD) kfvflib -ps kfvflib
-	$(ADDMOD) kfvflib -lib VFlib
+	$(ADDMOD) kfvflib -ps kfvflib kfvfbm
+	$(ADDMOD) kfvflib -lib VFlib2
+## VFlib without freetype
+	$(ADDMOD) kfvflib -lib ttf    
 
 zkfvflib.$(OBJ): zkfvflib.c 
+	${CC} ${CFLAGS} -I${LOCALBASE}/include -c zkfvflib.c
 
 #    Copyright (C) 1990, 1995, 1996, 1997 Aladdin Enterprises.  All rights reserved.
 # 
@@ -5666,6 +5668,9 @@
 	./echogs -w ldt.tr -n - $(CCLD) $(LDFLAGS) $(XLIBDIRS) -o $(GS_XE)
 	./echogs -a ldt.tr -n -s gs.$(OBJ) -s
 	cat ld.tr >>ldt.tr
+.if ${PORTOBJFORMAT} == "elf"
+	echo '-lICE -lSM \' >>ldt.tr
+.endif
 	./echogs -a ldt.tr -s - $(EXTRALIBS) -lm
 	LD_RUN_PATH=$(XLIBDIR); export LD_RUN_PATH; \
 	XCFLAGS= XINCLUDE= XLDFLAGS= XLIBDIRS= XLIBS= \
