--- src/Makefile.orig	Fri Mar 20 12:26:36 1998
+++ src/Makefile	Fri Mar 20 13:52:16 1998
@@ -24,6 +24,11 @@
 ### VFlib configurations
 #-------------------------
 
+# Default macros setting
+     PREFIX         ?= /usr/local
+     FREETYPELIBDIR ?= ${PREFIX}/lib
+     FREETYPEINCDIR ?= ${PREFIX}/include
+
 # Maximum of open files
     OPENFILES = -DMAX_OPEN_FONT_FILES=6
 
@@ -33,11 +38,11 @@
 
 # FreeType
      USEFTYPE = -DUSE_FREETYPE
-     FTYPELIB = -L../../freetype-1.0/lib -lttf
-     FTYPEINC = -I../../freetype-1.0/lib
+     FTYPELIB = -L${FREETYPELIBDIR} -lttf
+     FTYPEINC = -I${FREETYPEINCDIR}
 
 # VFontcap file
-        VFCAP = -DDEFAULT_VFCAP=\"/usr/local/TeX/lib/vfontcap\"
+        VFCAP = -DDEFAULT_VFCAP=\"${PREFIX}/lib/VFlib/vfontcap\"
 
 # OS and Machine dependent compiling options
 #  Define __MSDOS__ (e.g., CCOPT=-D__MSDOS__) if you compile VFlib on MS-DOS
@@ -50,7 +55,7 @@
 # Compilers, compiling options, etc.
 #-------------------------
         CC = cc
-    CFLAGS = $(CCOPT) $(DEBUGOPT) -O
+#    CFLAGS = $(CCOPT) $(DEBUGOPT) -O -m486
 
    LDFLAGS = $(LDOPT)
   SYS_LIBS = -lm
@@ -70,14 +75,14 @@
 #       ARC = ld -assert pure-text -o	# SunOS4
 #       ARC = ld -Bshareable -o		# FreeBSD
 #    RANLIB = echo
-#   LIBNAME = VFlib.so.2.22
+   LIBSNAME = VFlib.so.2.22
 
 #-------------------------
 # Installation Directories
 #-------------------------
-INSTALL_LIBDIR=/usr/local/lib
-INSTALL_INCDIR=/usr/local/include
-INSTALL_BINDIR=/usr/local/etc
+INSTALL_LIBDIR=${PREFIX}/lib
+INSTALL_INCDIR=${PREFIX}/include
+INSTALL_BINDIR=${PREFIX}/lib/VFlib
 
 
 
@@ -96,9 +101,9 @@
 FS=unix
 #endif
 
-default: lib$(LIBNAME) ttindex bdfindex fwindex
+default: lib$(LIBNAME) lib$(LIBSNAME) ttindex bdfindex fwindex
 
-all: lib$(LIBNAME) ttindex bdfindex fwindex
+all: lib$(LIBNAME) lib$(LIBSNAME) ttindex bdfindex fwindex
 
 
 install:
@@ -106,6 +111,7 @@
 	$(CP) $(LIBNAME) $(INSTALL_LIBDIR)/$(LIBNAME)
 	-$(RANLIB) $(INSTALL_LIBDIR)/$(LIBNAME)
 	$(LN) $(INSTALL_LIBDIR)/$(LIBNAME) $(INSTALL_LIBDIR)/lib$(LIBNAME)
+	$(INSTALL) -c -m 644 lib$(LIBSNAME) $(INSTALL_LIBDIR)/lib$(LIBSNAME)
 	$(CP) VF.h $(INSTALL_INCDIR)/VF.h
 	$(CP) ttindex $(INSTALL_BINDIR)/ttindex
 	$(CP) bdfindex $(INSTALL_BINDIR)/bdfindex
@@ -113,16 +119,19 @@
 
 clean:
 	-$(RM) -rf $(LIBNAME) lib$(LIBNAME) ttindex bdfindex fwindex bdfjpindex \
-		   *.o core
+		   *.o core *.so lib$(LIBSNAME)
 veryclean:
 	-$(RM) -rf $(LIBNAME) lib$(LIBNAME) ttindex bdfindex fwindex bdfjpindex\
-	           *.o core *~ \#tz* 
+	           *.o core *~ \#tz* *.so lib$(LIBSNAME)
 
 
 # Font drivers
 DRV_OBJ=  VF_Sony.o VF_Zeit.o VF_Jg.o VF_TT.o VF_Bdf.o VF_Hbf.o hbf.o \
 	  VF_Comp.o VF_BitOp.o VF_FNTWV.o VF_Comp2.o VF_Null.o VF_FType.o
 
+DRV_SOBJ=  VF_Sony.so VF_Zeit.so VF_Jg.so VF_TT.so VF_Bdf.so VF_Hbf.so hbf.so \
+	   VF_Comp.so VF_BitOp.so VF_FNTWV.so VF_Comp2.so VF_Null.so VF_FType.so
+
 
 # VFlib
 lib$(LIBNAME):	VFlib.o VFenc.o VFEtable.o VFcap.o fn2ent.o fman.o $(DRV_OBJ)
@@ -132,6 +141,11 @@
 	$(CP) lib$(LIBNAME) $(LIBNAME)
 	-$(RANLIB) $(LIBNAME)
 
+lib$(LIBSNAME):	VFlib.so VFenc.so VFEtable.so VFcap.so fn2ent.so fman.so $(DRV_SOBJ)
+	$(LD) -x -Bshareable -o lib$(LIBSNAME) \
+	VFlib.so VFenc.so VFEtable.so VFcap.so fn2ent.so fman.so $(DRV_SOBJ) \
+	$(FTYPELIB)
+
 # VFlib
 VFlib.o:  	VFlib.c
 	$(CC) $(CFLAGS) $(USEFSLIB) $(USEFTYPE)  -c VFlib.c
@@ -185,9 +199,92 @@
 # Null font driver
 VF_Null.o:  	VF_Null.c
 	$(CC) $(CFLAGS)  -c VF_Null.c
+
+# VFlib
+VFlib.so:       VFlib.c
+	$(CC) -fpic -DPIC $(CFLAGS) $(USEFSLIB) $(USEFTYPE) -c VFlib.c -o $(.TARGET)
+	$(LD) -O $(.TARGET) -x -r $(.TARGET)
+
+# font capability database 
+VFcap.so:	VFcap.c
+	$(CC) -fpic -DPIC $(CFLAGS) $(VFCAP) -c VFcap.c -o $(.TARGET)
+	$(LD) -O $(.TARGET) -x -r $(.TARGET)
+
+# handling of font encodings
+VFenc.so:	VFenc.c
+	$(CC) -fpic -DPIC $(CFLAGS) -c VFenc.c -o $(.TARGET)
+	$(LD) -O $(.TARGET) -x -r $(.TARGET)
+
+# font encoding and character set tables
+VFEtable.so:	VFEtable.c
+	$(CC) -fpic -DPIC $(CFLAGS) -c VFEtable.c -o $(.TARGET)
+	$(LD) -O $(.TARGET) -x -r $(.TARGET)
+
+# conv font name to font entry name
+fn2ent.so:	fn2ent.c
+	$(CC) -fpic -DPIC $(CFLAGS)  -c fn2ent.c -o $(.TARGET)
+	$(LD) -O $(.TARGET) -x -r $(.TARGET)
+
+# dynamic file stream manager
+fman.so:		fman.c
+	$(CC) -fpic -DPIC $(CFLAGS) $(OPENFILES) -c fman.c -o $(.TARGET)
+	$(LD) -O $(.TARGET) -x -r $(.TARGET)
+
+# Sony Font driver
+VF_Sony.so:  	VF_Sony.c
+	$(CC) -fpic -DPIC $(CFLAGS) $(USEFSLIB) -c VF_Sony.c -o $(.TARGET)
+	$(LD) -O $(.TARGET) -x -r $(.TARGET)
+# Zeit Syotai-Club Font driver
+VF_Zeit.so:  	VF_Zeit.c
+	$(CC) -fpic -DPIC $(CFLAGS)  -c VF_Zeit.c -o $(.TARGET)
+	$(LD) -O $(.TARGET) -x -r $(.TARGET)
+# Zeit JG Font driver
+VF_Jg.so:  	VF_Jg.c
+	$(CC) -fpic -DPIC $(CFLAGS)  -c VF_Jg.c -o $(.TARGET)
+	$(LD) -O $(.TARGET) -x -r $(.TARGET)
+# TrueType Driver
+VF_TT.so:  	VF_TT.c
+	$(CC) -fpic -DPIC $(CFLAGS)  -c VF_TT.c -o $(.TARGET)
+	$(LD) -O $(.TARGET) -x -r $(.TARGET)
+# BDF Driver
+VF_Bdf.so:  	VF_Bdf.c
+	$(CC) -fpic -DPIC $(CFLAGS)  -c VF_Bdf.c -o $(.TARGET)
+	$(LD) -O $(.TARGET) -x -r $(.TARGET)
+# HBF Driver
+VF_Hbf.so:	VF_Hbf.c
+	$(CC) -fpic -DPIC $(CFLAGS) -D$(FS) -c VF_Hbf.c -o $(.TARGET)
+	$(LD) -O $(.TARGET) -x -r $(.TARGET)
+hbf.so:	hbf.c
+	$(CC) -fpic -DPIC $(CFLAGS) -D$(FS) -DNO_STRDUP -c hbf.c -o $(.TARGET)
+	$(LD) -O $(.TARGET) -x -r $(.TARGET)
+# Composite font driver
+VF_Comp.so:  	VF_Comp.c
+	$(CC) -fpic -DPIC $(CFLAGS)  -c VF_Comp.c -o $(.TARGET)
+	$(LD) -O $(.TARGET) -x -r $(.TARGET)
+# Composite font driver
+VF_Comp2.so:  	VF_Comp2.c
+	$(CC) -fpic -DPIC $(CFLAGS)  -c VF_Comp2.c -o $(.TARGET)
+	$(LD) -O $(.TARGET) -x -r $(.TARGET)
+# Bit-Operated font driver
+VF_BitOp.so:  	VF_BitOp.c
+	$(CC) -fpic -DPIC $(CFLAGS)  -c VF_BitOp.c -o $(.TARGET)
+	$(LD) -O $(.TARGET) -x -r $(.TARGET)
+# Null font driver
+VF_Null.so:  	VF_Null.c
+	$(CC) -fpic -DPIC $(CFLAGS)  -c VF_Null.c -o $(.TARGET)
+	$(LD) -O $(.TARGET) -x -r $(.TARGET)
+# FontWave font driver
+VF_FNTWV.so:  	VF_FNTWV.c
+	$(CC) -fpic -DPIC $(CFLAGS)  -c VF_FNTWV.c -o $(.TARGET)
+	$(LD) -O $(.TARGET) -x -r $(.TARGET)
+
 # FreeType driver
 VF_FType.o:  	VF_FType.c
 	$(CC) $(CFLAGS) $(FTYPEINC) $(USEFTYPE) -c VF_FType.c
+VF_FType.so:    VF_FType.c
+	$(CC) -fpic -DPIC $(CFLAGS) $(FTYPEINC) $(USEFTYPE) -c VF_FType.c -o $(.TARGET)
+	$(LD) -O $(.TARGET) -x -r $(.TARGET)
+
 
 # Index generator for TrueType font
 ttindex:	ttindex.c 
