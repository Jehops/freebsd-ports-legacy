# New ports collection makefile for:    elvis + japanese patch
# Version required:     1.8 pl 4 + j 1.1
# Date created:         5 October 1995
# Whom:                 Yoshiro MIHIRA <sanpei@yy.cs.keio.ac.jp>
#
# $Id: Makefile,v 1.8 1997/09/14 23:58:18 max Exp $
#

DISTNAME=       elvis-1.8
PKGNAME=        ja-elvis-1.8.4
CATEGORIES=    japanese editors
MASTER_SITES=   ftp://ftp.cs.pdx.edu/pub/elvis/
EXTRACT_SUFX=	.tgz

PATCH_SITES=    ftp://ftp.foretune.co.jp/pub/tools/jelvis/
PATCHFILES=     jelvis1.8p4-j1.1.tar.Z

MAINTAINER=     sanpei@yy.cs.keio.ac.jp

LIB_DEPENDS=	canna\\.1\\.:${PORTSDIR}/japanese/Canna

NO_WRKSUBDIR=	yes
PATCH_DIST_STRIP=       -p1
MAN1=		elvis.1 ctags.1 ref.1 elvrec.1 elvprsv.1
MANCOMPRESSED=	yes

STARTUP_SCRIPT= ${PREFIX}/etc/rc.d/ja-elvis.sh

do-configure:
	@${CP} ${WRKSRC}/Makefile.mix ${WRKSRC}/Makefile

post-install:
	@${MKDIR} ${PREFIX}/share/doc/ja-elvis
	${INSTALL_DATA} ${WRKSRC}/README.j18 ${PREFIX}/share/doc/ja-elvis
	@${SH} ${PKGDIR}/REQ ${PKGNAME} INSTALL
	@if [ ! -f ${STARTUP_SCRIPT} ]; then				\
		echo "Installing ${STARTUP_SCRIPT} startup file.";	\
		echo '#!/bin/sh' > ${STARTUP_SCRIPT};			\
		echo 'virecovery=`echo /var/tmp/elv_*`'			\
			>> ${STARTUP_SCRIPT};				\
		echo 'if [ "$$virecovery" != '"'/var/tmp/elv_*' ]; then"	\
			>> ${STARTUP_SCRIPT};				\
		echo "	echo 'Recovering ja-elvis editor sessions'"	\
			>> ${STARTUP_SCRIPT};				\
		echo '	for i in $$virecovery; do'			\
			>> ${STARTUP_SCRIPT};				\
		echo "		${PREFIX}/bin/elvprsv "'$$i'		\
			>> ${STARTUP_SCRIPT};				\
		echo '	done'						\
			>> ${STARTUP_SCRIPT};				\
		echo 'fi' >> ${STARTUP_SCRIPT};				\
		chmod 755 ${STARTUP_SCRIPT};				\
		chown bin.bin ${STARTUP_SCRIPT};                        \
	fi

.include <bsd.port.mk>
