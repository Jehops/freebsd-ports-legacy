--- gnome-terminal/gnome-terminal.c.orig	Fri Apr 20 04:46:47 2001
+++ gnome-terminal/gnome-terminal.c	Thu Aug 30 18:46:34 2001
@@ -51,7 +51,7 @@
 
 char **env;
 
-#define DEFAULT_FONT "-misc-fixed-medium-r-normal--20-200-75-75-c-100-iso8859-1"
+#define DEFAULT_FONT "-misc-fixed-medium-r-normal--14-*-*-*-*-*-*-*"
 #define EXTRA 6
 
 /* is there pixmap compiled into zvt */
@@ -102,6 +102,7 @@
 	int scroll_out       :1;       		/* Scroll on output? */
 	int swap_keys        :1;       		/* Swap Delete/Backspace? */
 	int login_by_default :1;                /* do --login as default */
+ 	int use_im           :1;		/* Open XInput Method */         
 #ifdef ZVT_BACKGROUND_SCROLL
 	int scroll_background:1; 		/* background will scroll */
 #endif
@@ -165,6 +166,7 @@
 #endif
 	GtkWidget *login_by_default_checkbox;
 	GtkWidget *use_bold_checkbox;
+ 	GtkWidget *use_im_checkbox;
 	GtkWidget *wordclass_entry;
 	GtkWidget *pixmap_checkbox;
 	GtkWidget *pixmap_file_entry;
@@ -316,7 +318,7 @@
 	char *s;
 	GdkFont *font;
 
-	font = gdk_font_load (font_name);
+	font = gdk_fontset_load (font_name);
 	if (font) {
 #ifdef ZVT_TERM_EMBOLDEN_SUPPORT
 		if (zvt_term_get_capabilities(term) & ZVT_TERM_EMBOLDEN_SUPPORT &&
@@ -528,6 +530,7 @@
 
 	cfg->login_by_default  = gnome_config_get_bool ("login_by_default=0");
 	cfg->use_bold          = gnome_config_get_bool ("use_bold=true");
+	cfg->use_im            = gnome_config_get_bool ("use_im=true");
 
 #ifdef ZVT_BACKGROUND_SCROLL
 	cfg->scroll_background = gnome_config_get_bool ("scroll_background=0");
@@ -593,6 +596,7 @@
 	newcfg->bell           = GTK_TOGGLE_BUTTON (prefs->bell_checkbox)->active;
 	newcfg->blink          = GTK_TOGGLE_BUTTON (prefs->blink_checkbox)->active;
 	newcfg->swap_keys      = GTK_TOGGLE_BUTTON (prefs->swapkeys_checkbox)->active;
+ 	newcfg->use_im         = GTK_TOGGLE_BUTTON (prefs->use_im_checkbox)->active;
 #ifdef HAVE_ZVT_DEL_IS_DEL
 	newcfg->del_is_del     = GTK_TOGGLE_BUTTON (prefs->del_is_del_checkbox)->active;
 #endif
@@ -686,6 +690,7 @@
 	zvt_term_set_scroll_on_output (term, cfg->scroll_out);
 	zvt_term_set_scrollback (term, cfg->scrollback);
 	zvt_term_set_del_key_swap (term, cfg->swap_keys);
+ 	zvt_term_set_open_im (term, cfg->use_im);
 #ifdef HAVE_ZVT_DEL_IS_DEL
 	zvt_term_set_del_is_del (term, cfg->del_is_del);
 #endif
@@ -1030,6 +1035,7 @@
 #endif
 	gnome_config_set_bool   ("login_by_default", cfg->login_by_default);
 	gnome_config_set_bool   ("use_bold", cfg->use_bold);
+	gnome_config_set_bool   ("use_im", cfg->use_im);
 	gnome_config_set_int    ("scrollbacklines", cfg->scrollback);
 	gnome_config_set_int    ("color_set", cfg->color_set);
 	if (cfg->color_type>=4)
@@ -1241,6 +1247,13 @@
 	gtk_signal_connect (GTK_OBJECT (prefs->login_by_default_checkbox), "toggled",
 			    GTK_SIGNAL_FUNC (prop_changed), prefs);
 
+	/* Use XInput Method */
+	prefs->use_im_checkbox = gtk_check_button_new_with_label (_("Open IM(input method)"));
+	gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (prefs->use_im_checkbox),
+				     cfg->use_im ? 1 : 0);
+	gtk_signal_connect (GTK_OBJECT (prefs->use_im_checkbox), "toggled",
+			    GTK_SIGNAL_FUNC (prop_changed), prefs);
+
 	/* Word selection class */
 	prefs->wordclass_entry = glade_xml_get_widget (gui, "wordclass-entry");
 	gtk_entry_set_text (GTK_ENTRY (prefs->wordclass_entry),
@@ -1465,7 +1478,7 @@
 	GdkEvent *event;
 	gint32 time;
 	
-	string_atom = gdk_atom_intern ("STRING", FALSE);
+	string_atom = gdk_atom_intern ("COMPOUND_TEXT", FALSE);
 	if (string_atom == GDK_NONE)
 		return;
 
@@ -2273,6 +2286,7 @@
 	}
 
 	set_color_scheme (term, cfg);
+ 	zvt_term_set_open_im (term, cfg->use_im);
 
 	XSync(GDK_DISPLAY(), False);
 
