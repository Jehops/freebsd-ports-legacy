--- param/loadparm.c.orig	Tue May 20 11:28:38 2003
+++ param/loadparm.c	Wed Jun  4 23:31:55 2003
@@ -3857,8 +3857,10 @@
 	int iService;
 	fstring serviceName;
 	int len;
+	enum remote_arch_types ra_type = get_remote_arch();
 	
-	len = (get_remote_arch() == RA_WIN2K) ? 127 : 12;
+	len = ( (ra_type == RA_WIN2K) || (ra_type == RA_WINXP) ||
+	        (ra_type == RA_WIN2K3) ) ? 127 : 12;
 
 	for (iService = iNumServices - 1; iService >= 0; iService--)
 	{
--- rpc_server/srv_srvsvc_nt.c.orig	Tue May 20 11:22:11 2003
+++ rpc_server/srv_srvsvc_nt.c	Wed Jun  4 23:31:55 2003
@@ -38,9 +38,11 @@
 	pstring net_name;
 	pstring remark;
 	uint32 type;
+	enum remote_arch_types ra_type = get_remote_arch();
 
 	StrnCpy(net_name, lp_servicename(snum),
-		(get_remote_arch() == RA_WIN2K) ? 127 : 12);
+		(((ra_type == RA_WIN2K) || (ra_type == RA_WINXP) ||
+		  (ra_type == RA_WIN2K3) ) ? 127 : 12 ) );
 	pstrcpy(remark, lp_comment(snum));
 	standard_sub_conn(p->conn, remark, sizeof(remark));
 	len_net_name = strlen(net_name);
--- smbd/trans2.c.orig	Tue May 20 11:17:19 2003
+++ smbd/trans2.c	Wed Jun  4 23:34:21 2003
@@ -921,7 +921,8 @@
 	SMB_STRUCT_STAT sbuf;
 
 	ra_type = get_remote_arch();
-	NT_arch = ((ra_type == RA_WINNT) || (ra_type == RA_WIN2K));
+	NT_arch = ((ra_type == RA_WINNT) || (ra_type == RA_WIN2K) ||
+	           (ra_type == RA_WINXP) || (ra_type == RA_WIN2K3) );
 
 	if (total_params < 12)
 		return(ERROR_DOS(ERRDOS,ERRinvalidparam));
@@ -1488,7 +1489,9 @@
 			/* NT4 always serves this up as unicode but expects it to be
 			 * delivered as ascii! (tridge && JRA)
 			 */
-			if ((get_remote_arch() != RA_WIN2K) && (global_client_caps & CAP_NT_SMBS)) {
+			if (((get_remote_arch() != RA_WIN2K) ||
+			     (get_remote_arch() != RA_WINXP) ||
+			     (get_remote_arch() != RA_WIN2K3)) && (global_client_caps & CAP_NT_SMBS)) {
 				data_len = 18 + strlen(vname);
 				SIVAL(pdata,12,strlen(vname));
 				pstrcpy(pdata+18,vname);      
@@ -3100,7 +3103,8 @@
 	int max_referral_level;
 
 	ra_type = get_remote_arch();
-	NT_arch = ((ra_type == RA_WINNT) || (ra_type == RA_WIN2K));
+	NT_arch = ((ra_type == RA_WINNT) || (ra_type == RA_WIN2K) ||
+	           (ra_type == RA_WINXP) || (ra_type == RA_WIN2K3) );
 
 	DEBUG(10,("call_trans2getdfsreferral\n"));
 
