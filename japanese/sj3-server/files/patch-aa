diff -arcN ../sj3-2.0.1.13.org/doc/doc/sj3lib.ms ./doc/doc/sj3lib.ms
*** ../sj3-2.0.1.13.org/doc/doc/sj3lib.ms	Fri Jun  3 17:00:49 1994
--- ./doc/doc/sj3lib.ms	Tue Aug 13 03:17:26 1996
***************
*** 56,62 ****
  .IP ・
  メイン辞書、ユーザ辞書、学習ファイルは、接続するサーバの動作しているマシン上のものが使用されます。
  .br
! これらのファイルは、デフォルトではディレクトリ \fB/usr/dict/sj3\fP の下におかれますが、サーバのセットアップファイルにより変更が可能です。
  .IP ・
  ユーザ辞書と学習ファイルは、関数 sj3_open で指定されたユーザ名を USER と
  すれば、\fBuser/USER/private.dic\fP と \fBuser/USER/study.dat\fP です。
--- 56,62 ----
  .IP ・
  メイン辞書、ユーザ辞書、学習ファイルは、接続するサーバの動作しているマシン上のものが使用されます。
  .br
! これらのファイルは、デフォルトではディレクトリ \fB/usr/local/lib/sj3/dict\fP の下におかれますが、サーバのセットアップファイルにより変更が可能です。
  .IP ・
  ユーザ辞書と学習ファイルは、関数 sj3_open で指定されたユーザ名を USER と
  すれば、\fBuser/USER/private.dic\fP と \fBuser/USER/study.dat\fP です。
***************
*** 91,97 ****
  サーバと正常に接続できたときには 0 を、何かエラーのあったときには 0 以外の
  エラーステータスを返します。
  .sp
! エラーステータスはヘッダファイル \fB/usr/include/sj3lib.h\fP で
  定義されるビットアサインされた値で、詳細は以下のとおりです。
  .sp
  .IP "\fBSJ3_SERVER_DEAD\fP
--- 91,97 ----
  サーバと正常に接続できたときには 0 を、何かエラーのあったときには 0 以外の
  エラーステータスを返します。
  .sp
! エラーステータスはヘッダファイル \fB/usr/local/include/sj3lib.h\fP で
  定義されるビットアサインされた値で、詳細は以下のとおりです。
  .sp
  .IP "\fBSJ3_SERVER_DEAD\fP
***************
*** 138,144 ****
  サーバとの使用を正常に終了できたときには 0 を、
  何かエラーのあったときには 0 以外のエラーステータスを返します。
  .sp
! エラーステータスはヘッダファイル \fB/usr/include/sj3lib.h\fP で
  定義されるビットアサインされた値で、詳細は以下のとおりです。
  .sp
  .IP "\fBSJ3_SERVER_DEAD\fP
--- 138,144 ----
  サーバとの使用を正常に終了できたときには 0 を、
  何かエラーのあったときには 0 以外のエラーステータスを返します。
  .sp
! エラーステータスはヘッダファイル \fB/usr/local/include/sj3lib.h\fP で
  定義されるビットアサインされた値で、詳細は以下のとおりです。
  .sp
  .IP "\fBSJ3_SERVER_DEAD\fP
***************
*** 187,193 ****
  変換結果の漢字文字列を、配列 \fBstruct bunsetu bun[]\fP に
  各文節に関する情報をセットします。
  .br
! \fBstruct bunsetu\fP はヘッダファイル \fB/usr/include/sj3lib.h\fP で
  宣言されている以下のような構造体です。
  .sp
  .RS
--- 187,193 ----
  変換結果の漢字文字列を、配列 \fBstruct bunsetu bun[]\fP に
  各文節に関する情報をセットします。
  .br
! \fBstruct bunsetu\fP はヘッダファイル \fB/usr/local/include/sj3lib.h\fP で
  宣言されている以下のような構造体です。
  .sp
  .RS
***************
*** 417,423 ****
  なりません。
  またその長さは、最大でも 32 文字を越えてはなりません。
  .sp
! 品詞コードはヘッダファイル \fB/usr/include/sj3lib.h\fP で
  定義される以下の品詞のうちの一つです。
  .sp
  .RS
--- 417,423 ----
  なりません。
  またその長さは、最大でも 32 文字を越えてはなりません。
  .sp
! 品詞コードはヘッダファイル \fB/usr/local/include/sj3lib.h\fP で
  定義される以下の品詞のうちの一つです。
  .sp
  .RS
***************
*** 445,451 ****
  登録できたときには 0 が、登録できなかったときにはそれ以外の
  エラーステータスが返されます。
  .sp
! エラーステータスはヘッダファイル \fB/usr/include/sj3lib.h\fP で
  定義され、詳細は以下のとおりです。
  .sp
  .IP "\fBSJ3_DICT_ERROR\fP
--- 445,451 ----
  登録できたときには 0 が、登録できなかったときにはそれ以外の
  エラーステータスが返されます。
  .sp
! エラーステータスはヘッダファイル \fB/usr/local/include/sj3lib.h\fP で
  定義され、詳細は以下のとおりです。
  .sp
  .IP "\fBSJ3_DICT_ERROR\fP
***************
*** 519,525 ****
  なりません。
  またその長さは、最大でも 32 文字を越えてはなりません。
  .sp
! 品詞コードは \fB/usr/include/sj3lib.h\fP で定義される以下の品詞の
  うちの一つです。
  .sp
  .RS
--- 519,525 ----
  なりません。
  またその長さは、最大でも 32 文字を越えてはなりません。
  .sp
! 品詞コードは \fB/usr/local/include/sj3lib.h\fP で定義される以下の品詞の
  うちの一つです。
  .sp
  .RS
***************
*** 547,553 ****
  削除できたときには 0 が、削除できなかったときにはそれ以外の
  エラーステータスが返されます。
  .sp
! エラーステータスは \fB/usr/include/sj3lib.h\fP で定義され、
  詳細は以下のとおりです。
  .sp
  .IP "\fBSJ3_DICT_ERROR\fP
--- 547,553 ----
  削除できたときには 0 が、削除できなかったときにはそれ以外の
  エラーステータスが返されます。
  .sp
! エラーステータスは \fB/usr/local/include/sj3lib.h\fP で定義され、
  詳細は以下のとおりです。
  .sp
  .IP "\fBSJ3_DICT_ERROR\fP
diff -arcN ../sj3-2.0.1.13.org/doc/doc/sj3serv.ms ./doc/doc/sj3serv.ms
*** ../sj3-2.0.1.13.org/doc/doc/sj3serv.ms	Fri Jun  3 17:00:50 1994
--- ./doc/doc/sj3serv.ms	Tue Aug 13 03:18:01 1996
***************
*** 111,117 ****
  そのファイル名を絶対パスとして辞書にアクセスしますが、\'/\'以外のときには、
  ここで指定されるディレクトリからの相対パスとして辞書にアクセスします。
  .br
! デフォルトは /usr/dict/sj3 です。
  .RE
  .sp
  .NH 3
--- 111,117 ----
  そのファイル名を絶対パスとして辞書にアクセスしますが、\'/\'以外のときには、
  ここで指定されるディレクトリからの相対パスとして辞書にアクセスします。
  .br
! デフォルトは /usr/local/lib/sj3/dict です。
  .RE
  .sp
  .NH 3
diff -arcN ../sj3-2.0.1.13.org/doc/man/sj3.1 ./doc/man/sj3.1
*** ../sj3-2.0.1.13.org/doc/man/sj3.1	Fri Jun  3 17:00:51 1994
--- ./doc/man/sj3.1	Tue Aug 13 03:18:59 1996
***************
*** 109,121 ****
  .SH 関連ファイル
  .PD 0
  .TP 15
! /usr/dict/sj3/user/$USER/private.dic
  仮名漢字変換ユーザ辞書
  .TP
! /usr/dict/sj3/user/$USER/study.dat
  仮名漢字変換学習ファイル
  .TP
! /usr/lib/sj3/sjrk
  デフォルトローマ字仮名変換規則定義ファイル
  .SH 関連事項
  sj3serv(1), sj3lib(3) 
--- 109,121 ----
  .SH 関連ファイル
  .PD 0
  .TP 15
! /usr/local/lib/sj3/dict/user/$USER/private.dic
  仮名漢字変換ユーザ辞書
  .TP
! /usr/local/lib/sj3/dict/user/$USER/study.dat
  仮名漢字変換学習ファイル
  .TP
! /usr/local/lib/sj3/sjrk
  デフォルトローマ字仮名変換規則定義ファイル
  .SH 関連事項
  sj3serv(1), sj3lib(3) 
diff -arcN ../sj3-2.0.1.13.org/doc/man/sj3dic.1 ./doc/man/sj3dic.1
*** ../sj3-2.0.1.13.org/doc/man/sj3dic.1	Fri Jun  3 17:00:52 1994
--- ./doc/man/sj3dic.1	Tue Aug 13 03:19:55 1996
***************
*** 105,120 ****
  .SH 関連ファイル
  .PD 0
  .TP \w'\ \ \ \ user/\fIusername\fP/private.dic'u+2n
! /usr/bin/sj3serv
  かな漢字変換サーバ
  .TP
! /usr/lib/sj3/serverrc
  かな漢字変換サーバ セットアップファイル
  .TP
! /usr/bin/sj3
  日本語入力フロントエンドプロセッサ
  .TP
! /usr/dict/sj3/
  かな漢字変換サーバ デフォルト辞書ディレクトリ
  .TP
      sj3main.dic
--- 105,120 ----
  .SH 関連ファイル
  .PD 0
  .TP \w'\ \ \ \ user/\fIusername\fP/private.dic'u+2n
! /usr/local/bin/sj3serv
  かな漢字変換サーバ
  .TP
! /usr/local/lib/sj3/serverrc
  かな漢字変換サーバ セットアップファイル
  .TP
! /usr/local/bin/sj3
  日本語入力フロントエンドプロセッサ
  .TP
! /usr/local/lib/sj3/dict/
  かな漢字変換サーバ デフォルト辞書ディレクトリ
  .TP
      sj3main.dic
***************
*** 126,135 ****
      user/\fIusername\fP/study.dat
  かな漢字変換学習ファイル
  .TP
! /usr/include/sj3lib.h
  かな漢字変換ライブラリ用インクルードファイル
  .TP
! /usr/lib/libsj3lib.a
  かな漢字変換ライブラリ
  .\".TP
  .\"/usr/sony/demo/sj3/*
--- 126,135 ----
      user/\fIusername\fP/study.dat
  かな漢字変換学習ファイル
  .TP
! /usr/local/include/sj3lib.h
  かな漢字変換ライブラリ用インクルードファイル
  .TP
! /usr/local/lib/libsj3lib.a
  かな漢字変換ライブラリ
  .\".TP
  .\"/usr/sony/demo/sj3/*
diff -arcN ../sj3-2.0.1.13.org/doc/man/sj3mkdic.1 ./doc/man/sj3mkdic.1
*** ../sj3-2.0.1.13.org/doc/man/sj3mkdic.1	Fri Dec  9 18:15:37 1994
--- ./doc/man/sj3mkdic.1	Tue Aug 13 03:20:17 1996
***************
*** 550,565 ****
  .SH ファイル
  .PD 0
  .TP \w'\ \ \ \ user/\f2username\f1/private.dic'u+2n
! .B /usr/bin/sj3serv
  かな漢字変換サーバ
  .TP
! .B /usr/lib/sj3/serverrc
  かな漢字変換サーバ セットアップファイル
  .TP
! .B /usr/bin/sj3
  日本語入力フロントエンドプロセッサ
  .TP
! .B /usr/dict/sj3/
  かな漢字変換サーバ デフォルト辞書ディレクトリ
  .TP
  .B "   sj3main.dic
--- 550,565 ----
  .SH ファイル
  .PD 0
  .TP \w'\ \ \ \ user/\f2username\f1/private.dic'u+2n
! .B /usr/local/bin/sj3serv
  かな漢字変換サーバ
  .TP
! .B /usr/local/lib/sj3/serverrc
  かな漢字変換サーバ セットアップファイル
  .TP
! .B /usr/local/bin/sj3
  日本語入力フロントエンドプロセッサ
  .TP
! .B /usr/local/lib/sj3/dict/
  かな漢字変換サーバ デフォルト辞書ディレクトリ
  .TP
  .B "   sj3main.dic
***************
*** 571,584 ****
  .B "   user/\f2username\f1/study.dat
  かな漢字変換学習ファイル
  .TP
! .B /usr/include/sj3lib.h
  かな漢字変換ライブラリ用インクルードファイル
  .TP
! .B /usr/lib/libsj3lib.a
  かな漢字変換ライブラリ
! .TP
! \f3/usr/demo/sj3/ *\f1
! かな漢字変換ライブラリ 使用法サンプル
  .PD
  .SH 関連項目
  \f4sj3\f1 (1),
--- 571,584 ----
  .B "   user/\f2username\f1/study.dat
  かな漢字変換学習ファイル
  .TP
! .B /usr/local/include/sj3lib.h
  かな漢字変換ライブラリ用インクルードファイル
  .TP
! .B /usr/local/lib/libsj3lib.a
  かな漢字変換ライブラリ
! .\".TP
! .\"\f3/usr/local/demo/sj3/ *\f1
! .\"かな漢字変換ライブラリ 使用法サンプル
  .PD
  .SH 関連項目
  \f4sj3\f1 (1),
diff -arcN ../sj3-2.0.1.13.org/doc/man/sj3serv.1 ./doc/man/sj3serv.1
*** ../sj3-2.0.1.13.org/doc/man/sj3serv.1	Fri Jun  3 17:00:53 1994
--- ./doc/man/sj3serv.1	Tue Aug 13 03:20:41 1996
***************
*** 47,63 ****
  このオプションは、\fIsj3serv\fP の読み込むセットアップファイルを指定します。
  .br
  \fIsj3serv\fP はデフォルトではセットアップファイル
! ‘/usr/lib/sj3/serverrc’を読み込みますが、
  このオプションが指定されたときにはかわりに
  コマンドラインで指定されたセットアップファイルを読み込みます。
  .br
  .SH 関連ファイル
  .PD 0
  .TP \w'\ \ \ \ user/\fIusername\fP/private.dic'u+2n
! /usr/lib/sj3/serverrc
  デフォルト仮名変換サーバ セットアップファイル
  .TP
! /usr/sony/dict/sj3/
  かな漢字変換サーバ デフォルト辞書ディレクトリ
  .TP
      sj3main.dic
--- 47,63 ----
  このオプションは、\fIsj3serv\fP の読み込むセットアップファイルを指定します。
  .br
  \fIsj3serv\fP はデフォルトではセットアップファイル
! ‘/usr/local/lib/sj3/serverrc’を読み込みますが、
  このオプションが指定されたときにはかわりに
  コマンドラインで指定されたセットアップファイルを読み込みます。
  .br
  .SH 関連ファイル
  .PD 0
  .TP \w'\ \ \ \ user/\fIusername\fP/private.dic'u+2n
! /usr/local/lib/sj3/serverrc
  デフォルト仮名変換サーバ セットアップファイル
  .TP
! /usr/local/lib/sj3/dict/
  かな漢字変換サーバ デフォルト辞書ディレクトリ
  .TP
      sj3main.dic
*** server/setup.c.orig	Mon Mar 23 05:48:02 1998
--- server/setup.c	Fri Feb  2 19:53:37 2001
***************
*** 217,251 ****
  
  
  struct	optlist {
! 	char	*optname;
  	u_char	*(*optfunc)();
! 	int	optarg;
  } option[] = {
! 	"DebugOut",	get_str,	(int)&debug_file,
! 	"DebugLevel",	get_int,	(int)&debug_level,
! 	"ForkFlag",	get_flag,	(int)&fork_flag,
  
! 	"PortName",	get_str,	(int)&port_name,
  #ifdef TLI
! 	"PortNumber",	get_str,	(int)&port_number,
!         "ProtoName",    get_str,        (int)&proto_name,
  #else
! 	"PortNumber",	get_int,	(int)&port_number,
  #endif
! 	"SocketName",	get_str,	(int)&socket_name,
  #ifdef	LOCK_FILE
! 	"LockFile",	get_str,	(int)&lock_file;
  #endif
  
! 	"maxclient",	get_int,	(int)&max_client,
! 	"dictdir",	get_str,	(int)&dict_dir,
! 	"readdict",	get_list,	(int)&read_dict,
! 	"opendict",	get_list,	(int)&open_dict,
! 	"errorout",	get_str,	(int)&error_file,
! 	"logout",	get_str,	(int)&log_file,
! 	"dirmode",	get_int,	(int)&dir_mode,
! 	"filemode",	get_int,	(int)&file_mode,
! 	"allowuser",	get_list,	(int)&allow_user,
  	0, 0, 0
  };
  
--- 217,274 ----
  
  
  struct	optlist {
! 	const char	*optname;
  	u_char	*(*optfunc)();
! 	void	*optarg;
  } option[] = {
! /*
!  * Add option flag.
!  * Because They are lacked in here. See document.
!  * Patched by Hidekazu Kuroki(hidekazu@cs.titech.ac.jp)		1996/8/10
!  */
! 	"DebugOut",	get_str,	&debug_file,
! 	"debugout",	get_str,	&debug_file,
! 	"DebugLevel",	get_int,	&debug_level,
! 	"debuglevel",	get_int,	&debug_level,
! 	"ForkFlag",	get_flag,	&fork_flag,
! 	"forkflag",	get_flag,	&fork_flag,
  
! 	"PortName",	get_str,	&port_name,
! 	"portname",	get_str,	&port_name,
  #ifdef TLI
! 	"PortNumber",	get_str,	&port_number,
! 	"portnumber",	get_str,	&port_number,
! 	"ProtoName",    get_str,        &proto_name,
! 	"protoname",    get_str,        &proto_name,
  #else
! 	"PortNumber",	get_int,	&port_number,
! 	"portnumber",	get_int,	&port_number,
  #endif
! 	"SocketName",	get_str,	&socket_name,
! 	"socketname",	get_str,	&socket_name,
  #ifdef	LOCK_FILE
! 	"LockFile",	get_str,	&lock_file;
! 	"lockfile",	get_str,	&lock_file;
  #endif
  
! 	"MaxClient",	get_int,	&max_client,
! 	"maxclient",	get_int,	&max_client,
! 	"DictDir",	get_str,	&dict_dir,
! 	"dictdir",	get_str,	&dict_dir,
! 	"ReadDict",	get_list,	&read_dict,
! 	"readdict",	get_list,	&read_dict,
! 	"OpenDict",	get_list,	&open_dict,
! 	"opendict",	get_list,	&open_dict,
! 	"ErrorOut",	get_str,	&error_file,
! 	"errorout",	get_str,	&error_file,
! 	"LogOut",	get_str,	&log_file,
! 	"logout",	get_str,	&log_file,
! 	"DirMode",	get_int,	&dir_mode,
! 	"dirmode",	get_int,	&dir_mode,
! 	"FileMode",	get_int,	&file_mode,
! 	"filemode",	get_int,	&file_mode,
! 	"AllowUser",	get_list,	&allow_user,
! 	"allowuser",	get_list,	&allow_user,
  	0, 0, 0
  };
  
***************
*** 424,441 ****
  	int	c;
  	int	errflg = 0;
  	char	*p;
  
  	extern	char	*optarg, *strrchr();
  	extern	int	optind;
  
  	p = (p = strrchr(argv[0], '/')) ? p + 1 : argv[0];
! 	strcpy(program_name,	p);
! 	strcpy(runcmd_file,	RunCmdFile);
  
  	while ((c = getopt(argc, argv, "f:")) != EOF) {
  		switch (c) {
  		case 'f':
! 			strcpy(runcmd_file, optarg);
  			break;
  
  		case '?':
--- 447,467 ----
  	int	c;
  	int	errflg = 0;
  	char	*p;
+ 	size_t	ret;
  
  	extern	char	*optarg, *strrchr();
  	extern	int	optind;
  
  	p = (p = strrchr(argv[0], '/')) ? p + 1 : argv[0];
! 	strlcpy(program_name,	p, sizeof(program_name));
! 	strlcpy(runcmd_file,	RunCmdFile, sizeof(runcmd_file));
  
  	while ((c = getopt(argc, argv, "f:")) != EOF) {
  		switch (c) {
  		case 'f':
! 			ret = strlcpy(runcmd_file, optarg, sizeof(runcmd_file));
! 			if (ret > sizeof(runcmd_file))
! 				errflg++;
  			break;
  
  		case '?':
