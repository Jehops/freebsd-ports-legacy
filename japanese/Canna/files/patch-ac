--- Canna.conf.orig	Thu Oct 24 23:37:25 2002
+++ Canna.conf	Thu Nov  7 09:14:12 2002
@@ -132,11 +132,12 @@
 
 /* rootにならずにインストールする時はこれを定義して下さい */
 /* #define InstallAsUser */
-cannaPrefix = /usr/local/canna
+PREFIX?= /usr/local
+cannaPrefix = $(PREFIX)
 cannaExecPrefix = $(cannaPrefix)
 cannaBinDir = $(cannaExecPrefix)/bin
-cannaSrvDir = $(cannaExecPrefix)/bin
-cannaLibDir = $(cannaPrefix)/lib
+cannaSrvDir = $(cannaExecPrefix)/sbin
+cannaLibDir = $(cannaPrefix)/lib/canna
 cannaManDir = $(cannaPrefix)/man
 cannaIncDir = $(cannaPrefix)/include/canna
 
@@ -144,8 +145,8 @@
 libCannaDir = $(cannaExecPrefix)/lib
 ErrDir  = $(cannaExecPrefix)/log
 #else
-libCannaDir = /usr/lib
-ErrDir  = /usr/spool/canna
+libCannaDir = $(cannaPrefix)/lib
+ErrDir  = /var/log
 #endif
 
 /* 次の3行は変更しないでください */
@@ -161,10 +162,11 @@
 #else
 cannaOwnerGroup = -o $(cannaOwner) -g $(cannaGroup)
 #endif
+cannaOwnerDefinition = -DcannaOwner="\"$(cannaOwner)\""
 
 pointerIntegerDef =
 
-cannaDsoRev = 1
+cannaDsoRev = 1.0
     /* SunOS 4.x をお使いの方で shared object を利用する場合には
             cannaDsoRev = 1.1
     と指定してください。また、FreeBSD を利用する場合は、
@@ -308,7 +310,7 @@
  * ここから下は変更しないようにしてください。
  */
 
- CANNASERVER_DEFINES = $(wcharDefinition)
+ CANNASERVER_DEFINES = $(wcharDefinition) $(cannaOwnerDefinition)
           RK_DEFINES = $(pointerIntegerDef)
          RKC_DEFINES = $(wcharDefinition)
        UILIB_DEFINES = $(wcharDefinition) $(pointerIntegerDef) \
@@ -461,6 +463,15 @@
 		set +x; else (set -x; $(MKDIRHIER) $(DESTDIR)$$i;$(CHOWN) owner $(DESTDIR)$$i;$(CHGRP) group $(DESTDIR)$$i); fi; \	@@\
 	done
 #endif /* MakeDirectories */
+
+#ifdef LinkFileList
+#undef LinkFileList
+#endif
+#define LinkFileList(step,list,dir,sub)					@@\
+step:: list								@@\
+	@MakeFlagsToShellFlags(i,set +e); \				@@\
+	echo "	cd" dir; cd dir && \					@@\
+	for i in list; do (set -x; $(LN) -f sub/$$i .); done
 
 /* libname-def.cppを作るのが面倒なのでXのSharedLibraryTargetを上書き */
 #ifdef CYGWIN_DLL
