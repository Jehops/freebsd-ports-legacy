--- configure.orig	2007-07-08 13:47:15.000000000 -0400
+++ configure	2007-07-09 12:37:09.000000000 -0400
@@ -210,11 +210,11 @@
 
 # "tr '[a-z]' '[A-Z]'" is a workaround for Solaris tr not grokking "tr a-z A-Z"
 toupper(){
-    echo "$@" | tr '[a-z]' '[A-Z]'
+    echo "$@" | tr '[:lower:]' '[:upper:]'
 }
 
 tolower(){
-    echo "$@" | tr '[A-Z]' '[a-z]'
+    echo "$@" | tr '[:upper:]' '[:lower:]'
 }
 
 set_all(){
@@ -992,15 +992,9 @@
     enable fast_unaligned
   ;;
   x86_64|amd64)
-    arch="x86_32"
     enable fast_unaligned
-    canon_arch="`$cc -dumpmachine | sed -e 's,\([^-]*\)-.*,\1,'`"
-    if [ x"$canon_arch" = x"x86_64" -o x"$canon_arch" = x"amd64" ]; then
-      if [ -z "`echo $CFLAGS | grep -- -m32`"  ]; then
-        arch="x86_64"
-        enable fast_64bit
-      fi
-    fi
+    arch="x86_64"
+    enable fast_64bit
   ;;
   # armv4l is a subset of armv[567]*l
   arm|armv[4567]*l)
@@ -1734,12 +1728,6 @@
     check_cflags -Os            # not all compilers support -Os
     optimize="small"
 elif enabled optimize; then
-    if test -n "`$cc -v 2>&1 | grep xlc`"; then
-        add_cflags  "-O5"
-        add_ldflags "-O5"
-    else
-        add_cflags "-O3"
-    fi
 fi
 
 # PIC flags for shared library objects where they are needed
@@ -1927,15 +1915,15 @@
 if enabled shared; then
   echo "BUILD_SHARED=yes" >> config.mak
   echo "PIC=-fPIC -DPIC" >> config.mak
-  echo "SPPMAJOR=${pp_version%%.*}" >> config.mak
+  echo "SPPMAJOR=1" >> config.mak
   echo "SPPVERSION=$pp_version" >> config.mak
-  echo "LAVCMAJOR=${lavc_version%%.*}" >> config.mak
+  echo "LAVCMAJOR=%%SHLIB_VER%%" >> config.mak
   echo "LAVCVERSION=$lavc_version" >> config.mak
-  echo "LAVFMAJOR=${lavf_version%%.*}" >> config.mak
+  echo "LAVFMAJOR=%%SHLIB_VER%%" >> config.mak
   echo "LAVFVERSION=$lavf_version" >> config.mak
-  echo "LAVUMAJOR=${lavu_version%%.*}" >> config.mak
+  echo "LAVUMAJOR=%%SHLIB_VER%%" >> config.mak
   echo "LAVUVERSION=$lavu_version" >> config.mak
-  echo "SWSMAJOR=${sws_version%%.*}" >> config.mak
+  echo "SWSMAJOR=%%SHLIB_VER%%" >> config.mak
   echo "SWSVERSION=$sws_version" >> config.mak
   echo "SLIBNAME=${SLIBNAME}" >> config.mak
   echo "SLIBNAME_WITH_VERSION=${SLIBNAME_WITH_VERSION}" >> config.mak
@@ -1969,7 +1957,7 @@
 
 echo "SRC_PATH=\"$source_path\"" >> config.mak
 echo "SRC_PATH_BARE=$source_path" >> config.mak
-echo "BUILD_ROOT=\"$PWD\"" >> config.mak
+echo "BUILD_ROOT=\"$(pwd)\"" >> config.mak
 
 # Apparently it's not possible to portably echo a backslash.
 if enabled asmalign_pot; then
@@ -2047,8 +2035,8 @@
 Version: $version
 Requires: $requires
 Conflicts:
-Libs: -L\${libdir} $libs
-Cflags: -I\${includedir} -I\${includedir}/$include
+Libs: -L\${libdir} $libs -L%%LOCALBASE%%/lib
+Cflags: -I\${includedir} -I\${includedir}/$include -I%%LOCALBASE%%/include
 EOF
 }
 
@@ -2071,7 +2059,8 @@
 Requires: $requires
 Conflicts:
 Libs: \${libdir}/${LIBPREF}${shortname}${LIBSUF} $libs
-Cflags: -I\${includedir}
+Ldflags: -L%%LOCALBASE%%/lib
+Cflags: -I\${includedir} -I%%LOCALBASE%%/include
 EOF
 }
 
