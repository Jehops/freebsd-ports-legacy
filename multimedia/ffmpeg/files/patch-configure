--- configure.orig	2008-07-24 05:53:32.000000000 -0500
+++ configure	2008-07-27 17:31:20.767081842 -0500
@@ -1596,8 +1596,8 @@
 
 if check_func dlopen; then
     ldl=
-elif check_func dlopen -ldl; then
-    ldl=-ldl
+elif check_func dlopen ; then
+    ldl=
 fi
 
 check_func  fork
@@ -1718,10 +1718,17 @@
 if enabled vhook; then
     check_ldflags -rdynamic
     check_ldflags -export-dynamic
+    if enabled imlib2; then
+        check_foo_config imlib2 imlib2 Imlib2.h imlib_load_font
+    fi
+    if enabled freetype2; then
+        check_foo_config freetype2 freetype ft2build.h FT_Init_FreeType
+    fi
+else
+    disable imlib2
+    disable freetype2
 fi
 
-check_foo_config imlib2 imlib2 Imlib2.h imlib_load_font
-check_foo_config freetype2 freetype ft2build.h FT_Init_FreeType
 
 ##########################################
 # SDL check
@@ -2072,7 +2079,7 @@
     eval ${name}_VERSION=\$${name}_VERSION_MAJOR.\$${name}_VERSION_MINOR.\$${name}_VERSION_MICRO
     lcname=$(tolower $name)
     eval echo "${lcname}_VERSION=\$${name}_VERSION" >> config.mak
-    eval echo "${lcname}_VERSION_MAJOR=\$${name}_VERSION_MAJOR" >> config.mak
+    eval echo "${lcname}_VERSION_MAJOR=1" >> config.mak
 }
 
 get_version LIBSWSCALE  libswscale/swscale.h
@@ -2096,7 +2103,7 @@
     echo "SLIB_UNINSTALL_EXTRA_CMD=${SLIB_UNINSTALL_EXTRA_CMD}" >> config.mak
 fi
 echo "LIB_INSTALL_EXTRA_CMD=${LIB_INSTALL_EXTRA_CMD}" >> config.mak
-echo "EXTRALIBS=$extralibs" >> config.mak
+echo "EXTRALIBS=-L%%LOCALBASE%%/lib -L%%LOCALBASE%%/lib $extralibs" >> config.mak
 
 print_config ARCH_   $TMPH config.mak $ARCH_LIST
 print_config HAVE_   $TMPH config.mak $HAVE_LIST
