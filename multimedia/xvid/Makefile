# New ports collection makefile for:	xvid
# Date created:		04 April 2002
# Whom:			Michael Nottebrock <michaelnottebrock@gmx.net> et al
#
# $FreeBSD$
#

PORTNAME=	xvid
PORTVERSION=	0.20020404
CATEGORIES=	graphics
MASTER_SITES=	http://www.xvid.org/ \
		http://lofi.dyndns.org/
DISTNAME=	xvid_snapshot_${PORTVERSION:S/^0.//}

MAINTAINER=	lofi@lofi.dyndns.org

BUILD_DEPENDS=	${LOCALBASE}/bin/nasm:${PORTSDIR}/devel/nasm

ONLY_FOR_ARCHS=	i386
USE_AUTOCONF=	yes
USE_GMAKE=	yes
INSTALLS_SHLIB=	yes

CONFIGURE_WRKSRC=	${WRKDIR}
WRKSRC=			${WRKDIR}/xvid_20020404/xvidcore/build/generic

pre-everything::
.if !defined(WITH_OPTIMIZED_CFLAGS)
	@ ${ECHO_MSG} "You can enable additional compilation optimizations"
	@ ${ECHO_MSG} "by defining WITH_OPTIMIZED_CFLAGS"
.endif

post-patch:
	@ ${FIND} ${WRKDIR} -type f | \
		${XARGS} -n 10 -x ${PERL} -pi -e \
		's|<malloc.h>|<stdlib.h>|'
.ifndef(WITH_OPTIMIZED_CFLAGS)
	@ ${PERL} -pi -e 's|(CFLAGS \+=).*|\1 ${CFLAGS}|' ${WRKSRC}/Makefile
.else
	@ ${PERL} -pi -e 's|(CFLAGS \+=.*)|\1 ${CFLAGS}|' ${WRKSRC}/Makefile
.endif

# trick to detect existence of stdint.h
pre-configure:
.for file in configure.in config.h.in
	@ ${CP} ${FILESDIR}/${file} ${WRKDIR}
.endfor

do-install:
	@ ${INSTALL_DATA} ${WRKSRC}/libxvidcore.so ${PREFIX}/lib/libxvidcore.so.0
	@ ${INSTALL_DATA} ${WRKSRC}/libcore.a ${PREFIX}/lib/libcore.a
	@ ${LN} -s libxvidcore.so.0 ${PREFIX}/lib/libxvidcore.so
	@ ${INSTALL_DATA} ${WRKSRC}/../../src/xvid.h ${PREFIX}/include

.include <bsd.port.mk>
