--- contrib/Jamfile.orig	2007-10-08 15:57:23.000000000 -0500
+++ contrib/Jamfile	2007-12-07 17:58:44.000000000 -0600
@@ -23,9 +23,10 @@
 }
 actions Wget
 {
-    $(RM) $(<) &&
-    $(WGET) $(<) `cat $(>)` &&
-    ( touch $(<) || true )
+#    $(RM) $(<) &&
+#    $(WGET) $(<) `cat $(>)` &&
+#    ( touch $(<) || true )
+    true
 }
 
 # liba52
@@ -36,10 +37,9 @@
 }
 actions LibA52
 {
-
-    cd `dirname $(>)` && CONTRIB=`pwd` &&
-    rm -rf a52dec && tar xzf a52dec.tar.gz && cd a52dec && patch -p1 < ../patch-a52dec.patch &&
-    ./configure --prefix=$CONTRIB --cache-file=$CONTRIB/config.cache && make && make install &&
+    CONTRIB=%%CONTRIB%% &&
+    cd $CONTRIB/a52dec && patch -p1 < ../patch-a52dec.patch &&
+    ./configure --prefix=$CONTRIB && $(MAKE) && $(MAKE) install &&
     strip -S $CONTRIB/lib/liba52.a
 }
 Wget   $(SUBDIR)/a52dec.tar.gz : $(SUBDIR)/version_a52dec.txt ;
@@ -58,14 +58,13 @@
 }
 actions LibAvCodec
 {
-    cd `dirname $(>)` && CONTRIB=`pwd` &&
-    rm -rf ffmpeg && tar xzf ffmpeg.tar.gz &&
-    cd ffmpeg && $(FFMPEG_PATCH) &&
-    ./configure --prefix=$CONTRIB --enable-gpl --enable-pthreads --enable-swscaler --disable-audio-beos --disable-shared --enable-static \
+    CONTRIB=%%CONTRIB%% &&
+    cd $CONTRIB/ffmpeg && $(FFMPEG_PATCH) &&
+    ./configure --prefix="$CONTRIB" --cc="%%CC%%" --extra-libs="%%PTHREAD_LIBS%%" --enable-gpl --enable-pthreads --enable-swscaler --disable-audio-beos --disable-shared --enable-static --disable-opts \
         --disable-decoders --enable-decoder=mp2 --disable-parsers --enable-parser=mpegaudio \
         --disable-encoders --enable-encoder=mpeg4 --enable-encoder=ac3 --enable-encoder=snow \
         --disable-muxers --enable-muxer=ipod --disable-demuxers --disable-protocols --disable-bsfs &&
-    make && make install &&
+    $(MAKE) && $(MAKE) install &&
     strip -S $CONTRIB/lib/libavcodec.a
 }
 Wget       $(SUBDIR)/ffmpeg.tar.gz    : $(SUBDIR)/version_ffmpeg.txt ;
@@ -96,9 +95,9 @@
     }
     actions LibDvdCss
     {
-        cd `dirname $(>)` && CONTRIB=`pwd` &&
-        rm -rf libdvdcss && tar xzf libdvdcss.tar.gz && cd libdvdcss &&
-        ./configure --prefix=$CONTRIB --cache-file=$CONTRIB/config.cache && make && make install &&
+        CONTRIB=%%CONTRIB%% &&
+        cd $CONTRIB/libdvdcss &&
+        ./configure --prefix=$CONTRIB && $(MAKE) && $(MAKE) install &&
         strip -S $CONTRIB/lib/libdvdcss.a
     }
     Wget      $(SUBDIR)/libdvdcss.tar.gz : $(SUBDIR)/version_libdvdcss.txt ;
@@ -113,9 +112,9 @@
 }
 actions LibDCA
 {
-    cd `dirname $(>)` && CONTRIB=`pwd` &&
-    rm -rf libdca && tar xzf libdca.tar.gz && cd libdca && patch -p1 < ../patch-libdca.patch &&
-    ./configure --prefix=$CONTRIB --cache-file=$CONTRIB/config.cache && make && make install &&
+    CONTRIB=%%CONTRIB%% &&
+    cd $CONTRIB/libdca && patch -p1 < ../patch-libdca.patch &&
+    ./configure --prefix=$CONTRIB && $(MAKE) && $(MAKE) install &&
     strip -S $CONTRIB/lib/libdca.a
 }
 Wget   $(SUBDIR)/libdca.tar.gz : $(SUBDIR)/version_libdca.txt ;
@@ -131,10 +130,10 @@
 {
     actions LibDvdRead
     {
-        cd `dirname $(>)` && CONTRIB=`pwd` &&
-        rm -rf libdvdread && tar xzf libdvdread.tar.gz && cd libdvdread &&
-        ./configure --prefix=$CONTRIB --cache-file=$CONTRIB/config.cache --disable-shared --with-libdvdcss=$CONTRIB &&
-        make && make install &&
+        CONTRIB=%%CONTRIB%% &&
+        cd $CONTRIB/libdvdread &&
+        ./configure --prefix=$CONTRIB --disable-shared --with-libdvdcss=$CONTRIB &&
+        $(MAKE) && $(MAKE) install &&
         strip -S $CONTRIB/lib/libdvdread.a
     }
 }
@@ -143,10 +142,10 @@
     # configure line.
     actions LibDvdRead
     {
-        cd `dirname $(>)` && CONTRIB=`pwd` &&
-        rm -rf libdvdread && tar xzf libdvdread.tar.gz && cd libdvdread &&
-        ./configure --prefix=$CONTRIB --cache-file=$CONTRIB/config.cache --disable-shared &&
-        make && make install &&
+        CONTRIB=%%CONTRIB%% &&
+        cd $CONTRIB/libdvdread &&
+        ./configure --prefix=$CONTRIB --disable-shared &&
+        $(MAKE) && $(MAKE) install &&
         strip -S $CONTRIB/lib/libdvdread.a
     }
 }
@@ -161,10 +160,10 @@
 }
 actions LibFaac
 {
-    cd `dirname $(>)` && CONTRIB=`pwd` &&
-    rm -rf faac && tar xzf faac.tar.gz && cd faac &&
-    ./configure --prefix=$CONTRIB --cache-file=$CONTRIB/config.cache --disable-shared --enable-static &&
-    make && make install &&
+    CONTRIB=%%CONTRIB%% &&
+    cd $CONTRIB/faac &&
+    ./configure --prefix=$CONTRIB --disable-shared --enable-static &&
+    $(MAKE) && $(MAKE) install &&
     strip -S $CONTRIB/lib/libfaac.a
 }
 Wget    $(SUBDIR)/faac.tar.gz   : $(SUBDIR)/version_faac.txt ;
@@ -178,10 +177,10 @@
 }
 actions LibMp3Lame
 {
-    cd `dirname $(>)` && CONTRIB=`pwd` &&
-    rm -rf lame && tar xzf lame.tar.gz && cd lame &&
-    ./configure --prefix=$CONTRIB --cache-file=$CONTRIB/config.cache --disable-shared &&
-    make && make install &&
+    CONTRIB=%%CONTRIB%% &&
+    cd $CONTRIB/lame &&
+    ./configure --prefix=$CONTRIB --disable-shared &&
+    $(MAKE) && $(MAKE) install &&
     strip -S $CONTRIB/lib/libmp3lame.a
 }
 Wget       $(SUBDIR)/lame.tar.gz      : $(SUBDIR)/version_lame.txt ;
@@ -197,11 +196,11 @@
 {
     actions LibMp4v2
     {
-        cd `dirname $(>)` && CONTRIB=`pwd` &&
-        rm -rf mpeg4ip && tar xzf mpeg4ip.tar.gz && cd mpeg4ip &&
+        CONTRIB=%%CONTRIB%% &&
+        cd $CONTRIB/mpeg4ip &&
         patch -p1 < ../patch-mpeg4ip.patch && patch -p0 < ../patch-mpeg4ip-pascal-str.patch &&
-        ./bootstrap --cache-file=$CONTRIB/config.cache --disable-mp3lame --disable-faac --disable-x264 --disable-server --disable-player &&
-        make -C lib/mp4v2 libmp4v2.la && cp lib/mp4v2/.libs/libmp4v2.a $CONTRIB/lib &&
+        ./bootstrap --disable-mp3lame --disable-faac --disable-x264 --disable-server --disable-player &&
+        $(MAKE) -C lib/mp4v2 libmp4v2.la && cp lib/mp4v2/.libs/libmp4v2.a $CONTRIB/lib &&
         cp mpeg4ip_config.h include/mpeg4ip.h include/mpeg4ip_version.h \
             include/mpeg4ip_win32.h lib/mp4v2/*.h $CONTRIB/include &&
         strip -S $CONTRIB/lib/libmp4v2.a
@@ -211,11 +210,11 @@
 {
     actions LibMp4v2
     {
-        cd `dirname $(>)` && CONTRIB=`pwd` &&
-        rm -rf mpeg4ip && tar xzf mpeg4ip.tar.gz && cd mpeg4ip &&
+        CONTRIB=%%CONTRIB%% &&
+        cd $CONTRIB/mpeg4ip &&
         patch -p1 < ../patch-mpeg4ip.patch && patch -p1 < ../patch_mpeg4ip_cygwin.patch && patch -p0 < ../patch-mpeg4ip-pascal-str.patch &&
-        ./bootstrap --cache-file=$CONTRIB/config.cache --disable-mp3lame --disable-faac --disable-x264 --disable-server --disable-player &&
-        make -C lib/mp4v2 libmp4v2.la && cp lib/mp4v2/.libs/libmp4v2.a $CONTRIB/lib &&
+        ./bootstrap --disable-mp3lame --disable-faac --disable-x264 --disable-server --disable-player &&
+        $(MAKE) -C lib/mp4v2 libmp4v2.la && cp lib/mp4v2/.libs/libmp4v2.a $CONTRIB/lib &&
         cp mpeg4ip_config.h include/mpeg4ip.h include/mpeg4ip_version.h \
             include/mpeg4ip_win32.h lib/mp4v2/*.h $CONTRIB/include &&
         strip -S $CONTRIB/lib/libmp4v2.a
@@ -231,10 +230,10 @@
 }
 actions LibMkv
 {
-    cd `dirname $(>)` && CONTRIB=`pwd` &&
-    rm -rf libmkv && tar xzf libmkv.tar.gz && cd libmkv &&
-    ./configure --disable-shared --enable-static --prefix=$CONTRIB --cache-file=$CONTRIB/config.cache &&
-    make && make install &&
+    CONTRIB=%%CONTRIB%% &&
+    cd $CONTRIB/libmkv &&
+    ./configure --disable-shared --enable-static --prefix=$CONTRIB &&
+    $(MAKE) && $(MAKE) install &&
     strip -S $CONTRIB/lib/libmkv.a
 }
 Wget    $(SUBDIR)/libmkv.tar.gz : $(SUBDIR)/version_libmkv.txt ;
@@ -248,10 +247,10 @@
 }
 actions LibMpeg2
 {
-    cd `dirname $(>)` && CONTRIB=`pwd` &&
-    rm -rf mpeg2dec && tar xzf mpeg2dec.tar.gz && cd mpeg2dec && patch -p1 < ../patch-libmpeg2.patch &&
-    ./configure --prefix=$CONTRIB --cache-file=$CONTRIB/config.cache --disable-shared --disable-sdl &&
-    make && make install &&
+    CONTRIB=%%CONTRIB%% &&
+    cd $CONTRIB/mpeg2dec && patch -p1 < ../patch-libmpeg2.patch &&
+    ./configure --prefix=$CONTRIB --disable-shared --disable-sdl &&
+    $(MAKE) && $(MAKE) install &&
     strip -S $CONTRIB/lib/libmpeg2.a
 }
 Wget     $(SUBDIR)/mpeg2dec.tar.gz : $(SUBDIR)/version_mpeg2dec.txt ;
@@ -265,10 +264,10 @@
 }
 actions LibOgg
 {
-    cd `dirname $(>)` && CONTRIB=`pwd` &&
-    rm -rf libogg && tar xzf libogg.tar.gz && cd libogg &&
-    ./configure --prefix=$CONTRIB --cache-file=$CONTRIB/config.cache --disable-shared &&
-    make && make install &&
+    CONTRIB=%%CONTRIB%% &&
+    cd $CONTRIB/libogg &&
+    ./configure --prefix=$CONTRIB --disable-shared &&
+    $(MAKE) && $(MAKE) install &&
     strip -S $CONTRIB/lib/libogg.a
 }
 Wget   $(SUBDIR)/libogg.tar.gz : $(SUBDIR)/version_libogg.txt ;
@@ -282,10 +281,10 @@
 }
 actions LibSampleRate
 {
-    cd `dirname $(>)` && CONTRIB=`pwd` &&
-    rm -rf libsamplerate && tar xzf libsamplerate.tar.gz && cd libsamplerate &&
-    ./configure --prefix=$CONTRIB --cache-file=$CONTRIB/config.cache --disable-shared &&
-    make && make install &&
+    CONTRIB=%%CONTRIB%% &&
+    cd $CONTRIB/libsamplerate &&
+    ./configure --prefix=$CONTRIB --disable-shared &&
+    $(MAKE) && $(MAKE) install &&
     strip -S $CONTRIB/lib/libsamplerate.a
 }
 Wget          $(SUBDIR)/libsamplerate.tar.gz : $(SUBDIR)/version_libsamplerate.txt ;
@@ -299,10 +298,10 @@
 }
 actions LibVorbis
 {
-    cd `dirname $(>)` && CONTRIB=`pwd` &&
-    rm -rf libvorbis && tar xzf libvorbis.tar.gz && cd libvorbis &&
-    ./configure --prefix=$CONTRIB --with-ogg=$CONTRIB --cache-file=$CONTRIB/config.cache --disable-shared &&
-    make && make install &&
+    CONTRIB=%%CONTRIB%% &&
+    cd $CONTRIB/libvorbis &&
+    ./configure --prefix=$CONTRIB --with-ogg=$CONTRIB --disable-shared &&
+    $(MAKE) && $(MAKE) install &&
     strip -S $CONTRIB/lib/libvorbis.a
 }
 Wget      $(SUBDIR)/libvorbis.tar.gz : $(SUBDIR)/version_libvorbis.txt ;
@@ -338,10 +337,10 @@
 }
 actions LibX264
 {
-    cd `dirname $(>)` && CONTRIB=`pwd` &&
-    rm -rf x264 && tar xzf x264.tar.gz && cd x264 && $(LIBX264_PATCH)
-    ./configure --prefix=$CONTRIB --enable-pthread && make &&
-    make install &&
+    CONTRIB=%%CONTRIB%% &&
+    cd $CONTRIB/x264 && $(LIBX264_PATCH)
+    ./configure --prefix=$CONTRIB --enable-pthread && $(MAKE) &&
+    $(MAKE) install &&
     strip -S $CONTRIB/lib/libx264.a
 }
 Wget    $(SUBDIR)/x264.tar.gz   : $(SUBDIR)/version_x264.txt ;
@@ -364,10 +363,9 @@
 }
 actions LibXvidCore
 {
-    cd `dirname $(>)` && CONTRIB=`pwd` &&
-    rm -rf xvidcore && tar xzf xvidcore.tar.gz &&
-    cd xvidcore && $(LIBXVIDCORE_PATCH)
-    cd build/generic/ && ./configure --prefix=$CONTRIB --cache-file=$CONTRIB/config.cache && make libxvidcore.a &&
+    CONTRIB=%%CONTRIB%% &&
+    cd $CONTRIB/xvidcore && $(LIBXVIDCORE_PATCH)
+    cd build/generic/ && ./configure --prefix=$CONTRIB && $(MAKE) libxvidcore.a &&
     cp ./=build/libxvidcore.a $CONTRIB/lib/ &&
     cp ../../src/xvid.h $CONTRIB/include/ &&
     strip -S $CONTRIB/lib/libxvidcore.a
@@ -385,10 +383,9 @@
     }
     actions Zlib
     {
-        cd `dirname $(>)` && CONTRIB=`pwd` &&
-        rm -rf zlib && tar xzf zlib.tar.gz &&
-        cd zlib && ./configure --prefix=$CONTRIB --cache-file=$CONTRIB/config.cache &&
-        make && make install && touch $CONTRIB/.contrib &&
+        CONTRIB=%%CONTRIB%% &&
+        cd $CONTRIB/zlib && ./configure --prefix=$CONTRIB &&
+        $(MAKE) && $(MAKE) install && touch $CONTRIB/.contrib &&
         strip -S $CONTRIB/lib/libz.a
     }
     Wget  $(SUBDIR)/zlib.tar.gz : $(SUBDIR)/version_zlib.txt ;
