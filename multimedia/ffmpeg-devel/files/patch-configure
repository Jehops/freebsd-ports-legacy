--- configure.orig	Sun Apr 15 12:34:50 2007
+++ configure	Wed Apr 18 10:31:48 2007
@@ -982,14 +982,8 @@
     arch="x86_32"
   ;;
   x86_64|amd64)
-    arch="x86_32"
-    canon_arch="`$cc -dumpmachine | sed -e 's,\([^-]*\)-.*,\1,'`"
-    if [ x"$canon_arch" = x"x86_64" -o x"$canon_arch" = x"amd64" ]; then
-      if [ -z "`echo $CFLAGS | grep -- -m32`"  ]; then
-        arch="x86_64"
-        enable fast_64bit
-      fi
-    fi
+    arch="x86_64"
+    enable fast_64bit
   ;;
   # armv4l is a subset of armv[567]*l
   arm|armv[4567]*l)
@@ -1965,15 +1959,15 @@
 if enabled shared; then
   echo "BUILD_SHARED=yes" >> config.mak
   echo "PIC=-fPIC -DPIC" >> config.mak
-  echo "SPPMAJOR=${pp_version%%.*}" >> config.mak
+  echo "SPPMAJOR=1" >> config.mak
   echo "SPPVERSION=$pp_version" >> config.mak
-  echo "LAVCMAJOR=${lavc_version%%.*}" >> config.mak
+  echo "LAVCMAJOR=%%SHLIB_VER%%" >> config.mak
   echo "LAVCVERSION=$lavc_version" >> config.mak
-  echo "LAVFMAJOR=${lavf_version%%.*}" >> config.mak
+  echo "LAVFMAJOR=%%SHLIB_VER%%" >> config.mak
   echo "LAVFVERSION=$lavf_version" >> config.mak
-  echo "LAVUMAJOR=${lavu_version%%.*}" >> config.mak
+  echo "LAVUMAJOR=%%SHLIB_VER%%" >> config.mak
   echo "LAVUVERSION=$lavu_version" >> config.mak
-  echo "SWSMAJOR=${sws_version%%.*}" >> config.mak
+  echo "SWSMAJOR=%%SHLIB_VER%%" >> config.mak
   echo "SWSVERSION=$sws_version" >> config.mak
   echo "SLIBNAME=${SLIBNAME}" >> config.mak
   echo "SLIBNAME_WITH_VERSION=${SLIBNAME_WITH_VERSION}" >> config.mak
@@ -2096,8 +2090,8 @@
 Version: $version
 Requires: $requires
 Conflicts:
-Libs: -L\${libdir} $libs
-Cflags: -I\${includedir} -I\${includedir}/$include
+Libs: -L\${libdir} $libs -L%%LOCALBASE%%/lib
+Cflags: -I\${includedir} -I\${includedir}/$include -I%%LOCALBASE%%/include
 EOF
 }
 
@@ -2120,7 +2114,8 @@
 Requires: $requires
 Conflicts:
 Libs: \${libdir}/${LIBPREF}${shortname}${LIBSUF} $libs
-Cflags: -I\${includedir}
+Ldflags: -L%%LOCALBASE%%/lib
+Cflags: -I\${includedir} -I%%LOCALBASE%%/include
 EOF
 }
 
