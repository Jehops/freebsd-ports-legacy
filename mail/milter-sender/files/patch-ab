--- install.sh.in.orig	Sun May 30 11:26:05 2004
+++ install.sh.in	Wed Jun 16 13:50:22 2004
@@ -18,62 +18,22 @@
 MAILDIR="@with_sendmail@"
 MILTER_CF="@milter_cf@"
 
-if [ ! -d ${STATEDIR} ]; then
-	mkdir -p ${STATEDIR}
-fi
-chown ${USER} ${STATEDIR}
-chgrp ${GROUP} ${STATEDIR}
+install -d -o ${USER} -g ${GROUP} -m 755 ${STATEDIR}
 
 RC="${STARTUP_DIR}/${MILTER}${STARTUP_EXT}"
-if [ ! -f $RC ]; then
-	cp ${MILTER}.sh $RC
-	chmod 540 $RC
+${BSD_INSTALL_SCRIPT} ${MILTER}.sh $RC.sample
+[ ! -f $RC ] && cp $RC.sample $RC
 
-	case `uname -s` in
-	Linux*)
-		which chkconfig
-		if test $? -eq 0; then	
-			chkconfig --add ${MILTER}
-		else
-			# Probably a stupid Debian system.
-			cd ${STARTUP_DIR}
+${BSD_INSTALL_PROGRAM} ${MILTER} ${SBINDIR}
 
-			# Create relative links
-			cd ../rc0.d
-			ln -s ../init.d/${MILTER} K20${MILTER}
-			cd ../rc1.d
-			ln -s ../init.d/${MILTER} K20${MILTER}
-			cd ../rc6.d
-			ln -s ../init.d/${MILTER} K20${MILTER}
+${BSD_INSTALL_DATA} ${MILTER}.mc ${MAILDIR}/${MILTER}.mc.sample
+[ ! -f ${MAILDIR}/${MILTER}.mc ] && cp ${MAILDIR}/${MILTER}.mc.sample ${MAILDIR}/${MILTER}.mc
 
-			# Assume S20sendmail or higher.
-			cd ../rc2.d
-			ln -s ../init.d/${MILTER} S18${MILTER}
-			cd ../rc3.d
-			ln -s ../init.d/${MILTER} S18${MILTER}
-			cd ../rc4.d
-			ln -s ../init.d/${MILTER} S18${MILTER}
-			cd ../rc5.d
-			ln -s ../init.d/${MILTER} S18${MILTER}
-		fi
-		;;
-	SunOS*)
-		# Does SunOS have a chkconfig like tool?	
-		ln -s $RC /etc/rc2.d/S70${MILTER}
-		ln -s $RC /etc/rcS.d/K30${MILTER}
-		;;
-	esac
-fi
+./milter-sender help=1 | sed 's|^MilterSocket=.*|MilterSocket=unix:/var/spool/milter-sender/socket|' >${MILTER_CF}.sample
+[ ! -f ${MILTER_CF} ] && cp ${MILTER_CF}.sample ${MILTER_CF}
 
-cp -f ${MILTER} ${SBINDIR}
-chmod 550 ${SBINDIR}/${MILTER}
-
-cp -f ${MILTER}.mc ${MAILDIR}/${MILTER}.mc.sample
-
-./milter-sender help=1 >${MILTER_CF}.sample
-
-chmod g+r ${MAILDIR} ${MAILDIR}/access.* ${MAILDIR}/aliases.* ${MILTER_CF}.sample*
-chgrp ${GROUP} ${MAILDIR} ${MAILDIR}/access.* ${MAILDIR}/aliases.* ${MILTER_CF}.sample*
+chgrp ${GROUP} ${MAILDIR}/access.db ${MAILDIR}/aliases.db ${MILTER_CF} ${MILTER_CF}.sample
+chmod g+r ${MAILDIR}/access.db ${MAILDIR}/aliases.db ${MILTER_CF} ${MILTER_CF}.sample
 
 echo '***************************************************************'
 echo
