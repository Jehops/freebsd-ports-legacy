--- install.sh.in.orig	Wed Aug 25 17:35:08 2004
+++ install.sh.in	Tue Sep  7 14:25:25 2004
@@ -25,62 +25,27 @@
 chgrp ${GROUP} ${STATEDIR}
 
 RC="${STARTUP_DIR}/${MILTER}${STARTUP_EXT}"
+${BSD_INSTALL_SCRIPT} ${MILTER}.sh.freebsd ${RC}.sample
 if [ ! -f $RC ]; then
-	cp ${MILTER}.sh $RC
-	chmod 540 $RC
-
-	case `uname -s` in
-	FreeBSD)
-		${BSD_INSTALL_PROGRAM} ${MILTER} ${SBINDIR}
-		;;
-	Linux*)
-		which chkconfig
-		if test $? -eq 0; then	
-			chkconfig --add ${MILTER}
-		else
-			# Probably a stupid Debian system.
-			cd ${STARTUP_DIR}
-
-			# Create relative links
-			cd ../rc0.d
-			ln -s ../init.d/${MILTER} K20${MILTER}
-			cd ../rc1.d
-			ln -s ../init.d/${MILTER} K20${MILTER}
-			cd ../rc6.d
-			ln -s ../init.d/${MILTER} K20${MILTER}
-
-			# Assume S20sendmail or higher.
-			cd ../rc2.d
-			ln -s ../init.d/${MILTER} S18${MILTER}
-			cd ../rc3.d
-			ln -s ../init.d/${MILTER} S18${MILTER}
-			cd ../rc4.d
-			ln -s ../init.d/${MILTER} S18${MILTER}
-			cd ../rc5.d
-			ln -s ../init.d/${MILTER} S18${MILTER}
-		fi
-		;;
-	SunOS*)
-		# Does SunOS have a chkconfig like tool?	
-		ln -s $RC /etc/rc2.d/S70${MILTER}
-		ln -s $RC /etc/rcS.d/K30${MILTER}
-		;;
-	esac
+	cp ${RC}.sample $RC
 fi
 
-cp -f ${MILTER} ${SBINDIR}
-chmod 550 ${SBINDIR}/${MILTER}
+${BSD_INSTALL_PROGRAM} ${MILTER} ${SBINDIR}
 
-cp -f ${MILTER}.mc ${MAILDIR}/${MILTER}.mc.sample
+MILTER_MC=${MAILDIR}/${MILTER}.mc
+${BSD_INSTALL_DATA} ${MILTER}.mc ${MILTER_MC}.sample
+if [ ! -f $MILTER_MC ]; then
+	cp ${MILTER_MC}.sample ${MILTER_MC}
+fi
 
 # Save the default configuration.
-./milter-sender help=1 >${MILTER_CF}.sample
+./milter-sender help=1 | sed "s|^MilterSocket=.*|MilterSocket=unix:$STATEDIR/socket|">${MILTER_CF}.sample
 
 # Save the existing configuration with any new additions.
-./milter-sender help=2 >${MILTER_CF}.new
+./milter-sender help=2 | sed "s|^MilterSocket=.*|MilterSocket=unix:$STATEDIR/socket|">${MILTER_CF}.new
 
-chgrp ${GROUP} ${MAILDIR} ${MAILDIR}/access.* ${MAILDIR}/aliases.* ${MILTER_CF}.sample*
-chmod g+r ${MAILDIR} ${MAILDIR}/access.* ${MAILDIR}/aliases.* ${MILTER_CF}.sample*
+chgrp ${GROUP} ${MAILDIR}/access.db ${MAILDIR}/aliases.db ${MILTER_CF}.new ${MILTER_CF}.sample
+chmod g+r ${MAILDIR}/access.db ${MAILDIR}/aliases.db ${MILTER_CF}.new ${MILTER_CF}.sample
 
 echo '***************************************************************'
 echo
