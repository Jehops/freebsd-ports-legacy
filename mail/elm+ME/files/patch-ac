--- Configure.orig	Sat Nov 15 17:19:06 2003
+++ Configure	Tue Dec 23 03:24:03 2003
@@ -64,7 +64,7 @@
 		    shift
 		    ;;
 		-P*)
-		    prefix="`expr \"$1\" : '-P\(.*\)'`"
+		    prefix="`expr \"X$1\" : 'X-P\(.*\)'`"
 		    shift
 		    case "$prefix" in
 			"")
@@ -75,7 +75,7 @@
        		    echo "Prefix: $prefix"
 		;;
 		-s*)
-		    libsuffix="`expr \"$1\" : '-s\(.*\)'`"
+		    libsuffix="`expr \"X$1\" : 'X-s\(.*\)'`"
 		    shift
 		    case "$libsuffix" in
 			"")
@@ -86,7 +86,7 @@
        		    echo "Extra library suffix: $libsuffix"
 		;;
 		-c*)
-		    config="`expr \"$1\" : '-c\(.*\)'`"
+		    config="`expr \"X$1\" : 'X-c\(.*\)'`"
 		    shift
 		    case "$config" in
 			"")
@@ -122,7 +122,7 @@
 case "$error" in
 true)
     cat >&2 << EOM
-Usage: Configure [-dS]
+Usage: Configure [-dbhSMN] [-P'prefix'] [-s'suffix'] [-c'config'] [-DDEBUG]
   -d : use defaults for all answers.
   -b : batchmode -- do not prompt user (implies -d)
   -h : print this help message and exit (with an error status).
@@ -2296,7 +2296,7 @@
 	echo "Found shlib directory"
     fi
 
-    $echo "Trying create chared library"
+    $echo "Trying create shared library"
 
     LibLoc=`cd ..; pwd`/shlib
     
@@ -2589,7 +2589,10 @@
 
 : see if crypt exists
 echo " "
-if $contains '^crypt$' libc.list >/dev/null 2>&1; then
+if $test "$cryptlib" = -lcrypt; then
+    echo 'crypt() found.'
+    d_crypt="$define"
+elif $contains '^crypt$' libc.list >/dev/null 2>&1; then
     echo 'crypt() found.'
     d_crypt="$define"
     cryptlib=''
@@ -3093,6 +3096,7 @@
 
     $echo $n "Testing if inet_aton can be used ... $c"
     $cat > try.c <<'EOF'
+#include <sys/types.h>
 #include <sys/socket.h>
 #include <netinet/in.h>
 #include <arpa/inet.h>
