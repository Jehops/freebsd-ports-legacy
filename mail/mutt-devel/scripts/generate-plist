#!/bin/sh
#
# $FreeBSD$
#
# set -x

trap ' cleanup ' 0
trap ' echo_signal; exit 1' 1 2 3 15

tmp_first=$(mktemp ${WRKDIR:=/tmp}/.plist-first.XXXXXXXXXX)
tmp_last=$(mktemp ${WRKDIR}/.plist-last.XXXXXXXXXX)

cleanup() {
  rm -f $tmp_first $tmp_last
}

echo_signal() {
  echo "Got Signal -- aborting `basename $0`"
}

PATH=/bin:/usr/bin

cat > $tmp_first <<EOF
bin/flea
bin/mutt
bin/mutt_dotlock
bin/muttbug
bin/pgpewrap
bin/pgpring
bin/smime_keys
@unexec if cmp -s %D/etc/Muttrc.dist %D/etc/Muttrc; then rm -f %D/etc/Muttrc; fi
@unexec if cmp -s %D/etc/mime.types.dist %D/etc/mime.types; then rm -f %D/etc/mime.types; fi
etc/Muttrc.dist
etc/mime.types.dist
@exec if [ ! -f %D/etc/Muttrc ]; then cp %D/etc/Muttrc.dist %D/etc/Muttrc; fi
@exec if [ ! -f %D/etc/mime.types ]; then cp %D/etc/mime.types.dist %D/etc/mime.types; fi
EOF

if [ "$MUTT_NLS" = "yes" ]; then
  cat >> $tmp_first <<EOF
share/locale/bg/LC_MESSAGES/mutt.mo
share/locale/ca/LC_MESSAGES/mutt.mo
share/locale/cs/LC_MESSAGES/mutt.mo
share/locale/da/LC_MESSAGES/mutt.mo
share/locale/de/LC_MESSAGES/mutt.mo
share/locale/el/LC_MESSAGES/mutt.mo
share/locale/eo/LC_MESSAGES/mutt.mo
share/locale/es/LC_MESSAGES/mutt.mo
share/locale/et/LC_MESSAGES/mutt.mo
share/locale/fr/LC_MESSAGES/mutt.mo
share/locale/gl/LC_MESSAGES/mutt.mo
share/locale/hu/LC_MESSAGES/mutt.mo
share/locale/id/LC_MESSAGES/mutt.mo
share/locale/it/LC_MESSAGES/mutt.mo
share/locale/ja/LC_MESSAGES/mutt.mo
share/locale/ko/LC_MESSAGES/mutt.mo
share/locale/lt/LC_MESSAGES/mutt.mo
share/locale/nl/LC_MESSAGES/mutt.mo
share/locale/pl/LC_MESSAGES/mutt.mo
share/locale/pt_BR/LC_MESSAGES/mutt.mo
share/locale/ru/LC_MESSAGES/mutt.mo
share/locale/sk/LC_MESSAGES/mutt.mo
share/locale/sv/LC_MESSAGES/mutt.mo
share/locale/tr/LC_MESSAGES/mutt.mo
share/locale/uk/LC_MESSAGES/mutt.mo
share/locale/zh_CN/LC_MESSAGES/mutt.mo
share/locale/zh_TW/LC_MESSAGES/mutt.mo
EOF
fi

if [ "$MUTT_PORTDOCS" = "yes" ]; then
  cat >> $tmp_first <<EOF
%%DOCSDIR%%/ABOUT-NLS
%%DOCSDIR%%/COPYRIGHT
%%DOCSDIR%%/ChangeLog
%%DOCSDIR%%/ChangeLog.old
%%DOCSDIR%%/GPL
%%DOCSDIR%%/INSTALL
%%DOCSDIR%%/NEWS
%%DOCSDIR%%/PGP-Notes.txt
%%DOCSDIR%%/README
%%DOCSDIR%%/README.SECURITY
%%DOCSDIR%%/README.SSL
%%DOCSDIR%%/TODO
%%DOCSDIR%%/applying-patches.txt
%%DOCSDIR%%/devel-notes.txt
%%DOCSDIR%%/language.txt
%%DOCSDIR%%/language50.txt
%%DOCSDIR%%/manual.txt
%%DOCSDIR%%/patch-notes.txt
%%DOCSDIR%%/smime-notes.txt
%%EXAMPLESDIR%%/Mush.rc
%%EXAMPLESDIR%%/Pine.rc
%%EXAMPLESDIR%%/Tin.rc
%%EXAMPLESDIR%%/ca-bundle.crt
%%EXAMPLESDIR%%/colors.default
%%EXAMPLESDIR%%/colors.linux
%%EXAMPLESDIR%%/gpg.rc
%%EXAMPLESDIR%%/pgp2.rc
%%EXAMPLESDIR%%/pgp5.rc
%%EXAMPLESDIR%%/pgp6.rc
%%EXAMPLESDIR%%/sample.mailcap
%%EXAMPLESDIR%%/sample.muttrc
%%EXAMPLESDIR%%/sample.muttrc-tlr
%%EXAMPLESDIR%%/smime.rc
%%EXAMPLESDIR%%/smime_keys_test.pl
%%EXAMPLESDIR%%/iconv/iconv.aix-3.2.5.rc
%%EXAMPLESDIR%%/iconv/iconv.aix-4.1.5.rc
%%EXAMPLESDIR%%/iconv/iconv.aix-4.2.0.rc
%%EXAMPLESDIR%%/iconv/iconv.aix-4.3.2.rc
%%EXAMPLESDIR%%/iconv/iconv.freebsd-3.3.rc
%%EXAMPLESDIR%%/iconv/iconv.glibc-2.1.3.rc
%%EXAMPLESDIR%%/iconv/iconv.glibc-2.1.90.rc
%%EXAMPLESDIR%%/iconv/iconv.hpux-10.01.rc
%%EXAMPLESDIR%%/iconv/iconv.hpux-10.20.rc
%%EXAMPLESDIR%%/iconv/iconv.hpux-11.00.rc
%%EXAMPLESDIR%%/iconv/iconv.irix-6.5.rc
%%EXAMPLESDIR%%/iconv/iconv.osf1-4.0a.rc
%%EXAMPLESDIR%%/iconv/iconv.osf1-4.0d.rc
%%EXAMPLESDIR%%/iconv/iconv.solaris-2.4.rc
%%EXAMPLESDIR%%/iconv/iconv.solaris-2.5.1.rc
%%EXAMPLESDIR%%/iconv/iconv.solaris-2.6-cjk.rc
%%EXAMPLESDIR%%/iconv/iconv.solaris-2.6.rc
%%EXAMPLESDIR%%/iconv/iconv.solaris-2.7.rc
EOF

  if [ "$MUTT_NNTP" = "yes" ]; then
    echo "%%DOCSDIR%%/ChangeLog.nntp" >> $tmp_first
  fi
  if [ "$MUTT_SGML" = "yes" ]; then
    echo "%%DOCSDIR%%/manual.latin1" >> $tmp_first
    echo "%%DOCSDIR%%/manual.ps" >> $tmp_first
  fi

  if [ "$MUTT_HTML" = "yes" ]; then
    html=372
    if [ "$MUTT_COMPRESSED_FOLDERS" = "yes" ]; then
      html=$(($html + 5))
    fi
    if [ "$MUTT_NNTP" = "yes" ]; then
      html=$(($html + 22))
    fi
    if [ "$MUTT_QUOTE_PATCH" = "yes" ]; then
      html=$(($html + 2))
    fi
    if [ "$MUTT_EDIT_THREADS" = "yes" ]; then
      html=$(($html + 3))
    fi
    if [ "$MUTT_MAILDIR_HEADER_CACHE" = "yes" ]; then
      html=$(($html + 3))
    fi
    if [ "$MUTT_SIGNATURE_MENU" = "yes" ]; then
      html=$(($html + 1))
    fi
    if [ "$MUTT_IFDEF_PATCH" = "yes" ]; then
      html=$(($html + 1))
    fi
    if [ "$MUTT_PGP_PATCH" = "yes" ]; then
      html=$(($html + 3))
    fi
    if [ "$MUTT_SLAVE_HTML_PAGES" != "" ]; then
      html=$(($html + $MUTT_SLAVE_HTML_PAGES))
    fi
    echo "%%DOCSDIR%%/html/manual.html" >> $tmp_first
    echo "%%DOCSDIR%%/html/manual_toc.html" >> $tmp_first 
    i=1
    while [ $i -le $html ]; do
      echo "%%DOCSDIR%%/html/manual$i.html" >> $tmp_first 
      i=$(($i + 1))
    done
    echo "@dirrm %%DOCSDIR%%/html" >> $tmp_last
  fi
  cat >> $tmp_last <<EOF
@dirrm %%EXAMPLESDIR%%/iconv
@dirrm %%EXAMPLESDIR%%
@dirrm %%DOCSDIR%%
EOF
fi

sort -u $tmp_first
cat $tmp_last
