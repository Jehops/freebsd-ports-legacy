--- ../MailScanner-install-4.48.4.orig/docs/man/MailScanner.conf.5.html	Wed Dec  7 18:33:07 2005
+++ docs/man/MailScanner.conf.5.html	Wed Dec  7 18:34:00 2005
@@ -1,5 +1,5 @@
 <!-- Creator     : groff version 1.19 -->
-<!-- CreationDate: Wed Jun  1 11:29:47 2005 -->
+<!-- CreationDate: Tue Dec  6 20:28:14 2005 -->
 <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
 "http://www.w3.org/TR/html4/loose.dtd">
 <html>
@@ -34,6 +34,7 @@
 <a href="#Definitions of virus scanners and spam detectors">Definitions of virus scanners and spam detectors</a><br>
 <a href="#Spam detection and spam lists (DNS blocklists)">Spam detection and spam lists (DNS blocklists)</a><br>
 <a href="#SpamAssassin">SpamAssassin</a><br>
+<a href="#Custom Spam Scanner Plugin">Custom Spam Scanner Plugin</a><br>
 <a href="#What to do with spam">What to do with spam</a><br>
 <a href="#System logging">System logging</a><br>
 <a href="#Advanced SpamAssassin Settings">Advanced SpamAssassin Settings</a><br>
@@ -953,6 +954,61 @@
 <tr valign="top" align="left">
 <td width="11%"></td>
 <td width="89%">
+<p><b>Scan Messages</b></p></td>
+</table>
+<!-- INDENTATION -->
+<table width="100%" border=0 rules="none" frame="void"
+       cols="2" cellspacing="0" cellpadding="0">
+<tr valign="top" align="left">
+<td width="22%"></td>
+<td width="78%">
+<p>Default: yes</p>
+<!-- INDENTATION -->
+<p>If this is set to yes, then email messages passing
+through MailScanner will be processed and checked, and all
+the other options in this file will be used to control what
+checks are made on the message. If this is set to no, then
+email messages will NOT be processed or checked *at all*,
+and so any viruses or other problems will be ignored.</p>
+</td>
+</table>
+<!-- INDENTATION -->
+<table width="100%" border=0 rules="none" frame="void"
+       cols="2" cellspacing="0" cellpadding="0">
+<tr valign="top" align="left">
+<td width="11%"></td>
+<td width="89%">
+<p><b>Reject Messages</b></p></td>
+</table>
+<!-- INDENTATION -->
+<table width="100%" border=0 rules="none" frame="void"
+       cols="2" cellspacing="0" cellpadding="0">
+<tr valign="top" align="left">
+<td width="22%"></td>
+<td width="78%">
+<p>Default: no</p>
+<!-- INDENTATION -->
+<p>You may not want to receive mail from certain addresses
+and/or to certain addresses. If so, you can do this with
+your email transport (sendmail, Postfix, etc) but that will
+just send a one&minus;line message which is not helpful to
+the user sending the message. If this is set to yes, then
+the message set by the &quot;Rejection Report&quot; will be
+sent instead, and the incoming message will be deleted. If
+you want to store a copy of the original incoming message
+then use the &quot;Archive Mail&quot; setting to archive a
+copy of it. The purpose of this option is to set it to be a
+ruleset, so that you can reject messages from a few
+offending addresses where you need to send a polite reply
+instead of just a brief 1&minus;line rejection message.</p>
+</td>
+</table>
+<!-- INDENTATION -->
+<table width="100%" border=0 rules="none" frame="void"
+       cols="2" cellspacing="0" cellpadding="0">
+<tr valign="top" align="left">
+<td width="11%"></td>
+<td width="89%">
 <p><b>Maximum Attachments Per Message</b></p></td>
 </table>
 <!-- INDENTATION -->
@@ -2523,6 +2579,27 @@
 <tr valign="top" align="left">
 <td width="11%"></td>
 <td width="89%">
+<p><b>Quarantine Modified Body</b></p></td>
+</table>
+<!-- INDENTATION -->
+<table width="100%" border=0 rules="none" frame="void"
+       cols="2" cellspacing="0" cellpadding="0">
+<tr valign="top" align="left">
+<td width="22%"></td>
+<td width="78%">
+<p>Default: no</p>
+<!-- INDENTATION -->
+<p>Do you want to store copies of messages which have been
+disarmed by having their HTML modified at all? This can also
+be the filename of a ruleset.</p>
+</td>
+</table>
+<!-- INDENTATION -->
+<table width="100%" border=0 rules="none" frame="void"
+       cols="2" cellspacing="0" cellpadding="0">
+<tr valign="top" align="left">
+<td width="11%"></td>
+<td width="89%">
 <p><b>Quarantine Whole Message</b></p></td>
 </table>
 <!-- INDENTATION -->
@@ -2621,6 +2698,27 @@
 <tr valign="top" align="left">
 <td width="11%"></td>
 <td width="89%">
+<p><b>Rejection Report</b></p></td>
+</table>
+<!-- INDENTATION -->
+<table width="100%" border=0 rules="none" frame="void"
+       cols="2" cellspacing="0" cellpadding="0">
+<tr valign="top" align="left">
+<td width="22%"></td>
+<td width="78%">
+<p>Default: %reports&minus;dir%/rejection.report.txt</p>
+<!-- INDENTATION -->
+<p>Set where to find the message text sent to users who
+triggered the ruleset you are using with the &quot;Reject
+Message&quot; option.</p>
+</td>
+</table>
+<!-- INDENTATION -->
+<table width="100%" border=0 rules="none" frame="void"
+       cols="2" cellspacing="0" cellpadding="0">
+<tr valign="top" align="left">
+<td width="11%"></td>
+<td width="89%">
 <p><b>Deleted Bad Filename Message Report</b></p></td>
 </table>
 <!-- INDENTATION -->
@@ -4909,10 +5007,239 @@
 <td width="78%">
 <p>Default: no</p>
 <!-- INDENTATION -->
-<p># The Bayesian database rebuild and expiry may take a 2
-or 3 minutes # to complete. During this time you can either
-wait, or simply # disable SpamAssassin checks until it has
-completed. WaitDuringBayesRebuild = no</p>
+<p>The Bayesian database rebuild and expiry may take a 2 or
+3 minutes to complete. During this time you can either wait,
+or simply disable SpamAssassin checks until it has
+completed.</p>
+</td>
+</table>
+<a name="Custom Spam Scanner Plugin"></a>
+<h2>Custom Spam Scanner Plugin</h2>
+<!-- INDENTATION -->
+<table width="100%" border=0 rules="none" frame="void"
+       cols="2" cellspacing="0" cellpadding="0">
+<tr valign="top" align="left">
+<td width="11%"></td>
+<td width="89%">
+<p><b>Use Custom Spam Scanner</b></p></td>
+</table>
+<!-- INDENTATION -->
+<table width="100%" border=0 rules="none" frame="void"
+       cols="2" cellspacing="0" cellpadding="0">
+<tr valign="top" align="left">
+<td width="22%"></td>
+<td width="78%">
+<p>Default: no</p>
+<!-- INDENTATION -->
+<p>Use the Custom Spam Scanner. This is code you will have
+to write yourself, a function called
+&quot;GenericSpamScanner&quot; stored in the file
+&quot;MailScanner/lib/MailScanner/CustomFunctions/GenericSpamScanner.pm&quot;.
+A sample function is given in the correct file in the
+distribution. This sample function also includes code to
+show you how to make it run an external program to produce a
+spam score. This can also be the filename of a ruleset. The
+function will be passed</p>
+</td>
+</table>
+<!-- TABS -->
+<table width="100%" border=0 rules="none" frame="void"
+       cols="5" cellspacing="0" cellpadding="0">
+<tr valign="top" align="left">
+<td width="22%"></td>
+<td width="1%">
+
+<p>&bull;</p>
+</td>
+<td width="5%"></td>
+<td width="4%">
+
+<p>$IP</p>
+</td>
+<td width="68%">
+</td>
+<tr valign="top" align="left">
+<td width="22%"></td>
+<td width="1%"></td>
+<td width="5%"></td>
+<td width="4%">
+</td>
+<td width="68%">
+
+<p>&minus; the numeric IP address of the system on the
+remote end of the SMTP connections</p>
+</td>
+</table>
+<!-- TABS -->
+<table width="100%" border=0 rules="none" frame="void"
+       cols="7" cellspacing="0" cellpadding="0">
+<tr valign="top" align="left">
+<td width="22%"></td>
+<td width="1%">
+
+<p>&bull;</p>
+</td>
+<td width="5%"></td>
+<td width="7%">
+
+<p>$From</p>
+</td>
+<td width="2%"></td>
+<td width="8%">
+
+<p>&minus; the address of the envelope sender of the
+message</p>
+</td>
+<td width="55%">
+</td>
+</table>
+<!-- TABS -->
+<table width="100%" border=0 rules="none" frame="void"
+       cols="6" cellspacing="0" cellpadding="0">
+<tr valign="top" align="left">
+<td width="22%"></td>
+<td width="1%">
+
+<p>&bull;</p>
+</td>
+<td width="5%"></td>
+<td width="9%">
+
+<p>$To</p>
+</td>
+<td width="8%"></td>
+<td width="55%">
+</td>
+<tr valign="top" align="left">
+<td width="22%"></td>
+<td width="1%"></td>
+<td width="5%"></td>
+<td width="9%">
+</td>
+<td width="8%">
+
+<p>&minus; a perl reference to the envelope recipients of
+the message</p>
+</td>
+<td width="55%">
+</td>
+</table>
+<!-- TABS -->
+<table width="100%" border=0 rules="none" frame="void"
+       cols="5" cellspacing="0" cellpadding="0">
+<tr valign="top" align="left">
+<td width="22%"></td>
+<td width="1%">
+
+<p>&bull;</p>
+</td>
+<td width="5%"></td>
+<td width="12%">
+
+<p>$Message</p>
+</td>
+<td width="60%">
+</td>
+</table>
+<!-- INDENTATION -->
+<table width="100%" border=0 rules="none" frame="void"
+       cols="2" cellspacing="0" cellpadding="0">
+<tr valign="top" align="left">
+<td width="22%"></td>
+<td width="78%">
+<p>&minus; a perl reference to the list of line of the
+message</p></td>
+</table>
+<!-- INDENTATION -->
+<table width="100%" border=0 rules="none" frame="void"
+       cols="2" cellspacing="0" cellpadding="0">
+<tr valign="top" align="left">
+<td width="11%"></td>
+<td width="89%">
+<p><b>Max Custom Spam Scanner Size</b></p></td>
+</table>
+<!-- INDENTATION -->
+<table width="100%" border=0 rules="none" frame="void"
+       cols="2" cellspacing="0" cellpadding="0">
+<tr valign="top" align="left">
+<td width="22%"></td>
+<td width="78%">
+<p>Default: 20000</p>
+<!-- INDENTATION -->
+<p>How much of the message should be passed tot he Custom
+Spam Scanner. Most spam tools only need the first 20kbytes
+of the message to determine if it is spam or not. Passing
+more than is necessary only slows things down. This can also
+be the filename of a ruleset.</p>
+</td>
+</table>
+<!-- INDENTATION -->
+<table width="100%" border=0 rules="none" frame="void"
+       cols="2" cellspacing="0" cellpadding="0">
+<tr valign="top" align="left">
+<td width="11%"></td>
+<td width="89%">
+<p><b>Custom Spam Scanner Timeout</b></p></td>
+</table>
+<!-- INDENTATION -->
+<table width="100%" border=0 rules="none" frame="void"
+       cols="2" cellspacing="0" cellpadding="0">
+<tr valign="top" align="left">
+<td width="22%"></td>
+<td width="78%">
+<p>Default: 20</p>
+<!-- INDENTATION -->
+<p>How long should the custom spam scanner take to run? If
+it takes more seconds than this, then it should be
+considered to have crashed and should be killed. This stops
+denial&minus;of&minus;service attacks.</p>
+</td>
+</table>
+<!-- INDENTATION -->
+<table width="100%" border=0 rules="none" frame="void"
+       cols="2" cellspacing="0" cellpadding="0">
+<tr valign="top" align="left">
+<td width="11%"></td>
+<td width="89%">
+<p><b>Max Custom Spam Scanner Timeouts</b></p></td>
+</table>
+<!-- INDENTATION -->
+<table width="100%" border=0 rules="none" frame="void"
+       cols="2" cellspacing="0" cellpadding="0">
+<tr valign="top" align="left">
+<td width="22%"></td>
+<td width="78%">
+<p>Default: 10</p>
+<!-- INDENTATION -->
+<p>If the Custom Spam Scanner times out more times in a row
+than this, then it will be marked as &quot;unavailable&quot;
+until MailScanner next re&minus;starts itself.</p>
+</td>
+</table>
+<!-- INDENTATION -->
+<table width="100%" border=0 rules="none" frame="void"
+       cols="2" cellspacing="0" cellpadding="0">
+<tr valign="top" align="left">
+<td width="11%"></td>
+<td width="89%">
+<p><b>Custom Spam Scanner Timeout History</b></p></td>
+</table>
+<!-- INDENTATION -->
+<table width="100%" border=0 rules="none" frame="void"
+       cols="2" cellspacing="0" cellpadding="0">
+<tr valign="top" align="left">
+<td width="22%"></td>
+<td width="78%">
+<p>Default: 20</p>
+<!-- INDENTATION -->
+<p>The total number of Custom Spam Scanner attempts during
+which &quot;Max Custom Spam Scanner Timeouts&quot; will
+cause the Custom Spam Scanner to be marked as
+&quot;unavailable&quot;. See the previous comment for more
+information. The default values of 10 and 20 mean that 10
+timeouts in any sequence of 20 attempts will trigger the
+behaviour described above, until the next periodic restart
+(see &quot;Restart Every&quot;).</p>
 </td>
 </table>
 <a name="What to do with spam"></a>
