--- Makefile.orig	Mon Apr 18 21:07:30 2005
+++ Makefile	Mon Apr 18 21:07:36 2005
@@ -5,8 +5,9 @@
 SRCS		= utils.c relay.c smtp.c regex.c 
 MILTER_OBJS	= utils.o relay.o smtp.o regex.o
 MILTER		= smc-milter
-INSDIR		= /opt/SMC
-CC		= gcc
+BINDIR		= ${PREFIX}/bin
+ETCDIR		= ${PREFIX}/etc/smc
+CC		?= gcc
 
 ifdef DEBUG
     CFLAGS	= -g -ggdb2
@@ -18,8 +19,8 @@
     CFLAGS	+= -Wall -D_GNU_SOURCE -D_REENTRANT -I/usr/lib/bind/include
     LIBS	= /usr/lib/bind/lib/libbind_r.a -lmilter -pthread -lssl
 else
-    CFLAGS	+= -Wall -D_GNU_SOURCE -D_REENTRANT 
-    LIBS	= -lmilter -pthread -lssl -lresolv
+    CFLAGS	+= -Wall -D_GNU_SOURCE -D_REENTRANT -I${LOCALBASE}/include/bind
+    LIBS	= -lmilter ${PTHREAD_LIBS} -lssl -lbind_r -lcrypto -L${LOCALBASE}/lib
 endif
 
 all: milter
@@ -31,14 +32,14 @@
 	$(CC) $(CFLAGS) -c $<
 
 install:
-	[ -d "$(INSDIR)" ] || mkdir $(INSDIR)
+	[ -d "$(ETCDIR)" ] || mkdir $(ETCDIR)
 	if [ -n "$(MILTER)" ]; then \
 		strip $(MILTER) ; \
-		install -m 755 $(MILTER) $(INSDIR) ; \
+		install -m 755 $(MILTER) $(BINDIR) ; \
 	fi
-	install -m 644 $(MILTER).conf $(INSDIR)
-	install -m 644 $(MILTER).policy $(INSDIR)
-	install -m 644 $(MILTER).users $(INSDIR)
+	install -m 644 $(MILTER).conf $(ETCDIR)
+	install -m 644 $(MILTER).policy $(ETCDIR)
+	install -m 644 $(MILTER).users $(ETCDIR)
 
 remove:
 	rm -f $(INSDIR)/$(MILTER)*
