*** pop_uidl.c.orig	Thu Nov 20 00:20:38 1997
--- pop_uidl.c	Mon Jun 29 02:13:18 1998
***************
*** 57,63 ****
  			    "Message %d has been marked for deletion.",msg_id));
        } else {
  
! 	sprintf(buffer, "%d %s", msg_id, mp->uidl_str);
          if (nl = index(buffer, NEWLINE)) *nl = 0;
  	return (pop_msg (p,POP_SUCCESS, buffer));
        }
--- 57,63 ----
  			    "Message %d has been marked for deletion.",msg_id));
        } else {
  
! 	snprintf(buffer, sizeof(buffer), "%d %s", msg_id, mp->uidl_str);
          if (nl = index(buffer, NEWLINE)) *nl = 0;
  	return (pop_msg (p,POP_SUCCESS, buffer));
        }
***************
*** 73,79 ****
  	    /*  Is the message flagged for deletion? */
  	    if (mp->del_flag) continue;
  
! 	    sprintf(buffer, "%d %s", x, mp->uidl_str);
  /*	    nl = index(mp->uidl_str, NEWLINE); */
  	    pop_sendline(p, buffer);
  /*
--- 73,79 ----
  	    /*  Is the message flagged for deletion? */
  	    if (mp->del_flag) continue;
  
! 	    snprintf(buffer, sizeof(buffer), "%d %s", x, mp->uidl_str);
  /*	    nl = index(mp->uidl_str, NEWLINE); */
  	    pop_sendline(p, buffer);
  /*
***************
*** 101,107 ****
       POP         *p;
       MsgInfoList *mp;
  {
!   char buf[MAXLINELEN], *cp;
  
      fseek(p->drop, mp->offset, 0);
      while (fgets(buf, sizeof(buf), p->drop) != NULL) {
--- 101,107 ----
       POP         *p;
       MsgInfoList *mp;
  {
!   static char buf[MAXLINELEN], *cp;
  
      fseek(p->drop, mp->offset, 0);
      while (fgets(buf, sizeof(buf), p->drop) != NULL) {
***************
*** 150,158 ****
  			    "Message %d has been marked for deletion.",msg_id));
        } else {
  
! 	sprintf(buffer, "%d %s", msg_id, mp->uidl_str);
          if (nl = index(buffer, NEWLINE)) *nl = 0;
! 	sprintf(buffer, "%s %d %s", buffer, mp->length, from_hdr(p, mp));
  	return (pop_msg (p,POP_SUCCESS, buffer));
        }
      } else {
--- 150,158 ----
  			    "Message %d has been marked for deletion.",msg_id));
        } else {
  
! 	snprintf(buffer, sizeof(buffer), "%d %s", msg_id, mp->uidl_str);
          if (nl = index(buffer, NEWLINE)) *nl = 0;
! 	snprintf(buffer, sizeof(buffer), "%s %d %s", buffer, mp->length, from_hdr(p, mp));
  	return (pop_msg (p,POP_SUCCESS, buffer));
        }
      } else {
***************
*** 167,175 ****
  	    /*  Is the message flagged for deletion? */
  	    if (mp->del_flag) continue;
  
! 	    sprintf(buffer, "%d %s", x, mp->uidl_str);
  	    if (nl = index(buffer, NEWLINE)) *nl = 0;	    
! 	    sprintf(buffer, "%s %d %s", buffer, mp->length, from_hdr(p, mp));
  	    pop_sendline(p, buffer);
          }
      }
--- 167,175 ----
  	    /*  Is the message flagged for deletion? */
  	    if (mp->del_flag) continue;
  
! 	    snprintf(buffer, sizeof(buffer), "%d %s", x, mp->uidl_str);
  	    if (nl = index(buffer, NEWLINE)) *nl = 0;	    
! 	    snprintf(buffer, sizeof(buffer), "%s %d %s", buffer, mp->length, from_hdr(p, mp));
  	    pop_sendline(p, buffer);
          }
      }
