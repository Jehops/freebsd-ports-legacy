--- Razor2-Preproc-deHTMLxs/_deHTMLxs.c	Thu Jun 17 00:44:35 2004
+++ Razor2-Preproc-deHTMLxs/_deHTMLxs.c	Sun Aug  1 09:48:54 2004
@@ -177,13 +177,17 @@
 		    break;
 
 		case '&':
-		    *t++ = html_tagxlat(&s);
+		    if (t != NULL)
+			    *t++ = html_tagxlat(&s);
 		    break;
 
 		default:
 		valid:
-		    if (!tag)
-			*t++ = c;
+		    if (!tag) {
+			if (t != NULL ) {
+				*t++ = c;
+			}
+		    }
 		    break;
 	    }
 
--- Razor2-Preproc-deHTMLxs/deHTMLxs.xs	Sun Aug  1 13:55:03 2004
+++ Razor2-Preproc-deHTMLxs/deHTMLxs.xs	Sun Aug  1 13:52:28 2004
@@ -191,6 +191,7 @@
             text = SvRV(scalarref);
             raw = SvPV(text,size);
 
+	    *(raw + size - 1) = '\0';
             if ( (cleaned = malloc(size+1)) && 
                  (res = html_strip(raw, cleaned))  // html_strip will memset cleaned to 0
                  ) {
