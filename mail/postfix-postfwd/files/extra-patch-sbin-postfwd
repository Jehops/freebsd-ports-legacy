--- sbin/postfwd.orig	2009-06-29 05:36:15.000000000 -0400
+++ sbin/postfwd	2009-07-09 22:56:26.000000000 -0400
@@ -1229,7 +1229,7 @@
 					type 		=> $mycmd,
 					maxcount	=> $ratecount,
 					ttl		=> $ratetime,
-					count		=> ( ($mycmd eq 'size') ? $request{size} : 1 ),
+					count		=> (($mycmd eq 'size') ? $request{size} : (($mycmd eq 'mrcpt') ? $request{recipient_count} : 1)),
 					time		=> $now,
 					rule		=> $Rules[$index]{$COMP_ID},
 					action		=> $ratecmd,
@@ -1246,6 +1246,8 @@
 	},
 	# size() command
 	"size"	=> sub { return &{$postfwd_actions{rate}}(@_); },
+	# mrcpt() command
+	"mrcpt" => sub { return &{$postfwd_actions{rate}}(@_); },	
 	# wait() command
 	"wait"	=> sub {
 		my($index,$now,$mycmd,$myarg,$myline,%request) = @_;
@@ -1724,7 +1726,9 @@
 	next RATES unless ( $request{$checkreq} and (defined $Rates{$request{$checkreq}}) );
 	if ( ($now - $Rates{$request{$checkreq}}{"time"}) > $Rates{$request{$checkreq}}{ttl} ) {
 		# renew rate
-		$Rates{$request{$checkreq}}{count} = ( ($Rates{$request{$checkreq}}{type} eq 'size') ? $request{size} : 1 );
+		$Rates{$request{$checkreq}}{count} = ( ($Rates{$request{$checkreq}}{type} eq 'size') 
+			? $request{size} : (($Rates{$request{$checkreq}}{type} eq 'mrcpt') 
+			? $request{recipient_count} : 1) );
 		$Rates{$request{$checkreq}}{"time"} = $now;
 		mylogs $syslog_priority, "[RATE] renewing rate object ".$request{$checkreq}
 			." [type: ".$Rates{$request{$checkreq}}{type}
@@ -1733,7 +1737,9 @@
 			if ($opt_verbose > 1);
 	} else {
 		# increase rate
-		$Rates{$request{$checkreq}}{count} += ( ($Rates{$request{$checkreq}}{type} eq 'size') ? $request{size} : 1 );
+		$Rates{$request{$checkreq}}{count} += (($Rates{$request{$checkreq}}{type} eq 'size') 
+			? $request{size} : (($Rates{$request{$checkreq}}{type} eq 'mrcpt') 
+			? $request{recipient_count} : 1)); 
 		mylogs $syslog_priority, "[RATE] increasing rate object ".$request{$checkreq}
 			." to ".$Rates{$request{$checkreq}}{count}
 			." [type: ".$Rates{$request{$checkreq}}{type}
