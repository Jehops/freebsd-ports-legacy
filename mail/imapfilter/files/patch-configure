--- configure.orig	Thu Mar  9 23:58:22 2006
+++ configure	Fri May 26 21:52:12 2006
@@ -2,7 +2,7 @@
 
 # Default values
 
-destdir="/usr/local"
+destdir="%%PREFIX%%"
 bindir="$destdir/bin"
 sharedir="$destdir/share/imapfilter"
 mandir="$destdir/man"
@@ -10,13 +10,13 @@
 ssltls="yes"
 crammd5="yes"
 
-incdirs="-I/usr/local/include"
-libdirs="-L/usr/local/lib"
+incdirs="-I%%LOCALBASE%%/include"
+libdirs="-L%%LOCALBASE%%/lib"
 
 mycflags="-Wall -O"
 myldflags=""
 
-libs="-lm -llua -llualib"
+libs="-lm -llua"
 libssl="-lssl"
 libcrypto="-lcrypto"
 
@@ -145,16 +145,16 @@
 SHAREDIR = $sharedir
 MANDIR = $mandir
 
+INST_BIN = \$(BSD_INSTALL_PROGRAM)
+INST_DOC = \$(BSD_INSTALL_MAN)
+
 INCDIRS = $incdirs
 LIBDIRS = $libdirs
 
-MYCFLAGS = $mycflags
-MYLDFLAGS = $myldflags
-
 DEFS = $defs
 
-CFLAGS = \$(MYCFLAGS) \$(DEFS) \$(INCDIRS)
-LDFLAGS = \$(MYLDFLAGS) \$(LIBDIRS)
+CFLAGS += \$(DEFS) \$(INCDIRS)
+LDFLAGS += \$(LIBDIRS)
 
 LIBS = $libs
 
@@ -184,19 +184,9 @@
 imapfilter.o: version.h
 
 install: \$(BIN)
-	if test ! -d \$(BINDIR); then mkdir -p \$(BINDIR); fi
-	cp -f \$(BIN) \$(BINDIR) && chmod 0755 \$(BINDIR)/\$(BIN)
-	if test ! -d \$(SHAREDIR); then mkdir -p \$(SHAREDIR); fi
-	cp -f \$(INTERFACE_LUA) \$(SHAREDIR) && \\
-		chmod 0644 \$(SHAREDIR)/\$(INTERFACE_LUA)
-	cp -f \$(AUXILIARY_LUA) \$(SHAREDIR) && \\
-		chmod 0644 \$(SHAREDIR)/\$(AUXILIARY_LUA)
-	if test ! -d \$(MANDIR)/man1; then mkdir -p \$(MANDIR)/man1; fi
-	cp -f \$(MAN_BIN) \$(MANDIR)/man1 && \\
-		chmod 0644 \$(MANDIR)/man1/\$(MAN_BIN)
-	if test ! -d \$(MANDIR)/man5; then mkdir -p \$(MANDIR)/man5; fi
-	cp -f \$(MAN_CONFIG) \$(MANDIR)/man5 && \\
-		chmod 0644 \$(MANDIR)/man5/\$(MAN_CONFIG)
+	\$(INST_BIN) \$(BIN) \$(BINDIR)
+	\$(INST_DOC) \$(MAN_BIN) \$(MANDIR)/man1
+	\$(INST_DOC) \$(MAN_CONFIG) \$(MANDIR)/man5
 
 deinstall:
 	rm -f \$(BINDIR)/\$(BIN) \$(SHAREDIR)/\$(INTERFACE_LUA) \\
