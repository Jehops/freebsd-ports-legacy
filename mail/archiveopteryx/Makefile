# New ports collection makefile for:	archiveopteryx
# Date created:		2010-09-15
# Whom:			Ashish SHUKLA <ashish@FreeBSD.org>
#
# $FreeBSD$
#

PORTNAME=	archiveopteryx
PORTVERSION=	3.1.3
CATEGORIES=	mail
MASTER_SITES=	http://archiveopteryx.org/%SUBDIR%/
MASTER_SITE_SUBDIR=	download

MAINTAINER=	ashish@FreeBSD.org
COMMENT=	An advanced PostgreSQL-based IMAP/POP server

BUILD_DEPENDS=	jam:${PORTSDIR}/devel/jam

USE_BZIP2=	yes
USE_PERL5_BUILD=	5.8+

LICENSE=	BSD
LICENSE_FILE=	${WRKSRC}/bsd.txt

MAKE_JOBS_SAFE=	yes

MAN5=	aoxsuper.conf.5 archiveopteryx.conf.5
MAN8=	aox.8 aoximport.8 archiveopteryx.8 deliver.8 installer.8 logd.8 \
	recorder.8 tlsproxy.8

SUB_FILES=	pkg-message

USE_RC_SUBR=	${PORTNAME}

USERS=		aox
GROUPS=		aox

JAM?=		${LOCALBASE}/bin/jam

post-patch:
	@${GREP} -Rl '%%[[:alpha:]]\+%%' ${WRKSRC} |${XARGS} ${REINPLACE_CMD} \
		-e 's,%%PREFIX%%,${PREFIX},g'

do-build:
	@cd ${WRKSRC} && ${JAM} -j${MAKE_JOBS_NUMBER}

do-install:
	@cd ${WRKSRC} && ${JAM} install

post-install:
	@PKG_PREFIX=${PREFIX} ${SH} ${PKGINSTALL} ${PKGNAME} POST-INSTALL
	@${CAT} ${PKGMESSAGE}

post-deinstall:
	@PKG_PREFIX=${PREFIX} ${SH} ${PKGDEINSTALL} ${PKGNAME} POST-DEINSTALL

.include <bsd.port.mk>
