*** imap/ANSI/c-client/Makefile.orig	Sat Jun 22 01:25:45 1996
--- imap/ANSI/c-client/Makefile	Tue Dec  3 16:30:45 1996
***************
*** 32,43 ****
  
  
  ARCHIVE=c-client.a
  ARRC=ar rc
  BINARIES=mail.o bezerk.o mtx.o tenex2.o mbox.o mh.o mmdf.o imap2.o pop3.o \
  	news.o nntpcunx.o phile.o dummy.o smtp.o nntp.o rfc822.o misc.o \
  	osdep.o sm_unix.o newsrc.o
  CC=cc
! CFLAGS=$(EXTRACFLAGS)
  DEFAULTDRIVERS=imap nntp pop3 mh tenex mtx mmdf bezerk news phile dummy
  LN=ln -s
  MAKE=make
--- 32,45 ----
  
  
  ARCHIVE=c-client.a
+ SHLIB=libc-client.so.1.3
  ARRC=ar rc
  BINARIES=mail.o bezerk.o mtx.o tenex2.o mbox.o mh.o mmdf.o imap2.o pop3.o \
  	news.o nntpcunx.o phile.o dummy.o smtp.o nntp.o rfc822.o misc.o \
  	osdep.o sm_unix.o newsrc.o
+ SOFILES=	${BINARIES:.o=.so}
  CC=cc
! #CFLAGS=$(EXTRACFLAGS)
  DEFAULTDRIVERS=imap nntp pop3 mh tenex mtx mmdf bezerk news phile dummy
  LN=ln -s
  MAKE=make
***************
*** 48,53 ****
--- 50,58 ----
  RSHPATH=/usr/ucb/rsh
  SHELL=/bin/sh
  
+ # Need this for the shared library rule to work correctly
+ .SUFFIXES: .o .so
+ 
  missing:
  	@echo "You must specify what type of system"
  	@false
***************
*** 119,124 ****
--- 124,136 ----
  		ACTIVEFILE=/usr/lib/news/active NEWSSPOOL=/usr/spool/news \
  		RSHPATH=/usr/bin/rsh CFLAGS="-g -O -pipe -DNFSKLUDGE $(EXTRACFLAGS)"
  
+ bsf:	# FreeBSD
+ 	$(MAKE) mtest OS=bsi EXTRADRIVERS="$(EXTRADRIVERS)" \
+ 		STDPROTO=bezerkproto MAILSPOOL=/var/mail \
+ 		ACTIVEFILE=/usr/local/news/lib/active NEWSSPOOL=/var/news \
+               RSHPATH=/usr/bin/rsh CFLAGS="${CFLAGS} -DNFSKLUDGE $(EXTRACFLAGS)" \
+ 		LDFLAGS="-lcrypt"
+ 
  cvx:	# Convex
  	$(MAKE) mtest OS=$@ EXTRADRIVERS="$(EXTRADRIVERS)" \
  		STDPROTO=bezerkproto MAILSPOOL=/usr/spool/mail \
***************
*** 394,402 ****
  # From here on down is OS-independent
  
  clean:
! 	$(RM) *.o linkage.[ch] mtest $(ARCHIVE) osdep.* CCTYPE CFLAGS LDFLAGS
  
! mtest: $(ARCHIVE) mtest.o
  	$(CC) $(CFLAGS) -o mtest mtest.o $(ARCHIVE) $(LDFLAGS)
  
  $(ARCHIVE): $(BINARIES)
--- 406,414 ----
  # From here on down is OS-independent
  
  clean:
! 	$(RM) *.o *.so linkage.[ch] mtest $(SHLIB) $(ARCHIVE) osdep.* CCTYPE CFLAGS LDFLAGS
  
! mtest: $(ARCHIVE) $(SHLIB) mtest.o
  	$(CC) $(CFLAGS) -o mtest mtest.o $(ARCHIVE) $(LDFLAGS)
  
  $(ARCHIVE): $(BINARIES)
***************
*** 404,409 ****
--- 416,428 ----
  	$(ARRC) $(ARCHIVE) $(BINARIES)
  	$(RANLIB) $(ARCHIVE)
  
+ $(SHLIB):	$(SOFILES)
+ 	ld -Bshareable -o $(SHLIB) $(SOFILES)
+ 	strip $(SHLIB)
+ 
+ .c.so:	osdep.h
+ 	$(CC) -fpic -DPIC -c $(CFLAGS) ${@:.so=.c} -o $@
+ 
  # Dependencies
  
  bezerk.o: mail.h bezerk.h rfc822.h misc.h osdep.h
***************
*** 444,449 ****
--- 463,484 ----
  	-DRSH=\"$(RSH)\" -DRSHPATH=\"$(RSHPATH)\" \
  	$(EXTRAOSDEFS) -c os_$(OS).c
  	$(MV) os_$(OS).o osdep.o
+ 
+ osdep.so: mail.h misc.h env.h fs.h ftl.h nl.h tcp.h \
+ 	osdep.h env_unix.h tcp_unix.h \
+ 	os_$(OS).c env_unix.c fs_unix.c ftl_unix.c nl_unix.c tcp_unix.c \
+ 	log_std.c log_sv4.c log_ssn.c log_ult.c \
+ 	gr_wait.c gr_wait4.c gr_waitp.c \
+ 	flock.c ingroups.c opendir.c scandir.c \
+ 	memmove.c memmove2.c memset.c \
+ 	write.c writev.c writevs.c \
+ 	tz_bsd.c tz_nul.c tz_sv4.c \
+ 	strerror.c strpbrk.c strstr.c strtok.c strtol.c strtoul.c
+ 	$(CC) -fpic -DPIC $(CFLAGS) -DSTDPROTO=$(STDPROTO) -DMAILSPOOL=\"$(MAILSPOOL)\" \
+ 	-DACTIVEFILE=\"$(ACTIVEFILE)\" -DNEWSSPOOL=\"$(NEWSSPOOL)\" \
+ 	-DRSH=\"$(RSH)\" -DRSHPATH=\"$(RSHPATH)\" \
+ 	$(EXTRAOSDEFS) -c os_$(OS).c -o os_$(OS).so
+ 	$(MV) os_$(OS).so osdep.so
  
  osdep.h: os_$(OS).h linkage
  	$(RM) CCTYPE CFLAGS LDFLAGS osdep.h
