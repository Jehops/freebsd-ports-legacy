# New ports collection makefile for:	tmda
# Date created:				08 June 2001
# Whom:					Jason R. Mastaler <jason@mastaler.com>
#
# $FreeBSD$
#

PORTNAME=	tmda
PORTVERSION=	0.78
CATEGORIES=	mail python
MASTER_SITES=	http://www.tmda.net/releases/%SUBDIR%/ \
		http://www.us.tmda.net/releases/%SUBDIR%/ \
		http://tmda.mirrors.summersault.com/releases/%SUBDIR%/ \
		http://mirrors.standblue.net/tmda.net/releases/%SUBDIR%/ \
		http://www.au.tmda.net/releases/%SUBDIR%/
MASTER_SITE_SUBDIR=	. old
EXTRACT_SUFX=	.tgz

MAINTAINER=	mwm@mired.org
COMMENT=	Python-based SPAM reduction system

USE_PYTHON=	yes

PKGMESSAGE=	${WRKDIR}/pkg-message

DOCS=		CODENAMES CRYPTO THANKS UPGRADE htdocs/*.html
CONTRIB=	collectaddys def2html printcdb printdbm \
		sendit.sh tmda.el vadduser-tmda

.include <bsd.port.pre.mk>

.if ${PYTHON_REL} < 210
BROKEN=		"TMDA requries Python 2.1 or greater"
.endif

do-build:
	cd ${WRKSRC} && ${PYTHON_CMD} ./compileall

do-install:
	@${MKDIR} ${PYTHONPREFIX_SITELIBDIR}/TMDA/pythonlib/email
	${INSTALL_SCRIPT} ${WRKSRC}/TMDA/*.py* ${PYTHONPREFIX_SITELIBDIR}/TMDA
	${INSTALL_SCRIPT} ${WRKSRC}/TMDA/pythonlib/email/*.py* \
		${PYTHONPREFIX_SITELIBDIR}/TMDA/pythonlib/email
	@${MKDIR} ${DATADIR}
	${INSTALL_DATA} ${WRKSRC}/templates/*.txt ${DATADIR}
	${INSTALL_SCRIPT} ${WRKSRC}/bin/tmda-* ${PREFIX}/bin
	@${MKDIR} ${EXAMPLESDIR}/contrib
	cd ${WRKSRC}/contrib && \
		${INSTALL_DATA} sample.config ${EXAMPLESDIR} && \
		${INSTALL_DATA} ${CONTRIB} ${EXAMPLESDIR}/contrib
.if !defined(NOPORTDOCS)
	@${MKDIR} ${DOCSDIR}
	cd ${WRKSRC} && ${INSTALL_DATA} ${DOCS} ${DOCSDIR}
.endif
	@${SED} -e 's!PREFIX!${PREFIX}!; s!DOCSDIR!${DOCSDIR}!;' \
	       -e 's!EXAMPLESDIR!${EXAMPLESDIR}!' ${.CURDIR}/pkg-message \
	       > ${PKGMESSAGE}
	@${CAT} ${PKGMESSAGE}

.include <bsd.port.post.mk>
