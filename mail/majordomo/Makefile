# New ports collection makefile for:	majordomo
# Date created:		23 October 1996
# Whom:			jfitz@FreeBSD.org
#
# $FreeBSD$
#

PORTNAME=	majordomo
PORTVERSION= 	1.94.5
CATEGORIES=	mail
MASTER_SITES=	ftp://ftp.greatcircle.com/pub/majordomo/1.94.5/ \
		ftp://ftp.sgi.com/other/majordomo/1.94.5/
EXTRACT_SUFX=   .tgz

MAINTAINER=	jfitz@FreeBSD.org

Y2K=		http://www.greatcircle.com/majordomo/majordomo-faq.html#1.8

# Needs to create a user and group
IS_INTERACTIVE= yes
NO_PACKAGE=	"User and group need to be created"
ALL_TARGET=	wrapper
INSTALL_TARGET=	install install-wrapper
MAN1=		approve.1 bounce-remind.1 digest.1
MAN8=		majordomo.8

pre-fetch:
.if !defined(BATCH) && !defined(PACKAGE_BUILDING)
	/usr/bin/dialog --yesno "Majordomo is unsafe to use on multi-user machines: local users can run arbitrary commands as the majordomo user. Do you wish to accept the security risk and build majordomo anyway?" 8 60 || ${FALSE}
.endif

pre-configure:
		@ ${SETENV} ${MAKE_ENV} /usr/bin/perl ${SCRIPTDIR}/createuser
		@ ${CP} ${FILESDIR}/aliases.majordomo ${WRKSRC}

pre-install:
		@ ${CP} ${WRKSRC}/sample.cf ${WRKSRC}/majordomo.cf

post-install:
.for file in ${MAN1}
	@ ${INSTALL_MAN} ${WRKSRC}/Doc/man/${file} ${PREFIX}/man/man1
.endfor
.for file in ${MAN8}
	@ ${INSTALL_MAN} ${WRKSRC}/Doc/man/${file} ${PREFIX}/man/man8
.endfor

		@ ${LN} -sf archive2.pl ${PREFIX}/majordomo/archive
		@ for dir in tmp lists/test-l.archive lists/test-l-digest.archive digests/test-l-digest doc; do \
			${MKDIR} ${PREFIX}/majordomo/$$dir; \
		done
		@ ${CHOWN} majordom.majordom ${PREFIX}/majordomo/tmp
		@ ${CHMOD} 700 ${PREFIX}/majordomo/tmp
		@ ${CHMOD} 755 ${PREFIX}/majordomo
		@ for dir in digests lists lists/test-l.archive lists/test-l-digest.archive digests/test-l-digest doc; do \
			${CHOWN} majordom.majordom ${PREFIX}/majordomo/$$dir; \
			${CHMOD} 775 ${PREFIX}/majordomo/$$dir; \
		done
.if !defined(NOPORTDOCS)
		@ for file in Changelog FUTURE INSTALL LICENSE NEWLIST README; do \
			${INSTALL_DATA} ${WRKSRC}/$$file ${PREFIX}/majordomo/doc; \
		done
		@ for file in FAQ README.sequencer list-owner-info majordomo-faq.html majordomo.lisa6.ps majordomo.ora; do \
			${INSTALL_DATA} ${WRKSRC}/Doc/$$file ${PREFIX}/majordomo/doc; \
		done
		@ ${INSTALL_DATA} ${FILESDIR}/post-install-notes ${PREFIX}/majordomo/doc
.endif
		@ ${INSTALL_DATA} ${WRKSRC}/aliases.majordomo ${PREFIX}/majordomo
		@ for file in test-l test-l-digest test-l.passwd test-l.info; do \
			${INSTALL_DATA} ${FILESDIR}/$$file ${PREFIX}/majordomo/lists; \
		done
		@ ${LN} -sf test-l.info ${PREFIX}/majordomo/lists/test-l-digest.info
		@ ${LN} -sf test-l.passwd ${PREFIX}/majordomo/lists/test-l-digest.passwd
		@ ${CHMOD} 660 ${PREFIX}/majordomo/lists/test-l.passwd
		@ ${CHOWN} -R majordom.majordom ${PREFIX}/majordomo/lists
		@ ${CHMOD} -R 664 ${PREFIX}/majordomo/lists
		@ ${CHMOD} 755 ${PREFIX}/majordomo/lists
		@ ${CHMOD} 755 ${PREFIX}/majordomo/lists/test-l.archive
		@ ${CHMOD} 755 ${PREFIX}/majordomo/lists/test-l-digest.archive
		@ ${CHMOD} 660 ${PREFIX}/majordomo/lists/*.passwd
.if !defined(BATCH)
		@ /usr/bin/more -e ${FILESDIR}/post-install-notes
.endif

.include <bsd.port.mk>
