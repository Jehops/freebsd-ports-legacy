--- configure.orig	Fri Oct 17 01:12:22 2003
+++ configure	Sat Nov  1 14:01:27 2003
@@ -20,6 +20,10 @@
 ac_help="$ac_help
   --enable-qmail-newmrh=path Full path to qmail-newmrh program"
 ac_help="$ac_help
+  --enable-spamassassin=path Enable SpamAssassin. Full path to spamc program. default /usr/local/bin/spamc"
+ac_help="$ac_help
+  --enable-spam-threshold=# or n Automatically delete messages that score more than # spam hits"
+ac_help="$ac_help
   --enable-vpopuser=vpopmail   user vchkpw was installed as."
 ac_help="$ac_help
   --enable-vpopgroup=vchkpw   group vchkpw was installed as."
@@ -1317,7 +1321,7 @@
   ;;
 esac
 
-if test `$idcommand` != "0"
+if false && test `$idcommand` != "0"
 then
     echo "configure: warning: === vpopmail must be configured as root. ===" 1>&2
     echo "configure: warning: === please switch to the root user and  ===" 1>&2
@@ -1446,6 +1450,49 @@
 EOF
 
 
+# Check whether --enable-spamassassin or --disable-spamassassin was given.
+if test "${enable_spamassassin+set}" = set; then
+  enableval="$enable_spamassassin"
+  spamc="$enableval"
+
+  case $spamc in
+  1*|y*|Y*)
+      spamc="/usr/local/bin/spamc"
+      ;;
+  esac
+
+  if test ! -f "$spamc"
+  then
+      { echo "configure: error: Unable to find your spamc file, specify --enable-spamassassin=/full/path/to/spamc" 1>&2; exit 1; }
+  fi
+
+  cat >> confdefs.h <<EOF
+#define SPAMC "$spamc"
+EOF
+
+# Check whether --enable-spam-threshold or --disable-spam-threshold was given.
+if test "${enable_spam_threshold+set}" = set; then
+  enableval="$enable_spam_threshold"
+  ENABLE_SPAM_THRESHOLD=$enableval
+else
+
+                        ENABLE_SPAM_THRESHOLD=0
+
+fi
+
+
+case $ENABLE_SPAM_THRESHOLD in
+0*|n*|N*)
+      ;;
+*)
+          cat >> confdefs.h <<EOF
+#define SPAM_THRESHOLD $ENABLE_SPAM_THRESHOLD
+EOF
+
+          ;;
+esac
+fi
+
 
 vpopuser="vpopmail"
 # Check whether --enable-vpopuser or --disable-vpopuser was given.
@@ -1601,15 +1648,6 @@
 EOF
 
 
-if test ! -d $vpopmaildir/etc
-then 
-	mkdir $vpopmaildir/etc
-	chown $vpopmailuid "$vpopmaildir"/etc 
-	chgrp $vpopmailgid "$vpopmaildir"/etc 
-        chmod 755 "$vpopmaildir"/etc
-        echo "configure: warning: making a vpopmail etc directory " 1>&2
-fi
-
 # Check whether --enable-roaming-users or --disable-roaming-users was given.
 if test "${enable_roaming_users+set}" = set; then
   enableval="$enable_roaming_users"
@@ -1671,17 +1709,7 @@
 if test "${enable_tcpserver_file+set}" = set; then
   enableval="$enable_tcpserver_file"
   tcpserver_file="$enableval"
-else
-  
-        if test "$tcpserver_file" = ""
-        then
-	    echo "127.:allow,RELAYCLIENT=\"\"" > "$vpopmaildir"/etc/tcp.smtp
-    	    tcpserver_file="$vpopmaildir"/etc/tcp.smtp
-	
-            echo "configure: warning: Unable to find your tcpserver relay file." 1>&2
-            echo "configure: warning: Creating tcp.smtp in "$vpopmaildir"/etc/tcp.smtp." 1>&2
-        fi
-     
+  echo "127.:allow,RELAYCLIENT=\"\"" > ${VCFGDIR}/tcp.smtp
 fi
 
 cat >> confdefs.h <<EOF
