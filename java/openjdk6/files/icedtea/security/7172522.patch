# HG changeset patch
# User coffeys
# Date 1340096399 -3600
# Node ID 88243aa6e67b6b84ff529ccdfd3b476410f60057
# Parent  39b599e90c7b33435ca42ae96ed673812a8be3d7
7172522: Improve DomainCombiner checking
Reviewed-by: mullan

diff --git a/src/share/classes/java/security/AccessController.java b/src/share/classes/java/security/AccessController.java
--- jdk/src/share/classes/java/security/AccessController.java
+++ jdk/src/share/classes/java/security/AccessController.java
@@ -1,5 +1,5 @@
 /*
- * Copyright (c) 1997, 2007, Oracle and/or its affiliates. All rights reserved.
+ * Copyright (c) 1997, 2012, Oracle and/or its affiliates. All rights reserved.
  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  *
  * This code is free software; you can redistribute it and/or modify it
@@ -293,7 +293,7 @@
         DomainCombiner dc = null;
         AccessControlContext acc = getStackAccessControlContext();
         if (acc == null || (dc = acc.getAssignedCombiner()) == null) {
-            return AccessController.doPrivileged(action);
+            return AccessController.doPrivileged(action, acc);
         }
         return AccessController.doPrivileged(action, preserveCombiner(dc));
     }
@@ -389,7 +389,7 @@
         DomainCombiner dc = null;
         AccessControlContext acc = getStackAccessControlContext();
         if (acc == null || (dc = acc.getAssignedCombiner()) == null) {
-            return AccessController.doPrivileged(action);
+            return AccessController.doPrivileged(action, acc);
         }
         return AccessController.doPrivileged(action, preserveCombiner(dc));
     }
