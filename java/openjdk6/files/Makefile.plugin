# $FreeBSD$
#
# Makefile for IcedTea Mozilla plugin
#

LIB=
SHLIB_NAME=	IcedTeaPlugin.so
NO_MAN=		yes
NO_PROFILE=	yes

SRCS=		IcedTeaJavaRequestProcessor.cc \
		IcedTeaNPPlugin.cc \
		IcedTeaPluginRequestProcessor.cc \
		IcedTeaPluginUtils.cc \
		IcedTeaScriptablePluginObject.cc
SRCS+=		IcedTeaJavaRequestProcessor.h \
		IcedTeaNPPlugin.h \
		IcedTeaPluginRequestProcessor.h \
		IcedTeaPluginUtils.h \
		IcedTeaScriptablePluginObject.h

.if empty(DEBUG_FLAGS)
.undef DEBUG_FLAGS
STRIP=		-s
.endif
.if !defined(LOCALBASE)
.error "LOCALBASE not defined"
.endif
.if !defined(JDK_UPDATE_VERSION)
.error "JDK_UPDATE_VERSION not defined"
.endif
.if !defined(PLUGIN_VERSION)
.error "PLUGIN_VERSION not defined"
.endif

PLUGIN_NAME=IcedTea-Web Plugin
PACKAGE_URL=http://icedtea.classpath.org/wiki/IcedTea-Web

MOZILLA_VERSION!=${LOCALBASE}/bin/pkg-config --modversion mozilla-plugin
MOZILLA_VERSION2!=/usr/bin/printf "%d%02d%02d%02d" ${MOZILLA_VERSION:C/\./ /g}

PLUGIN_PKG_INC=	glib-2.0 gtk+-2.0 mozilla-plugin
PLUGIN_PKG_LIB=	glib-2.0 gtk+-2.0
PLUGIN_CFLAGS!=	${LOCALBASE}/bin/pkg-config --cflags ${PLUGIN_PKG_INC}
PLUGIN_LIBS!=	${LOCALBASE}/bin/pkg-config --libs ${PLUGIN_PKG_LIB}

CFLAGS+=	-DJDK_UPDATE_VERSION="\"${JDK_UPDATE_VERSION}\"" \
		-DPLUGIN_NAME="\"${PLUGIN_NAME}\"" \
		-DPLUGIN_VERSION="\"${PLUGIN_VERSION}\"" \
		-DPACKAGE_URL="\"${PACKAGE_URL}\"" \
		-DMOZILLA_VERSION_COLLAPSED="${MOZILLA_VERSION2}"
.if ${MOZILLA_VERSION2} >= 1090200
CFLAGS+=	${PLUGIN_CFLAGS:S,/libxul/stable,/libxul,}
.else
CFLAGS+=	${PLUGIN_CFLAGS:S,/libxul/stable,/libxul/unstable,}
.endif
LDFLAGS+=	${PLUGIN_LIBS}

.include <bsd.lib.mk>
