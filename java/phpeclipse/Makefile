# New ports collection makefile for:	phpeclipse
# Date created:				22 Oct 2003
# Whom:					rtdean@cytherianage.net
#
# $FreeBSD$
#

PORTNAME=	phpeclipse
PORTVERSION=	1.2.1
CATEGORIES=	java editors devel
MASTER_SITES=	SF
DISTNAME=	PHPEclipse_${PORTVERSION}_src

MAINTAINER=	kamikaze@bsdforen.de
COMMENT=	PHP Eclipse adds PHP support to the Eclipse IDE Framework

BUILD_DEPENDS+=	unzip:${PORTSDIR}/archivers/unzip
RUN_DEPENDS=	eclipse:${PORTSDIR}/java/eclipse

PLUGIN_PATHS=	features plugins
PATCH_TASKS=	eclipse.versionReplacer eclipse.idReplacer

USE_JAVA=	yes
USE_ANT=	yes
USE_ZIP=	yes

WRKSRC=		${WRKDIR}/dist
ECLIPSE=	${PREFIX}/eclipse
PLIST_VER=	${PORTVERSION}.200810130444PRD

PLIST_SUB=	VER=${PLIST_VER}

post-patch:
.for _task in ${PATCH_TASKS}
	@${FIND} ${WRKDIR} -name build.xml -exec ${REINPLACE_CMD} -E \
		-e 's|<(${_task})(.*)/>|<!--\1\2/-->|1' \{} \;
.endfor

do-build:
	@cd ${WRKDIR}/features; \
	for feature in `ls`; do \
		cd "$$feature"; \
		${ANT} zip.distribution; \
		cd ..; \
	done
	@${MKDIR} ${WRKSRC}
	@for file in ${WRKDIR}/features/*/*.zip; do \
		${UNZIP_CMD} "$$file" -d "${WRKSRC}/" ; \
	done

do-install:
.for _path in ${PLUGIN_PATHS}
	@${MKDIR} ${ECLIPSE}/${_path}
	@${CP} -r ${WRKSRC}/${_path}/* ${ECLIPSE}/${_path}/
.endfor

plist: build
	@${ECHO} "===>  Rebuilding PLIST."
	@${TOUCH} ${PLIST}
	@${RM} ${PLIST}
.for _path in ${PLUGIN_PATHS}
	@${FIND} ${WRKSRC}/${_path}/ -not -type d \
		| ${SED} "s|${WRKSRC}|eclipse|1" \
		| ${SED} "s|${PLIST_VER}|%%VER%%|g" \
		>> ${PLIST}
	@${FIND} -d ${WRKSRC}/${_path}/ -mindepth 1 -type d \
		| ${SED} "s|${WRKSRC}|@dirrm eclipse|1" \
		| ${SED} "s|${PLIST_VER}|%%VER%%|g" \
		>> ${PLIST}
	@${ECHO} "@dirrmtry eclipse/${_path}" >> ${PLIST}
.endfor
	@${ECHO} "@dirrmtry eclipse" >> ${PLIST}

post-install:
	@${CAT} ${PKGMESSAGE}

.include <bsd.port.mk>
