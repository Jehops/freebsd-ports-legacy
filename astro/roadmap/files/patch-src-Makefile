--- src/Makefile.orig	Tue May 25 08:36:00 2004
+++ src/Makefile	Mon Jun  7 00:36:22 2004
@@ -10,7 +10,7 @@
    MODECFLAGS=-g -Wall -pg -fprofile-arcs -g
    MODELDFLAGS=-pg
 else
-   MODECFLAGS=-O2 -ffast-math -fomit-frame-pointer -Wall $(OPTIONS)
+   MODECFLAGS=-ffast-math -fomit-frame-pointer -Wall $(OPTIONS) -I${LOCALBASE}/include
    MODELDFLAGS=
 endif
 endif
@@ -20,17 +20,17 @@
 	SQLLDFLAGS=
 	SQLTOOLS=
 else
-   SQLCFLAGS=-DROADMAP_USES_SQLITE
-	SQLLDFLAGS=-lsqlite
+   SQLCFLAGS=-DROADMAP_USES_SQLITE -I${LOCALBASE}/include
+	SQLLDFLAGS=-lsqlite -L${LOCALBASE}/lib
 	SQLTOOLS=sqliteload
 endif
 
-CFLAGS=$(MODECFLAGS) $(SQLCFLAGS)
+CFLAGS+=$(MODECFLAGS) $(SQLCFLAGS)
 LDFLAGS=$(MODELDFLAGS) $(SQLLDFLAGS)
 TOOLS=sunrise $(SQLTOOLS)
 
 RDMLIBS=libroadmap.a unix/libosroadmap.a
-LIBS=$(RDMLIBS) -lpopt -lm
+LIBS=$(RDMLIBS) -lpopt -lm -L${LOCALBASE}/lib
 
 
 
@@ -133,7 +133,7 @@
 SCRIPTS=rdmdownload rdmgetall rdmgenmaps rdmcompare
 RUNTIME=$(RDMLIBS) libguiroadgps.a libguiroadmap.a
 
-INSTALLDIR=/usr/local
+INSTALLDIR=${PREFIX}
 
 
 # --- Conventional targets ----------------------------------------
@@ -149,10 +149,10 @@
 	strip -s $(BUILD)
 
 clean: cleanone
-	make -C qt cleanone
-	make -C gtk cleanone
-	make -C gtk2 cleanone
-	make -C unix cleanone
+#	${MAKE} -C qt cleanone
+	${MAKE} -C gtk cleanone
+#	${MAKE} -C gtk2 cleanone
+	${MAKE} -C unix cleanone
 
 cleanone:
 	rm -f *.o *.a *.da $(BUILD)
@@ -168,7 +168,7 @@
 	cd $(INSTALLDIR)/bin ; chmod a+x $(BUILD) $(SCRIPTS)
 	if [ -d /usr/lib/menu ] ; then cp roadmap.menu /usr/lib/menu/roadmap; fi
 	mkdir -p $(INSTALLDIR)/share/pixmaps
-	cd icons ; make ICONDIR="$(INSTALLDIR)/share/pixmaps" install
+	cd icons ; ${MAKE} ICONDIR="$(INSTALLDIR)/share/pixmaps" install
 	cp -f roadmap*.png $(INSTALLDIR)/share/pixmaps
 	cp -f roadmap.desktop $(INSTALLDIR)/applications
 
@@ -178,9 +178,7 @@
 	rm -f /usr/lib/menu/roadmap
 
 everything: runtime build icons $(TOOLS)
-	cd gtk ; make STDCFLAGS="$(CFLAGS)" all
-	cd gtk2 ; make STDCFLAGS="$(CFLAGS)" all
-	cd qt ; make STDCFLAGS="$(CFLAGS)" all
+	cd gtk ; ${MAKE} STDCFLAGS="$(CFLAGS)" all
 
 cleanall:
 	cd gtk ; make clean
@@ -207,7 +205,7 @@
 	$(AR) rf libguiroadgps.a $(RGGUIOBJS)
 
 unix/libosroadmap.a:
-	cd unix; make "CFLAGS=$(CFLAGS) -I.."
+	cd unix; ${MAKE} "CFLAGS=$(CFLAGS) -I.."
 
 dumpmap: $(DMOBJS) $(RDMLIBS)
 	$(CC) $(LDFLAGS) $(DMOBJS) -o dumpmap $(LIBS)
