--- Makefile.orig	Thu Aug  9 07:14:42 2001
+++ Makefile	Mon Apr 11 21:07:03 2005
@@ -1,36 +1,39 @@
-# GPR400 IFD Handler Makefile
-# 
-# Author: Joe Phillips <joe.phillips@innovationsw.com>
-# Based on the IFD Devkit Makefile by David Corcoran and MUSCLE
 #
-# $Id: Makefile,v 1.2 2001/08/09 05:14:42 jaiger Exp $
+# BSD makefile for ifd-gpr400
 #
 
-CC       = cc
-CFLAGS   = -g -fpic -w
-LD       = ld
-LEX      = flex
-OBJ     := $(filter-out test.o, $(patsubst %.c,%.o,$(wildcard *.c)))
-INCLUDE  = -I.
+DESTDIR?=	${PREFIX}
 
-MAKEXE   = make
-LIBNAME  = libgpr400_ifd.so
-PREFIX   = /usr/local/pcsc
+# XXX
+LIBDIR=		/lib
+#LIBDIR=		/pcsc
+INCSDIR=	/include
 
-DEFS     = -DPCSC_DEBUG=1 #-DATR_DEBUG=1
+SHLIB_NAME=	libgpr400_ifd.so
+SHLIB_MAJOR=	0
+SHLIB_MINOR=	3
 
-all: unix
+NOMAN=		1
+NOPROFILE=	1
 
-clean:
-	rm -f *.o $(LIBNAME) core
+.if !defined(NO_DEBUG)
+CFLAGS+=	-g -Wall
+.endif
 
-osx: $(OBJ)
-	$(CC) -dynamiclib $(OBJ) -o $(LIBNAME)
+GPRDEVNAME?=	/dev/gprsc0
 
-unix: $(OBJ)
-	$(LD) -shared $(OBJ) -o $(LIBNAME)
+CFLAGS+=	-I. -I${DESTDIR}${INCSDIR}/PCSC -I${DESTDIR}${INCSDIR} -DGPRDEVNAME=\"${GPRDEVNAME}\"
+LDFLAGS+=	-L${DESTDIR}/lib
+LDADD+=		-lpcsclite
 
-$(patsubst %.c,%.o,$(wildcard *.c)) : %.o : %.c
-	$(CC) $(CFLAGS) -c $< $(INCLUDE) $(DEFS)
+.if !defined(NO_PCSC_DEBUG)
+CFLAGS+=	-DPCSC_DEBUG=1
+.if defined(PCSC_ATR_DEBUG)
+CFLAGS+=	-DATR_DEBUG=1
+.endif
+.endif
 
-##
+SRCS=	gpr400_ifd.c
+INCS=	gpr400.h
+
+.include <bsd.lib.mk>
