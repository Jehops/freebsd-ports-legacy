#!/bin/sh

# PROVIDE: sguild
# REQUIRE: DAEMON
# KEYWORD: FreeBSD shutdown

# Add the following lines to /etc/rc.conf to enable sguild:
# sguild_enable (bool):		Set to YES to enable sguild
# 				Default: NO
# sguild_flags (str):		Extra flags passed to sguild
#				Default: -D
# sguild_conf (str):		Sguild configuration file
#				Default: %%PREFIX%%/etc/%%SGUILDIR%%/sguild.conf

. %%RC_SUBR%%

name="sguild"
rcvar=`set_rcvar`

command="%%PREFIX%%/bin/${name}"
procname="%%TCLSH%%"
check_process="${command} /bin/sh"
stop_cmd="sguild_stop"

sguild_enable=${sguild_enable-NO}
sguild_conf=${sguild_conf-%%PREFIX%%/etc/%%SGUILDIR%%/sguild.conf}
sguild_flags=${sguild_flags--D}
[ -n "$sguild_conf" ] && sguild_flags="$sguild_flags -c $sguild_conf"

sguild_stop() {
  if [ -z "${rc_pid}" ]; then
    echo "${name} not running?"
  else
    echo "Stopping ${name}."
    `/bin/kill -9 ${rc_pid}`
    wait_for_pids "${rc_pid}"
    if [ -f "/var/run/${name}.pid" ]; then
      `rm -f /var/run/${name}.pid`
    fi    
  fi
}

load_rc_config ${name}
run_rc_command "$1"
