#!/bin/sh
ex=0
USER=drweb
GROUP=${USER}
UID=426
GID=${UID}

if ! pw group show "${GROUP}" 2>/dev/null 1>&2; then
	if pw groupadd ${GROUP} -g ${GID}; then
		echo "Added group \"${GROUP}\"."
	else
		echo "Adding group \"${GROUP}\" failed..."
		ex=1
	fi
fi

if ! pw user show "${USER}" 2>/dev/null 1>&2; then
	if pw useradd ${USER} -u ${UID} -g ${GROUP} -h - \
		-s "/sbin/nologin" -d "/nonexistent" -c "Dr. Web Scanner"
	then
		echo "Added user \"${USER}\"."
	else
		echo "Adding user \"${USER}\" failed..."
		ex=1
	fi
fi

if ! grep -q "^!drweb" /etc/syslog.conf; then
  echo "You may also add this lines to your /etc/syslog.conf:"
  echo "*.*             /var/log/drwebd.log"
  echo ""
fi
if ! grep -q drweb /etc/crontab; then
  if ! crontab -l -u root | grep -q drweb; then
      echo "You may also add this crontab entry to /etc/crontab"
      echo "0 12 * * * ${BINOWN} ${PREFIX}/drweb/update/update.pl ${PREFIX}/drweb"
      echo ""
  fi
fi
[ "$ex" = "1" ] && exit 1
install -dv -m 0755 -o drweb -g ${BINGRP} ${PREFIX}/drweb/run
install -dv -m 0700 -o drweb -g ${BINGRP} ${PREFIX}/drweb/infected.!!!
exit 0
