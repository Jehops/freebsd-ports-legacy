--- contrib/tor.sh.in.orig	Mon Dec 26 04:28:12 2005
+++ contrib/tor.sh.in	Thu Jan 12 06:25:02 2006
@@ -9,26 +9,26 @@
 # This particular script is written for Red Hat/Fedora Linux, and may
 # also work on Mandrake, but not SuSE.
 #
-# These next couple of lines "declare" tor for the "chkconfig" program,
-# originally from SGI, used on Red Hat/Fedora and probably elsewhere.
-#
-# chkconfig: 2345 90 10
 # description: Onion Router - A low-latency anonymous proxy
 #
+#
+# Add some of the following variables to /etc/rc.conf to configure stunnel:
+# tor_enable (bool):        Default "NO"
+#                               Set it to "YES" to enable stunnel.
+# tor_user (str):         Default "_tor"
+#                               Set it to the tor user
+# tor_group (str):        Default "_tor"
+#                               Set it to the tor group
+#
 
-# Library functions
-if [ -f /etc/rc.d/init.d/functions ]; then
-   . /etc/rc.d/init.d/functions
-elif [ -f /etc/init.d/functions ]; then
-   . /etc/init.d/functions
-fi
+tor_enable=${tor_enable-"NO"}
 
-TORCTL=@BINDIR@/torctl
+TORCTL=%%PREFIX%%/bin/torctl
 
 # torctl will use these environment variables
-TORUSER=@TORUSER@
+TORUSER=${tor_user-"_tor"}
 export TORUSER
-TORGROUP=@TORGROUP@
+TORGROUP=${tor_group-"_tor"}
 export TORGROUP
 
 if [ -x /bin/su ] ; then
@@ -46,28 +46,32 @@
 case "$1" in
 
     start)
-    action $"Starting tor:" $TORCTL start
-    RETVAL=$?
+      echo "Starting tor:"
+        $TORCTL start
+      RETVAL=$?
     ;;
 
     stop)
-    action $"Stopping tor:" $TORCTL stop
-    RETVAL=$?
+      echo "Stopping tor:" 
+        $TORCTL stop
+      RETVAL=$?
     ;;
 
     restart)
-    action $"Restarting tor:" $TORCTL restart
-    RETVAL=$?
+      echo "Restarting tor:"
+        $TORCTL restart
+      RETVAL=$?
     ;;
 
     reload)
-    action $"Reloading tor:" $TORCTL reload
-    RETVAL=$?
+      echo "Reloading tor:"
+        $TORCTL reload
+      RETVAL=$?
     ;;
 
     status)
-    $TORCTL status
-    RETVAL=$?
+      $TORCTL status
+      RETVAL=$?
     ;;
 
     *)
