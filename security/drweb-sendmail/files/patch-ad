--- Makefile.nix.orig	Mon May  6 14:58:38 2002
+++ Makefile.nix	Fri May 10 12:00:39 2002
@@ -25,7 +25,6 @@
 CC_AIX          = cc_r
 CC_Solaris_GNU  = gcc
 CC_Solaris_SUN  = cc
-CC              = $(CC_$(OS)$(ENV))
 
 # OS-specific compilation flags
 ADDF_AIX        = -qmaxmem=16384 -DNO_VSYSLOG -DNO_SNPRINTF -I./addons/aix/include
@@ -37,7 +36,7 @@
 # Common flags
 OPTFLAGS        = ___OPT_FLAGS___
 DEFFLAGS        = -D__UNIX_DW -D$(OS)_DW 
-INCFLAGS        = -I./include -I./src -I./addons/md5
+INCFLAGS        = -I./src
 ADD_CFLAGS      = $(OPTFLAGS) $(DEFFLAGS) $(INCFLAGS) $(ADDFLAGS)
 
 # Multihtreaded libraries
@@ -70,14 +69,13 @@
 # Filter build options
 
 DCOPT  = -D__SIGNAL_BASED_DW
-SMOPT  = -DDW_SENDMAIL -D__THREAD_BASED_DW
+SMOPT  = -DDW_SENDMAIL -D__THREAD_BASED_DW -D_THREAD_SAFE
 ZMOPT  = -DDW_ZMAILER -D__SIGNAL_BASED_DW
 QMOPT  = -DDW_QMAIL -D__SIGNAL_BASED_DW
 EXIMOPT= -DDW_PIPE -DDW_EXIM -D__SIGNAL_BASED_DW
 PSTFOPT= -DDW_PIPE -DDW_POSTFIX -D__SIGNAL_BASED_DW
 
 SMOBJS = \
-	dwsm_md5.o\
 	dwsm_opt.o\
 	dwsm_user.o\
 	dwsm_file.o\
@@ -174,7 +172,7 @@
 
 # Sendmail Filter Rules
 drweb-smf : $(SMOBJS) $(DWLIB_R)
-	$(CC) $(SMOBJS) -o $@ $(LINKLIBMT) $(LIBMILTER)
+	$(CC) $(SMOBJS) -o $@ -lmd $(LINKLIBMT) $(LIBMILTER)
 
 drweb_smf.o: drweb_smf.c 
 	$(CC) -c $(ADD_CFLAGS) $(SMOPT) ___SOURCE___ -o $@ $(CCOUTPUT)
