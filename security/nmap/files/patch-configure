--- configure.orig	Sat Sep 20 09:06:56 2003
+++ configure	Wed Sep 24 23:09:21 2003
@@ -1302,7 +1302,7 @@
      fi
    if test -d /usr/local/include; then
      CFLAGS="$CFLAGS -I/usr/local/include"
-     CXXFLAGS="$CFLAGS -I/usr/local/include"
+     CXXFLAGS="$CXXFLAGS -I/usr/local/include"
    fi
 fi
 
@@ -3299,7 +3299,7 @@
 
 
 
-for ac_header in string.h getopt.h strings.h memory.h sys/param.h sys/sockio.h bstring.h sys/time.h pwd.h unistd.h
+for ac_header in string.h strings.h memory.h sys/param.h sys/sockio.h bstring.h sys/time.h pwd.h unistd.h
 do
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
@@ -4319,7 +4319,7 @@
     ;;
   *)
     specialssldir="$with_openssl"
-    CXXFLAGS="$CXXFLAGS -I$with_openssl/include"
+    CPPFLAGS="$CPPFLAGS -I$with_openssl/include"
     LDFLAGS="$LDFLAGS -L$with_openssl/lib"
     ;;
   esac
@@ -5105,10 +5105,10 @@
 
     ;;
   *)
-    _cppflags=$CXXFLAGS
+    _cppflags=$CPPFLAGS
     _ldflags=$LDFLAGS
 
-    CXXFLAGS="-I$with_libpcap/include $CXXFLAGS"
+    CPPFLAGS="-I$with_libpcap/include $CPPFLAGS"
     LDFLAGS="-L$with_libpcap/lib $LDFLAGS"
 
     if test "${ac_cv_header_pcap_h+set}" = set; then
@@ -5307,7 +5307,7 @@
 
 
     LDFLAGS=$_ldflags
-    CXXFLAGS=$_cppflags
+    CPPFLAGS=$_cppflags
     ;;
   esac
 
@@ -5323,10 +5323,10 @@
 
 if test $have_libpcap = yes; then
   if test "${LIBPCAP_INC+set}" = "set"; then
-    _cflags=$CXXFLAGS
+    _cppflags=$CPPFLAGS
     _ldflags=$LDFLAGS
 
-    CXXFLAGS="-I$LIBPCAP_INC $CXXFLAGS"
+    CPPFLAGS="-I$LIBPCAP_INC $CPPFLAGS"
     LDFLAGS="-L$LIBPCAP_LIB $LDFLAGS"
   fi
 
@@ -5336,6 +5336,8 @@
   echo "$as_me:$LINENO: result: no" >&5
 echo "${ECHO_T}no" >&6; have_libpcap=no
 else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lpcap  $LIBS"
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 /* confdefs.h.  */
@@ -5391,6 +5393,7 @@
 echo "${ECHO_T}no" >&6; have_libpcap=no
 fi
 rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
 fi
 fi
 
@@ -5406,10 +5409,10 @@
 else
   if test "${LIBPCAP_INC+set}" = "set"; then
     LDFLAGS="-L$libpcapdir $_ldflags"
-    CXXFLAGS="$_cflags -I$libpcapdir"
+    CPPFLAGS="$_cppflags -I$libpcapdir"
   else
     LDFLAGS="-L$libpcapdir $LDFLAGS"
-    CXXFLAGS="$CXXFLAGS -I$libpcapdir"
+    CPPFLAGS="$CPPFLAGS -I$libpcapdir"
   fi
   PCAP_DEPENDS='$(LIBPCAPDIR)/libpcap.a'
   PCAP_CLEAN="pcap_clean"
@@ -5433,7 +5436,7 @@
   yes)
     ;;
   *)
-    CXXFLAGS="-I$with_libpcre/include $CXXFLAGS"
+    CPPFLAGS="-I$with_libpcre/include $CPPFLAGS"
     LDFLAGS="-L$with_libpcre/lib $LDFLAGS"
     have_pcre=yes
     ;;
@@ -5844,7 +5847,7 @@
 
 subdirs="$subdirs libpcre "
 
-  CXXFLAGS="-I$LIBPCREDIR $CXXFLAGS"
+  CPPFLAGS="-I$LIBPCREDIR $CPPFLAGS"
   LIBPCRE_LIB="$LIBPCREDIR"
   LIBS="$LIBS $LIBPCRE_LIB/libpcre.a"
   PCRE_DEPENDS="$LIBPCRE_LIB/libpcre.a"
