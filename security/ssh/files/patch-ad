*** sshconnect.c.orig	Wed Oct 16 10:10:26 1996
--- sshconnect.c	Wed Oct 16 10:23:49 1996
***************
*** 797,802 ****
--- 797,803 ----
    char buf[256], remote_version[256]; /* must be same size! */
    int remote_major, remote_minor, i;
    int my_major, my_minor;
+   int len;
    int connection_in = packet_get_connection_in();
    int connection_out = packet_get_connection_out();
  
***************
*** 803,809 ****
    /* Read other side\'s version identification. */
    for (i = 0; i < sizeof(buf) - 1; i++)
      {
!       if (read(connection_in, &buf[i], 1) != 1)
  	fatal("read: %.100s", strerror(errno));
        if (buf[i] == '\r')
  	{
--- 804,813 ----
    /* Read other side\'s version identification. */
    for (i = 0; i < sizeof(buf) - 1; i++)
      {
!       len = read(connection_in, &buf[i], 1);
!       if (len == 0)
! 	fatal("Connection closed by foreign host.");
!       else if (len < 0)
  	fatal("read: %.100s", strerror(errno));
        if (buf[i] == '\r')
  	{