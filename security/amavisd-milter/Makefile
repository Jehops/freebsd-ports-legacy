# New ports collection makefile for:	amavisd-milter
# Date created:		2005-06-08
# Whom:			Petr Rehor <prehor@gmail.com>
#
# $FreeBSD$
#

PORTNAME=	amavisd-milter
PORTVERSION=	1.2.0
CATEGORIES=	security mail
MASTER_SITES=	${MASTER_SITE_SOURCEFORGE}
MASTER_SITE_SUBDIR=	${PORTNAME}

MAINTAINER=	prehor@gmail.com
COMMENT=	Milter for amavisd-new

RUN_DEPENDS=	amavisd:${PORTSDIR}/security/amavisd-new

##
# Use the following quirks to choose which sendmail to use (ports or system):
#
#   WITH_SENDMAIL_BASE=yes
# or
#   WITH_SENDMAIL_PORT=yes
#
# If unspecified, check for an up-to-date system version but give an
# installed port preference over it.
##

# Shared defaults with security/amavisd-new
AMAVISUSER?=	vscan
AMAVISDIR?=	/var/amavis

GNU_CONFIGURE=	yes
USE_RC_SUBR=	${PORTNAME}.sh

SUB_FILES=	pkg-message
SUB_LIST=	AMAVISUSER=${AMAVISUSER} \
		AMAVISDIR=${AMAVISDIR}

PORTDOCS=	AUTHORS CHANGES INSTALL LICENSE README TODO

PLIST_SUB=	RC_DIR=${RC_DIR} \
		RC_SUFX=${RC_SUFX}

MAN8=		amavisd-milter.8

.include <bsd.port.pre.mk>

.if !defined(WITH_SENDMAIL_BASE) && \
    !defined(WITH_SENDMAIL_PORT) && \
    !exists(${LOCALBASE}/lib/libmilter.a)
WITH_SENDMAIL_BASE=yes
.endif

.if defined(WITH_SENDMAIL_BASE)
.if !exists(/usr/lib/libmilter.a)
BROKEN=		Base system sendmail not found or too old, rebuild with WITH_SENDMAIL_PORT=yes
.endif
.else
BUILD_DEPENDS+=	${LOCALBASE}/lib/libmilter.a:${PORTSDIR}/mail/sendmail
CONFIGURE_ARGS+=--with-sendmail=${LOCALBASE}
.endif

post-install:
.if !defined(NOPORTDOCS)
	@${MKDIR} ${DOCSDIR}
.for f in ${PORTDOCS}
	${INSTALL_DATA} ${WRKSRC}/${f} ${DOCSDIR}
.endfor
.endif
	@${CAT} ${PKGMESSAGE}

.include <bsd.port.post.mk>
