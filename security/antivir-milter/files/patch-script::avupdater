--- script/avupdater.orig	Nov 25 10:29:31 2004
+++ script/avupdater	Wed Dec  8 15:23:09 2004
@@ -5,13 +5,11 @@
 # Copyright 2002-2005 H+BEDV Datentechnik GmbH
 #
 
-PATH="/bin:/usr/bin:/usr/local/bin:/sbin:/usr/sbin:/usr/local/sbin"
-
 DAEMONNAME="antivir"
-AVDIR="/usr/lib/AntiVir"
+AVDIR="%%PREFIX%%/AntiVir"
 
 DAEMON="${AVDIR}/${DAEMONNAME}"
-DAEMONPARAMS="--updater-daemon"
+DAEMONPARAMS="--updater-daemon -q -C %%PREFIX%%/etc/antivir.conf"
 SERVICENAME="avupdater"
 OS=`uname | tr "[:upper:]" "[:lower:]"`
 PROCCMD=""
@@ -35,23 +33,22 @@
 {
 	if [ $1 -eq 0 ]
 	then
-		${ECHO} "."
+		${ECHO} -n " ${SERVICENAME}"
 	fi
 	exit $1
 }
 
 stopEXIT()
 {
-	if [ $1 -ne 1 ]
+	if [ $1 -eq 0 ]
 	then
-		${ECHO} "."
+		${ECHO} -n " ${SERVICENAME}"
 	fi
 	exit $1
 }
 
 statusEXIT()
 {
-	${ECHO} "."
 	exit $1
 }
 
@@ -104,7 +101,7 @@
 		fi
 	fi
 
-	for PROC in `$PROCCMD | grep ${DAEMONNAME}.*${DAEMONPARAMS} | grep -v grep`
+	for PROC in `$PROCCMD | grep "${DAEMONNAME}.*${DAEMONPARAMS}" | grep -v grep`
 	do
 		if [ -z "`$ECHO ${PROC} | sed -e s/[0-9]//g`" ]
 		then
@@ -115,16 +112,9 @@
 
 case "$1" in
 	start)
-		${ECHO} -n "Starting AntiVir: ${SERVICENAME}"
-
 		if [ ! -x "${DAEMON}" ]
 		then
 			# daemon missing
-
-			${ECHO} " (FAILED)"
-			${ECHO} " "
-			${ECHO} "error: ${DAEMON} missing"
-			${ECHO} " "
 			startEXIT 5
 		fi
 
@@ -144,20 +134,12 @@
 		if [ ${ERROR} -ne 0 -o -z "${PROCESSLIST}" ]
 		then
 			# daemon failed to start, there is a problem
-
-			${ECHO} " (FAILED)"
-			${ECHO} " "
-			${ECHO} "error: ${DAEMON} failed"
-			${ECHO} "See log files for details."
-			${ECHO} " "
 			startEXIT 1
 		fi
 
 		startEXIT 0
 		;;
 	stop)
-		${ECHO} -n "Stopping AntiVir: ${SERVICENAME}"
-
 		getPROCESSLIST
 		if [ -z "${PROCESSLIST}" ]
 		then
@@ -194,28 +176,21 @@
 		if [ ! -z "${PROCESSLIST}" ]
 		then
 			# there are still processes running? this may be a problem
-
-			${ECHO} " (FAILED)"
-			${ECHO} " "
-			${ECHO} "There may be processes still running."
-			${ECHO} " "
 			stopEXIT 1
 		fi
 
 		stopEXIT 0
 		;;
 	status)
-		${ECHO} -n "AntiVir Status: ${SERVICENAME} "
-
 		getPROCESSLIST
 
 		# display the results of what we found
 		if [ -z "${PROCESSLIST}" ]
 		then
-			${ECHO} -n "not running"
+			${ECHO} "FAILED ${SERVICENAME} not running"
 			statusEXIT 3
 		else
-			${ECHO} -n "running"
+			${ECHO} "OK ${SERVICENAME} running"
 			statusEXIT 0
 		fi
 		;;
