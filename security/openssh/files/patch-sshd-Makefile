--- sshd/Makefile.orig	Tue Jun 25 00:07:14 2002
+++ sshd/Makefile	Tue Jun 25 00:17:30 2002
@@ -5,8 +5,9 @@
 PROG=	sshd
 BINOWN=	root
 BINMODE=555
-BINDIR=	/usr/sbin
-MAN=	sshd.8 sshd_config.5
+BINDIR=	/sbin
+MAN8=	sshd.8
+MAN5=	sshd_config.5
 #CFLAGS+=-DHAVE_LOGIN_CAP -DBSD_AUTH
 CFLAGS+=-DHAVE_LOGIN_CAP
 
@@ -19,9 +20,10 @@
 	auth2-hostbased.c auth2-kbdint.c
 
 .include <bsd.own.mk> # for KERBEROS and AFS
+.include "../Makefile.inc"
 
 .if (${KERBEROS5:L} == "yes")
-CFLAGS+=-DKRB5 -I${DESTDIR}/usr/include/kerberosV
+CFLAGS+=-DKRB5 -I/usr/include/kerberosV
 SRCS+=  auth-krb5.c
 LDADD+= -lkrb5 -lkafs -lasn1 -lcom_err
 DPADD+= ${LIBKRB5} ${LIBKAFS} ${LIBASN1} ${LIBCOM_ERR}
@@ -33,15 +35,22 @@
 LDADD+=  -lkafs
 DPADD+=  ${LIBKAFS}
 .endif # AFS
-CFLAGS+= -DKRB4 -I${DESTDIR}/usr/include/kerberosIV
+CFLAGS+= -DKRB4 -I/usr/include/kerberosIV
 SRCS+=	auth-krb4.c
-LDADD+=	 -lkrb
+LDADD+=	 -lkrb -lcom_err
 DPADD+=	 ${LIBKRB}
 .endif # KERBEROS
 
+.if (${PAM:L} == "yes")
+CFLAGS+= -DUSE_PAM -Dmm_auth_pam_password=auth_pam_password
+SRCS+= auth-pam.c auth2-pam.c
+LDADD+= -lpam
+DPADD+= ${PAM}
+.endif
+
 .include <bsd.prog.mk>
 
-LDADD+=	-lcrypto -lutil -lz -ldes
+LDADD+=	${CRYPTOLIBS} -lcrypt -lutil -lz
 DPADD+=	${LIBCRYPTO} ${LIBUTIL} ${LIBZ} ${LIBDES}
 
 .if (${TCP_WRAPPERS:L} == "yes")
@@ -52,6 +61,6 @@
 
 .if (${SKEY:L} == "yes")
 CFLAGS+= -DSKEY
-LDADD+= -lskey
+LDADD+= -lopie
 DPADD+= ${SKEY}
 .endif
