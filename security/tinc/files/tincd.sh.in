#!/bin/sh
#

# PROVIDE: tinc
# REQUIRE: ipfilter FILESYSTEMS sysctl netif
# BEFORE:  SERVERS
# KEYWORD: nojail

# Define these tincd_* variables in one of these files:
#	/etc/rc.conf
#	/etc/rc.conf.local
#	/etc/rc.conf.d/threeproxy
#
# DO NOT CHANGE THESE DEFAULT VALUES HERE

tincd_enable=${tincd_enable:-"NO"}

. /etc/rc.subr

name="tincd"
rcvar=`set_rcvar`
command="%%PREFIX%%/sbin/tincd"
start_cmd="tincd_start"
stop_cmd="tincd_stop"
reload_cmd="tincd_restart"
extra_commands="reload"
procname=${command:-tincd}

load_rc_config $name

tincd_start()
{
	if test -z $tincd_cfg
	then
		echo "Starting tincd"
		$command
	else
		echo "Starting tincd for: $tincd_cfg"
		for cfg in $tincd_cfg
		do
			$command -n $cfg
		done
	fi
# code deliberately borrowed from /etc/rc.d/netif
	if [ -f /etc/rc.d/ipfilter ] ; then
		# Resync ipfilter
		/etc/rc.d/ipfilter resync
	fi
	if [ -f /etc/rc.d/bridge -a -n "$cmdifn" ] ; then
		/etc/rc.d/bridge start $cmdifn
	fi

}
tincd_stop()
{
	if test -z $tincd_cfg
	then
		echo "Stopping tincd"
		$command -k
	else
		echo "Stopping tincd for: $tincd_cfg"
		for cfg in $tincd_cfg
		do
			$command -n $cfg -k
		done
	fi
}
tincd_restart()
{
	if test -z $tincd_cfg
	then
		echo "Sending HUP to tincd"
		$command -k HUP
	else
		echo "Sending HUP tincd for: $tincd_cfg"
		for cfg in $tincd_cfg
		do
			$command -n $cfg -k HUP
		done
	fi
}

run_rc_command "$1"
# eof
