*** Makefile.orig	Tue Mar 26 03:22:25 1996
--- Makefile	Sat Jun 21 02:40:03 1997
***************
*** 46,52 ****
  #REAL_DAEMON_DIR=/usr/sbin
  #
  # BSD 4.4
! #REAL_DAEMON_DIR=/usr/libexec
  #
  # HP-UX SCO Unicos
  #REAL_DAEMON_DIR=/etc
--- 46,52 ----
  #REAL_DAEMON_DIR=/usr/sbin
  #
  # BSD 4.4
! REAL_DAEMON_DIR=/usr/libexec
  #
  # HP-UX SCO Unicos
  #REAL_DAEMON_DIR=/etc
***************
*** 137,143 ****
  
  freebsd:
  	@make REAL_DAEMON_DIR=$(REAL_DAEMON_DIR) STYLE=$(STYLE) \
! 	LIBS= RANLIB=ranlib ARFLAGS=rv AUX_OBJ= NETGROUP= TLI= \
  	EXTRA_CFLAGS=-DSYS_ERRLIST_DEFINED VSYSLOG= all
  
  linux:
--- 137,143 ----
  
  freebsd:
  	@make REAL_DAEMON_DIR=$(REAL_DAEMON_DIR) STYLE=$(STYLE) \
! 	LIBS= RANLIB=ranlib ARFLAGS=rv AUX_OBJ= NETGROUP=-DNETGROUP TLI= \
  	EXTRA_CFLAGS=-DSYS_ERRLIST_DEFINED VSYSLOG= all
  
  linux:
***************
*** 361,367 ****
  # the ones provided with this source distribution. The environ.c module
  # implements setenv(), getenv(), and putenv().
  
! AUX_OBJ= setenv.o
  #AUX_OBJ= environ.o
  #AUX_OBJ= environ.o strcasecmp.o
  
--- 361,367 ----
  # the ones provided with this source distribution. The environ.c module
  # implements setenv(), getenv(), and putenv().
  
! #AUX_OBJ= setenv.o
  #AUX_OBJ= environ.o
  #AUX_OBJ= environ.o strcasecmp.o
  
***************
*** 424,430 ****
  # host name aliases. Compile with -DSOLARIS_24_GETHOSTBYNAME_BUG to work
  # around this. The workaround does no harm on other Solaris versions.
  
! BUGS = -DGETPEERNAME_BUG -DBROKEN_FGETS -DLIBC_CALLS_STRTOK
  #BUGS = -DGETPEERNAME_BUG -DBROKEN_FGETS -DINET_ADDR_BUG
  #BUGS = -DGETPEERNAME_BUG -DBROKEN_FGETS -DSOLARIS_24_GETHOSTBYNAME_BUG
  
--- 424,430 ----
  # host name aliases. Compile with -DSOLARIS_24_GETHOSTBYNAME_BUG to work
  # around this. The workaround does no harm on other Solaris versions.
  
! #BUGS = -DGETPEERNAME_BUG -DBROKEN_FGETS -DLIBC_CALLS_STRTOK
  #BUGS = -DGETPEERNAME_BUG -DBROKEN_FGETS -DINET_ADDR_BUG
  #BUGS = -DGETPEERNAME_BUG -DBROKEN_FGETS -DSOLARIS_24_GETHOSTBYNAME_BUG
  
***************
*** 442,448 ****
  # If your system supports vsyslog(), comment out the following definition.
  # If in doubt leave it in, it won't harm.
  
! VSYSLOG	= -Dvsyslog=myvsyslog
  
  # End of the system dependencies.
  #################################
--- 442,448 ----
  # If your system supports vsyslog(), comment out the following definition.
  # If in doubt leave it in, it won't harm.
  
! #VSYSLOG	= -Dvsyslog=myvsyslog
  
  # End of the system dependencies.
  #################################
***************
*** 461,467 ****
  # Uncomment the next definition to turn on the language extensions
  # (examples: allow, deny, banners, twist and spawn).
  # 
! #STYLE	= -DPROCESS_OPTIONS	# Enable language extensions.
  
  ################################################################
  # Optional: Changing the default disposition of logfile records
--- 461,467 ----
  # Uncomment the next definition to turn on the language extensions
  # (examples: allow, deny, banners, twist and spawn).
  # 
! STYLE	= -DPROCESS_OPTIONS	# Enable language extensions.
  
  ################################################################
  # Optional: Changing the default disposition of logfile records
***************
*** 484,490 ****
  #
  # The LOG_XXX names below are taken from the /usr/include/syslog.h file.
  
! FACILITY= LOG_MAIL	# LOG_MAIL is what most sendmail daemons use
  
  # The syslog priority at which successful connections are logged.
  
--- 484,491 ----
  #
  # The LOG_XXX names below are taken from the /usr/include/syslog.h file.
  
! #FACILITY= LOG_MAIL	# LOG_MAIL is what most sendmail daemons use
! FACILITY= LOG_AUTH
  
  # The syslog priority at which successful connections are logged.
  
***************
*** 559,565 ****
  # look for access control information. Watch out for the quotes and
  # backslashes when you make changes.
  
! TABLES	= -DHOSTS_DENY=\"/etc/hosts.deny\" -DHOSTS_ALLOW=\"/etc/hosts.allow\"
  
  ####################################################
  # Optional: dealing with host name/address conflicts
--- 560,566 ----
  # look for access control information. Watch out for the quotes and
  # backslashes when you make changes.
  
! TABLES	= -DHOSTS_DENY=\"${PREFIX}/etc/hosts.deny\" -DHOSTS_ALLOW=\"${PREFIX}/etc/hosts.allow\"
  
  ####################################################
  # Optional: dealing with host name/address conflicts
***************
*** 579,585 ****
  # Paranoid mode implies hostname lookup. In order to disable hostname
  # lookups altogether, see the next section.
  
! PARANOID= -DPARANOID
  
  ########################################
  # Optional: turning off hostname lookups
--- 580,586 ----
  # Paranoid mode implies hostname lookup. In order to disable hostname
  # lookups altogether, see the next section.
  
! #PARANOID= -DPARANOID
  
  ########################################
  # Optional: turning off hostname lookups
***************
*** 625,633 ****
  # Protection against weird shells or weird make programs.
  
  SHELL	= /bin/sh
! .c.o:;	$(CC) $(CFLAGS) -c $*.c
  
! CFLAGS	= -O -DFACILITY=$(FACILITY) $(ACCESS) $(PARANOID) $(NETGROUP) \
  	$(BUGS) $(SYSTYPE) $(AUTH) $(UMASK) \
  	-DREAL_DAEMON_DIR=\"$(REAL_DAEMON_DIR)\" $(STYLE) $(KILL_OPT) \
  	-DSEVERITY=$(SEVERITY) -DRFC931_TIMEOUT=$(RFC931_TIMEOUT) \
--- 626,639 ----
  # Protection against weird shells or weird make programs.
  
  SHELL	= /bin/sh
! PREFIX  = /usr/local
! 
! .SUFFIXES: .c .so .o
!   
! .c.so:
! 	${CC} -fpic -DPIC ${CFLAGS} -c ${.IMPSRC} -o ${.TARGET}
  
! CFLAGS  += -DFACILITY=$(FACILITY) $(ACCESS) $(PARANOID) $(NETGROUP) \
  	$(BUGS) $(SYSTYPE) $(AUTH) $(UMASK) \
  	-DREAL_DAEMON_DIR=\"$(REAL_DAEMON_DIR)\" $(STYLE) $(KILL_OPT) \
  	-DSEVERITY=$(SEVERITY) -DRFC931_TIMEOUT=$(RFC931_TIMEOUT) \
***************
*** 652,660 ****
  	refuse.c tcpdchk.8 setenv.c inetcf.c inetcf.h scaffold.c \
  	scaffold.h tcpdmatch.8 README.NIS
  
! LIB	= libwrap.a
  
- all other: config-check tcpd tcpdmatch try-from safe_finger tcpdchk
  
  # Invalidate all object files when the compiler options (CFLAGS) have changed.
  
--- 658,687 ----
  	refuse.c tcpdchk.8 setenv.c inetcf.c inetcf.h scaffold.c \
  	scaffold.h tcpdmatch.8 README.NIS
  
! LIB     = libwrap.a
! SLIB    = libwrap.so.7.4
! 
! all other: config-check $(LIB) $(SLIB) tcpd tcpdmatch try-from safe_finger tcpdchk
! 
! install:
! 	${INSTALL} -o ${BINOWN} -g ${BINGRP} -c -m 644 \
! 		tcpd.h ${PREFIX}/include
! 	${INSTALL} -o ${BINOWN} -g ${BINGRP} -c -m 644 \
! 		$(LIB) $(SLIB) ${PREFIX}/lib
! 	ranlib ${PREFIX}/lib/$(LIB)
! 	${INSTALL} -o ${BINOWN} -g ${BINGRP} -cs -m ${BINMODE} \
! 		tcpd ${PREFIX}/libexec
! 	${INSTALL} -o ${BINOWN} -g ${BINGRP} -cs -m ${BINMODE} \
! 		tcpdchk tcpdmatch ${PREFIX}/sbin
! 	${INSTALL} -o ${BINOWN} -g ${BINGRP} -cs -m ${BINMODE} \
! 		try-from safe_finger ${PREFIX}/bin
! 	${INSTALL} -o ${MANOWN} -g ${MANGRP} -c -m ${MANMODE} \
! 		tcpd.8 tcpdchk.8 tcpdmatch.8 ${PREFIX}/man/man8
! 	${INSTALL} -o ${MANOWN} -g ${MANGRP} -c -m ${MANMODE} \
! 		hosts_access.3 ${PREFIX}/man/man3
! 	${INSTALL} -o ${MANOWN} -g ${MANGRP} -c -m ${MANMODE} \
! 		hosts_access.5 hosts_options.5 ${PREFIX}/man/man5
  
  
  # Invalidate all object files when the compiler options (CFLAGS) have changed.
  
***************
*** 671,697 ****
  	$(AR) $(ARFLAGS) $(LIB) $(LIB_OBJ)
  	-$(RANLIB) $(LIB)
  
! tcpd:	tcpd.o $(LIB)
! 	$(CC) $(CFLAGS) -o $@ tcpd.o $(LIB) $(LIBS)
  
! miscd:	miscd.o $(LIB)
! 	$(CC) $(CFLAGS) -o $@ miscd.o $(LIB) $(LIBS)
  
! safe_finger: safe_finger.o $(LIB)
! 	$(CC) $(CFLAGS) -o $@ safe_finger.o $(LIB) $(LIBS)
  
  TCPDMATCH_OBJ = tcpdmatch.o fakelog.o inetcf.o scaffold.o
  
! tcpdmatch: $(TCPDMATCH_OBJ) $(LIB)
! 	$(CC) $(CFLAGS) -o $@ $(TCPDMATCH_OBJ) $(LIB) $(LIBS)
  
! try-from: try-from.o fakelog.o $(LIB)
! 	$(CC) $(CFLAGS) -o $@ try-from.o fakelog.o $(LIB) $(LIBS)
  
  TCPDCHK_OBJ = tcpdchk.o fakelog.o inetcf.o scaffold.o
  
! tcpdchk: $(TCPDCHK_OBJ) $(LIB)
! 	$(CC) $(CFLAGS) -o $@ $(TCPDCHK_OBJ) $(LIB) $(LIBS)
  
  shar:	$(KIT)
  	@shar $(KIT)
--- 698,728 ----
  	$(AR) $(ARFLAGS) $(LIB) $(LIB_OBJ)
  	-$(RANLIB) $(LIB)
  
! $(SLIB): $(LIB_OBJ:S/o$/so/g) shdata.so
! 	rm -f $(SLIB)
! 	ld -Bshareable -o $(SLIB) $(LIB_OBJ:S/o$/so/g) shdata.so
! 
! tcpd:   tcpd.o $(SLIB)
! 	$(CC) $(CFLAGS) -o $@ tcpd.o -L. -lwrap $(LIBS)
  
! miscd:  miscd.o $(SLIB)
! 	$(CC) $(CFLAGS) -o $@ miscd.o -L. -lwrap $(LIBS)
  
! safe_finger: safe_finger.o $(SLIB)
! 	$(CC) $(CFLAGS) -o $@ safe_finger.o -L. -lwrap $(LIBS)
  
  TCPDMATCH_OBJ = tcpdmatch.o fakelog.o inetcf.o scaffold.o
  
! tcpdmatch: $(TCPDMATCH_OBJ) $(SLIB)
! 	$(CC) $(CFLAGS) -o $@ $(TCPDMATCH_OBJ) -L. -lwrap $(LIBS)
  
! try-from: try-from.o fakelog.o $(SLIB)
! 	$(CC) $(CFLAGS) -o $@ try-from.o fakelog.o -L. -lwrap $(LIBS)
  
  TCPDCHK_OBJ = tcpdchk.o fakelog.o inetcf.o scaffold.o
  
! tcpdchk: $(TCPDCHK_OBJ) $(SLIB)
! 	$(CC) $(CFLAGS) -o $@ $(TCPDCHK_OBJ) -L. -lwrap $(LIBS)
  
  shar:	$(KIT)
  	@shar $(KIT)
***************
*** 707,713 ****
  
  clean:
  	rm -f tcpd miscd safe_finger tcpdmatch tcpdchk try-from *.[oa] core \
! 	cflags
  
  tidy:	clean
  	chmod -R a+r .
--- 738,744 ----
  
  clean:
  	rm -f tcpd miscd safe_finger tcpdmatch tcpdchk try-from *.[oa] core \
! 	cflags *.so $(SLIB)
  
  tidy:	clean
  	chmod -R a+r .
*** /dev/null	Thu Jan 25 06:52:04 1996
--- shdata.c	Thu Jan 25 06:54:34 1996
***************
*** 0 ****
--- 1,2 ----
+ int allow_severity;
+ int deny_severity;
