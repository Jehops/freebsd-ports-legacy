Index: bin/Makefile
===================================================================
RCS file: /home/cvs/pkgtools/bin/Makefile,v
retrieving revision 1.6
diff -u -u -0 -r1.6 Makefile
--- bin/Makefile	26 Jan 2002 23:57:34 -0000	1.6
+++ bin/Makefile	7 Feb 2004 08:49:02 -0000
@@ -7,3 +7 @@
-SCRIPTS=	${BUILDDIR}/make_describe_pass1 \
-		${BUILDDIR}/make_describe_pass2 \
-		${BUILDDIR}/pkg_fetch \
+SCRIPTS=	${BUILDDIR}/pkg_fetch \
Index: bin/portupgrade
===================================================================
RCS file: /home/cvs/pkgtools/bin/portupgrade,v
retrieving revision 1.220
diff -u -u -0 -r1.220 portupgrade
--- bin/portupgrade	23 Jul 2003 12:23:03 -0000	1.220
+++ bin/portupgrade	22 Aug 2003 07:41:57 -0000
@@ -174,0 +175 @@
+  $new_force = false
@@ -327,2 +328,7 @@
-		    "packages (default: #{MYNAME == 'portinstall' ? 'on' : 'off'})") {
-      |$new|
+		    "packages; Specified twice, always install a new" << NEXTLINE <<
+		    "one instead of upgrading (default: #{MYNAME == 'portinstall' ? 'on' : 'off'})") {
+      if $new
+	$new_force = true
+      else
+	$new = true
+      end
Index: lib/pkgdb.rb
===================================================================
RCS file: /home/cvs/pkgtools/lib/pkgdb.rb,v
retrieving revision 1.112
diff -u -u -0 -r1.112 pkgdb.rb
--- lib/pkgdb.rb	23 Jul 2003 12:23:05 -0000	1.112
+++ lib/pkgdb.rb	7 Feb 2004 08:52:43 -0000
@@ -45,2 +44,0 @@
-    :make_describe_pass1	=> "#{PREFIX}/sbin/make_describe_pass1",
-    :make_describe_pass2	=> "#{PREFIX}/sbin/make_describe_pass2",
Index: lib/portsdb.rb
===================================================================
RCS file: /home/cvs/pkgtools/lib/portsdb.rb,v
retrieving revision 1.78
diff -u -u -0 -r1.78 portsdb.rb
--- lib/portsdb.rb	23 Jul 2003 12:23:05 -0000	1.78
+++ lib/portsdb.rb	7 Feb 2004 08:52:26 -0000
@@ -340,18 +340 @@
-    if true
-      system %`
-	#{PkgDB::command(:make_describe_pass1)} |
-	#{PkgDB::command(:make_describe_pass2)} |
-	(cd #{abs_ports_dir} && perl Tools/make_index) |
-	sed -e 's./.\001.g' |
-	sort -t '|' +1 -2 |
-	sed -e 's.\001./.g' > #{tmp}
-      `
-    else
-      system %`
-	cd #{abs_ports_dir} && (make describe ECHO_MSG='echo > /dev/null' 2> /dev/null |
-	perl Tools/make_index) |
-	sed -e 's./.\001.g' |
-	sort -t '|' +1 -2 |
-	sed -e 's.\001./.g' > #{tmp}
-      `
-    end
+    system "cd #{abs_ports_dir} && make INDEXFILE=INDEX.tmp index && mv INDEX.tmp #{tmp}"
