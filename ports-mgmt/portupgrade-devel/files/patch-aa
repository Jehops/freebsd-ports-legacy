Index: pkgdb.rb
===================================================================
RCS file: /home/cvs/pkgtools/pkgdb.rb,v
retrieving revision 1.13
diff -u -r1.13 pkgdb.rb
--- pkgdb.rb	2001/05/29 19:12:44	1.13
+++ pkgdb.rb	2001/05/29 21:28:33
@@ -113,9 +113,20 @@
 
   def glob(pattern = '*')
     list = []
+    complete = false
 
-    Dir.glob(File.join(@db_dir, pattern)).sort.each do |pkgname|
+    g = Dir.glob(File.join(@db_dir, pattern))
+    if g.empty?
+      complete = true
+      g = Dir.glob(File.join(@db_dir, pattern + '-*'))
+    end
+    
+    g.sort.each do |pkgname|
       pkgname.slice!(0, @db_dir.size + 1)
+
+      if complete
+	/^#{Regexp.quote(pattern)}-[^\-]+$/ =~ pkgname or next
+      end
 
       next unless installed?(pkgname)
 
Index: portversion
===================================================================
RCS file: /home/cvs/pkgtools/portversion,v
retrieving revision 1.4
diff -u -r1.4 portversion
--- portversion	2001/05/29 20:38:32	1.4
+++ portversion	2001/05/29 21:32:00
@@ -208,7 +208,7 @@
   newpkg = nil
 
   if $?
-    return [5, nil]
+#    return [5, nil]
   end
 
   begin
