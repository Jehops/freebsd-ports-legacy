Index: bin/portupgrade
===================================================================
RCS file: /cvsroot/portupgrade/pkgtools/bin/portupgrade,v
retrieving revision 1.49
retrieving revision 1.50
diff -u -r1.49 -r1.50
--- bin/portupgrade	4 Feb 2008 11:34:20 -0000	1.49
+++ bin/portupgrade	10 Feb 2008 12:04:39 -0000	1.50
@@ -617,7 +617,11 @@
 	    not_need_upgrade = []
 	    upgrade_tasks.each do |task|
 	      pkg = PkgInfo.new(task)
-	      origin = $pkgdb.origin(task)
+	      if task == first && $origin
+		origin = $origin
+	      else
+		origin = $pkgdb.origin(task)
+	      end
 	      if !origin.nil?
 		begin
 		  name = get_pkgname(origin)
@@ -625,6 +629,10 @@
 		  $results << PkgResult.new(origin, :ignored, e.message)
 		  not_need_upgrade << task
 		  next
+		rescue PortDirError => e
+		  $results << PkgResult.new(origin, :ignored, e.message)
+		  not_need_upgrade << task
+		  next
 		end
 		if name == ''
 		  warning_message "There are errors in a meta info for #{task}"
