--- bin/portupgrade.orig	2008-02-11 02:20:02.000000000 +0300
+++ bin/portupgrade	2008-02-11 19:12:49.000000000 +0300
@@ -647,7 +647,8 @@
 		  end
 		  depends |= dep
 		end
-		install_tasks |= get_notinstalled_depends(origin)
+		# XXX It makes more problems than solves
+		#install_tasks |= get_notinstalled_depends(origin)
 	      end
 	    end
 	    upgrade_tasks -= not_need_upgrade
@@ -656,8 +657,10 @@
 	    if $upward_recursive
 	      STDERR.print '[Exclude up-to-date packages '
 	      not_need_upgrade = []
+	      not_need_upgrade << ''
 	      depends.each do |task|
 		STDERR.print '.'
+		next if task == ''
 		pkg = PkgInfo.new(task)
 		origin = $pkgdb.origin(task)
 		if !origin.nil?
