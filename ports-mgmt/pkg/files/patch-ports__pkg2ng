--- ./ports/pkg2ng.orig	2012-07-20 22:06:38.000000000 +0200
+++ ./ports/pkg2ng	2012-07-30 00:16:30.916916951 +0200
@@ -11,12 +11,12 @@
 ARCH=$( uname -m )
 failed_pkgs=""
 MOVED=0
+DBDIR="/var/db"
+PKGDB="${DBDIR}/pkg"
+PKGBAK="${DBDIR}/pkg.bak"
 
 for PKG in $( pkg_info -Ea )
 do
-	DBDIR="/var/db"
-	PKGDB="${DBDIR}/pkg"
-	PKGBAK="${DBDIR}/pkg.bak"
 	DB="${PKGDB}/${PKG}"
 	DESC="${DB}/+DESC"
 	if [ ! -e "${PKGBAK}" ]; then
@@ -84,10 +84,6 @@
 		failed_pkgs="${failed_pkgs} ${PKG}"
 	else
 		rm -rf ${MANIFEST}
-		if [ -e ${DB} ]; then
-			mv ${DB} ${PKGBAK}/${PKG}
-			MOVED=1
-		fi
 	fi
 
 	rm -rf ${MDIR}
@@ -101,6 +97,16 @@
 	echo "" >&2
 	echo "!!! Some packages failed to register !!!" >&2
 	echo "Failed packages: ${failed_pkgs}" >&2
+else
+	for PKG in $( pkg_info -Ea ); do
+		DB="${PKGDB}/${PKG}"
+		if [ -e ${DB} ]; then
+			mv ${DB} ${PKGBAK}/${PKG}
+			MOVED=1
+		fi
+	done
+	echo "Conversion has been successfully finished"
+	echo "Your old packages database has been moved to: ${PKGBAK}."
 fi
 
 # Delete the portupgrade pkgdb to avoid discrepencies. It will be auto recreated.
