--- scripts/pdfnup.orig	2005-01-25 22:19:21.000000000 +0300
+++ scripts/pdfnup	2008-12-29 20:00:44.000000000 +0300
@@ -23,12 +23,17 @@
 ##  
 ##  First say where your "pdflatex" program lives:
 ##
-pdflatex=pdflatex
+pdflatex="__LOCALBASE__"/bin/pdflatex
 #pdflatex="pdflatex.exe"    ## this for Windows computers
 ##
 ##  Next a permitted location for temporary files on your system:
 ##
-tempfileDir="/var/tmp" ## /var/tmp is standard on many unix systems
+## /var/tmp is standard on most unix systems
+tempfileDir=`mktemp -dq /var/tmp/pdfnup.XXXXXXXX`
+if [ -z "$tempfileDir" ]; then
+	echo "pdfnup: unable to create temporary directory"
+	exit 2
+fi
 #tempfileDir="C:/tmp"  ## use something like this under Windows
 ##
 ##  Now specify the default settings for pdfnup:
@@ -57,12 +62,12 @@
 for d in /etc /usr/share/etc /usr/local/share /usr/local/etc
 do if test -f $d/pdfnup.conf; then
      echo "Reading site configuration from $d/pdfnup.conf"
-     source $d/pdfnup.conf
+     . $d/pdfnup.conf
    fi 
 done
 if test -f ~/.pdfnup.conf; then 
    echo "Reading user defaults from ~/.pdfnup.conf";
-   source ~/.pdfnup.conf; 
+   . ~/.pdfnup.conf; 
 fi
 #######################################################################
 ##
@@ -134,7 +139,7 @@
 ##
 ##  Check that necessary LaTeX packages are installed
 ##
-PATH=`dirname "$pdflatex"`:$PATH
+PATH="$PATH":"__LOCALBASE__"/bin
 export PATH
 case `kpsewhich pdfpages.sty` in
 	"") echo "pdfnup: pdfpages.sty not installed"; exit 1;;
