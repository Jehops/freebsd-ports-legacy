#!/bin/sh

# The subdirectory searching in kpathsearch is bugged for some paths
# so let's disable the feature (It can be reenabled with the proper environment
# variables though.
#
cd $WRKSRC/kpathsea || exit 1;
mv paths.h.in paths.h.in.orig || exit 1;
sed -e s://:/: <paths.h.in.orig >paths.h.in || exit 1;

cd $WRKSRC || exit 1;
LEX=lex; YACC=yacc; export LEX YACC
./configure --prefix=$PREFIX

cd $WRKDIR || exit 1;
rm -rf mf
mkdir mf
cd mf
for f in `find ../cm -name \*.mf -print`; do
  if [ ! -f `basename $f` ]; then 
    ln -s $f
  fi 
done
for f in `find ../lib -name \*.mf -print`; do
  if [ ! -f `basename $f` ]; then
    ln -s $f;
  fi
done
if [ -d ../latex ]; then
  for f in `find ../latex -name \*.mf -print`; do 
    if [ ! -f `basename $f` ]; then 
      ln -s $f
    fi
  done
fi

cp $DISTDIR/modes.mf . || exit 1;

exit 0;
