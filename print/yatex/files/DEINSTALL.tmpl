#!/bin/sh

pkgname=$1

CP=${CP:-%CP%}
ECHO=${ECHO:-%ECHO%}
GREP=${GREP:-%GREP%}
RM=${RM:-%RM%}
SED=${SED:-%SED%}

infodir=${INFODIR:-%INFODIR%}
infofiles=${INFOFILES:-%INFOFILES%}
elispdir=${ELISPDIR:-%ELISPDIR%}

OptionStart=";;; configuration options for ${pkgname}"
OptionEnd=";;; End of configuration options for ${pkgname}"

if [ "X$2" = X"DEINSTALL" ]; then
	${ECHO} "Deleting entry for \"${pkgname}\" from ${infodir}/dir"
	for file in `echo  ${infofiles} | ${SED} "s,:, ,g"`; do
		install-info --delete ${infodir}/${file} ${infodir}/dir
	done
	if  [ "`grep \"^${OptionStart}\"  ${elispdir}/site-start.el`" ]; then 
		${ECHO} "Deleting entry for \"${pkgname}\" from ${elispdir}/site-start.el"
		${SED} -e "/^${OptionStart}/,/^${OptionEnd}/d" \
		    ${elispdir}/site-start.el > ${elispdir}/site-start.el.bak
		${CP} ${elispdir}/site-start.el.bak ${elispdir}/site-start.el
		${RM} ${elispdir}/site-start.el.bak
	fi
else
	exit 0
fi
