--- configure.orig	Mon Dec 11 15:16:01 2006
+++ configure	Mon Dec 11 15:28:29 2006
@@ -19868,6 +19868,74 @@
 
 
 
+# Check whether --with-curl-config was given.
+if test "${with_curl_config+set}" = set; then
+  withval=$with_curl_config; curl_config="$withval"
+else
+  curl_config=""
+fi
+
+
+if test "X$curl_config" != "X" ; then
+  { echo "$as_me:$LINENO: checking for $curl_config" >&5
+echo $ECHO_N "checking for $curl_config... $ECHO_C" >&6; }
+
+  if test -f $curl_config ; then
+    CURL_CONFIG=$curl_config
+    { echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6; }
+  else
+    { echo "$as_me:$LINENO: result: no - searching PATH" >&5
+echo "${ECHO_T}no - searching PATH" >&6; }
+  fi
+fi
+if test "X$CURL_CONFIG" = "X"; then
+  for ac_prog in curl-config
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+{ echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
+if test "${ac_cv_prog_CURL_CONFIG+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -n "$CURL_CONFIG"; then
+  ac_cv_prog_CURL_CONFIG="$CURL_CONFIG" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
+    ac_cv_prog_CURL_CONFIG="$ac_prog"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+IFS=$as_save_IFS
+
+fi
+fi
+CURL_CONFIG=$ac_cv_prog_CURL_CONFIG
+if test -n "$CURL_CONFIG"; then
+  { echo "$as_me:$LINENO: result: $CURL_CONFIG" >&5
+echo "${ECHO_T}$CURL_CONFIG" >&6; }
+else
+  { echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6; }
+fi
+
+
+  test -n "$CURL_CONFIG" && break
+done
+
+fi
+
+oCPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS `$CURL_CONFIG --cflags`"
 
 for ac_header in errno.h stdlib.h unistd.h string.h limits.h dmalloc.h getopt.h sys/stat.h curl/curl.h libxml/nanohttp.h sys/param.h sys/time.h
 do
@@ -20037,6 +20105,9 @@
 
 done
 
+CPPFLAGS="$oCPPFLAGS"
+LIBS="$oLIBS"
+
 { echo "$as_me:$LINENO: checking whether time.h and sys/time.h may both be included" >&5
 echo $ECHO_N "checking whether time.h and sys/time.h may both be included... $ECHO_C" >&6; }
 if test "${ac_cv_header_time+set}" = set; then
@@ -23931,72 +24002,6 @@
 fi
 
 
-# Check whether --with-curl-config was given.
-if test "${with_curl_config+set}" = set; then
-  withval=$with_curl_config; curl_config="$withval"
-else
-  curl_config=""
-fi
-
-
-if test "X$curl_config" != "X" ; then
-  { echo "$as_me:$LINENO: checking for $curl_config" >&5
-echo $ECHO_N "checking for $curl_config... $ECHO_C" >&6; }
-
-  if test -f $curl_config ; then
-    CURL_CONFIG=$curl_config
-    { echo "$as_me:$LINENO: result: yes" >&5
-echo "${ECHO_T}yes" >&6; }
-  else
-    { echo "$as_me:$LINENO: result: no - searching PATH" >&5
-echo "${ECHO_T}no - searching PATH" >&6; }
-  fi
-fi
-if test "X$CURL_CONFIG" = "X"; then
-  for ac_prog in curl-config
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_CURL_CONFIG+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  if test -n "$CURL_CONFIG"; then
-  ac_cv_prog_CURL_CONFIG="$CURL_CONFIG" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_CURL_CONFIG="$ac_prog"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-fi
-fi
-CURL_CONFIG=$ac_cv_prog_CURL_CONFIG
-if test -n "$CURL_CONFIG"; then
-  { echo "$as_me:$LINENO: result: $CURL_CONFIG" >&5
-echo "${ECHO_T}$CURL_CONFIG" >&6; }
-else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
-fi
-
-
-  test -n "$CURL_CONFIG" && break
-done
-
-fi
-
 
 oLIBS="$LIBS"
 
@@ -25623,7 +25628,9 @@
 
 oCPPFLAGS="$CPPFLAGS"
 if test "X$CURL_CONFIG" != X; then
+  oCPPFLAGS="$CPPFLAGS"
   oLIBS="$LIBS"
+  CPPFLAGS="$CPPFLAGS `$CURL_CONFIG --cflags`"
   LIBS="$LIBS `$CURL_CONFIG --libs`"
   { echo "$as_me:$LINENO: checking for curl_easy_init" >&5
 echo $ECHO_N "checking for curl_easy_init... $ECHO_C" >&6; }
@@ -25728,6 +25735,7 @@
   have_curl_easy_init=no
 fi
 
+  CPPFLAGS="$oCPPFLAGS"
   LIBS="$oLIBS"
   { echo "$as_me:$LINENO: checking for libcurl library" >&5
 echo $ECHO_N "checking for libcurl library... $ECHO_C" >&6; }
